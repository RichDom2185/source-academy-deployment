import{z as Re,a1 as Le,j as e,y as ae,d as w,B as ms,a2 as ps,a3 as dt,a4 as ut,a5 as gs,a6 as kt,c as J,a7 as fs,a8 as Cs,a9 as bs,I as Te,aa as de,ab as vs,ac as xs,ad as Ts,e as W,V as wt,r as i,N as he,h as jt,ae as ht,H as yt,af as ks,ag as ue,S as He,ah as _,ai as ne,aj as xe,ak as Ge,al as Et,am as ws,an as Nt,ao as js,ap as ys,aq as Es,ar as Ns,R as me,as as Ss,at as Ds,C as St,au as mt,av as pt,aw as Ms,ax as As,ay as Os,az as Bs,p as De,u as Dt,a as Mt,aA as Is,aB as Ps,aC as Rs,aD as Ls,aE as Hs,aF as Gs,aG as Vs,aH as Q,aI as Us,aJ as Qs,aK as gt,aL as _s,aM as qs,aN as Fs,aO as Ws,aP as Ys,aQ as zs,aR as Js,aS as $s,aT as Xs,aU as Ks,aV as Zs,aW as ea,D as ft,b as ta,aX as sa,aY as aa,n as na,U as oa,aZ as Me,a_ as ia,a$ as ce,b0 as ra,b1 as ca}from"./index-6556bce7.js";import{C as Oe,d as la,a as da,b as ua,c as ha,e as ma,f as pa}from"./ControlBarSaveButton-e8a7a8aa.js";import{C as ke}from"./card-6826540c.js";import{C as At,M as ga}from"./MobileWorkspace-d152242a.js";import{_ as fa,c as Ca,W as ba,a as va,b as xa,d as Ta}from"./Workspace-1e8fa32a.js";import{S as ka}from"./SideContentTestcaseCard-89ee8f58.js";const wa=t=>{const{isMobileBreakpoint:n}=Re(),o=Le(l=>l.session.githubOctokitObject).octokit!==void 0?e.jsx(ae,{label:"Log Out",icon:w.GIT_BRANCH,onClick:t.onClickLogOut}):e.jsx(ae,{label:"Log In",icon:w.GIT_BRANCH,onClick:t.onClickLogIn});return e.jsx(ms,{large:!n,children:o})},ja=t=>{const n=s=>{t.changeCourseHandler(s)};return e.jsxs(ps,{className:"NavigationBar secondary-navbar",children:[e.jsx(dt,{align:ut.LEFT,children:t.types?.map((s,o)=>e.jsxs(gs,{to:`/githubassessments/${kt(s)}`,state:{courses:t.courses,assessmentTypeOverviews:t.assessmentTypeOverviews,selectedCourse:t.selectedCourse},className:({isActive:l})=>J("NavigationBar__link",fs,Cs,{[bs]:l}),children:[e.jsx(Te,{icon:o<5?Ct[o]:Ct[0]}),e.jsx("div",{className:"navbar-button-text hidden-xs hidden-sm",children:s})]},s))}),e.jsxs(dt,{align:ut.RIGHT,children:[t.octokit!==void 0&&t.types&&t.types.length>0&&e.jsx(de,{disabled:!0,leftElement:e.jsx(vs,{content:e.jsx(xs,{children:t.courses?.map(s=>e.jsx(Ts,{onClick:n,text:s},s))}),placement:"bottom-end",children:e.jsx(W,{minimal:!0,rightIcon:"caret-down","aria-label":"choose"})}),placeholder:"Select Course",onChange:t.changeCourseHandler,value:t.selectedCourse},"courseselect"),e.jsx(wa,{onClickLogIn:t.handleGitHubLogIn,onClickLogOut:t.handleGitHubLogOut},"loginlogout")]})]})},Ct=[w.FLAME,w.LIGHTBULB,w.PREDICTIVE_ANALYSIS,w.COMPARISON,w.MANUAL],ya=t=>{const{isMobileBreakpoint:n}=Re(),s=wt();let o;const l=i.useMemo(()=>e.jsx(W,{icon:w.ADD,onClick:()=>s("/githubassessments/editor"),children:"Create a New Assessment!"}),[s]),d=i.useMemo(()=>e.jsx(W,{icon:w.REFRESH,onClick:t.refreshAssessmentOverviews,children:"Refresh Assessments"}),[t.refreshAssessmentOverviews]);if(!t.assessmentOverviews)o=e.jsxs(e.Fragment,{children:[l,e.jsx(he,{description:"Fetching assessment...",icon:e.jsx(He,{})})]});else if(t.assessmentOverviews.length===0)o=e.jsxs(e.Fragment,{children:[l,d,e.jsx(he,{title:"There are no assessments.",icon:w.FLAME})]});else{const p=t.assessmentOverviews.map(c=>Ea(c,n,s));o=e.jsxs(e.Fragment,{children:[l,d,p]})}return e.jsx("div",{className:"Assessment",style:{overflow:"auto"},children:e.jsx(Oe,{display:o,loadContentDispatch:()=>{}})})};function Ea(t,n,s){const o=n?5:3,l=t.missionRepoData.repoOwner+"/"+t.missionRepoData.repoName,d=t.dueDate.toDateString(),p=new Date(864e13)>t.dueDate,c=new Date>t.dueDate,g=t.link!==void 0;let h="Open",f=()=>s("/githubassessments/editor",{state:t});return g?(h="Accept",f=()=>window.open(t.link)):c&&(h="Review Answers"),e.jsx("div",{children:e.jsxs(ke,{className:"row listing",elevation:jt.ONE,children:[e.jsx("div",{className:`col-xs-${String(o)} listing-picture`,children:e.jsx("img",{alt:"Assessment",className:`cover-image-${t.title}`,src:t.coverImage?t.coverImage:la})}),e.jsxs("div",{className:`col-xs-${String(12-o)} listing-text`,children:[e.jsx("div",{className:"listing-header",children:e.jsxs(ht,{ellipsize:!0,children:[e.jsx(yt,{className:"listing-title",children:t.title}),e.jsx(ks,{children:l})]})}),e.jsx("div",{className:"listing-description",children:e.jsx(ue,{content:t.webSummary})}),e.jsxs("div",{className:"listing-footer",children:[e.jsxs(ht,{className:"listing-due-date",children:[e.jsx(Te,{className:"listing-due-icon",iconSize:12,icon:w.TIME}),p?"Due: "+d:"No due date"]}),e.jsx("div",{className:"listing-button",children:e.jsx(W,{icon:w.PLAY,minimal:!0,onClick:f,children:e.jsx("span",{className:"custom-hidden-xxxs",children:h})})})]})]})]})},l)}const Na=t=>{const n=t.mcqDisplayed?"Show MCQ Text":"Hide MCQ Text",s=t.mcqDisplayed?t.displayTextInEditor:t.displayMCQInEditor;return e.jsx(ae,{label:n,icon:w.REFRESH,onClick:s})},Be=20,Ve=t=>JSON.stringify(t,null,4),Sa=t=>{const n=t.map(s=>({answer:s.answer,program:s.program,score:s.score?s.score:0,type:s.type?s.type:"public"}));return Ve(n)},F=t=>t,M={taskDescription:{fileName:"Problem.md",isDefaultValue:t=>t==="",fromStringConverter:F,toStringConverter:F},starterCode:{fileName:"StarterCode.js",isDefaultValue:t=>t==="",fromStringConverter:F,toStringConverter:F},savedCode:{fileName:"SavedCode.js",isDefaultValue:t=>t==="",fromStringConverter:F,toStringConverter:F},testPrepend:{fileName:"TestPrepend.js",isDefaultValue:t=>t==="",fromStringConverter:F,toStringConverter:F},testPostpend:{fileName:"TestPostpend.js",isDefaultValue:t=>t==="",fromStringConverter:F,toStringConverter:F},testCases:{fileName:"TestCases.json",isDefaultValue:t=>t.length===0,fromStringConverter:JSON.parse,toStringConverter:Sa}};async function Da(t,n){const s=Ie(t.repoOwner,t.repoName,"README.md",n),o=Ie(t.repoOwner,t.repoName,".metadata",n),l=Ma(t.repoOwner,t.repoName,n),[d,p,c]=await Promise.all([s,o,l]),g=Aa(p);return{missionRepoData:t,missionBriefing:d,missionMetadata:g,tasksData:c}}async function Ma(t,n,s){const o=[];if(s===void 0)return o;const d=(await s.repos.getContent({owner:t,repo:n,path:""})).data;if(!Array.isArray(d))return o;const p=[];for(let c=1;c<=Be;c++){const g="Q"+c;if(d.find(h=>h.name===g)===void 0)break;p.push(s.repos.getContent({owner:t,repo:n,path:g}).then(h=>{if(!Array.isArray(h.data))return;const v=h.data.map(T=>T.name),b=Object.keys(M).filter(T=>v.includes(M[T].fileName)),N=b.map(async T=>{const j=M[T].fileName,k=await Ie(t,n,g+"/"+j,s);return M[T].fromStringConverter(k)});return Promise.all(N).then(T=>{const j={questionNumber:c,taskDescription:"",starterCode:"",savedCode:"",testPrepend:"",testPostpend:"",testCases:[]};for(let k=0;k<T.length;k++)j[b[k]]=T[k];j.savedCode===""&&(j.savedCode=j.starterCode),o.push(j)})}).catch(h=>{_("Error occurred while trying to retrieve file content",1e3),console.error(h)}))}return await Promise.all(p),o.sort((c,g)=>c.questionNumber-g.questionNumber),o}async function Ie(t,n,s,o){let l="";if(o===void 0)return l;try{const d=await o.repos.getContent({owner:t,repo:n,path:s});l=Buffer.from(d.data.content,"base64").toString()}catch(d){_("Error occurred while trying to retrieve file content",1e3),console.error(d)}return l}function Aa(t){try{return JSON.parse(t)}catch(n){return console.error(n),{sourceVersion:ne.Chapter.SOURCE_4}}}function Ot(t){return Ve(t)}function Oa(t,n,s,o,l,d,p){const c={},g=[];t!==n&&(c[".metadata"]=Ot(t)),s!==o&&(c["README.md"]=s);let h=0;for(;h<l.length;){const f=h+1,v="Q"+f;if(f>d.length){c[v+"/StarterCode.js"]=l[h].savedCode,c[v+"/Problem.md"]=l[h].taskDescription;const x=["testCases","testPrepend","testPostpend"];for(const b of x){const N=l[h][b];if(!M[b].isDefaultValue(N)){const j=v+"/"+M[b].fileName,k=M[b].toStringConverter(l[h][b]);c[j]=k}}}else{const x=Object.keys(M);for(const b of x){const N=l[h][b],T=d[h][b];if(!xe.isEqual(N,T)){const j=v+"/"+M[b].fileName,k=M[b].toStringConverter(l[h][b]);c[j]=k}}if(p&&c[v+"/"+M.savedCode.fileName]){const b=c[v+"/"+M.savedCode.fileName];delete c[v+"/"+M.savedCode.fileName],c[v+"/"+M.starterCode.fileName]=b}}h++}for(;h<d.length;){const f=h+1;g.push("Q"+f),h++}return[c,g]}function Ba(t,n,s){const o={};o[".metadata"]=Ot(t),o["README.md"]=n;const l=["testCases","testPrepend","testPostpend"];for(let d=0;d<s.length;d++){const c="Q"+(d+1);o[c+"/"+M.starterCode.fileName]=s[d].savedCode,o[c+"/"+M.taskDescription.fileName]=s[d].taskDescription,l.forEach(g=>{const h=s[d][g];if(!M[g].isDefaultValue(h)){const v=c+"/"+M[g].fileName,x=M[g].toStringConverter(s[d][g]);o[v]=x}})}return o}function bt(t){let n=!1;const s={answer:0,choices:[],solution:-1,type:"mcq",content:"",grade:0,id:0,library:{chapter:ne.Chapter.SOURCE_4,external:{name:"NONE",symbols:[]},globals:[]},maxGrade:0,xp:0,maxXp:0},o=t.trim();if(o.substring(0,3).toLowerCase()==="mcq"&&(n=!0),n){const l=o.substring(3,o.length);try{const d=JSON.parse(l),p=d.answer,g=d.choices.map(f=>({content:f.option,hint:f.hint})),h=d.solution;s.answer=p,s.choices=g,s.solution=h}catch{n=!1}}return[n,s]}function Ia(t){const n=t.answer,s=t.choices.map(d=>({option:d.content,hint:d.hint})),o=t.solution;return`MCQ
`+Ve({choices:s,answer:n,solution:o})}const Pa=t=>{function n(){if(t.numberOfTasks===Be){_("Cannot have more than "+Be+" Tasks in a Mission!");return}t.addNewQuestion()}return e.jsx(ae,{label:"Add Task",icon:w.ADD,onClick:n})},Ra=t=>{async function n(){if(t.numberOfTasks<=1){_("Cannot delete the only remaining task!");return}await Ge({contents:e.jsxs("div",{children:[e.jsx("p",{children:"Warning: you are about to delete a task."}),e.jsx("p",{children:"This action cannot be undone."}),e.jsx("p",{children:"Please click 'Confirm' to continue, or 'Cancel' to go back."})]}),negativeLabel:"Cancel",positiveIntent:"primary",positiveLabel:"Confirm"})&&t.deleteCurrentQuestion()}return e.jsx(ae,{label:"Delete Current Task",icon:w.DELETE,onClick:n})},La=t=>{const[n,s]=i.useState("sa-new-mission-repository");return e.jsxs(Et,{className:"missionBrowser",isOpen:!0,children:[e.jsx("div",{className:J("githubDialogHeader",ws),children:e.jsx("h3",{children:"Please confirm your save"})}),e.jsxs("div",{className:J("githubDialogBody",Nt),children:[e.jsxs("div",{children:[e.jsxs("h4",{children:["This will create a repository owned by ",t.userLogin," with the title:"]}),e.jsx(de,{onChange:o,placeholder:"Enter Repository Title",value:n})]}),e.jsxs("div",{children:[e.jsx("h4",{children:"This repository will be created with following files:"}),t.filesToCreate.map(p=>e.jsx("li",{children:p},p))]})]}),e.jsx("div",{className:J(js),children:e.jsxs("div",{className:J(ys),children:[e.jsx(W,{onClick:l,children:"Close"}),e.jsx(Es,{onClick:d,intent:Ns.PRIMARY,children:"Confirm"})]})})]});function o(p){s(p.target.value)}function l(){t.resolveDialog({confirmSave:!1,repoName:""})}function d(){if(n===""){_("Cannot create repository without title!",2e3);return}t.resolveDialog({confirmSave:!0,repoName:n})}},Bt=t=>{const[n,s]=me.useState(!1),o=t.allowEdits,l=me.useRef();return i.useEffect(()=>{function p(c){o&&(l.current&&!l.current.contains(c.target)&&s(!1),l.current&&l.current.contains(c.target)&&s(!0))}return document.addEventListener("mousedown",p),()=>{document.removeEventListener("mousedown",p)}},[o]),e.jsx("div",{ref:l,children:n?e.jsx(Ss,{onChange:d,fill:!0,growVertically:!0,defaultValue:t.content}):e.jsx(ue,{content:t.content,openLinksInNewWindow:!0})});function d(p){t.setContent(p.target.value)}},Ha=t=>{return e.jsx("div",{className:"SideContentMissionEditor",children:e.jsxs("div",{className:"SideContentMissionEditorRow",children:[e.jsx("div",{className:"SideContentMissionEditorLabelColumn",children:e.jsx(Ds,{children:"Source Version"})}),e.jsx("div",{className:"SideContentMissionEditorOptionColumn",children:e.jsx(At,{isFolderModeEnabled:t.isFolderModeEnabled,sourceChapter:t.missionMetadata.sourceVersion,sourceVariant:St.defaultSourceVariant,disabled:!1,handleChapterSelect:s},"chapter")})]})});function n(o,l){const d=Object.assign({},t.missionMetadata);d[o]=l,t.setMissionMetadata(d)}function s(o,l){n("sourceVersion",o.chapter)}},Ga=t=>{const n=t.currentTaskNumber-1,s=t.taskDescriptions,o=t.setTaskDescriptions,l=n<0||n>=s.length||s.length===0,d=l?"Welcome to Mission Mode! This is where the Task Briefing for each question will appear!":s[n],p=me.useCallback(c=>{if(l)return;const g=s.map(h=>h);g[n]=c,o(g)},[o,s,n,l]);return e.jsx("div",{children:e.jsx(Bt,{allowEdits:t.allowEdits,content:d,setContent:p})})},Va=t=>{const{index:n,testcase:s,setTestcaseProgram:o,setTestcaseExpectedResult:l,handleTestcaseEval:d,deleteTestcase:p}=t,c=i.useMemo(()=>{const N=s.result!==void 0||s.errors,T=mt.stringify(s.result)===s.answer;return{correct:N&&T,wrong:N&&!T,secret:s.type===pt.secret||s.type===pt.opaque}},[s]),g=i.useCallback(()=>{d(n)},[n,d]),h=s.program,f=s.answer,v=e.jsx(W,{className:"testcase-button",icon:w.PLAY,onClick:g}),x=e.jsx(W,{className:"testcase-button",icon:w.DELETE,onClick:()=>p(n)}),b=i.useMemo(()=>{let N="No Answer";return s.errors?N=Ms.parseError(s.errors):s.result!==void 0&&(N=mt.stringify(s.result)),N},[s]);return e.jsx("div",{className:J("EditableAutograderCard",c),children:e.jsxs(ke,{className:As,elevation:jt.ONE,children:[e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"testcase-program",value:h,onChange:N=>o(N.target.value)}),e.jsx(de,{className:"testcase-expected",value:f,onChange:N=>l(N.target.value)}),e.jsx(de,{className:"testcase-actual",value:b,readOnly:!0})]}),v,x]})})},Ua=t=>{const[n,s]=i.useState(!0),[o,l]=i.useState(!0),[d,p]=i.useState(!0),{testcases:c,testPrepend:g,testPostpend:h,allowEdits:f,handleTestcaseEval:v,setTaskTestcases:x,setTestPrepend:b,setTestPostpend:N}=t,T=i.useCallback(S=>O=>{const I=c.map(oe=>Object.assign({},oe));I[S].program=O,delete I[S].result,x(I)},[x,c]),j=i.useCallback(S=>O=>{const I=c.map(oe=>Object.assign({},oe));I[S].answer=O,delete I[S].result,x(I)},[x,c]),k=i.useCallback(()=>{const S=[...c];S.push({answer:"",program:"",score:0,type:"public"}),x(S)},[c,x]),R=i.useCallback(async S=>{if(!await Ge({title:"confirm testcase deletion",contents:"Are you sure you want to delete this testcase? This cannot be undone.",positiveLabel:"Confirm",negativeLabel:"Cancel"}))return;const I=c.slice(0,S).concat(c.slice(S+1));x(I)},[c,x]),V=i.useCallback((S,O)=>f?e.jsx(Va,{index:O,testcase:S,setTestcaseProgram:T(O),setTestcaseExpectedResult:j(O),deleteTestcase:R,handleTestcaseEval:v},O):e.jsx(ka,{index:O,testcase:S,handleTestcaseEval:v,workspaceLocation:"githubAssessment"},O),[f,R,v,T,j]),pe=i.useMemo(()=>c.length>0?e.jsxs("div",{className:"testcaseCards",children:[_a,c.map((S,O)=>V(S,O))]}):e.jsx("div",{className:"noResults",children:"There are no testcases provided for this question."}),[c,V]),$=i.useMemo(()=>e.jsx(W,{className:"collapse-button",icon:w.ADD,minimal:!0,text:"Add a new testcase",onClick:k}),[k]),H=i.useCallback(()=>{s(!n)},[n]),ee=i.useCallback(()=>{l(!o)},[o]),m=i.useCallback(()=>{p(!d)},[d]);return e.jsxs("div",{className:"Autograder",children:[e.jsxs(W,{className:"collapse-button",icon:d?w.CARET_DOWN:w.CARET_RIGHT,minimal:!0,onClick:m,children:[e.jsx("span",{children:"Testcases"}),e.jsx(Os,{content:Qa,placement:Bs.LEFT,children:e.jsx(Te,{icon:w.HELP})})]}),e.jsx(De,{isOpen:d,keepChildrenMounted:!0,children:e.jsxs("div",{className:"testcaseeditor-subcomponent",children:[pe,f&&$]})}),f&&xt("Testcase Prepend",n,H),f&&e.jsx(De,{isOpen:n,keepChildrenMounted:!0,children:e.jsx("div",{className:"testcaseeditor-subcomponent",children:vt(g,S=>b(S))})}),f&&xt("Testcase Postpend",o,ee),f&&e.jsx(De,{isOpen:o,keepChildrenMounted:!0,children:e.jsx("div",{className:"testcaseeditor-subcomponent",children:vt(h,S=>N(S))})})]})};function vt(t,n){return e.jsx(fa,{className:"react-ace",fontSize:14,highlightActiveLine:!1,mode:"javascript",onChange:n,theme:"source",value:t,width:"100%",height:"16rem"})}const Qa=e.jsxs("div",{className:"autograder-help-tooltip",children:[e.jsx("p",{children:"Click on each testcase below to execute it with the program in the editor."}),e.jsx("p",{children:"To execute all testcases at once, evaluate the program in the editor with this tab active."}),e.jsx("p",{children:"A green or red background indicates a passed or failed testcase respectively."}),e.jsx("p",{children:"Private testcases (only visible to staff when grading) have a grey background."})]}),Ae=(t,n)=>e.jsxs("div",{className:t,children:[n,e.jsx(Te,{icon:w.CARET_DOWN})]}),_a=e.jsxs("div",{className:"testcases-header",children:[Ae("header-fn","Testcase"),Ae("header-expected","Expected result"),Ae("header-actual","Actual result")]}),xt=(t,n,s)=>e.jsx(ae,{label:t,icon:n?w.CARET_DOWN:w.CARET_RIGHT,onClick:s,options:{className:"collapse-button",minimal:!0}}),le=`### Assignment Briefing (Click to Edit!)
Welcome to Assignment Creator! This is where the Briefing for each assignment will appear.

If you are on the SourceAcademy website, you may edit **this section** by clicking on it. You can also add or delete questions through the control bar.

The text written here will show up as the \`README.md\` file on the GitHub repository.

Please also refer to our instructor's guide [here](https://github.com/source-academy/general/tree/master/instructor/github) to learn more about how to use this website.

### Brief Markdown Cheatsheet
Everything here is written in Markdown.

This means that you can **bolden** or *italicize* text by adding asterisks.

Programs can be formatted through the use of triple backticks:
\`\`\`
// This is a program example
\`\`\`
If you want to in-line program snippets, rather than display it as a block, you can also use single backticks like \`this\`.

Lists can be created by adding dashes to the start of a line:
- First element
- Second element
- Third element


It is also possible to embed images, like this:

![an embedded image](https://avatars.githubusercontent.com/u/35620705?s=400&u=32f72fd1d65a0d6877ad1d5870ffa327dda754f1&v=4)

If you need a more detailed cheatsheet, please click [here](https://www.markdownguide.org/cheat-sheet/)!
`,qa=`### Problem Description (Click to Edit!)
Welcome to the Assignment Creator! This is where the problem description specific to each problem should be written.

If you are on the SourceAcademy website, you may edit **this section** by clicking on it. You can also add or delete questions through the control bar.

If you would like to add new questions outside of the website, simply duplicate this folder, and edit the \`Problem.md\` and \`StarterCode.js\` files accordingly. Make sure that the folders are named 'Q1', 'Q2', 'Q3' and so on.

Please also refer to our instructor's guide [here](https://github.com/source-academy/general/tree/master/instructor/github).

### Brief Markdown Cheatsheet
Everything here is written in Markdown.

This means that you can **bolden** or *italicize* text by adding asterisks.

Programs can be formatted through the use of triple backticks:
\`\`\`
// This is a program example
\`\`\`
If you want to in-line program snippets, rather than display it as a block, you can also use single backticks like \`this\`.

Lists can be created by adding dashes to the start of a line:
- First element
- Second element
- Third element


It is also possible to embed images, like this:

![an embedded image](https://avatars.githubusercontent.com/u/35620705?s=400&u=32f72fd1d65a0d6877ad1d5870ffa327dda754f1&v=4)

If you need a more detailed cheatsheet, please click [here](https://www.markdownguide.org/cheat-sheet/)!
`,Tt=`// Your program here!
`,be={sourceVersion:ne.Chapter.SOURCE_1},ve={questionNumber:0,taskDescription:qa,starterCode:Tt,savedCode:Tt,testPrepend:"",testPostpend:"",testCases:[]},Fa={answer:-1,choices:[],solution:-1,type:"mcq",content:"",grade:0,id:0,library:{chapter:ne.Chapter.SOURCE_4,external:{name:"NONE",symbols:[]},globals:[]},maxGrade:0,xp:0,maxXp:0},A="githubAssessment",Wa=()=>{const t=wt(),n=Dt(),s=Mt(),o=Is();o===void 0&&t("/githubassessments/login");const{handleEditorEval:l,handleEditorValueChange:d,handleReplEval:p,handleReplOutputClear:c,handleUpdateHasUnsavedChanges:g,handleUpdateWorkspace:h}=i.useMemo(()=>({handleEditorEval:()=>n(Ps(A)),handleEditorValueChange:(a,r)=>n(Rs(A,a,r)),handleReplEval:()=>n(Ls(A)),handleReplOutputClear:()=>n(Hs(A)),handleUpdateHasUnsavedChanges:a=>n(Gs(A,a)),handleUpdateWorkspace:a=>n(Vs(A,a))}),[n]),[f,v]=i.useState(be),[x,b]=i.useState(be),[N,T]=i.useState(!1),[j,k]=i.useState(le),[R,V]=i.useState(le),[pe,$]=i.useState(!1),[H,ee]=i.useState([]),[m,S]=i.useState([]),[O,I]=i.useState(!1),[oe,Ue]=i.useState(""),[C,It]=i.useState(0),[X,Qe]=i.useState(!1),[Pt,_e]=i.useState(!0),[te,qe]=i.useState(!1),[ie,Fe]=i.useState(!0),[ge,we]=i.useState(Fa),[G,We]=i.useState(void 0),K=s.state,[Rt,Lt]=i.useState(!1),[Z,je]=i.useState(Q.questionOverview),{isMobileBreakpoint:fe}=Re(),{isFolderModeEnabled:ye,activeEditorTabIndex:Ye,editorTabs:Ht,editorTestcases:Gt,hasUnsavedChanges:re,isRunning:Vt,output:Ut,replValue:Qt,sideContentHeight:_t}=Le(a=>a.workspaces.githubAssessment),q=i.useCallback((a,r)=>{It(a);const u=a-1;h({editorTabs:[{value:r[u].savedCode,highlightedLines:[],breakpoints:[]}],programPrependValue:r[u].testPrepend,programPostpendValue:r[u].testPostpend,editorTestcases:r[u].testCases}),c();const[y,E]=bt(r[u].savedCode);qe(y),we(E)},[h,c]),qt=i.useCallback(a=>{k(a),$(a!==R)},[R]),Ft=i.useCallback(a=>{v(a),T(!xe.isEqual(a,x))},[x]),B=i.useCallback(a=>{S(a),I(!xe.isEqual(a,H))},[H]),ze=i.useCallback(a=>{if(a){const[r,u]=bt(m[C-1].savedCode);qe(r),we(u)}Fe(a)},[m,C]),Ee=i.useMemo(()=>N||pe||O,[N,pe,O]);i.useEffect(()=>{Ee!==re&&g(Ee)},[Ee,re,g]);const Je=i.useCallback(async()=>{if(o===void 0)return;const a=K.missionRepoData,r=Da(a,o),u=o.users.getAuthenticated().then(E=>E.data.login===a.repoOwner),y=[r,u];Promise.all(y).then(E=>{We(a),I(!1),$(!1),T(!1),g(!1);const D=E[0];Ue(D.missionBriefing),v(D.missionMetadata),b(D.missionMetadata),k(D.missionBriefing),V(D.missionBriefing),S(D.tasksData),ee(D.tasksData.map(P=>Object.assign({},P))),q(1,D.tasksData);const L=E[1];Qe(L),_e(!1)})},[K,o,q,g]),$e=i.useCallback(()=>{Ue(le),v(be),b(be),k(le),V(le),S([ve]),ee([ve]),Fe(!1),q(1,[ve]),I(!1),$(!1),T(!1),g(!1),Qe(!0),_e(!1)},[q,g]);i.useEffect(()=>{K===void 0?$e():Je()},[K,Je,$e]);const Wt=e.jsx(Et,{className:"assessment-briefing",isOpen:Rt,children:e.jsxs(ke,{children:[e.jsx(ue,{content:oe}),e.jsx(W,{className:"assessment-briefing-button",onClick:()=>Lt(!1),text:"Continue"})]})}),se=i.useCallback((a,r)=>{if(a>m.length)return;const u=m.map(y=>Object.assign({},y));u[a-1]={...u[a-1],savedCode:r},B(u)},[m,B]),Xe=i.useCallback(()=>{const a=m[C-1].starterCode;d(0,a),se(C,a)},[C,se,d,m]),Ke=i.useCallback(async(a,r,u,y,E)=>{const D=G,{saveType:L}=await Us(o,D.repoOwner,D.repoName,a);L==="Overwrite"&&await Qs(o,D.repoOwner,D.repoName,a,u,y,E,r),L==="Create"&&await gt(o,D.repoOwner,D.repoName,a,u,y,E,r)},[G,o]),Ze=i.useCallback(async(a,r,u,y)=>{const E=G;await _s(o,E.repoOwner,E.repoName,a,r,u,y)},[G,o]),et=i.useCallback(async()=>{if(o===void 0){_("Please sign in with GitHub!",2e3);return}const[a,r]=Oa(f,x,j,R,m,H,X),u=Object.keys(a),y=await o.users.getAuthenticated(),E=y.data.name,D=y.data.email,L="";for(let P=0;P<r.length;P++)await Ze(r[P],E,D,L);for(let P=0;P<u.length;P++){const U=u[P],Y=a[U];await Ke(U,Y,E,D,L)}ee(m),V(j),b(f),I(!1),$(!1),T(!1)},[o,X,j,f,m,H,R,x,Ke,Ze]),tt=i.useCallback(async()=>{if(o===void 0){_("Please sign in with GitHub!",2e3);return}const a=Ba(f,j,m),r=Object.keys(a).sort(),u=await o.users.getAuthenticated(),y=await qs(La,U=>({filesToCreate:r,userLogin:u.data.login,resolveDialog:Y=>U(Y)}));if(!y.confirmSave)return;const E=u.data.name,D=u.data.email,L=y.repoName,P=u.data.login;try{await o.repos.createForAuthenticatedUser({name:L});for(let U=0;U<r.length;U++){const Y=r[U],Se=a[Y];await gt(o,P,L,Y,E,D,"Repository created from Source Academy",Se)}ee(m),V(j),b(f),I(!1),$(!1),T(!1),We({repoOwner:P,repoName:L,dateOfCreation:new Date})}catch(U){console.error(U),_("Something went wrong while creating the repository!",2e3)}},[j,f,o,m]),Yt=i.useCallback(()=>{if(K!==void 0&&new Date>K.dueDate){_("It is past the due date for this assessment!");return}G!==void 0?et():tt()},[K,G,et,tt]),zt=i.useCallback(async()=>{await Ge({contents:e.jsxs("div",{className:Nt,children:[e.jsx(ue,{content:"Are you sure you want to reset the template?"}),e.jsx(ue,{content:"*Note this will not affect the saved copy of your program, unless you save over it.*"})]}),negativeLabel:"Cancel",positiveIntent:"primary",positiveLabel:"Confirm"})&&Xe()},[Xe]),Ce=i.useCallback((a,r,u,y)=>{if(y===void 0)return!0;const E=a-1;return xe.isEqual(r[E],u[E])?!0:window.confirm("You have unsaved changes to the current question. Are you sure you want to continue?")},[]),Jt=i.useCallback(()=>{if(Ce(C,m,H,G)){let a=m;G!==void 0&&(a=H.map(u=>Object.assign({},u)),B(a));const r=C-1;q(r,a)}},[C,m,H,G,B,Ce,q]),$t=i.useCallback(()=>{if(Ce(C,m,H,G)){let a=m;G!==void 0&&(a=H.map(u=>Object.assign({},u)),B(a));const r=C+1;q(r,a)}},[C,m,H,G,B,Ce,q]),Xt=i.useCallback(()=>{t("/githubassessments/missions")},[t]);i.useEffect(()=>{!fe&&(Z===Q.mobileEditor||Z===Q.mobileEditorRun)&&je(Q.questionOverview)},[fe,Z]);const Kt=i.useCallback(a=>{d(0,a),se(C,a)},[C,se,d]),Zt=(a,r,u)=>{a!==r&&je(a)},st=i.useRef(Z);st.current=Z;const Ne=()=>{l(),st.current===Q.testcases&&n(sa(A))},es=i.useCallback(a=>{const r=[];for(let u=0;u<m.length;u++){const y=Object.assign({},m[u]);y.taskDescription=a[u],r.push(y)}B(r)},[m,B]),ts=i.useCallback(a=>{const r=m.map(u=>Object.assign({},u));r[C-1]={...r[C-1],testCases:a},h({editorTestcases:r[C-1].testCases}),B(r)},[C,m,h,B]),ss=i.useCallback(a=>{const r=m.map(u=>Object.assign({},u));r[C-1]={...r[C-1],testPrepend:a},B(r)},[C,m,B]),as=i.useCallback(a=>{const r=m.map(u=>Object.assign({},u));r[C-1]={...r[C-1],testPostpend:a},B(r)},[C,m,B]),at=()=>{const a=[{label:"Task",iconName:w.NINJA,body:e.jsx(Ga,{allowEdits:X,currentTaskNumber:C,taskDescriptions:m.map(E=>E.taskDescription),setTaskDescriptions:es}),id:Q.questionOverview},{label:"Briefing",iconName:w.BRIEFCASE,body:e.jsx(Bt,{allowEdits:X,content:j,setContent:qt}),id:Q.briefing}],r=C-1,u=m[r]?m[r].testPrepend:"",y=m[r]?m[r].testPostpend:"";return a.push({label:"Testcases",iconName:w.AIRPLANE,body:e.jsx(Ua,{allowEdits:X,testcases:Gt,testPrepend:u,testPostpend:y,setTaskTestcases:ts,setTestPrepend:ss,setTestPostpend:as,handleTestcaseEval:E=>n(aa(A,E))}),id:Q.testcases}),X&&a.push({label:"Mission Metadata",iconName:w.BUILD,body:e.jsx(Ha,{isFolderModeEnabled:ye,missionMetadata:f,setMissionMetadata:Ft}),id:Q.missionMetadata}),{selectedTabId:Z,tabs:{beforeDynamicTabs:a,afterDynamicTabs:[]},onChange:Zt,workspaceLocation:"githubAssessment"}},ns=()=>{const a=m.slice(0,C).concat([ve]).concat(m.slice(C,m.length));B(a);const r=C+1;q(r,a)},os=()=>{const a=C-1,r=m.slice(0,a).concat(m.slice(C,m.length));B(r);const u=C===1?C:C-1;q(u,r)},nt=()=>{const a=e.jsx(Ta,{isEntrypointFileDefined:Ye!==null,handleEditorEval:Ne},"run"),r=e.jsx(ma,{hasUnsavedChanges:re,onClickSave:Yt},"save"),u=e.jsx(pa,{onClick:zt},"reset"),y=e.jsx(At,{handleChapterSelect:()=>{},isFolderModeEnabled:ye,sourceChapter:f.sourceVersion,sourceVariant:St.defaultSourceVariant,disabled:!0},"chapter"),E=e.jsx(da,{onClickNext:$t,onClickReturn:Xt,questionProgress:[C,m.length]},"next_question"),D=e.jsx(ua,{onClick:Jt,questionProgress:[C,m.length]},"previous_question"),L=e.jsx(ha,{questionProgress:[C,m.length]},"task_view"),P=fe?[r,u]:[a,r,u,y];if(X){const Y=e.jsx(Pa,{addNewQuestion:ns,numberOfTasks:m.length},"add_task"),Se=e.jsx(Ra,{deleteCurrentQuestion:os,numberOfTasks:m.length},"delete_task"),hs=e.jsx(Na,{displayMCQInEditor:()=>ze(!0),displayTextInEditor:()=>ze(!1),mcqDisplayed:ie},"display MCQ");P.push(Y,Se,hs)}return{editorButtons:P,flowButtons:[D,L,E]}},is=()=>{const a=(u,y,E)=>{u!==y&&(y===Q.testcases&&u===Q.mobileEditorRun||je(u))},r=at();return{mobileControlBarProps:{...nt()},...r,onChange:a,selectedTabId:Z,handleEditorEval:Ne}},rs=()=>{const a=e.jsx(va,{handleReplOutputClear:c},"clear_repl");return[e.jsx(xa,{handleReplEval:p,isRunning:Vt},"eval_repl"),a]},ot=i.useCallback(a=>{if(!te)return;const r=Object.assign({},ge);r.answer=a,we(r),se(C,Ia(r))},[te,C,se,ge]),it=i.useMemo(()=>te&&ie?{mcq:ge,handleMCQSubmit:ot}:void 0,[te,ie,ge,ot]),cs=me.useCallback(a=>n(Fs(A,a)),[n]),ls=me.useCallback(a=>n(Ws(A,a)),[n]),rt={editorVariant:"normal",isFolderModeEnabled:ye,activeEditorTabIndex:Ye,setActiveEditorTabIndex:cs,removeEditorTabByIndex:ls,editorTabs:Ht.map(Ca),editorSessionId:"",handleDeclarationNavigate:a=>n(Ys(A,a)),handleEditorEval:Ne,handleEditorValueChange:Kt,handleUpdateHasUnsavedChanges:g,handleEditorUpdateBreakpoints:(a,r)=>n(zs(A,a,r)),handlePromptAutocomplete:(a,r,u)=>n(Js(A,a,r,u)),isEditorAutorun:!1},ct={handleBrowseHistoryDown:()=>n($s(A)),handleBrowseHistoryUp:()=>n(Xs(A)),handleReplEval:p,handleReplValueChange:a=>n(Ks(a,A)),output:Ut,replValue:Qt,sourceChapter:f.sourceVersion||ne.Chapter.SOURCE_4,sourceVariant:ne.Variant.DEFAULT,externalLibrary:Zs.NONE,replButtons:rs()},lt={tabs:[]},ds={controlBarProps:nt(),editorContainerProps:te&&ie?void 0:rt,handleSideContentHeightChange:a=>n(ea(a,A)),hasUnsavedChanges:re,mcqProps:it,sideBarProps:lt,sideContentHeight:_t,sideContentProps:at(),replProps:ct},us={editorContainerProps:te&&ie?void 0:rt,replProps:ct,sideBarProps:lt,hasUnsavedChanges:re,mcqProps:it,mobileSideContentProps:is()};return Pt?e.jsx("div",{className:J("missionLoading",ft),children:e.jsx(he,{description:"Loading",icon:e.jsx(He,{size:ta.LARGE})})}):e.jsxs("div",{className:J("WorkspaceParent",ft),children:[Wt,fe?e.jsx(ga,{...us}):e.jsx(ba,{...ds})]})},Ya=()=>e.jsx("div",{className:"github-welcome",children:e.jsx(ke,{className:"github-welcome-content",children:e.jsx("div",{style:{marginTop:"20px",display:"flex",justifyContent:"center"},children:e.jsxs("div",{children:[e.jsx(na,{children:"Welcome to Source Academy with GitHub Classroom!"}),e.jsx("br",{}),e.jsx(yt,{children:"Source Academy does not find any course information for this account."}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsxs(oa,{style:{textAlign:"justify"},children:[e.jsx("li",{children:"If you are enrolled in a Source Academy course that uses GitHub Classroom, check with the course staff to make sure your account is added to the course."}),e.jsxs("li",{children:["If you are looking for a course to join, check"," ",e.jsx("a",{href:"https://about.sourceacademy.org/learner/README.html",children:"here"})," to find a course that suits your needs."]})]})})]})})})}),z={GITHUB_LOGIN:"login",GITHUB_WELCOME:"welcome",GITHUB_EDITOR:"editor",getAssessmentTypeLink:kt},za=()=>{const n=Mt().state,s=Le(k=>k.session.githubOctokitObject).octokit,o=Dt(),l=()=>o(ra()),d=()=>o(ca()),[p,c]=i.useState(n?.courses),[g,h]=i.useState(n?.selectedCourse||""),[f,v]=i.useState(n?.assessmentTypeOverviews),x=f?.map(k=>k.typeName);i.useEffect(()=>{s!==void 0&&(p||Ja(s,c,h,v))},[p,s]);const b=i.useCallback(k=>{s!==void 0&&(Pe(s,k.target.innerText,v),h(k.target.innerText))},[s,h,v]),N=()=>{s!==void 0&&Pe(s,g,v)},T=e.jsx(Me,{to:z.GITHUB_LOGIN,replace:!0}),j=e.jsx(Me,{to:`${z.getAssessmentTypeLink(x?x[0]:z.GITHUB_WELCOME)}`,state:{courses:p,assessmentTypeOverviews:f,selectedCourse:g},replace:!0});return e.jsxs("div",{className:"Academy",style:{overflow:"hidden"},children:[e.jsx(ja,{changeCourseHandler:b,handleGitHubLogIn:l,handleGitHubLogOut:()=>{d(),c(void 0),v(void 0),h("")},octokit:s,courses:p,selectedCourse:g,types:x,assessmentTypeOverviews:f}),e.jsxs(ia,{children:[e.jsx(ce,{path:z.GITHUB_LOGIN,element:s&&(!p||p.length>0&&!f)?e.jsx(Oe,{display:e.jsx(he,{description:"Loading...",icon:e.jsx(He,{})}),loadContentDispatch:()=>{}}):s&&p&&p.length===0?e.jsx(Me,{to:z.GITHUB_WELCOME,replace:!0}):s?j:e.jsx(Oe,{display:e.jsx(he,{description:"Please sign in to GitHub.",icon:w.WARNING_SIGN}),loadContentDispatch:()=>{}})}),e.jsx(ce,{path:z.GITHUB_WELCOME,element:s?e.jsx(Ya,{}):T}),e.jsx(ce,{path:z.GITHUB_EDITOR,element:e.jsx(Wa,{})}),s?x?.map((k,R)=>{const V=f?f[R].assessments:void 0;return e.jsx(ce,{path:`${z.getAssessmentTypeLink(k)}`,element:e.jsx(ya,{assessmentOverviews:V,refreshAssessmentOverviews:N})},R)}):null,e.jsx(ce,{path:"*",element:s&&p&&p.length>0?j:T})]})]})};async function Ja(t,n,s,o){const l=[];(await t.orgs.listForAuthenticatedUser({per_page:100})).data.filter(c=>c.login.includes("source-academy-course")).forEach(c=>{l.push(c.login.replace("source-academy-course-",""))}),n(l),l.length>0&&(s(l[0]),Pe(t,l[0],o))}async function Pe(t,n,s){const o=(await t.users.getAuthenticated()).data.login,l="source-academy-course-".concat(n),d=(await t.repos.listForAuthenticatedUser({per_page:100})).data,c=d.filter(h=>h.owner.login===l).find(h=>h.name.includes("course-info"));if(c===void 0){_("The course-info repository cannot be located.",2e3);return}const g=(await t.repos.getContent({owner:c.owner.login,repo:c.name,path:""})).data;if(Array.isArray(g))if(g.find(h=>h.name==="course-info.json")){const h=await t.repos.getContent({owner:c.owner.login,repo:c.name,path:"course-info.json"}),f=JSON.parse(Buffer.from(h.data.content,"base64").toString());f.types.forEach(v=>{const x=[];v.assessments.forEach(b=>{if(!b.published)return;const N=b.repoPrefix+"-"+o,T=d.find(R=>R.name===N);let j=new Date,k;T===void 0?k=b.acceptLink:T.created_at!==null&&(j=new Date(T.created_at)),x.push({title:b.title,coverImage:b.coverImage,webSummary:b.shortSummary,missionRepoData:{repoOwner:c.owner.login,repoName:N,dateOfCreation:j},dueDate:new Date(b.closeAt),link:k}),x.sort((R,V)=>R.dueDate<=V.dueDate?-1:1)}),v.assessments=x}),s(f.types)}else{_("The course-info.json file cannot be located.",2e3);return}}const $a=za;$a.displayName="GitHubClassroom";export{$a as Component,za as default};

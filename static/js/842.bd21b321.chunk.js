"use strict";(globalThis.webpackChunkfrontend=globalThis.webpackChunkfrontend||[]).push([[842,896],{42693:(e,t,a)=>{a.d(t,{Z:()=>o});var s=a(51411),n=a(92379),i=a(72791),r=a(80184);const o=e=>((0,i.useEffect)((()=>{var t;null===(t=e.loadContentDispatch)||void 0===t||t.call(e)}),[]),(0,r.jsx)("div",{className:"ContentDisplay row center-xs",children:(0,r.jsx)("div",{className:(e.fullWidth?"col-md-12":"col-md-10 col-xs-11")+" contentdisplay-content-parent",children:(0,r.jsx)(s.Zb,{className:"contentdisplay-content",elevation:n.u.THREE,children:e.display})})}))},34165:(e,t,a)=>{a.d(t,{g:()=>o});var s=a(59118),n=(a(72791),a(17862)),i=a(80184);const r=e=>{let{onClick:t}=e;return(0,i.jsx)(n.Z,{label:"Return to Academy",icon:s.d.ARROW_RIGHT,onClick:t,options:{iconOnRight:!0}})},o=e=>e.questionProgress[0]===e.questionProgress[1]?(0,i.jsx)(r,{onClick:e.onClickReturn},"return_to_academy"):(0,i.jsx)(n.Z,{label:"Next",icon:s.d.ARROW_RIGHT,onClick:e.onClickNext,options:{iconOnRight:!0}})},68206:(e,t,a)=>{a.d(t,{f:()=>r});var s=a(59118),n=(a(72791),a(17862)),i=a(80184);const r=e=>e.questionProgress[0]<=1?null:(0,i.jsx)(n.Z,{label:"Previous",icon:s.d.ARROW_LEFT,onClick:e.onClick})},63309:(e,t,a)=>{a.d(t,{M:()=>i});a(72791);var s=a(17862),n=a(80184);const i=e=>{let{questionProgress:t}=e;return(0,n.jsx)(s.Z,{label:`Question ${t[0]} of ${t[1]}  `,isDisabled:!0})}},71697:(e,t,a)=>{a.d(t,{A:()=>r});var s=a(59118),n=(a(72791),a(17862)),i=a(80184);const r=e=>{let{onClick:t}=e;return(0,i.jsx)(n.Z,{label:"Reset",icon:s.d.REPEAT,onClick:t})}},1799:(e,t,a)=>{a.d(t,{t:()=>o});var s=a(50698),n=a(59118),i=(a(72791),a(17862)),r=a(80184);const o=e=>{const t=e.hasUnsavedChanges?{intent:s.S.WARNING,minimal:!1}:{};return(0,r.jsx)(i.Z,{label:"Save",icon:n.d.FLOPPY_DISK,onClick:e.onClickSave,options:t})}},14748:(e,t,a)=>{a.d(t,{Z:()=>g});var s=a(51411),n=a(37305),i=a(92379),r=a(81694),o=a.n(r),c=a(61881),l=a(92469),d=a(72791),h=a(76796),u=a(80184);const g=e=>{const{index:t,testcase:a,handleTestcaseEval:r}=e,g=d.useMemo((()=>{const e=void 0!==a.result||a.errors,t=(0,l.stringify)(a.result)===a.answer;return{correct:e&&t,wrong:e&&!t,secret:a.type===h.Be.secret||a.type===h.Be.opaque}}),[a]),p=d.useCallback((()=>{r(t)}),[t,r]);return(0,u.jsx)("div",{className:o()("AutograderCard",g),"data-testid":"AutograderCard",children:(0,u.jsx)(s.Zb,{className:n.znr,elevation:i.u.ONE,onClick:p,children:a.type===h.Be.opaque&&"assessment"===e.workspaceLocation?(0,u.jsx)(s.SU,{className:"testcase-placeholder","data-testid":"testcase-placeholder",children:"Hidden testcase"}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(s.SU,{className:"testcase-program",children:a.program}),(0,u.jsx)(s.SU,{className:"testcase-expected",children:a.answer}),(0,u.jsx)(s.SU,{className:"testcase-actual","data-testid":"testcase-actual",children:a.errors?(0,c.parseError)(a.errors):void 0!==a.result?(0,l.stringify)(a.result):"No Answer"})]})})})}},86373:(e,t,a)=>{a.d(t,{Z:()=>d});var s=a(37305),n=a(51411),i=a(81694),r=a.n(i),o=a(72791),c=a(80184);const l=()=>{const e=(0,o.useRef)(null);(0,o.useEffect)((()=>{window.ToneMatrix&&window.ToneMatrix.initialise_matrix(e.current)}),[]);return(0,c.jsxs)("div",{className:"sa-tone-matrix",children:[(0,c.jsx)("div",{className:"row",children:(0,c.jsxs)("div",{className:r()("controls","col-xs-12",s.Pyr,s.ZoI),children:[(0,c.jsx)(n.zx,{id:"clear-matrix",onClick:()=>{window.ToneMatrix.clear_matrix()},children:"Clear"}),(0,c.jsx)(n.zx,{id:"randomise-matrix",onClick:()=>{window.ToneMatrix.randomise_matrix()},children:"Randomise"})]})}),(0,c.jsx)("div",{className:"row",children:(0,c.jsx)("div",{className:"col-xs-12",ref:e})})]})},d=o.memo(l,(()=>!0))},62725:(e,t,a)=>{a.d(t,{Dh:()=>r,IU:()=>i,gS:()=>o,lu:()=>c});var s=a(72426),n=a.n(s);const i=e=>{const t=n()(e),a=n()();return t.isBefore(a)},r=e=>n()(e).format("Do MMMM, HH:mm"),o=e=>n()(e).format("MMMM Do YYYY, HH:mm"),c=e=>n()(e).format("MMMM Do YYYY")},35842:(e,t,a)=>{a.r(t),a.d(t,{Component:()=>Vl,default:()=>Hl});var s=a(37305),n=a(51411),i=a(81694),r=a.n(i),o=a(72791),c=a(78687),l=a(57689),d=a(95134),h=a(50698),u=a(71594),g=a(9631),p=a(80184);const m=()=>{const e=(0,c.I0)();return(0,p.jsx)("div",{className:"research-prompt",children:(0,p.jsxs)(n.Vq,{className:s.Pyr,title:"Agreement to Participate in Educational Research",canOutsideClickClose:!1,canEscapeKeyClose:!1,isCloseButtonShown:!1,isOpen:!0,children:[(0,p.jsxs)("div",{className:s.TmF,children:[(0,p.jsxs)(n.H4,{children:["Welcome to your new ",g.Z.sourceAcademyDeploymentName," course!"]}),(0,p.jsxs)("div",{children:["Here at ",g.Z.sourceAcademyDeploymentName,", our mission is to bring out the beauty and fun in programming and the ideas behind programming, and to make these ideas universally accessible. This includes educational research!"]}),(0,p.jsx)("br",{}),(0,p.jsxs)("div",{children:["We collect programs that students run in ",g.Z.sourceAcademyDeploymentName," and store them anonymously for our research. You are free to opt out of this collection, with no penalty for you whatsoever. Contact your course instructor if you have questions or concerns about this research."]})]}),(0,p.jsx)("div",{className:s.Alt,children:(0,p.jsxs)("div",{className:s.e$L,children:[(0,p.jsx)(n.zx,{text:"I would like to opt out",onClick:()=>e((0,u.updateCourseResearchAgreement)(!1))}),(0,p.jsx)(n.zx,{text:"I consent!",intent:h.S.SUCCESS,onClick:()=>e((0,u.updateCourseResearchAgreement)(!0))})]})})]})})};var x=a(90362),y=a(92379),v=a(32183),b=a(59118),C=a(95785),f=a(763),S=a.n(f),j=a(11087),w=a(12538),I=a(5602),k=a(42543),M=a(92469),A=a(76796),T=a(44439);const P=(e,t,a,s)=>()=>{if(!s)return e();if(t.type===A.LD.mcq){if(null===t.answer)return(0,T.N9)("Please select an option!",750);if(void 0===t.solution)return e();if(t.answer!==t.solution)return(0,T.N9)("Your MCQ solution is incorrect!",750)}else if(t.type===A.LD.programming){if(!a.reduce(((e,t)=>e&&(0,M.stringify)(t.result)===t.answer),!0))return(0,T.N9)("Your solution has not passed all testcases!",750)}return e()};var E=a(84259),N=a(18465),O=a(94694),D=a(60054),R=a(89360),B=a(27156),L=a(34165),G=a(68206),U=a(63309),F=a(71697),_=a(50472),V=a(1799),H=a(17862),z=a(29860),$=a(74106),X=a(45686);const W=e=>{const{index:t,result:a}=e;return(0,p.jsx)("div",{className:r()("ResultCard","pass"===a.resultType?"correct":"wrong"),"data-testid":"ResultCard",children:(0,p.jsxs)(n.Zb,{elevation:y.u.ONE,children:[(0,p.jsxs)("div",{className:"result-data",children:[(0,p.jsx)("div",{className:"result-idx","data-testid":"result-idx",children:t+1}),(0,p.jsx)("div",{className:"result-status","data-testid":"result-status",children:a.resultType.toUpperCase()})]}),(0,p.jsx)(n.SU,{className:"result-expected","data-testid":"result-expected",children:a.expected}),(0,p.jsx)(n.SU,{className:"result-actual","data-testid":"result-actual",children:"error"===a.resultType?(s=a.errors,s.map((e=>{switch(e.errorType){case"timeout":return"[TIMEOUT] Submission exceeded time limit for this test case.";case"syntax":return`[SYNTAX] Line ${e.line}: ${e.errorExplanation}`;case"runtime":return`[RUNTIME] Line ${e.line}: ${e.errorExplanation}`;case"systemError":return`[SYSTEM] ${e.errorMessage}`;default:return`[UNKNOWN] Autograder error: type ${e.errorType}`}})).join("\n\n")):a.actual})]})});var s};var K=a(14748);const q=(0,p.jsxs)("div",{className:"autograder-help-tooltip",children:[(0,p.jsx)("p",{children:"Click on each testcase below to execute it with the program in the editor."}),(0,p.jsx)("p",{children:"To execute all testcases at once, evaluate the program in the editor with this tab active."}),(0,p.jsx)("p",{children:"A green or red background indicates a passed or failed testcase respectively."}),(0,p.jsx)("p",{children:"Private testcases (only visible to staff when grading) have a grey background."})]}),Z=(e,t)=>(0,p.jsxs)("div",{className:e,children:[t,(0,p.jsx)(n.JO,{icon:b.d.CARET_DOWN})]}),Y=(0,p.jsxs)("div",{className:"testcases-header","data-testid":"testcases-header",children:[Z("header-fn","Testcase"),Z("header-expected","Expected result"),Z("header-actual","Actual result")]}),J=(0,p.jsxs)("div",{className:"results-header","data-testid":"results-header",children:[(0,p.jsxs)("div",{className:"header-data",children:[Z("header-sn","S/N"),Z("header-status","Testcase status")]}),Z("header-expected","Expected result"),Z("header-actual","Actual result")]}),Q=(e,t,a)=>(0,p.jsx)(H.Z,{label:e,icon:t?b.d.CARET_DOWN:b.d.CARET_RIGHT,onClick:a,options:{className:"collapse-button",minimal:!0}}),ee=e=>{const[t,a]=o.useState(!0),[s,i]=o.useState(!0),{testcases:r,autogradingResults:c,handleTestcaseEval:l,workspaceLocation:d}=e,h=o.useMemo((()=>r.length>0?(0,p.jsxs)("div",{className:"testcaseCards",children:[Y,r.map(((e,t)=>(0,p.jsx)(K.Z,{index:t,testcase:e,handleTestcaseEval:l,workspaceLocation:d},t)))]}):(0,p.jsx)("div",{className:"noResults","data-testid":"noResults",children:"There are no testcases provided for this question."})),[r,l,d]),u=o.useMemo((()=>c.length>0?(0,p.jsxs)("div",{children:[J,c.map(((e,t)=>(0,p.jsx)(W,{index:t,result:e},t)))]}):(0,p.jsx)("div",{className:"noResults","data-testid":"noResults",children:"There are no results to show."})),[c]),g=o.useCallback((()=>{a(!t)}),[t]),m=o.useCallback((()=>i(!s)),[s]);return(0,p.jsxs)("div",{className:"Autograder",children:[(0,p.jsxs)(n.zx,{className:"collapse-button",icon:t?b.d.CARET_DOWN:b.d.CARET_RIGHT,minimal:!0,onClick:g,children:[(0,p.jsx)("span",{children:"Testcases"}),(0,p.jsx)(C.u,{content:q,placement:n.I2.LEFT,children:(0,p.jsx)(n.JO,{icon:b.d.HELP})})]}),(0,p.jsx)(n.UO,{isOpen:t,keepChildrenMounted:!0,children:h}),Q("Autograder Results",s,m),(0,p.jsx)(n.UO,{isOpen:s,keepChildrenMounted:!0,children:u})]})},te=e=>{const{handleContestEntryClick:t,contestEntry:a,rank:i}=e;return(0,p.jsx)("div",{className:r()("LeaderboardCard"),children:(0,p.jsxs)(n.Zb,{className:s.znr,elevation:y.u.ONE,onClick:()=>{var e;return t(a.submission_id,null!==(e=a.answer.code)&&void 0!==e?e:"")},"data-testid":"SideContentLeaderboardCard",children:[(0,p.jsx)(n.SU,{className:"contestentry-entryid",children:a.student_name}),(0,p.jsx)(n.SU,{className:"contestentry-rank",children:i}),(0,p.jsx)(n.SU,{className:"contestentry-score","data-testid":"contestentry-score",children:a.final_score})]})})},ae=(e,t)=>(0,p.jsxs)("div",{className:e,children:[t,(0,p.jsx)(n.JO,{icon:b.d.CARET_DOWN})]}),se=(0,p.jsxs)("div",{className:"leaderboard-header",children:[ae("header-entryid","Student Name"),ae("header-entryrank","Rank"),ae("header-score","Score")]}),ne=e=>{const{orderedContestEntries:t,handleContestEntryClick:a}=e,[s,i]=(0,o.useState)(!0),r=(0,o.useMemo)((()=>(0,p.jsxs)("div",{children:[se,t.length>0?t.map(((e,t)=>(0,p.jsx)(te,{handleContestEntryClick:a,contestEntry:e,rank:t+1},e.submission_id))):(0,p.jsx)("div",{className:"noResults",children:"There are no eligible contest leaderboard entries found."})]})),[a,t]);return(0,p.jsxs)("div",{className:"ContestLeaderboard",children:[(0,p.jsxs)(n.zx,{className:"collapse-button",icon:s?b.d.CARET_DOWN:b.d.CARET_RIGHT,minimal:!0,onClick:()=>i(!s),children:[(0,p.jsx)("span",{children:"Contest Leaderboard"}),(0,p.jsx)(C.u,{content:"View the top-rated contest entries!",children:(0,p.jsx)(n.JO,{icon:b.d.HELP})})]}),(0,p.jsx)(n.UO,{isOpen:s,keepChildrenMounted:!0,children:r})]})},ie=[{name:"S",color:"rgb(255, 127, 127)",score:10},{name:"A",color:"rgb(255, 223, 127)",score:7},{name:"B",color:"rgb(255, 255, 127)",score:4},{name:"C",color:"rgb(191, 255, 127)",score:2},{name:"D",color:"rgb(127, 191, 255)",score:1}],re=e=>{const{contestEntries:t,canSave:a,isValid:i,handleContestEntryClick:c,handleVotingSubmissionChange:l}=e,[d,h]=(0,o.useState)(!0),[u,g]=(0,o.useState)(null),[m,x]=(0,o.useState)(null),v=(0,o.useMemo)((()=>[...t].sort(((e,t)=>e.submission_id-t.submission_id))),[t]),f=e=>{g(e.currentTarget),e.dataTransfer.effectAllowed="move"},S=(0,o.useCallback)((e=>t=>{const a=t.currentTarget.closest(".tier");if(a){const t=a.id.split("-")[1],s=ie.find((e=>e.name.toLowerCase()===t));l(e.submission_id,(null===s||void 0===s?void 0:s.score)||0)}x(null)}),[l]),j=(0,o.useCallback)((e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"}),[]),w=(0,o.useCallback)((e=>{setTimeout((()=>{const t=e.target.closest(".tier");t&&x(t.id)}),0)}),[]),I=(0,o.useCallback)((e=>{const t=e.target.closest(".tier");t&&t.id===m&&x(null)}),[m]),k=(0,o.useCallback)((e=>{e.preventDefault();const t=e.target.closest(".item-container");t&&t.appendChild(u)}),[u]),M=(0,o.useRef)({}),A=(0,o.useRef)({}),T=(0,o.useMemo)((()=>ie.map(((e,t)=>(0,p.jsxs)("div",{className:r()("tier",{"hovered-tier":m===`tier-${e.name.toLowerCase()}`}),id:`tier-${e.name.toLowerCase()}`,"data-testid":"tier",children:[(0,p.jsx)("h2",{style:{backgroundColor:e.color},children:e.name}),(0,p.jsx)("div",{className:"item-container",onDragOver:j,onDragLeave:I,onDragEnter:w,onDrop:k,ref:e=>A.current[t]=e})]},`tier-${e.name.toLowerCase()}`)))),[m,j,I,w,k]),P=(0,o.useMemo)((()=>(0,p.jsxs)("div",{className:"tier-list",children:[T,v.length>0?(0,p.jsx)("div",{className:"tier",id:"bank","data-testid":"tier",children:(0,p.jsx)("div",{className:"item-container",id:"items",onDragOver:j,onDragLeave:I,onDragEnter:w,onDrop:k,"data-testid":"voting-item-container",children:v.map(((e,t)=>(0,p.jsx)("div",{className:r()("item",{wrong:!i}),draggable:a,id:`item-${t+1}`,onDragStart:f,onDragEnd:S(e),ref:e=>M.current[t]=e,"data-testid":"voting-item",children:(0,p.jsx)(n.Zb,{className:s.znr,elevation:y.u.ONE,onClick:()=>{var t;return c(e.submission_id,null!==(t=e.answer.code)&&void 0!==t?t:"")},children:(0,p.jsx)(n.SU,{className:"contestentry-entryid",children:t+1})})},`item-${t+1}`)))})}):(0,p.jsx)("div",{className:"noResults",children:"There are no eligible entries for voting found."})]})),[i,a,v,c,S,w,I,j,k,T]);return(0,o.useEffect)((()=>{v.forEach(((e,t)=>{if(null!==e.score){const a=ie.findIndex((t=>!!e.score&&t.score<=e.score));if(-1!==a){const e=A.current[a],s=M.current[t];e&&s&&e.appendChild(s)}}}))}),[v]),(0,p.jsxs)("div",{className:"ContestEntryVoting",children:[(0,p.jsxs)(n.zx,{className:"collapse-button",icon:d?b.d.CARET_DOWN:b.d.CARET_RIGHT,minimal:!0,onClick:()=>h(!d),children:[(0,p.jsx)("span",{children:"Contest Voting"}),(0,p.jsx)(C.u,{content:(0,p.jsx)("span",{children:"Rank your favourite contest entries from tiers D (worst) to S (best)!"}),children:(0,p.jsx)(n.JO,{icon:b.d.HELP})})]}),(0,p.jsx)(n.UO,{isOpen:d,keepChildrenMounted:!0,children:P})]})},oe=e=>{const{canSave:t,contestEntries:a,handleSave:s,handleContestEntryClick:n}=e,[i,r]=(0,o.useState)(!0),[c,l]=(0,o.useState)([]);(0,o.useEffect)((()=>{l(a)}),[a]);return(0,p.jsx)(re,{isValid:i,canSave:t,handleContestEntryClick:n,handleVotingSubmissionChange:(e,t)=>{const a=c.map((a=>a.submission_id===e?{...a,score:t}:a));l(a);const n=(e=>e.reduce(((e,t)=>e&&void 0!==t.score&&null!==t.score),!0))(a);n?(s(a),r(!0)):((0,T.N9)("Please assign every entry to a tier."),r(!1))},contestEntries:c})};var ce=a(86373),le=a(39215),de=a(90713),he=a(40239),ue=a(89702),ge=a(62725);const pe=e=>(0,p.jsx)("div",{className:"GradingResult",children:(0,p.jsxs)("div",{className:"grading-result-table",children:[(0,p.jsx)(n.vl,{children:(0,p.jsxs)("tbody",{children:[(0,p.jsxs)("tr",{children:[(0,p.jsx)("th",{children:"XP:"}),(0,p.jsx)("td",{children:(0,p.jsxs)(n.xv,{children:[e.xp," / ",e.maxXp]})})]}),(0,p.jsxs)("tr",{children:[(0,p.jsx)("th",{children:"Comments:"}),(0,p.jsx)("td",{children:!e.comments&&(0,p.jsx)(n.xv,{children:"None"})})]})]})}),e.comments&&(0,p.jsx)(n.vl,{children:(0,p.jsx)("tbody",{children:(0,p.jsx)("tr",{children:(0,p.jsxs)("td",{children:[(0,p.jsx)(n.iz,{}),(0,p.jsx)($.Z,{content:e.comments,simplifiedAutoLink:!0,strikethrough:!0,tasklists:!0,openLinksInNewWindow:!0}),(0,p.jsx)(n.iz,{})]})})})}),(0,p.jsx)("br",{}),(0,p.jsx)("div",{className:"grading-result-info",children:(0,p.jsxs)(n.xv,{children:["Graded by ",(0,p.jsx)("b",{children:e.graderName})," on ",(0,ge.Dh)(e.gradedAt)]})})]})}),me="assessment",xe=e=>{var t,a,i,m,y;const[v,C]=(0,o.useState)(!1),[S,j]=(0,o.useState)(!1),[w,I]=(0,o.useState)(""),{isMobileBreakpoint:M}=(0,x.Fs)(),T=(0,x.ix)((t=>t.session.assessments.get(e.assessmentId))),[W,K]=(0,o.useState)(void 0!==(null===T||void 0===T?void 0:T.questions[e.questionId].grader)?le.B.grading:le.B.questionOverview),q=(0,l.s0)(),{courseId:Z}=(0,x.ix)((e=>e.session)),{isFolderModeEnabled:Y,activeEditorTabIndex:J,editorTabs:Q,autogradingResults:te,editorTestcases:ae,hasUnsavedChanges:se,isRunning:ie,output:re,replValue:ge,sideContentHeight:xe,currentAssessment:ye,currentQuestion:ve}=(0,x.ix)((e=>e.workspaces[me])),be=(0,c.I0)(),{handleTestcaseEval:Ce,handleClearContext:fe,handleChangeExecTime:Se,handleUpdateCurrentAssessmentId:je,handleResetWorkspace:we,handleRunAllTestcases:Ie,handleEditorEval:ke,handleAssessmentFetch:Me,handleEditorValueChange:Ae,handleEditorUpdateBreakpoints:Te,handleReplEval:Pe,handleSave:Ee,handleUpdateHasUnsavedChanges:Ne}=(0,o.useMemo)((()=>({handleTestcaseEval:e=>be((0,ue.evalTestcase)(me,e)),handleClearContext:(e,t)=>be((0,ue.beginClearContext)(me,e,t)),handleChangeExecTime:e=>be((0,ue.changeExecTime)(e,me)),handleUpdateCurrentAssessmentId:(e,t)=>be((0,ue.updateCurrentAssessmentId)(e,t)),handleResetWorkspace:e=>be((0,ue.resetWorkspace)(me,e)),handleRunAllTestcases:()=>be((0,ue.runAllTestcases)(me)),handleEditorEval:()=>be((0,ue.evalEditor)(me)),handleAssessmentFetch:e=>be((0,u.fetchAssessment)(e)),handleEditorValueChange:(e,t)=>be((0,ue.updateEditorValue)(me,e,t)),handleEditorUpdateBreakpoints:(e,t)=>be((0,ue.setEditorBreakpoint)(me,e,t)),handleReplEval:()=>be((0,ue.evalRepl)(me)),handleSave:(e,t)=>be((0,u.submitAnswer)(e,t)),handleUpdateHasUnsavedChanges:e=>be((0,ue.updateHasUnsavedChanges)(me,e))})),[be]);(0,o.useEffect)((()=>{Ae(0,"")}),[]),(0,o.useEffect)((()=>{if(Me(e.assessmentId),0===e.questionId&&e.notAttempted&&C(!0),!T)return;let t=e.questionId;e.questionId>=T.questions.length&&(t=T.questions.length-1);const a=T.questions[t];let s="";a.type===A.LD.programming&&(s=a.answer?a.answer:a.solutionTemplate),Ae(0,s)}),[]),(0,o.useEffect)((()=>{Be()})),(0,o.useEffect)((()=>{!M&&E.JN.includes(W)&&K(le.B.questionOverview)}),[M,e,W]);const Oe=(0,o.useCallback)((e=>(0,N.cM)(w,e)),[w]),De=(0,o.useRef)(W);De.current=W;const Re=(0,o.useCallback)((()=>{De.current===le.B.autograder?Ie():ke();const e={time:Date.now(),type:"keyboardCommand",data:O.SO.run};Oe(e)}),[ke,Ie,Oe]),Be=()=>{var t,a,s;if(void 0===T)return;const{assessmentId:n,questionId:i}=e;if(ye===n&&ve===i)return;const r=T.questions[i],o={};switch(r.type){case A.LD.programming:const t=r;var c,l;if(o.autogradingResults=t.autogradingResults,o.programPrependValue=t.prepend,o.programPostpendValue=t.postpend,o.editorTestcases=t.testcases,o.editorValue=t.answer||t.solutionTemplate,!w)I((0,N.wH)(`${T.number}/${e.questionId}`,{chapter:r.library.chapter,externalLibrary:(null===r||void 0===r||null===(c=r.library)||void 0===c||null===(l=c.external)||void 0===l?void 0:l.name)||"NONE",editorValue:o.editorValue}));break;case A.LD.voting:const a=r;o.programPrependValue=a.prepend,o.programPostpendValue=a.postpend;case A.LD.mcq:}Te(0,[]),je(n,i),we({autogradingResults:o.autogradingResults,editorTabs:[{value:null!==(t=o.editorValue)&&void 0!==t?t:"",highlightedLines:[],breakpoints:[]}],programPrependValue:o.programPrependValue,programPostpendValue:o.programPostpendValue,editorTestcases:null!==(a=o.editorTestcases)&&void 0!==a?a:[]}),Se(null!==(s=r.library.execTimeMs)&&void 0!==s?s:d.t7.assessment.execTime),fe(r.library,!0),Ne(!1),o.editorValue&&Ae(0,o.editorValue)},Le=(e,t)=>{const a=T.questions[t],s=void 0!==a.grader,n=(null===a||void 0===a?void 0:a.type)===A.LD.voting,i=(e,t)=>{Ae(0,t)},r=[{label:`Question ${t+1}`,iconName:b.d.NINJA,body:(0,p.jsx)($.Z,{content:a.content}),id:le.B.questionOverview}];var o,c;n?r.push({label:"Contest Voting Briefing",iconName:b.d.BRIEFCASE,body:(0,p.jsx)($.Z,{content:T.longSummary}),id:le.B.briefing},{label:"Contest Voting",iconName:b.d.NEW_LAYERS,body:(0,p.jsx)(oe,{canSave:e.canSave,handleSave:e=>Ee(a.id,e),handleContestEntryClick:i,contestEntries:null!==(o=null===a||void 0===a?void 0:a.contestEntries)&&void 0!==o?o:[]}),id:le.B.contestVoting},{label:"Contest Leaderboard",iconName:b.d.CROWN,body:(0,p.jsx)(ne,{handleContestEntryClick:i,orderedContestEntries:null!==(c=null===a||void 0===a?void 0:a.contestLeaderboard)&&void 0!==c?c:[]}),id:le.B.contestLeaderboard}):r.push({label:"Briefing",iconName:b.d.BRIEFCASE,body:(0,p.jsx)($.Z,{className:"sidecontent-overview",content:T.longSummary}),id:le.B.briefing},{label:"Autograder",iconName:b.d.AIRPLANE,body:(0,p.jsx)(ee,{testcases:ae,autogradingResults:s||!e.assessmentConfiguration.isManuallyGraded?te:[],handleTestcaseEval:Ce,workspaceLocation:"assessment"}),id:le.B.autograder});s&&r.push({label:"Report Card",iconName:b.d.TICK,body:(0,p.jsx)(pe,{graderName:a.grader.name,gradedAt:a.gradedAt,xp:a.xp,maxXp:a.maxXp,comments:a.comments}),id:le.B.grading});a.library.external.symbols.includes("get_matrix")&&r.push({label:"Tone Matrix",iconName:b.d.GRID_VIEW,body:(0,p.jsx)(ce.Z,{}),id:le.B.toneMatrix});return{selectedTabId:W,tabs:{beforeDynamicTabs:r,afterDynamicTabs:[]},onChange:(e,t,a)=>{e!==t&&K(e)},workspaceLocation:me}},Ge=t=>{var a;const s=`/courses/${Z}/${(0,de.q1)(T.type)}`,n=s+`/${T.id.toString()}`,i=T.questions,r=i[t],o=[t+1,i.length],c=()=>{q(n+`/${(t+1).toString()}`),K(le.B.questionOverview)},l=()=>q(s),d=i.filter((e=>null!==e.answer)).length-1,h=t>=d,u=(0,p.jsx)(L.g,{onClickNext:r.blocking?P(c,r,ae,h):c,onClickReturn:r.blocking?P(l,r,ae,h):l,questionProgress:o},"next_question"),m=(0,p.jsx)(G.f,{onClick:()=>{q(n+`/${(t-1).toString()}`),K(le.B.questionOverview)},questionProgress:o},"previous_question"),x=(0,p.jsx)(U.M,{questionProgress:o},"question_view"),y=r.type!==A.LD.mcq?(0,p.jsx)(F.A,{onClick:()=>{j(!0)}},"reset_template"):null,v=(0,p.jsx)(_.h,{isEntrypointFileDefined:null!==J,handleEditorEval:Re},"run"),b=e.canSave&&r.type===A.LD.programming?(0,p.jsx)(V.t,{hasUnsavedChanges:se,onClickSave:()=>Ee(r.id,Q[0].value)},"save"):null,C=(0,p.jsx)(D.b,{handleChapterSelect:()=>{},isFolderModeEnabled:Y,sourceChapter:r.library.chapter,sourceVariant:null!==(a=r.library.variant)&&void 0!==a?a:g.Z.defaultSourceVariant,disabled:!0},"chapter");return{editorButtons:M?[b,y]:[v,b,y,C],flowButtons:[m,x,u]}},Ue=(0,o.useMemo)((()=>{const e=(0,p.jsx)(R._,{handleReplOutputClear:()=>be((0,ue.clearReplOutput)(me))},"clear_repl");return[(0,p.jsx)(B.e,{handleReplEval:Pe,isRunning:ie},"eval_repl"),e]}),[be,ie,Pe]),Fe=(0,o.useMemo)((()=>({setActiveEditorTabIndex:e=>be((0,ue.updateActiveEditorTabIndex)(me,e)),removeEditorTabByIndex:e=>be((0,ue.removeEditorTab)(me,e)),handleDeclarationNavigate:e=>be((0,ue.navigateToDeclaration)(me,e)),handlePromptAutocomplete:(e,t,a)=>be((0,ue.promptAutocomplete)(me,e,t,a))})),[be]),_e=(0,o.useMemo)((()=>({handleBrowseHistoryDown:()=>be((0,ue.browseReplHistoryDown)(me)),handleBrowseHistoryUp:()=>be((0,ue.browseReplHistoryUp)(me)),handleReplValueChange:e=>be((0,ue.updateReplValue)(e,me))})),[be]),Ve=(0,o.useMemo)((()=>({handleSideContentHeightChange:e=>be((0,ue.changeSideContentHeight)(e,me))})),[be]);if(null===T||void 0===T||!T.questions.length)return(0,p.jsx)(n.tR,{className:r()("WorkspaceParent",s.Pyr),description:"Getting mission ready...",icon:(0,p.jsx)(n.$j,{size:n.Ey.LARGE})});const He=(0,p.jsx)(n.Vq,{className:"assessment-briefing",isOpen:v,children:(0,p.jsxs)(n.Zb,{children:[(0,p.jsx)($.Z,{content:T.longSummary}),(0,p.jsx)(n.zx,{className:"assessment-briefing-button",onClick:()=>C(!1),text:"Continue"})]})}),ze=()=>j(!1),$e=(0,p.jsxs)(n.Vq,{className:"assessment-reset",icon:b.d.ERROR,isCloseButtonShown:!0,isOpen:S,onClose:ze,title:"Confirmation: Reset editor?",children:[(0,p.jsxs)("div",{className:s.TmF,children:[(0,p.jsx)($.Z,{content:"Are you sure you want to reset the template?"}),(0,p.jsx)($.Z,{content:"*Note this will not affect the saved copy of your program, unless you save over it.*"})]}),(0,p.jsx)("div",{className:s.Alt,children:(0,p.jsxs)(n.hE,{children:[(0,p.jsx)(H.Z,{label:"Cancel",onClick:ze,options:{minimal:!1}}),(0,p.jsx)(H.Z,{label:"Confirm",onClick:()=>{ze(),Ae(0,T.questions[Xe].solutionTemplate),Ne(!0)},options:{minimal:!1,intent:h.S.DANGER}})]})})]}),Xe=e.questionId>=T.questions.length?T.questions.length-1:e.questionId,We=T.questions[Xe],Ke=We.type===A.LD.programming||We.type===A.LD.voting?{editorVariant:"normal",isFolderModeEnabled:Y,activeEditorTabIndex:J,setActiveEditorTabIndex:Fe.setActiveEditorTabIndex,removeEditorTabByIndex:Fe.removeEditorTabByIndex,editorTabs:Q.map(z.F),editorSessionId:"",sourceChapter:We.library.chapter||k.Chapter.SOURCE_4,sourceVariant:null!==(t=We.library.variant)&&void 0!==t?t:k.Variant.DEFAULT,externalLibraryName:We.library.external.name||"NONE",handleDeclarationNavigate:Fe.handleDeclarationNavigate,handleEditorEval:Re,handleEditorValueChange:Ae,handleUpdateHasUnsavedChanges:Ne,handleEditorUpdateBreakpoints:Te,handlePromptAutocomplete:Fe.handlePromptAutocomplete,isEditorAutorun:!1,onChange:(e,t)=>{null===Ne||void 0===Ne||Ne(!0),Ae(0,e);const a={time:Date.now(),type:"codeDelta",data:t};Oe(a)},onCursorChange:e=>{const t={time:Date.now(),type:"cursorPositionChange",data:e.getCursor()};Oe(t)},onSelectionChange:e=>{const t=e.getRange(),a=e.isBackwards();if(!(0,f.isEqual)(t.start,t.end)){const e={time:Date.now(),type:"selectionRangeData",data:{range:t,isBackwards:a}};Oe(e)}}}:void 0,qe={mcq:We,handleMCQSubmit:e=>Ee(T.questions[Xe].id,e)},Ze={handleBrowseHistoryDown:_e.handleBrowseHistoryDown,handleBrowseHistoryUp:_e.handleBrowseHistoryUp,handleReplEval:Pe,handleReplValueChange:_e.handleReplValueChange,output:re,replValue:ge,sourceChapter:(null===We||void 0===We||null===(a=We.library)||void 0===a?void 0:a.chapter)||k.Chapter.SOURCE_4,sourceVariant:null!==(i=We.library.variant)&&void 0!==i?i:k.Variant.DEFAULT,externalLibrary:(null===We||void 0===We||null===(m=We.library)||void 0===m||null===(y=m.external)||void 0===y?void 0:y.name)||"NONE",replButtons:Ue},Ye={tabs:[]},Je={controlBarProps:Ge(Xe),editorContainerProps:Ke,handleSideContentHeightChange:Ve.handleSideContentHeightChange,hasUnsavedChanges:se,mcqProps:qe,sideBarProps:Ye,sideContentHeight:xe,sideContentProps:Le(e,Xe),replProps:Ze},Qe={editorContainerProps:Ke,hasUnsavedChanges:se,mcqProps:qe,replProps:Ze,sideBarProps:Ye,mobileSideContentProps:(t=>({mobileControlBarProps:{...Ge(t)},...Le(e,t),onChange:(e,t,a)=>{e!==t&&(t===le.B.autograder&&e===le.B.mobileEditorRun||K(e))},selectedTabId:W,handleEditorEval:Re}))(Xe)};return(0,p.jsxs)("div",{className:r()("WorkspaceParent",s.Pyr),children:[He,$e,M?(0,p.jsx)(X.Z,{...Qe}):(0,p.jsx)(he.Z,{...Je})]})};var ye=a(42693),ve=a(47763),be=a(62123);const Ce=()=>(0,p.jsx)("div",{className:r()("NoPage",s.Pyr),children:(0,p.jsx)(n.tR,{icon:b.d.ERROR,title:"Assessment Not Found",description:"Please check the top right dropdown menu to see if you are in the right course."})}),fe=e=>{let t,a,s;switch(e){case A.TD.graded:t=b.d.TICK,a=h.S.SUCCESS,s="Fully graded";break;case A.TD.grading:t=b.d.TIME,a=h.S.WARNING,s="Grading in progress";break;case A.TD.none:t=b.d.CROSS,a=h.S.DANGER,s="Not graded yet";break;default:t=b.d.DISABLE,a=h.S.PRIMARY,s="Not applicable"}return(0,p.jsx)(C.u,{className:"listing-title-tooltip",content:s,placement:v.Ly.RIGHT,children:(0,p.jsx)(n.JO,{icon:t,intent:a})})},Se=(e,t,a)=>(0,p.jsx)(H.Z,{label:e,icon:t?b.d.CARET_DOWN:b.d.CARET_RIGHT,onClick:a,options:{minimal:!0,className:"collapse-button"}}),je=e=>{var t,a;const i=(0,l.UO)(),{isMobileBreakpoint:r}=(0,x.Fs)(),[m,v]=o.useState(null),[S,k]=o.useState(!1),[M,T]=o.useState(!0),[P,E]=o.useState(!0),N=(0,x.ix)((e=>e.session.assessmentOverviews)),O=(0,x.ix)((e=>!e.session.role||e.session.role===d.uU.Student)),D=(0,x.ix)((e=>e.session.courseId)),R=(0,c.I0)(),B=()=>k(!S),L=()=>T(!M),G=()=>E(!P),U=()=>v(null),F=e=>(0,f.sortBy)(e,[e=>-e.id]),_=(e,t)=>(0,p.jsxs)(n.zx,{disabled:e.status!==A.PF.attempted,icon:b.d.CONFIRM,intent:e.status===A.PF.attempted?h.S.DANGER:h.S.NONE,minimal:!0,onClick:()=>v(e),children:[(0,p.jsx)("span",{className:"custom-hidden-xxxs",children:"Finalize"}),(0,p.jsx)("span",{className:"custom-hidden-xxs",children:" Submission"})]}),V=e=>{let t,a,s="";switch(e.status){case A.PF.not_attempted:t=b.d.PLAY,a="Attempt";break;case A.PF.attempting:t=b.d.PLAY,a="Continue",s=" Attempt";break;case A.PF.attempted:t=b.d.EDIT,a="Review",s=" Attempt";break;case A.PF.submitted:t=b.d.EYE_OPEN,a="Review",s=" Submission";break;default:t=b.d.PLAY,a="Review"}return(0,p.jsx)(j.OL,{to:`/courses/${D}/${(0,de.q1)(e.type)}/${e.id.toString()}/${g.Z.defaultQuestionId}`,children:(0,p.jsxs)(n.zx,{icon:t,minimal:!0,onClick:()=>R((0,u.acknowledgeNotifications)((0,be.Vf)(e.id))),children:[(0,p.jsx)("span",{className:"custom-hidden-xxxs","data-testid":"Assessment-Attempt-Button",children:a}),(0,p.jsx)("span",{className:"custom-hidden-xxs",children:s})]})})},z=(t,a,s,i)=>{const o="graded"===t.gradingStatus||!e.assessmentConfiguration.isManuallyGraded,c=r?5:3;return(0,p.jsx)("div",{children:(0,p.jsxs)(n.Zb,{className:"row listing",elevation:y.u.ONE,children:[(0,p.jsxs)("div",{className:`col-xs-${String(c)} listing-picture`,children:[(0,p.jsx)(ve.Z,{className:"badge",notificationFilter:(0,be.Vf)(t.id),large:!0}),(0,p.jsx)("img",{alt:"Assessment",className:`cover-image-${t.status}`,src:t.coverImage?t.coverImage:I})]}),(0,p.jsxs)("div",{className:`col-xs-${String(12-c)} listing-text`,children:[X(t,a,i),(0,p.jsx)("div",{className:"listing-xp",children:(0,p.jsx)(n.H6,{children:o?`XP: ${t.xp} / ${t.maxXp}`:`Max XP: ${t.maxXp}`})}),(0,p.jsx)("div",{className:"listing-description",children:(0,p.jsx)($.Z,{content:t.shortSummary})}),(0,p.jsxs)("div",{className:"listing-footer",children:[(0,p.jsxs)("div",{children:[(0,p.jsxs)(n.xv,{className:"listing-due-date",children:[(0,p.jsx)(n.JO,{className:"listing-due-icon",iconSize:12,icon:b.d.CALENDAR}),`${(0,ge.IU)(t.openAt)?"Opened":"Opens"}: ${(0,ge.Dh)(t.openAt)}`]}),(0,ge.IU)(t.openAt)&&(0,p.jsxs)(n.xv,{className:"listing-due-date",children:[(0,p.jsx)(n.JO,{className:"listing-due-icon",iconSize:12,icon:b.d.TIME}),`Due: ${(0,ge.Dh)(t.closeAt)}`]})]}),(0,p.jsx)("div",{className:"listing-button",children:s?V(t):null})]})]})]})},a)},X=(e,t,a)=>(0,p.jsxs)("div",{className:"listing-header",children:[(0,p.jsx)(n.xv,{ellipsize:!0,children:(0,p.jsxs)(n.H4,{className:"listing-title",children:[e.title,e.private?(0,p.jsx)(C.u,{className:"listing-title-tooltip",content:"This assessment is password-protected.",children:(0,p.jsx)(n.JO,{icon:"lock"})}):null,a?fe(e.gradingStatus):null]})}),(0,p.jsx)("div",{className:"listing-button",children:_(e)})]}),W=o.useMemo((()=>null===N||void 0===N?void 0:N.filter((t=>t.type===e.assessmentConfiguration.type))),[N,e.assessmentConfiguration.type]);if(i.assessmentId&&(null===(t=i.assessmentId)||void 0===t||!t.match(w.CJ))||i.questionId&&(null===(a=i.questionId)||void 0===a||!a.match(w.CJ)))return(0,p.jsx)(l.Fg,{to:`/courses/${D}/${e.assessmentConfiguration.type}`});const K=(0,de.GA)(i.assessmentId),q=(0,de.GA)(i.questionId)||g.Z.defaultQuestionId;if(null!==K&&void 0!==W){const t=W.filter((e=>e.id===K))[0];if(!t)return(0,p.jsx)(Ce,{});const a={assessmentId:K,questionId:q,notAttempted:t.status===A.PF.not_attempted,canSave:!O||t.status!==A.PF.submitted&&!(0,ge.IU)(t.closeAt),assessmentConfiguration:e.assessmentConfiguration};return(0,p.jsx)(xe,{...a})}let Z;if(void 0===W)Z=(0,p.jsx)(n.tR,{description:"Fetching assessment...",icon:(0,p.jsx)(n.$j,{})});else if(0===W.length)Z=(0,p.jsx)(n.tR,{title:"There are no assessments.",icon:b.d.FLAME});else{const e=e=>!(0,ge.IU)(e.closeAt)&&!(0,ge.IU)(e.openAt),t=F(W.filter(e)).map(((e,t)=>z(e,t,!O,!1))),a=e=>!(0,ge.IU)(e.closeAt)&&(0,ge.IU)(e.openAt)&&e.status!==A.PF.submitted,s=F(W.filter((e=>a(e)))).map(((e,t)=>z(e,t,!0,!1))),i=F(W.filter((t=>!a(t)&&!e(t)))).map(((e,t)=>z(e,t,!0,!0))),r=(0,p.jsxs)(p.Fragment,{children:[Se("Upcoming",P,G),(0,p.jsx)(n.UO,{isOpen:P,children:t})]}),o=(0,p.jsxs)(p.Fragment,{children:[Se("Open",M,L),(0,p.jsx)(n.UO,{isOpen:M,children:s})]}),c=(0,p.jsxs)(p.Fragment,{children:[Se("Closed",S,B),(0,p.jsx)(n.UO,{isOpen:S,children:i})]});Z=(0,p.jsxs)(p.Fragment,{children:[t.length>0?r:null,s.length>0?o:null,i.length>0?c:null]})}const Y=m?(0,p.jsxs)("p",{children:["You are about to finalise your submission for the ",m.type.toLowerCase()," ",(0,p.jsxs)("i",{children:['"',m.title,'"']}),"."]}):(0,p.jsx)("p",{children:"You are about to finalise your submission."}),J=(0,p.jsxs)(p.Fragment,{children:[Y,(0,p.jsxs)("p",{children:["Finalising your submission early grants you additional XP, but"," ",(0,p.jsx)("span",{className:"warning",children:"this action is irreversible."})]})]}),Q=(0,p.jsxs)(n.Vq,{className:"betcha-dialog",icon:b.d.ERROR,isCloseButtonShown:!0,isOpen:null!==m,onClose:U,title:"Finalise submission?",children:[(0,p.jsx)("div",{className:s.TmF,children:(0,p.jsx)(n.xv,{children:J})}),(0,p.jsx)("div",{className:s.Alt,children:(0,p.jsxs)(n.hE,{children:[(0,p.jsx)(H.Z,{label:"Cancel",onClick:U,options:{minimal:!1}}),(0,p.jsx)(H.Z,{label:"Finalise",onClick:()=>{m&&(R((0,u.submitAssessment)(m.id)),U())},options:{minimal:!1,intent:h.S.DANGER}})]})})]});return(0,p.jsxs)("div",{className:"Assessment",children:[(0,p.jsx)(ye.Z,{display:Z,loadContentDispatch:()=>R((0,u.fetchAssessmentOverviews)())}),Q]})};var we=a(36896),Ie=a(59050),ke=a(16219),Me=a(58596),Ae=a(42805);const Te={coverImage:`${Ae.ej}/default.png`,description:"",completionText:""},Pe={uuid:"",title:"Achievement Title Here",xp:0,isVariableXp:!1,isTask:!1,position:0,prerequisiteUuids:[],goalUuids:[],cardBackground:`${Ae.Y9}/default.png`,view:Te};const Ee=function(e){const{allowNewUuid:t,setNewUuid:a}=e,s=(0,o.useContext)(Ae.gc);return(0,p.jsx)(n.zx,{className:"command-button",disabled:!t,icon:b.d.NEW_OBJECT,onClick:()=>a(s.insertAchievement(Pe)),text:"Create Achievement"})};var Ne=a(97594);const Oe=function(e){const{deleteItem:t,item:a}=e;return(0,p.jsx)(C.u,{content:"Delete",children:(0,p.jsx)(n.zx,{icon:b.d.TRASH,intent:"danger",onClick:async()=>{await(0,Ne.pG)({contents:`Are you sure you want to delete '${a}' ?`,negativeLabel:"No",positiveIntent:"danger",positiveLabel:"Yes, delete"})&&t()}})})};const De=function(e){const{discardChanges:t,saveChanges:a}=e;return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(C.u,{content:"Save Changes",children:(0,p.jsx)(n.zx,{icon:b.d.FLOPPY_DISK,intent:"primary",onClick:()=>{a(),(0,T.rO)("Saved changes locally")}})}),(0,p.jsx)(C.u,{content:"Discard Changes",children:(0,p.jsx)(n.zx,{icon:b.d.CROSS,intent:"danger",onClick:()=>{t(),(0,T.N9)("Discarded changes")}})})]})};var Re=a(88489);const Be=function(e){const{changeGoalUuids:t,goalUuids:a}=e,s=(0,o.useContext)(Ae.gc),i=s.getAllGoalUuids(),r=a.filter((e=>!s.isInvalidGoal(s.getGoal(e)))),c=Re.N.ofType(),l=new Set(r),d=new Set((0,f.without)(i,...a)),h=e=>{void 0!==h&&(l.delete(e),d.add(e),t([...l]))};return(0,p.jsx)(c,{itemRenderer:(e,t)=>{let{handleClick:a}=t;return(0,p.jsx)(n.sN,{onClick:a,text:e.text},e.uuid)},items:[...d].map((e=>s.getGoal(e))),noResults:(0,p.jsx)(n.sN,{disabled:!0,text:"No available goal"}),onItemSelect:e=>{return a=e.uuid,l.add(a),d.delete(a),void t([...l]);var a},selectedItems:[...l].map((e=>s.getGoal(e))),tagInputProps:{onRemove:e=>h((e=>s.getUuidByText(e))(e.toString()))},tagRenderer:e=>e.text,itemPredicate:(e,t)=>t.text.toLowerCase().includes(e.toLowerCase()),resetOnSelect:!0})};var Le=a(28644);const Ge=function(e){const{changePosition:t,position:a}=e,s=(0,o.useContext)(Ae.gc).listTaskUuids().length+1,i=[...Array(s+1).keys()],r=Le.P.ofType();return(0,p.jsx)(r,{filterable:!1,itemRenderer:(e,t)=>{let{handleClick:a}=t;return(0,p.jsx)(n.sN,{onClick:a,text:e},e)},items:i,onItemSelect:t,children:(0,p.jsx)(n.zx,{text:a})})};const Ue=function(e){const{changePrerequisiteUuids:t,uuid:a,prerequisiteUuids:s}=e,i=(0,o.useContext)(Ae.gc),r=[],c=s.filter((e=>!i.isInvalidAchievement(i.getAchievement(e)))),l=Re.N.ofType(),d=new Set(c),h=new Set((0,f.without)(r,...c));return(0,p.jsx)(l,{itemRenderer:(e,t)=>{let{handleClick:a}=t;return(0,p.jsx)(n.sN,{onClick:a,text:e.title},e.uuid)},items:[...h].map((e=>i.getAchievement(e))),noResults:(0,p.jsx)(n.sN,{disabled:!0,text:"No available achievement"}),onItemSelect:e=>{return a=e.uuid,d.add(a),h.delete(a),void t([...d]);var a},selectedItems:[...d].map((e=>i.getAchievement(e))),tagInputProps:{onRemove:e=>{var a;void 0!==(a=(e=>i.getUuidByTitle(e))(e.toString()))&&(d.delete(a),h.add(a),t([...d]))}},tagRenderer:e=>e.title,itemPredicate:(e,t)=>t.title.toLowerCase().includes(e.toLowerCase()),resetOnSelect:!0})};const Fe=function(e){const{changeCardBackground:t,changeGoalUuids:a,changePosition:s,changePrerequisiteUuids:i,changeIsVariableXp:r,editableAchievement:c}=e,{uuid:l,cardBackground:d,goalUuids:h,position:u,prerequisiteUuids:g,isVariableXp:m}=c,[x,y]=(0,o.useState)(!1),v=()=>y(!x);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(C.u,{content:"More Settings",children:(0,p.jsx)(n.zx,{icon:b.d.WRENCH,onClick:v})}),(0,p.jsx)(n.Vq,{title:"More Settings",icon:b.d.WRENCH,isOpen:x,onClose:v,children:(0,p.jsxs)("div",{style:{padding:"0 0.5em"},children:[(0,p.jsx)("h3",{children:"Card Background"}),(0,p.jsx)(n.sL,{multiline:!0,onChange:t,placeholder:"Enter card background URL here",value:d}),(0,p.jsx)("h3",{children:"Position"}),(0,p.jsx)("p",{children:"Note: Select position 0 to hide achievement"}),(0,p.jsx)(Ge,{changePosition:s,position:u}),(0,p.jsx)("h3",{children:"Prerequisites"}),(0,p.jsx)(Ue,{changePrerequisiteUuids:i,uuid:l,prerequisiteUuids:g}),(0,p.jsx)("h3",{children:"Goals"}),(0,p.jsx)(Be,{changeGoalUuids:a,goalUuids:h}),(0,p.jsx)("h3",{children:"Variable XP"}),(0,p.jsx)(n.XZ,{label:"The rewarded XP will be equal to the sum of 'count' of goals",checked:m,onChange:r})]})})]})};const _e=function(e){const{uuid:t}=e;return(0,p.jsx)(C.u,{content:"Click to copy achievement UUID",children:(0,p.jsx)(n.zx,{icon:b.d.CLIPBOARD,onClick:()=>{navigator.clipboard.writeText(t),(0,T.rO)("UUID copied to clipboard")}})})};let Ve;!function(e){e.CHANGE_CARD_BACKGROUND="CHANGE_CARD_BACKGROUND",e.CHANGE_DEADLINE="CHANGE_DEADLINE",e.CHANGE_GOAL_UUIDS="CHANGE_GOAL_UUIDS",e.CHANGE_POSITION="CHANGE_POSITION",e.CHANGE_PREREQUISITE_UUIDS="CHANGE_PREREQUISITE_UUIDS",e.CHANGE_RELEASE="CHANGE_RELEASE",e.CHANGE_TITLE="CHANGE_TITLE",e.CHANGE_IS_VARIABLE_XP="CHANGE_VARIABLE_XP",e.CHANGE_VIEW="CHANGE_VIEW",e.CHANGE_XP="CHANGE_XP",e.DELETE_ACHIEVEMENT="DELETE_ACHIEVEMENT",e.DISCARD_CHANGES="DISCARD_CHANGES",e.SAVE_CHANGES="SAVE_CHANGES"}(Ve||(Ve={}));var He=a(23213),ze=a(61134);const $e=function(e){const{type:t,date:a,changeDate:s}=e,[i,r]=(0,o.useState)(!1),c=()=>r(!i),l=void 0===a?`No ${t}`:`${(0,ze.ti)(a)}`;return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(C.u,{content:l,children:(0,p.jsx)(n.zx,{minimal:!0,onClick:c,outlined:!0,children:`${t}`})}),(0,p.jsxs)(n.Vq,{isCloseButtonShown:!1,isOpen:i,onClose:c,style:{background:"#fff",maxWidth:"max-content",padding:"0.25em",textAlign:"center"},title:`${t}`,children:[(0,p.jsx)(He.M,{onChange:s,timePickerProps:{showArrowButtons:!0},value:a}),(0,p.jsx)(n.zx,{onClick:()=>s(void 0),text:`Remove ${t}`})]})]})};const Xe=function(e){const{changeView:t,view:a}=e,{coverImage:s,description:i,completionText:r}=a,[c,l]=(0,o.useState)(!1),d=()=>l(!c);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(C.u,{content:"Edit View",children:(0,p.jsx)(n.zx,{icon:b.d.WIDGET_HEADER,onClick:d})}),(0,p.jsx)(n.Vq,{title:"Edit View",icon:b.d.WIDGET_HEADER,isOpen:c,onClose:d,children:(0,p.jsxs)("div",{style:{padding:"0 0.5em"},children:[(0,p.jsx)("h3",{children:"Cover Image"}),(0,p.jsx)(n.sL,{multiline:!0,onChange:e=>t({...a,coverImage:e}),placeholder:"Enter cover image URL here",value:s}),(0,p.jsx)("h3",{children:"Description"}),(0,p.jsx)(n.sL,{multiline:!0,onChange:e=>t({...a,description:e}),placeholder:"Enter description here",value:i}),(0,p.jsx)("h3",{children:"Completion Text"}),(0,p.jsx)(n.sL,{multiline:!0,onChange:e=>t({...a,completionText:e}),placeholder:"Enter completion text here",value:r})]})})]})},We=e=>({editableAchievement:e,isDirty:!1}),Ke=(e,t)=>{switch(t.type){case Ve.SAVE_CHANGES:return{...e,isDirty:!1};case Ve.DISCARD_CHANGES:return We(t.payload);case Ve.DELETE_ACHIEVEMENT:return{...e,isDirty:!1};case Ve.CHANGE_CARD_BACKGROUND:return{editableAchievement:{...e.editableAchievement,cardBackground:t.payload},isDirty:!0};case Ve.CHANGE_DEADLINE:return{editableAchievement:{...e.editableAchievement,deadline:t.payload},isDirty:!0};case Ve.CHANGE_GOAL_UUIDS:return{editableAchievement:{...e.editableAchievement,goalUuids:t.payload},isDirty:!0};case Ve.CHANGE_POSITION:return{editableAchievement:{...e.editableAchievement,isTask:0!==t.payload,position:t.payload},isDirty:!0};case Ve.CHANGE_PREREQUISITE_UUIDS:return{editableAchievement:{...e.editableAchievement,prerequisiteUuids:t.payload},isDirty:!0};case Ve.CHANGE_RELEASE:return{editableAchievement:{...e.editableAchievement,release:t.payload},isDirty:!0};case Ve.CHANGE_TITLE:return{editableAchievement:{...e.editableAchievement,title:t.payload},isDirty:!0};case Ve.CHANGE_VIEW:return{editableAchievement:{...e.editableAchievement,view:t.payload},isDirty:!0};case Ve.CHANGE_XP:return{editableAchievement:{...e.editableAchievement,xp:t.payload},isDirty:!0};case Ve.CHANGE_IS_VARIABLE_XP:return{editableAchievement:{...e.editableAchievement,isVariableXp:!e.editableAchievement.isVariableXp},isDirty:!0};default:return e}};const qe=function(e){const{uuid:t,isNewAchievement:a,releaseUuid:s,removeCard:i,requestPublish:r}=e,c=(0,o.useContext)(Ae.gc),l=c.getAchievement(t),d=(0,o.useMemo)((()=>(0,f.cloneDeep)(l)),[l]),[h,u]=(0,o.useReducer)(Ke,d,We),[g,m]=(0,o.useState)(a),{editableAchievement:x,isDirty:y}=h,{cardBackground:v,deadline:S,release:j,title:w,view:I,xp:k}=x;return(0,p.jsxs)("li",{className:"editable-card",style:{background:`url(${v}) center/cover`},children:[(0,p.jsx)("div",{className:"action-button",children:y?(0,p.jsx)(De,{discardChanges:()=>u({type:Ve.DISCARD_CHANGES,payload:d}),saveChanges:()=>{u({type:Ve.SAVE_CHANGES}),c.modifyAchievement(x),g&&(s(),m(!1)),r()}}):(0,p.jsx)(Oe,{deleteItem:()=>{u({type:Ve.DELETE_ACHIEVEMENT}),c.removeAchievement(t),g&&(s(),m(!1)),i(t),r()},item:w})}),(0,p.jsxs)("div",{className:"content",children:[(0,p.jsx)("h3",{className:"title",children:(0,p.jsx)(n.sL,{onChange:e=>u({type:Ve.CHANGE_TITLE,payload:e}),placeholder:"Enter your title here",value:w})}),(0,p.jsx)("div",{className:"xp",children:(0,p.jsx)(C.u,{content:"XP",children:(0,p.jsx)(n.Af,{value:k,min:0,allowNumericCharactersOnly:!0,leftIcon:b.d.TRENDING_UP,placeholder:"XP",onValueChange:e=>u({type:Ve.CHANGE_XP,payload:e})})})}),(0,p.jsxs)("div",{className:"details",children:[(0,p.jsx)($e,{changeDate:e=>u({type:Ve.CHANGE_RELEASE,payload:e}),date:j,type:"Release"}),(0,p.jsx)($e,{changeDate:e=>u({type:Ve.CHANGE_DEADLINE,payload:e}),date:S,type:"Deadline"}),(0,p.jsx)(_e,{uuid:t})]})]}),(0,p.jsxs)("div",{className:"content-button",children:[(0,p.jsx)(Xe,{changeView:e=>u({type:Ve.CHANGE_VIEW,payload:e}),view:I}),(0,p.jsx)(Fe,{changeCardBackground:e=>u({type:Ve.CHANGE_CARD_BACKGROUND,payload:e}),changeGoalUuids:e=>{u({type:Ve.CHANGE_GOAL_UUIDS,payload:e})},changePosition:e=>u({type:Ve.CHANGE_POSITION,payload:e}),changePrerequisiteUuids:e=>u({type:Ve.CHANGE_PREREQUISITE_UUIDS,payload:e}),changeIsVariableXp:()=>u({type:Ve.CHANGE_IS_VARIABLE_XP}),editableAchievement:x})]})]})};let Ze=[];const Ye=function(e){const{requestPublish:t}=e,a=(0,o.useContext)(Ae.gc),[s,n]=(0,o.useState)(""),i=""===s,r=()=>n(""),c=e=>{let t=0;for(;Ze[t].key!==e&&t<Ze.length;)t++;Ze.splice(t,1)},l=(e,a)=>(0,p.jsx)(qe,{uuid:e,isNewAchievement:a,releaseUuid:r,removeCard:c,requestPublish:t},e);return 0===Ze.length&&(Ze=a.listSortedAchievementUuids().map((e=>l(e,!1)))),(0,p.jsxs)("div",{className:"achievement-editor",children:[(0,p.jsx)("div",{className:"command",children:(0,p.jsx)(Ee,{allowNewUuid:i,setNewUuid:e=>{n(e),Ze[Ze.length]=Ze[0],Ze[0]=l(e,!0)}})}),(0,p.jsx)("ul",{className:"achievement-container",children:Ze})]})};var Je=a(79752);const Qe=function(e){const{filterState:t,icon:a,ownStatus:s}=e,[i,r]=t;return(0,p.jsxs)("div",{className:"filter",onClick:()=>r(s),style:{color:(0,Ae.jf)(i,s)},children:[(0,p.jsx)(n.JO,{icon:a,iconSize:30}),(0,p.jsx)("p",{children:s})]})};var et=a(47010),tt=a(81920);const at=function(e){const{studentXp:t}=e;return(0,p.jsxs)("div",{className:"milestone",children:[(0,p.jsx)("h3",{children:"Your Total XP"}),(0,p.jsxs)("div",{className:"user-xp",children:[t," XP"]}),(0,p.jsx)("h3",{children:"CA Achievement Level"}),(0,p.jsxs)("div",{className:"details",children:[(0,p.jsxs)("div",{className:"level-badge",children:[(0,p.jsx)("span",{className:"level-icon"}),(0,p.jsx)("p",{children:g.Z.caFulfillmentLevel})]}),(0,p.jsx)("p",{className:"description",children:"Complete CS1101S CA Component"})]}),(0,p.jsxs)("div",{className:"details",children:[(0,p.jsxs)("div",{className:"level-badge",children:[(0,p.jsx)("span",{className:"level-icon"}),(0,p.jsxs)("p",{children:[g.Z.caFulfillmentLevel,"+"]})]}),(0,p.jsx)("p",{className:"description",children:"Counts towards CS1010R"})]}),(0,p.jsx)("div",{className:"footer",children:(0,p.jsxs)("p",{children:["Full CA level of ",g.Z.caFulfillmentLevel," is subjected to change."]})})]})};const st=function(e){const{studentXp:t}=e,[a,s]=(0,o.useState)(!1),i=Math.floor(t/Ae.Dt)+1,r=t%Ae.Dt,c=r/Ae.Dt;return(0,p.jsxs)("div",{className:"level",onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),children:[(0,p.jsxs)("div",{className:"level-badge",children:[(0,p.jsx)("span",{className:"level-icon"}),(0,p.jsx)("p",{children:`Level ${i}`})]}),(0,p.jsxs)("span",{className:"level-progress",children:[(0,p.jsx)(n.ko,{animate:!1,className:"progress-bar",stripes:!1,value:c}),(0,p.jsxs)("p",{children:[r," / ",Ae.Dt," XP"]})]}),0!==g.Z.caFulfillmentLevel&&a&&(0,p.jsx)(at,{studentXp:t})]})};const nt=function(e){const{name:t,userState:a}=e,[s]=a,n=null===s||void 0===s?void 0:s.courseRegId,i=(0,x.ix)((e=>e.session.courseRegId)),r=(0,c.I0)();(0,o.useEffect)((()=>{r(n&&n!==i?{type:tt.wn,payload:n}:{type:tt.e_})}),[n,i,r]);const l=(0,x.ix)((e=>e.session.xp));return(0,p.jsxs)("div",{className:"achievement-overview",children:[(0,p.jsx)(st,{studentXp:l}),(0,p.jsx)("h3",{children:t})]})},it=new Date(0,0,2).getTime()-new Date(0,0,0).getTime();const rt=function(e){const{deadline:t}=e,a=void 0!==t&&!(0,ze.Bw)(t)&&(0,ze.Y4)(t)<=it?Ae.dh.RED:Ae.dh.BLACK;return(0,p.jsxs)("div",{className:"deadline",children:[(0,p.jsx)(n.JO,{color:a,icon:b.d.STOPWATCH}),(0,p.jsx)("p",{style:{color:a},children:(0,ze.xI)(t)})]})},ot=(e,t)=>(t?"Total ":"")+e+" XP";const ct=function(e){const{isBonus:t,xp:a}=e;return(0,p.jsx)("div",{className:"xp",children:0!==a&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(n.JO,{icon:b.d.BANK_ACCOUNT}),(0,p.jsx)("p",{children:ot(a,t)})]})})};const lt=function(e){const{uuid:t,focusState:a,isDropdownOpen:s,shouldRender:i,toggleDropdown:r}=e,c=(0,o.useContext)(Ae.gc),[l,d]=a,{cardBackground:u,title:g}=c.getAchievement(t),m=c.getDisplayDeadline(t),x=c.getDescendantXp(t),y=c.getProgressFrac(t),v=c.getStatus(t),C=void 0!==s&&0!==c.getImmediateChildren(t).size;return(0,p.jsxs)("div",{className:"achievement-card",onClick:()=>d(t),onClickCapture:r,style:{...(0,Ae.cb)(t,l),opacity:i?"100%":"20%",background:`url(${u}) center/cover`},children:[(0,p.jsx)("div",{className:"dropdown-button",children:C&&(0,p.jsx)(n.JO,{icon:s?b.d.CARET_DOWN:b.d.CARET_RIGHT})}),(0,p.jsxs)("div",{className:"content",children:[(0,p.jsxs)("div",{className:"heading",children:[(0,p.jsx)("h3",{children:g.toUpperCase()}),v===Je.Cv.COMPLETED&&(0,p.jsx)(n.JO,{icon:b.d.CONFIRM,intent:h.S.SUCCESS,style:{padding:"1em"}})]}),(0,p.jsxs)("div",{className:"details",children:[(0,p.jsx)(rt,{deadline:m}),(0,p.jsx)(ct,{isBonus:C,xp:x})]}),(0,p.jsx)(n.ko,{animate:!1,className:"progress",intent:1===y?"success":"primary",stripes:!1,value:y})]})]})},dt=e=>{let{uuid:t,filterStatus:a,focusState:s}=e;const i=(0,o.useContext)(Ae.gc),r=[...i.getImmediateChildren(t)],c=(0,Ae.Xb)(),[l,d]=(0,o.useState)(!1),h=e=>{const t=i.getStatus(e);switch(a){case Je.fS.ALL:return!0;case Je.fS.ACTIVE:return t===Je.Cv.ACTIVE;case Je.fS.COMPLETED:return t===Je.Cv.COMPLETED;default:return!1}};return(0,p.jsx)(p.Fragment,{children:(e=>(e=>!i.isPrerequisite(e)&&h(e))(e)||(e=>[...i.getImmediateChildren(e)].reduce(((e,t)=>e||h(t)),!1))(e))(t)&&(0,p.jsxs)("li",{className:"task",children:[(0,p.jsx)(lt,{uuid:t,focusState:s,isDropdownOpen:l,shouldRender:h(t),toggleDropdown:()=>d(!l)}),(0,p.jsx)(n.UO,{isOpen:l,keepChildrenMounted:!0,children:(0,p.jsx)("div",{className:"prerequisite-container",children:r.map((e=>(0,p.jsxs)("div",{className:"prerequisite",children:[(0,p.jsx)("div",{className:"dropdown-lines",style:{borderBottom:`1px solid ${c}`,borderLeft:`1px solid ${c}`}}),(0,p.jsx)(lt,{uuid:e,focusState:s,shouldRender:h(e)})]},e)))})})]})})},ht=e=>{let{assessment:t,showToQuestion:a}=e;const s=(0,l.s0)(),n=(0,x.ix)((e=>e.session.courseId)),i=(0,o.useMemo)((()=>e=>{if(!n)return void(0,T.N9)("Course ID not found");const a=`/courses/${n}/${(0,de.q1)(null===t||void 0===t?void 0:t.type)}`+`/${null===t||void 0===t?void 0:t.id.toString()}`;s(a+`/${e}`)}),[null===t||void 0===t?void 0:t.id,null===t||void 0===t?void 0:t.type,n,s]);return(0,p.jsxs)("div",{children:[(0,p.jsx)("h1",{className:"assessment-feedback",children:"Feedback"}),(0,p.jsx)("div",{className:"feedback-list",children:t&&t.questions.map(((e,t)=>(0,p.jsxs)("div",{className:"assessment-comments",children:[(0,p.jsx)("span",{children:(0,p.jsx)("h2",{className:"question-header",children:"Q"+(t+1)})}),(0,p.jsxs)("div",{className:"box-comment",children:[(0,p.jsx)("p",{children:null===e.comments?"No Comments":e.comments}),(0,p.jsx)("p",{className:"xp",children:"XP: "+e.xp+"/"+e.maxXp})]}),a&&(0,p.jsx)("button",{className:"to-assessment-button",onClick:()=>i(t),children:"To Question"})]},t)))})]})};const ut=function(e){const{awardedXp:t,completionText:a}=e,s=a?a.split("\n"):[""];return(0,p.jsxs)("div",{className:"completion",children:[t>0&&(0,p.jsx)("h1",{children:`AWARDED ${t}XP`}),s.map(((e,t)=>(0,p.jsxs)("p",{children:[e,(0,p.jsx)("br",{})]},t)))]})},gt=e=>{const{uuid:t,text:a,targetCount:s,count:i,completed:r}=e,o=Math.min(0===s?0:i/s,1);return(0,p.jsxs)("div",{className:"goal",children:[(0,p.jsxs)("div",{className:"goal-badge",children:[(0,p.jsx)("span",{className:"goal-icon"}),(0,p.jsxs)("p",{children:[i," / ",s]})]}),(0,p.jsxs)("div",{className:"goal-progress",children:[(0,p.jsx)("p",{children:a}),(0,p.jsx)(n.ko,{animate:!1,className:"progress",intent:r?"success":void 0,stripes:!1,value:o})]})]},t)};const pt=function(e){const{goals:t}=e;return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("h1",{className:"progress-header",children:"Progress"}),t.map((e=>gt(e)))]})};const mt=function(e){var t;let{focusUuid:a,userState:s}=e;const i=Number.isNaN(+a)||0===+a?void 0:+a;let r;if(s){const[e]=s;r=null===e||void 0===e?void 0:e.courseRegId}const l=(0,x.ix)((e=>e.session.courseRegId)),d=void 0!==r&&r!==l,h=(0,c.I0)();(0,o.useEffect)((()=>{h({type:A.pL}),i&&h(d?{type:tt.hc,payload:{assessmentId:i,courseRegId:r}}:{type:tt.cp,payload:i})}),[h,i,r,d]);const u=(0,o.useContext)(Ae.gc),g=(0,x.ix)((e=>e.session.assessments)).get(i),m=(null!==(t=(0,x.ix)((e=>e.session.assessmentOverviews)))&&void 0!==t?t:[]).find((e=>e.id===i));if(""===a)return(0,p.jsxs)("div",{className:"no-view",children:[(0,p.jsx)(n.JO,{icon:b.d.MOUNTAIN,iconSize:60}),(0,p.jsx)("h2",{children:"Select an achievement"})]});const y=u.getAchievement(a),{deadline:v,title:C,view:f}=y,{coverImage:S,completionText:j,description:w}=f,I=u.getAchievementXp(a),k=u.listGoals(a),M=u.getStatus(a),T=w?w.split("\n"):[""];return(0,p.jsxs)("div",{className:"view",style:{...(0,Ae.wI)(),...(0,Ae.v_)()},children:[(0,p.jsxs)("div",{className:"cover",style:{background:`rgba(0, 0, 0, 0.5) url(${S}) center/cover`,backgroundBlendMode:"darken"},children:[(0,p.jsx)("h1",{children:C.toUpperCase()}),v&&(0,p.jsx)("p",{children:`Deadline: ${(0,ze.ti)(v)}`}),(0,p.jsx)("span",{className:"description",children:T.map(((e,t)=>(0,p.jsxs)("p",{children:[e,(0,p.jsx)("br",{})]},t)))})]}),M===Je.Cv.COMPLETED&&g&&m&&m.isManuallyGraded&&(0,p.jsx)(ht,{assessment:g,showToQuestion:!d}),k.length>0&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(pt,{goals:k}),M===Je.Cv.COMPLETED&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("hr",{}),(0,p.jsx)(ut,{awardedXp:I,completionText:j})]})]})]})};var xt=a(72426),yt=a.n(xt);function vt(e){return"graded"===e.gradingStatus||!e.isManuallyGraded&&"submitted"===e.status}const bt=function(e,t,a){const s=[...e].sort(((e,t)=>yt()(e.closeAt).diff(yt()(t.closeAt)))),n=e.length,i=t.map((e=>e.type)),r=i.map((e=>[]));s.forEach(((e,t)=>{if(!(0,ze.Oe)(new Date(e.openAt))||(0,ze.Bw)(new Date(e.closeAt))&&"submitted"!==e.status)return;const s=e.id.toString();a.hasAchievement(s)||(a.insertFakeGoalDefinition({uuid:s+"0",text:`Submitted ${e.title}`,achievementUuids:[s],meta:{type:Je.lC.ASSESSMENT,assessmentNumber:e.id,requiredCompletionFrac:0}},"submitted"===e.status),e.isManuallyGraded&&a.insertFakeGoalDefinition({uuid:s+"1",text:`Graded ${e.title}`,achievementUuids:[s],meta:{type:Je.lC.ASSESSMENT,assessmentNumber:e.id,requiredCompletionFrac:0}},"graded"===e.gradingStatus),a.insertFakeAchievement({uuid:s,title:e.title,xp:vt(e)?e.xp:e.maxXp,isVariableXp:!1,deadline:new Date(e.closeAt),release:new Date(e.openAt),isTask:void 0!==e.isPublished&&e.isPublished,position:t-n-100,prerequisiteUuids:[],goalUuids:e.isManuallyGraded?[s+"0",s+"1"]:[s+"0"],cardBackground:`${Ae.Y9}/default.png`,view:{coverImage:e.coverImage,description:e.shortSummary,completionText:`XP: ${e.xp} / ${e.maxXp}`}}),vt(e)&&i.forEach(((t,a)=>{t===e.type&&r[a].push(s)})))})),r.forEach(((e,t)=>{const s=i[t];e.length>0&&a.insertFakeAchievement({uuid:s,title:"Completed "+s,xp:0,isVariableXp:!1,deadline:void 0,release:void 0,isTask:!0,position:-1-t,prerequisiteUuids:e,goalUuids:[],cardBackground:`${Ae.Y9}/default.png`,view:{coverImage:`${Ae.ej}/default.png`,description:"Your completed "+s+" are listed here!",completionText:""}})}))},Ct=(e,t,a)=>e.map((e=>(0,p.jsx)(dt,{uuid:e,filterStatus:t,focusState:a},e))),ft=e=>{const{getAchievements:t,getOwnGoals:a,getGoals:s,getUserAssessmentOverviews:n,getUsers:i,updateGoalProgress:r,fetchAssessmentOverviews:c,group:l,inferencer:h,name:u,role:g,assessmentConfigs:m,assessmentOverviews:x,achievementAssessmentOverviews:y,users:v}=e,C=(0,o.useState)(void 0),[f]=C;(0,o.useEffect)((()=>{f?s(f.courseRegId):a(),f?n(f.courseRegId):c(),t()}),[f,t,s,a,n,c]);const S=f?y:x;S&&m&&bt(S,m,h);const j=(0,o.useState)(Je.fS.ALL),[w]=j,I=(0,o.useState)(""),[k,M]=I,A=(0,o.useState)(!1),[T]=A;return(0,o.useEffect)((()=>{M("")}),[f,M]),(0,p.jsx)(Ae.gc.Provider,{value:h,children:(0,p.jsxs)("div",{className:"AchievementDashboard",children:[(0,p.jsx)(nt,{name:f?f.name||f.username:u||"User",userState:C}),g&&g!==d.uU.Student&&(0,p.jsx)(et.Z,{userState:C,hiddenState:A,studio:l||"Staff",users:v,getUsers:i,updateGoalProgress:r}),(0,p.jsxs)("div",{className:"achievement-main",children:[(0,p.jsxs)("div",{className:"filter-container",children:[(0,p.jsx)(Qe,{filterState:j,icon:b.d.GLOBE,ownStatus:Je.fS.ALL}),(0,p.jsx)(Qe,{filterState:j,icon:b.d.LOCATE,ownStatus:Je.fS.ACTIVE}),(0,p.jsx)(Qe,{filterState:j,icon:b.d.ENDORSED,ownStatus:Je.fS.COMPLETED})]}),(0,p.jsx)("ul",{className:"task-container",children:Ct(g!==d.uU.Student&&T?h.listAllSortedAchievementUuids():h.listSortedReleasedTaskUuids(),w,I)}),(0,p.jsx)("div",{className:"view-container",children:(0,p.jsx)(mt,{focusUuid:k,userState:C})})]})]})})};const St=function(e){const{awaitPublish:t,publishChanges:a}=e,s=(0,o.useContext)(Ae.gc),[i,r]=(0,o.useReducer)((e=>!e),!1),c=(0,o.useState)(""),[l]=c;return(0,p.jsxs)("div",{className:"achievement-preview",children:[(0,p.jsxs)("div",{className:"command",children:[(0,p.jsx)(n.zx,{className:"command-button",icon:i&&b.d.ARROW_LEFT,rightIcon:!i&&b.d.ARROW_RIGHT,text:i?"Task":"View",onClick:r}),t&&(0,p.jsx)(n.zx,{className:"command-button",icon:b.d.CLOUD_UPLOAD,intent:"primary",text:"Publish Changes",onClick:a})]}),i?(0,p.jsx)("div",{className:"preview-container",children:(0,p.jsx)(mt,{focusUuid:l})}):(0,p.jsx)("ul",{className:"preview-container",children:Ct(s.listSortedTaskUuids(),Je.fS.ALL,c)})]})};let jt;!function(e){e.CHANGE_META="CHANGE_META",e.CHANGE_TEXT="CHANGE_TEXT",e.DELETE_GOAL="DELETE_GOAL",e.DISCARD_CHANGES="DISCARD_CHANGES",e.SAVE_CHANGES="SAVE_CHANGES"}(jt||(jt={}));const wt=e=>{switch(e){case Je.lC.ASSESSMENT:return{type:Je.lC.ASSESSMENT,assessmentNumber:0,requiredCompletionFrac:0};case Je.lC.BINARY:return{type:Je.lC.BINARY,condition:!1,targetCount:1};case Je.lC.MANUAL:return{type:Je.lC.MANUAL,targetCount:1};case Je.lC.EVENT:return{type:Je.lC.EVENT,eventNames:[Je.tw.RUN_CODE],targetCount:1,release:void 0,deadline:void 0,observeFrom:void 0,observeTo:void 0}}},It={uuid:"",text:"Goal Text Here",achievementUuids:[],meta:wt(Je.lC.MANUAL)};const kt=function(e){const{assessmentMeta:t,changeMeta:a}=e,{assessmentNumber:s,requiredCompletionFrac:i}=t;return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(C.u,{content:"Assessment Number",children:(0,p.jsx)(n.Af,{allowNumericCharactersOnly:!0,onValueChange:e=>a({...t,assessmentNumber:e}),placeholder:"Enter assessment number here",value:s})}),(0,p.jsx)(C.u,{content:"Required Completion Percentage",children:(0,p.jsx)(n.Af,{allowNumericCharactersOnly:!0,max:100,min:0,onValueChange:e=>{const s=e/100;a({...t,requiredCompletionFrac:s})},placeholder:"Enter required completion percentage here",rightElement:(0,p.jsx)("p",{children:"%"}),value:100*i})})]})};let Mt;function At(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return{type:"AND",operands:t}}function Tt(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return{type:"OR",operands:t}}!function(e){e.ACHIEVEMENT="achievement",e.ASSESSMENT_GRADING="assessment-grading",e.ASSESSMENT_SUBMISSION="assessment-submission"}(Mt||(Mt={}));const Pt=Le.P.ofType(),Et=(e,t)=>{let{handleClick:a}=t;return(0,p.jsx)(n.sN,{onClick:a,text:e},e)},Nt=e=>{if("object"===typeof e&&"type"in e){const{type:t,operands:a}=e,s=a.length,n=[];for(let e=0;e<s;e++)n.push(Nt(a[e])),e!==s-1&&n.push(t);return n.flat()}return[JSON.stringify(e)]};const Ot=function(e){const{binaryMeta:t,changeMeta:a}=e,{condition:s,targetCount:i}=t,r=[],o=[],c=Nt(s);for(let n=0;n<c.length;n++)n%2===0?o[o.length]=c[n]:r[r.length]=c[n];const l=()=>{let e=JSON.parse(o[0]);for(let t=1;t<o.length;t++)e="AND"===r[t-1]?At(e,JSON.parse(o[t])):Tt(e,JSON.parse(o[t]));a({...t,condition:e})};return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(C.u,{content:"Target Count",children:(0,p.jsx)(n.Af,{allowNumericCharactersOnly:!0,leftIcon:b.d.BANK_ACCOUNT,min:0,onValueChange:e=>a({...t,targetCount:e}),placeholder:"Enter target count here",value:i})}),c.map(((e,t)=>(0,p.jsx)("div",{children:t%2===0?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(C.u,{content:"Condition",children:(0,p.jsx)(n.sL,{onChange:e=>((e,t)=>{o[t]=e,l()})(e,t/2),multiline:!0,placeholder:"Enter condition here",value:e})}),o.length>1&&(0,p.jsx)(C.u,{content:"Delete Condition",children:(0,p.jsx)(n.zx,{intent:"danger",icon:"trash",onClick:()=>(e=>{for(let t=e;t<o.length-1;t++)o[t]=o[t+1],r[t]=r[t+1];o.length=o.length-1,r.length=r.length-1,l()})(t)})})]}):(0,p.jsx)(C.u,{content:"And/Or",children:(0,p.jsx)(Pt,{filterable:!1,itemRenderer:Et,items:["AND","OR"],onItemSelect:e=>((e,t)=>{r[t]=e,l()})(e,(t-1)/2),children:(0,p.jsx)(n.zx,{minimal:!0,outlined:!0,text:e})})})},t))),(0,p.jsx)("br",{}),(0,p.jsx)(n.zx,{minimal:!0,outlined:!0,text:"Add Condition",onClick:()=>{r.push("AND"),o.push('{"event":"", "restriction":""}'),l()}})]})};const Dt=function(e){const{type:t,date:a,changeDate:s}=e,[i,r]=(0,o.useState)(!1),c=()=>r(!i),l=void 0===a?`No ${t}`:`${(0,ze.ti)(a)}`;return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(C.u,{content:l,children:(0,p.jsx)(n.zx,{minimal:!0,onClick:c,outlined:!0,children:`${t}`})}),(0,p.jsxs)(n.Vq,{isCloseButtonShown:!1,isOpen:i,onClose:c,style:{background:"#fff",maxWidth:"max-content",padding:"0.25em",textAlign:"center"},title:`${t}`,children:[(0,p.jsx)(He.M,{onChange:s,timePickerProps:{showArrowButtons:!0},value:a}),(0,p.jsx)(n.zx,{onClick:()=>s(void 0),text:`Remove ${t}`})]})]})};var Rt=a(78045);const Bt=function(e){const{type:t,time:a,changeTime:s}=e,[i,r]=(0,o.useState)(!1),c=()=>r(!i),l=void 0===a?`No ${t}`:`${(0,ze.yG)(a)}`;return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(C.u,{content:l,children:(0,p.jsx)(n.zx,{minimal:!0,onClick:c,outlined:!0,children:`${t}`})}),(0,p.jsxs)(n.Vq,{isCloseButtonShown:!1,isOpen:i,onClose:c,style:{background:"#fff",maxWidth:"max-content",padding:"0.25em",textAlign:"center"},title:`${t}`,children:[(0,p.jsx)(Rt.j,{onChange:s,showArrowButtons:!0,value:a}),(0,p.jsx)(n.zx,{onClick:()=>s(void 0),text:`Remove ${t}`})]})]})},Lt=Le.P.ofType(),Gt=(e,t)=>{let{handleClick:a}=t;return(0,p.jsx)(n.sN,{onClick:a,text:e},e)};const Ut=function(e){const{changeMeta:t,eventMeta:a}=e,{eventNames:s,targetCount:i,release:r,deadline:o,observeFrom:c,observeTo:l}=a,d=e=>n=>((e,n)=>{e===Je.tw.NONE?t({...a,eventNames:s.filter(((e,t)=>t!==n))}):(s[n]=e,t({...a,eventNames:s}))})(n,e);return(0,p.jsxs)(p.Fragment,{children:[s.map(((e,t)=>(0,p.jsx)(C.u,{content:"Change event type "+t,children:(0,p.jsx)(Lt,{filterable:!1,items:Object.values(Je.tw),itemRenderer:Gt,onItemSelect:d(t),children:(0,p.jsx)(n.zx,{outlined:!0,text:e})})},t))),(0,p.jsx)(C.u,{content:"Add Event",children:(0,p.jsx)(n.zx,{outlined:!0,text:"Add Event",onClick:()=>{s[s.length]=Je.tw.RUN_CODE,t({...a,eventNames:s})}})}),(0,p.jsx)(C.u,{content:"Target Count",children:(0,p.jsx)(n.Af,{allowNumericCharactersOnly:!0,leftIcon:b.d.LOCATE,min:0,onValueChange:e=>t({...a,targetCount:e}),placeholder:"Enter target count here",value:i})}),(0,p.jsx)("br",{}),(0,p.jsx)(Dt,{type:"Release",date:r,changeDate:e=>{t({...a,release:e})}}),(0,p.jsx)(Dt,{type:"Deadline",date:o,changeDate:e=>{t({...a,deadline:e})}}),(0,p.jsx)(Bt,{type:"Observe From",time:c,changeTime:e=>{t({...a,observeFrom:e})}}),(0,p.jsx)(Bt,{type:"Observe To",time:l,changeTime:e=>{t({...a,observeTo:e})}})]})};const Ft=function(e){const{changeMeta:t,manualMeta:a}=e,{targetCount:s}=a;return(0,p.jsx)(C.u,{content:"Target Count",children:(0,p.jsx)(n.Af,{allowNumericCharactersOnly:!0,leftIcon:b.d.BANK_ACCOUNT,min:0,onValueChange:e=>t({...a,targetCount:e}),placeholder:"Enter target count here",value:s})})};const _t=function(e){const{changeMeta:t,meta:a}=e,{type:s}=a,i=Le.P.ofType();return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(C.u,{content:"Change Goal Type",children:(0,p.jsx)(i,{filterable:!1,itemRenderer:(e,t)=>{let{handleClick:a}=t;return(0,p.jsx)(n.sN,{onClick:a,text:e},e)},items:Object.values(Je.lC),onItemSelect:e=>t(wt(e)),children:(0,p.jsx)(n.zx,{minimal:!0,outlined:!0,text:s})})}),(e=>{switch(e){case Je.lC.ASSESSMENT:return(0,p.jsx)(kt,{assessmentMeta:a,changeMeta:t});case Je.lC.BINARY:return(0,p.jsx)(Ot,{binaryMeta:a,changeMeta:t});case Je.lC.MANUAL:return(0,p.jsx)(Ft,{changeMeta:t,manualMeta:a});case Je.lC.EVENT:return(0,p.jsx)(Ut,{eventMeta:a,changeMeta:t});default:return null}})(s)]})},Vt=e=>({editableGoal:e,isDirty:!1}),Ht=(e,t)=>{switch(t.type){case jt.SAVE_CHANGES:return{...e,isDirty:!1};case jt.DISCARD_CHANGES:return Vt(t.payload);case jt.DELETE_GOAL:return{...e,isDirty:!1};case jt.CHANGE_META:return{editableGoal:{...e.editableGoal,meta:t.payload},isDirty:!0};case jt.CHANGE_TEXT:return{editableGoal:{...e.editableGoal,text:t.payload},isDirty:!0};default:return e}};const zt=function(e){const{uuid:t,isNewGoal:a,releaseUuid:s,removeCard:i,requestPublish:r}=e,c=(0,o.useContext)(Ae.gc),l=c.getGoalDefinition(t),d=(0,o.useMemo)((()=>(0,f.cloneDeep)(l)),[l]),[h,u]=(0,o.useReducer)(Ht,d,Vt),[g,m]=(0,o.useState)(a),{editableGoal:x,isDirty:y}=h,{meta:v,text:b}=x;return(0,p.jsxs)("li",{className:"editable-goal",id:t,children:[(0,p.jsx)("div",{className:"action-button",children:y?(0,p.jsx)(De,{discardChanges:()=>u({type:jt.DISCARD_CHANGES,payload:d}),saveChanges:()=>{u({type:jt.SAVE_CHANGES}),c.modifyGoalDefinition(x),g&&(s(),m(!1)),r()}}):(0,p.jsx)(Oe,{deleteItem:()=>{u({type:jt.DELETE_GOAL}),c.removeGoalDefinition(t),g&&(s(),m(!1)),i(t),r()},item:b})}),(0,p.jsx)("h3",{children:(0,p.jsx)(n.sL,{onChange:e=>u({type:jt.CHANGE_TEXT,payload:e}),placeholder:"Enter goal text here",value:b})}),(0,p.jsx)("div",{className:"meta",children:(0,p.jsx)(_t,{changeMeta:e=>u({type:jt.CHANGE_META,payload:e}),meta:v})})]})};const $t=function(e){const{allowNewUuid:t,setNewUuid:a}=e,s=(0,o.useContext)(Ae.gc);return(0,p.jsx)(n.zx,{className:"command-button",disabled:!t,icon:b.d.NEW_OBJECT,onClick:()=>a(s.insertGoalDefinition(It)),text:"Create Goal"})};let Xt=[];const Wt=function(e){const{requestPublish:t}=e,a=(0,o.useContext)(Ae.gc),[s,n]=(0,o.useState)(""),i=""===s,r=()=>n(""),c=e=>{let t=0;for(;Xt[t].key!==e&&t<Xt.length;)t++;Xt.splice(t,1)},l=(e,a)=>(0,p.jsx)(zt,{uuid:e,isNewGoal:a,releaseUuid:r,requestPublish:t,removeCard:c},e);return 0===Xt.length&&(Xt=a.getAllGoalUuids().map((e=>l(e,!1)))),(0,p.jsxs)("div",{className:"goal-editor",children:[(0,p.jsx)("div",{className:"command",children:(0,p.jsx)($t,{allowNewUuid:i,setNewUuid:e=>{n(e),Xt[Xt.length]=Xt[0],Xt[0]=l(e,!0)}})}),(0,p.jsx)("ul",{className:"goal-container",children:Xt})]})};var Kt=a(70152);const qt=function(e){const{bulkUpdateAchievements:t,bulkUpdateGoals:a,getAchievements:s,getOwnGoals:n,removeAchievement:i,removeGoal:r,inferencer:c}=e;(0,o.useEffect)((()=>{s(),n()}),[s,n]);const[l,d]=(0,o.useState)(!1),h=()=>{d(!0),u()},[,u]=(0,o.useReducer)((e=>e+1),0);return(0,p.jsxs)(Ae.gc.Provider,{value:c,children:[(0,p.jsx)(Kt.N,{message:"You have unpublished changes. Are you sure you want to leave?",when:l}),(0,p.jsxs)("div",{className:"AchievementControl",children:[(0,p.jsx)(St,{awaitPublish:l,publishChanges:()=>{a(c.getAllGoals()),t(c.getAllAchievements()),c.getGoalsToDelete().forEach(r),c.getAchievementsToDelete().forEach(i),c.resetToDelete(),d(!1)}}),(0,p.jsx)(Ye,{requestPublish:h}),(0,p.jsx)(Wt,{requestPublish:h})]})]})},Zt=(0,c.$j)((e=>({inferencer:new ke.Z(e.achievement.achievements,e.achievement.goals)})),(e=>(0,Ie.DE)({bulkUpdateAchievements:Me.bulkUpdateAchievements,bulkUpdateGoals:Me.bulkUpdateGoals,getAchievements:Me.getAchievements,getOwnGoals:Me.getOwnGoals,removeAchievement:Me.removeAchievement,removeGoal:Me.removeGoal},e)))(qt),Yt=(0,c.$j)((e=>({group:e.session.group,inferencer:new ke.Z(e.achievement.achievements,e.achievement.goals),name:e.session.name,role:e.session.role,assessmentOverviews:e.session.assessmentOverviews,achievementAssessmentOverviews:e.achievement.assessmentOverviews,users:e.achievement.users,assessmentConfigs:e.session.assessmentConfigurations})),(e=>(0,Ie.DE)({fetchAssessmentOverviews:u.fetchAssessmentOverviews,getAchievements:Me.getAchievements,getGoals:Me.getGoals,getOwnGoals:Me.getOwnGoals,getUserAssessmentOverviews:Me.getUserAssessmentOverviews,getUsers:Me.getUsers,updateGoalProgress:Me.updateGoalProgress},e)))(ft),Jt=()=>{const e=(0,x.ix)((e=>e.session.role)),t=e===d.uU.Admin||e===d.uU.Staff?(0,p.jsx)(Zt,{}):(0,p.jsx)(we.default,{});return(0,p.jsxs)(l.Z5,{children:[(0,p.jsx)(l.AW,{path:"/",element:(0,p.jsx)(Yt,{})}),(0,p.jsx)(l.AW,{path:"control",element:t}),(0,p.jsx)(l.AW,{path:"*",element:(0,p.jsx)(we.default,{})})]})};var Qt=a(94500),ea=a(46957),ta=a(85492),aa=a(60363),sa=a(38321),na=a(626);class ia extends o.PureComponent{constructor(e){super(e),this.audio=void 0,this.handleSeeked=()=>{this.stopPreviousPlaybackAndApplyFromStart(this.props.playbackData)},this.handleAudioLoaded=()=>{this.props.handleSetSourcecastDuration(this.audio.current.duration)},this.applyDeltas=e=>{this.props.handleSetCodeDeltasToApply(e)},this.stopPreviousPlaybackAndApplyFromStart=e=>{this.setState({currentDeltaRevision:this.state.currentDeltaRevision+1},(()=>this.applyPlaybackDataFromStart(e)))},this.applyPlaybackDataFromStart=async e=>{const t=e=>new Promise((t=>setTimeout(t,e))),a=this.state.currentDeltaRevision;let s=1e3*this.audio.current.currentTime;this.props.handleEditorValueChange(e.init.editorValue),this.props.handleExternalSelect(e.init.externalLibrary),this.props.handleChapterSelect(e.init.chapter);const n=e.inputs.filter((e=>e.time<=s&&"codeDelta"===e.type)).map((e=>e.data));this.applyDeltas(n);const i=e.inputs.filter((e=>e.time>s)),r=i.length;let o=0;for(;o<r&&this.state.currentDeltaRevision===a;)s=1e3*this.audio.current.currentTime,i[o].time<s?(this.props.handleSetInputToApply(i[o]),o++):await t(20)},this.handlePlayerPausing=()=>{this.audio.current.pause(),this.props.handleSetIsEditorReadonly(!1),this.props.handleSetSourcecastStatus(O.PO.paused),this.stopCurrentPlayback()},this.handlePlayerPlaying=()=>{this.audio.current.play(),this.props.handleSetIsEditorReadonly(!0),this.props.handleSetSourcecastStatus(O.PO.playing),this.stopPreviousPlaybackAndApplyFromStart(this.props.playbackData),this.props.setSelectedTab&&this.props.setSelectedTab(le.B.mobileEditor)},this.handlePlayerStopping=()=>{this.props.handleSetIsEditorReadonly(!1),this.props.handleSetSourcecastStatus(O.PO.paused),this.props.handleSetCurrentPlayerTime(0),this.setState({currentPlayerProgress:0})},this.updatePlayerTime=e=>{const{currentTime:t}=e.target;this.props.handleSetCurrentPlayerTime(t),this.setState({currentPlayerProgress:t/this.props.duration}),this.props.playbackStatus===O.PO.forcedPaused&&this.handlePlayerPausing()},this.handlePlayerProgressBarChange=e=>{if(this.audio.current){const t=this.props.duration*e;this.audio.current.currentTime=t,this.props.handleSetCurrentPlayerTime(t),this.setState({currentPlayerProgress:e})}},this.renderLabel=e=>{if(this.props.duration){const t=this.props.duration*e,a=Math.floor(t/60),s=Math.floor(t-60*a);return(a<10?"0"+a:a)+":"+(s<10?"0"+s:s)}return"00:00"},this.audio=o.createRef(),this.state={currentDeltaRevision:0,currentPlayerProgress:0,currentSourcecastItem:null,duration:0}}render(){const e=(0,p.jsx)(H.Z,{label:"Play",icon:b.d.PLAY,onClick:this.handlePlayerPlaying,isDisabled:!this.props.duration}),t=(0,p.jsx)(H.Z,{label:"Pause",icon:b.d.PAUSE,onClick:this.handlePlayerPausing});return(0,p.jsxs)("div",{className:"SourcecastControlBar",children:[(0,p.jsx)("audio",{src:this.props.audioUrl,ref:this.audio,onEnded:this.handlePlayerStopping,onLoadedMetadata:this.handleAudioLoaded,onSeeked:this.handleSeeked,onTimeUpdate:this.updatePlayerTime,preload:"metadata"}),(0,p.jsx)("br",{}),(0,p.jsxs)("div",{className:"PlayerControl",children:[(0,p.jsxs)(n.hE,{className:"PlayerControlButton",children:[this.props.playbackStatus===O.PO.paused&&e,this.props.playbackStatus===O.PO.playing&&t]}),(0,p.jsx)("div",{className:"Slider",children:(0,p.jsx)(n.iR,{min:0,max:1,stepSize:1e-4,onChange:this.handlePlayerProgressBarChange,value:this.state.currentPlayerProgress,labelRenderer:this.renderLabel})})]})]})}stopCurrentPlayback(){this.setState({currentDeltaRevision:this.state.currentDeltaRevision+1})}}const ra=ia;a(5491);var oa=a(62953);const ca=e=>{const[t,a]=(0,o.useState)(!1),i=()=>a(!1);return(0,p.jsxs)("div",{children:[(0,p.jsx)(H.Z,{icon:b.d.TRASH,onClick:()=>a(!0)}),(0,p.jsxs)(n.Vq,{icon:"info-sign",isOpen:t,onClose:i,title:"Delete Sourcecast",canOutsideClickClose:!0,children:[(0,p.jsx)("div",{className:s.TmF,children:(0,p.jsx)("p",{children:"Are you sure to delete this sourcecast entry?"})}),(0,p.jsx)("div",{className:s.Alt,children:(0,p.jsxs)("div",{className:s.e$L,children:[(0,p.jsx)(H.Z,{label:"Confirm Delete",icon:b.d.TRASH,onClick:()=>{const{data:t}=e;e.handleDeleteSourcecastEntry(t.id)}}),(0,p.jsx)(H.Z,{label:"Cancel",icon:b.d.CROSS,onClick:i})]})})]})]})},la=e=>{let{data:t,handleSetSourcecastData:a}=e;return(0,p.jsx)(C.u,{content:"Load Sourcecast Recording",children:(0,p.jsx)(H.Z,{label:`${t.title}`,icon:b.d.PAPERCLIP,onClick:()=>{a(t.title,t.description,t.uid,t.url,JSON.parse(t.playbackData))}})})};var da=a(65047),ha=a(78029);const ua=e=>{const t=(0,o.useRef)(null),[a]=(0,o.useState)(`${window.location.protocol}//${window.location.host}/courses/${e.courseId}/sourcecast/${e.data.uid}`),s=(0,p.jsxs)("div",{children:[(0,p.jsx)("input",{defaultValue:a,readOnly:!0,ref:t}),(0,p.jsx)(C.u,{content:"Copy link to clipboard",children:(0,p.jsx)(ha,{text:a,children:(0,p.jsx)(H.Z,{icon:b.d.DUPLICATE,onClick:()=>{null!==t.current&&(t.current.focus(),t.current.select())}})})})]},a);return(0,p.jsx)(da.p,{popoverClassName:"Popover-share",inheritDarkTheme:!1,content:s,children:(0,p.jsx)(C.u,{content:"Get shareable link",children:(0,p.jsx)(H.Z,{icon:b.d.SHARE})})})};class ga extends o.Component{constructor(e){super(e),this.defaultColumnDefs=void 0,this.gridApi=void 0,this.handleFilterChange=e=>{const t=e.target.value;this.setState({filterValue:t}),this.gridApi&&this.gridApi.setQuickFilter(t)},this.onGridReady=e=>{this.gridApi=e.api,this.gridApi.sizeColumnsToFit(),window.onresize=()=>this.gridApi.sizeColumnsToFit()},this.state={columnDefs:[{headerName:"Title",field:"title",cellRendererFramework:la,cellRendererParams:{handleSetSourcecastData:this.props.handleSetSourcecastData},minWidth:200,suppressMovable:!0,suppressMenu:!0,cellStyle:{"text-align":"left"},hide:!this.props.handleSetSourcecastData},{headerName:"Title",field:"title",minWidth:100,suppressMovable:!0,suppressMenu:!0,hide:!!this.props.handleSetSourcecastData},{headerName:"Uploader",field:"uploader.name",minWidth:150,suppressMovable:!0,suppressMenu:!0,cellStyle:{"text-align":"center"}},{headerName:"Date",valueGetter:e=>(0,ge.lu)(e.data.inserted_at),minWidth:150,suppressMovable:!0,suppressMenu:!0},{headerName:"Share",field:"uid",cellRendererFramework:ua,cellRendererParams:{courseId:this.props.courseId},minWidth:80,suppressMovable:!0,suppressMenu:!0},{headerName:"Delete",field:"",cellRendererFramework:ca,cellRendererParams:{handleDeleteSourcecastEntry:this.props.handleDeleteSourcecastEntry},minWidth:100,maxWidth:100,sortable:!1,suppressMovable:!0,suppressMenu:!0,cellStyle:{"text-align":"center"},hide:!this.props.handleDeleteSourcecastEntry},{headerName:"description",field:"description",hide:!0},{headerName:"inserted_at",field:"inserted_at",hide:!0},{headerName:"updated_at",field:"updated_at",hide:!0},{headerName:"audio",field:"audio",hide:!0},{headerName:"playbackData",field:"playbackData",hide:!0},{headerName:"url",field:"url",hide:!0}],filterValue:"",groupFilterEnabled:!1},this.defaultColumnDefs={filter:!0,resizable:!0,sortable:!0}}render(){const e=(0,p.jsx)(n.tR,{className:"Sourcecast",description:"Fetching sourcecast index...",icon:(0,p.jsx)(n.$j,{size:n.Ey.LARGE})}),t=(0,f.sortBy)(this.props.sourcecastIndex,[e=>-e.id]),a=(0,p.jsxs)("div",{className:"SourcecastContainer",children:[(0,p.jsx)("br",{}),(0,p.jsx)("div",{children:(0,p.jsx)(n.cw,{label:"",labelFor:"text-input",children:(0,p.jsx)(n.BZ,{id:"searchBar",large:!1,leftIcon:"search",placeholder:"Search",value:this.state.filterValue,onChange:this.handleFilterChange})})}),(0,p.jsx)(n.iz,{}),(0,p.jsx)("div",{className:"SourcecastTable",children:(0,p.jsx)("div",{className:"ag-grid-parent",children:(0,p.jsx)(oa.AgGridReact,{domLayout:"autoHeight",columnDefs:this.state.columnDefs,defaultColDef:this.defaultColumnDefs,onGridReady:this.onGridReady,rowData:t,rowHeight:30,pagination:!1,paginationPageSize:50})})}),(0,p.jsx)("br",{})]});return(0,p.jsx)("div",{children:void 0===this.props.sourcecastIndex?e:a})}}const pa=ga,ma="sourcecast",xa="Welcome to Sourcecast!",ya=()=>{const{isMobileBreakpoint:e}=(0,x.Fs)(),t=(0,l.UO)(),{audioUrl:a,currentPlayerTime:i,codeDeltasToApply:d,title:h,description:u,externalLibrary:g,isEditorAutorun:m,isEditorReadonly:y,inputToApply:v,isRunning:C,isDebugging:f,output:S,playbackDuration:j,playbackData:w,playbackStatus:I,replValue:M,sideContentHeight:A,sourcecastIndex:T,context:{chapter:P,variant:E},uid:N,isFolderModeEnabled:L,activeEditorTabIndex:G,editorTabs:U}=(0,x.ix)((e=>e.workspaces[ma])),F=(0,x.ix)((e=>e.session.courseId)),_=(0,c.I0)(),{handleFetchSourcecastIndex:V,handleChapterSelect:H,handleEditorEval:$,handleEditorValueChange:W,handleExternalSelect:K,handleReplEval:q,handleSetSourcecastData:Z,handleSetSourcecastStatus:Y,handleReplOutputClear:J,handleSideContentHeightChange:Q}=(0,o.useMemo)((()=>({handleFetchSourcecastIndex:()=>_((0,ea.fetchSourcecastIndex)(ma)),handleChapterSelect:e=>_((0,ue.chapterSelect)(e,k.Variant.DEFAULT,ma)),handleEditorEval:()=>_((0,ue.evalEditor)(ma)),handleEditorValueChange:e=>_((0,ue.updateEditorValue)(ma,0,e)),handleExternalSelect:e=>_((0,ue.externalLibrarySelect)(e,ma)),handleReplEval:()=>_((0,ue.evalRepl)(ma)),handleSetSourcecastData:(e,t,a,s,n)=>_((0,ta.setSourcecastData)(e,t,a,s,n,ma)),handleSetSourcecastStatus:e=>_((0,ta.setSourcecastStatus)(e,ma)),handleReplOutputClear:()=>_((0,ue.clearReplOutput)(ma)),handleSideContentHeightChange:e=>_((0,ue.changeSideContentHeight)(e,ma))})),[_]),[ee,te]=(0,o.useState)(le.B.introduction),ae=()=>{const e=t.sourcecastId;if(e&&e!==N&&T){const t=T.find((t=>t.uid===e));t&&Z(t.title,t.description,t.uid,t.url,JSON.parse(t.playbackData))}};(0,o.useEffect)((()=>{V()}),[]),(0,o.useEffect)((()=>{if(ae(),v)switch(v.type){case"activeTabChange":te(v.data);break;case"chapterSelect":H(v.data);break;case"externalLibrarySelect":K(v.data);break;case"forcePause":Y(O.PO.forcedPaused)}}),[ae,v]),(0,o.useEffect)((()=>{e||ee!==le.B.mobileEditor&&ee!==le.B.mobileEditorRun||te(le.B.introduction)}),[e,ee]);const se=(0,o.useMemo)((()=>({handleDebuggerPause:()=>_((0,Qt.beginDebuggerPause)(ma)),handleDebuggerReset:()=>_((0,Qt.debuggerReset)(ma)),handleDebuggerResume:()=>_((0,Qt.debuggerResume)(ma)),handleInterruptEval:()=>_((0,Qt.beginInterruptExecution)(ma)),handleToggleEditorAutorun:()=>_((0,ue.toggleEditorAutorun)(ma))})),[_]),ne=(0,p.jsx)(aa.k,{handleDebuggerPause:se.handleDebuggerPause,handleDebuggerReset:se.handleDebuggerReset,handleDebuggerResume:se.handleDebuggerResume,handleEditorEval:$,handleInterruptEval:se.handleInterruptEval,handleToggleEditorAutorun:se.handleToggleEditorAutorun,isEntrypointFileDefined:null!==G,isDebugging:f,isEditorAutorun:m,isRunning:C},"autorun"),ie=(0,p.jsx)(D.b,{handleChapterSelect:(e,t)=>{let{chapter:a}=e;return H(a)},isFolderModeEnabled:L,sourceChapter:P,sourceVariant:E},"chapter"),re=(0,p.jsx)(R._,{handleReplOutputClear:J},"clear_repl"),oe=(0,p.jsx)(B.e,{handleReplEval:q,isRunning:C},"eval_repl"),ce={label:"Data Visualizer",iconName:b.d.EYE_OPEN,body:(0,p.jsx)(sa.Z,{}),id:le.B.dataVisualizer},de={label:"Env Visualizer",iconName:b.d.GLOBE,body:(0,p.jsx)(na.Z,{workspaceLocation:ma}),id:le.B.envVisualizer},ge=[{label:"Sourcecast Table",iconName:b.d.HOME,body:(0,p.jsxs)("div",{children:[(0,p.jsx)("span",{className:"Multi-line",children:(0,p.jsx)(n.SU,{children:h?"Title: "+h+"\nDescription: "+u:xa})}),(0,p.jsx)(pa,{handleSetSourcecastData:Z,sourcecastIndex:T,courseId:F})]}),id:le.B.introduction},ce,de],pe=(e,t,a)=>{e!==t&&te(e)},me=(0,o.useMemo)((()=>({handleDeclarationNavigate:e=>_((0,ue.navigateToDeclaration)(ma,e)),handleEditorUpdateBreakpoints:e=>_((0,ue.setEditorBreakpoint)(ma,0,e)),setActiveEditorTabIndex:e=>_((0,ue.updateActiveEditorTabIndex)(ma,e)),removeEditorTabByIndex:e=>_((0,ue.removeEditorTab)(ma,e))})),[_]),xe={editorVariant:"sourcecast",isFolderModeEnabled:L,activeEditorTabIndex:G,setActiveEditorTabIndex:me.setActiveEditorTabIndex,removeEditorTabByIndex:me.removeEditorTabByIndex,editorTabs:U.map(z.F),codeDeltasToApply:d,isEditorReadonly:y,editorSessionId:"",handleDeclarationNavigate:me.handleDeclarationNavigate,handleEditorEval:$,handleEditorValueChange:W,isEditorAutorun:m,inputToApply:v,isPlaying:I===O.PO.playing,handleEditorUpdateBreakpoints:me.handleEditorUpdateBreakpoints},ye=(0,o.useMemo)((()=>({handleBrowseHistoryDown:()=>_((0,ue.browseReplHistoryDown)(ma)),handleBrowseHistoryUp:()=>_((0,ue.browseReplHistoryUp)(ma)),handleReplValueChange:e=>_((0,ue.updateReplValue)(e,ma))})),[_]),ve={output:S,replValue:M,handleBrowseHistoryDown:ye.handleBrowseHistoryDown,handleBrowseHistoryUp:ye.handleBrowseHistoryUp,handleReplEval:q,handleReplValueChange:ye.handleReplValueChange,sourceChapter:P,sourceVariant:E,externalLibrary:g,replButtons:[oe,re]},be={tabs:[]},Ce={controlBarProps:{editorButtons:[ne,ie]},editorContainerProps:xe,handleSideContentHeightChange:Q,replProps:ve,sideBarProps:be,sideContentHeight:A,sideContentProps:{selectedTabId:ee,onChange:pe,tabs:{beforeDynamicTabs:ge,afterDynamicTabs:[]},workspaceLocation:ma,sideContentHeight:A}},fe={editorContainerProps:xe,replProps:ve,sideBarProps:be,mobileSideContentProps:{mobileControlBarProps:{editorButtons:[ne,ie]},selectedTabId:ee,onChange:pe,tabs:{beforeDynamicTabs:ge,afterDynamicTabs:[]},workspaceLocation:ma}},Se=(0,o.useMemo)((()=>({handlePromptAutocomplete:(e,t,a)=>_((0,ue.promptAutocomplete)(ma,e,t,a)),handleSetCurrentPlayerTime:e=>_((0,ta.setCurrentPlayerTime)(e,ma)),handleSetCodeDeltasToApply:e=>_((0,ta.setCodeDeltasToApply)(e,ma)),handleSetIsEditorReadonly:e=>_((0,ue.setIsEditorReadonly)(ma,e)),handleSetInputToApply:e=>_((0,ta.setInputToApply)(e,ma)),handleSetSourcecastDuration:e=>_((0,ta.setSourcecastDuration)(e,ma))})),[_]),je={handleEditorValueChange:W,handlePromptAutocomplete:Se.handlePromptAutocomplete,handleSetCurrentPlayerTime:Se.handleSetCurrentPlayerTime,handleSetCodeDeltasToApply:Se.handleSetCodeDeltasToApply,handleSetIsEditorReadonly:Se.handleSetIsEditorReadonly,handleSetInputToApply:Se.handleSetInputToApply,handleSetSourcecastDuration:Se.handleSetSourcecastDuration,handleSetSourcecastStatus:Y,audioUrl:a,currentPlayerTime:i,duration:j,playbackData:w,playbackStatus:I,handleChapterSelect:H,handleExternalSelect:K,setSelectedTab:te};return(0,p.jsxs)("div",{className:r()("Sourcecast",s.Pyr),children:[(0,p.jsx)(ra,{...je}),e?(0,p.jsx)(X.Z,{...fe}):(0,p.jsx)(he.Z,{...Ce})]})};a(82523);var va=a(59603),ba=a(77763);const Ca=e=>{const[t,a]=o.useState([]),[s,i]=o.useState(""),r=o.useRef(),{CSVReader:c}=(0,ba.ds)(),l=(0,p.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:(0,p.jsx)(oa.AgGridReact,{domLayout:"autoHeight",columnDefs:[{headerName:"Username",field:"username"},{headerName:"Role",field:"role"},{headerName:"Group",field:"group"}],defaultColDef:{filter:!0,resizable:!0,sortable:!0},onGridReady:e=>{r.current=e.api},onGridSizeChanged:()=>{var e;return null===(e=r.current)||void 0===e?void 0:e.sizeColumnsToFit()},rowData:t,rowHeight:36,suppressCellSelection:!0,suppressMovableColumns:!0,pagination:!0})}),u=[...g.Z.authProviders.entries()].map((e=>{let[t,a]=e;return t})),[m,x]=o.useState(u[0]);return(0,p.jsxs)("div",{className:"add-users",children:[(0,p.jsx)(n.H2,{children:"Add Users"}),l,(0,p.jsx)(n.H4,{children:"Upload a CSV file to mass insert or update users in your course."}),(0,p.jsx)("div",{className:"upload-container",children:(0,p.jsxs)("div",{children:[(0,p.jsxs)("div",{className:"upload-settings",children:[(0,p.jsx)("div",{className:"file-input",children:(0,p.jsx)(c,{onUploadAccepted:e=>(e=>{const{data:s,errors:n}=e;if(n.length)return void i("Error detected while uploading the CSV file! Please recheck the file and try again.");const r=[...t];if(s.length+t.length>1e3)i("Please limit each upload to 1000 entries!");else{for(let e=0;e<s.length;e++){if(2!==s[e].length&&3!==s[e].length)return void i((0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("div",{children:["Invalid format (line ",e,")! Please ensure that the username and role is specified for each row entry!"]}),(0,p.jsx)("br",{}),(0,p.jsxs)("div",{children:["Format: ",(0,p.jsx)("i",{children:"username,role"})," ",(0,p.jsx)("b",{children:"OR"})," ",(0,p.jsx)("i",{children:"username,role,group"})]}),(0,p.jsx)("br",{}),(0,p.jsx)("div",{children:"(please hover over the question mark above for more details)"})]}));if(!Object.values(d.uU).includes(s[e][1]))return void i(`Invalid role (line ${e})! Please ensure that the second column of each entry contains one of the following: 'admin, staff, student'`)}s.forEach((e=>{r.push({username:e[0],role:e[1],group:e[2]})})),(0,f.uniqBy)(r,(e=>e.username)).length===r.length?(a(r),i("")):i("There are duplicate usernames in the uploaded CSV(s)!")}})(e),config:{delimiter:",",skipEmptyLines:!0},children:e=>{let{getRootProps:t,acceptedFile:a,ProgressBar:s,getRemoveFileProps:i}=e;return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(n.S2,{text:"Upload CSV",inputProps:t()}),(0,p.jsx)(da.p,{content:(0,p.jsxs)("div",{children:[(0,p.jsxs)("p",{children:[(0,p.jsx)("u",{children:"CSV Format"}),": \xa0",(0,p.jsx)("b",{children:(0,p.jsx)("i",{children:"username,role"})}),"\xa0\xa0OR\xa0\xa0",(0,p.jsx)("b",{children:(0,p.jsx)("i",{children:"username,role,group"})})]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("b",{children:(0,p.jsx)("i",{children:"username"})}),": the username of the learner in the corresponding authentication provider"]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("b",{children:(0,p.jsx)("i",{children:"role"})}),": the role of the learner in this course"," ",(0,p.jsx)("i",{children:"(admin | staff | student)"})]}),(0,p.jsxs)("p",{children:[(0,p.jsx)("b",{children:(0,p.jsx)("i",{children:"group (optional)"})}),": the group name that the learner belongs to in this course"]}),(0,p.jsx)("p",{children:(0,p.jsx)("i",{children:"(*Note that staff or admin will automatically be assigned as group leader and each group"})}),(0,p.jsx)("p",{children:(0,p.jsx)("i",{children:"can only have one leader. If there are duplicates the latest entry will take effect)"})}),(0,p.jsx)("p",{children:"\xa0"}),(0,p.jsx)("p",{children:(0,p.jsx)("u",{children:"Examples:"})}),(0,p.jsx)("p",{children:(0,p.jsx)("i",{children:"(Luminus): \xa0e1234567,student \xa0\u2022\xa0 e1234567,student,Group1"})}),(0,p.jsx)("p",{children:(0,p.jsx)("i",{children:"(Google): \xa0learner@gmail.com,staff \xa0\u2022\xa0 learner@gmail.com,staff,Group1"})}),(0,p.jsx)("p",{children:(0,p.jsx)("i",{children:"(GitHub): \xa0ghusername,admin \xa0\u2022\xa0 ghusername,admin,Group1"})})]}),interactionKind:"hover",position:v.Ly.TOP,popoverClassName:"file-input-popover",children:(0,p.jsx)(n.JO,{icon:b.d.HELP,className:"file-input-icon"})})]})}})}),(0,p.jsx)(n.cw,{className:"html-select",label:(0,p.jsxs)("div",{className:"html-select-label",children:[(0,p.jsx)("div",{children:"Authentication Provider"}),(0,p.jsx)(da.p,{content:"The authentication provider your learners will use to log in with",interactionKind:"hover-target",position:v.Ly.TOP,popoverClassName:"html-select-popover",children:(0,p.jsx)(n.JO,{icon:b.d.HELP,className:"html-select-label-icon"})})]}),inline:!0,children:(0,p.jsx)(n.Lu,{options:u,value:m,onChange:e=>x(e.target.value)})})]}),s&&(0,p.jsx)(n.UW,{intent:h.S.DANGER,title:"Invalid CSV file provided!",children:s})]})}),(0,p.jsx)(n.zx,{className:"add-button",text:"Add Users",intent:0===t.length?h.S.NONE:h.S.WARNING,onClick:()=>{e.handleAddNewUsersToCourse(t,m),a([]),x(u[0])}})]})},fa=e=>{const{data:t}=e,a=t[e.field],s=o.useCallback((()=>{e.setStateHandler(e.rowIndex,!a)}),[e,a]);return(0,p.jsx)(n.rs,{checked:a,onChange:s})},Sa=e=>{const[t,a]=o.useState(!1),i=o.useCallback((()=>{e.deleteRowHandler(e.rowIndex),a(!1)}),[e]);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(n.zx,{icon:b.d.CROSS,onClick:()=>{a(!0)}}),(0,p.jsxs)(n.Vq,{icon:b.d.WARNING_SIGN,isOpen:t,onClose:()=>a(!1),title:"Warning",children:[(0,p.jsxs)("div",{className:s.TmF,children:[(0,p.jsxs)("p",{children:["Are you sure you want to ",(0,p.jsx)("b",{children:"delete"})," the assessment type ",(0,p.jsx)("i",{children:e.data.type}),"?"]}),(0,p.jsx)("p",{children:(0,p.jsx)("b",{children:"All related assessments, submissions and answers will be deleted as well upon clicking the main save button."})})]}),(0,p.jsx)("div",{className:s.Alt,children:(0,p.jsxs)("div",{className:s.e$L,children:[(0,p.jsx)(H.Z,{label:"Cancel",icon:b.d.CROSS,onClick:()=>a(!1),options:{minimal:!1}}),(0,p.jsx)(H.Z,{label:"Ok",icon:b.d.TICK,onClick:i,options:{minimal:!1,intent:h.S.WARNING}})]})})]})]})},ja=e=>{const{data:t}=e,a=o.useCallback((t=>{e.setStateHandler(e.rowIndex,t)}),[e]);return(0,p.jsx)(n.Af,{value:t[e.field],min:0,clampValueOnBlur:!0,onValueChange:a})};function wa(e,t){for(let a=0;a<e.length;a++)if((0,f.isEqual)(e[a],t))return a;return-1}const Ia=e=>{const{assessmentConfig:t,setAssessmentConfig:a,setAssessmentConfigsToDelete:s}=e,i=o.useRef(),r=[{headerName:"Assessment Type",field:"type",rowDrag:!0,editable:!0},{headerName:"Is Manually Graded",field:"isManuallyGraded",cellRendererFramework:fa,cellRendererParams:{setStateHandler:(e,s)=>{var n,r;const o=[...t.current];o[e]={...o[e],isManuallyGraded:s},a(o),null===(n=i.current)||void 0===n||null===(r=n.getDisplayedRowAtIndex(e))||void 0===r||r.setDataValue("isManuallyGraded",s)},field:"isManuallyGraded"}},{headerName:"Display in Dashboard",field:"displayInDashboard",cellRendererFramework:fa,cellRendererParams:{setStateHandler:(e,s)=>{var n,r;const o=[...t.current];o[e]={...o[e],displayInDashboard:s},a(o),null===(n=i.current)||void 0===n||null===(r=n.getDisplayedRowAtIndex(e))||void 0===r||r.setDataValue("displayInDashboard",s)},field:"displayInDashboard"}},{headerName:"Max Bonus XP",field:"earlySubmissionXp",cellRendererFramework:ja,cellRendererParams:{setStateHandler:(e,s)=>{var n,r;const o=[...t.current];o[e]={...o[e],earlySubmissionXp:s},a(o),null===(n=i.current)||void 0===n||null===(r=n.getDisplayedRowAtIndex(e))||void 0===r||r.setDataValue("earlySubmissionXp",s)},field:"earlySubmissionXp"}},{headerName:"Early Hours Before Decay",field:"hoursBeforeEarlyXpDecay",cellRendererFramework:ja,cellRendererParams:{setStateHandler:(e,s)=>{var n,r;const o=[...t.current];o[e]={...o[e],hoursBeforeEarlyXpDecay:s},a(o),null===(n=i.current)||void 0===n||null===(r=n.getDisplayedRowAtIndex(e))||void 0===r||r.setDataValue("hoursBeforeEarlyXpDecay",s)},field:"hoursBeforeEarlyXpDecay"}},{headerName:"Delete Row",field:"placeholderToPreventColumnRerender",cellRendererFramework:Sa,cellRendererParams:{deleteRowHandler:e=>{var n;if(t.current.length<=1)return void(0,T.N9)("You must have at least 1 assessment type!");const r=[...t.current],o=r.splice(e,1);null===(n=i.current)||void 0===n||n.setRowData(r),a(r),s(o[0])}},maxWidth:120,resizable:!1}],c=o.useCallback((e=>{const a=e.node,s=e.overNode;if(a!==s){const e=a.data,n=null===s||void 0===s?void 0:s.data,i=wa(t.current,e),r=wa(t.current,n),o=[...t.current];!function(e,t,a){const s=e[t];e.splice(t,1),e.splice(a,0,s)}(o,i,r),t.current=o}}),[t]),l=a=>{var s;null===(s=i.current)||void 0===s||s.setRowData(t.current),e.setHasChangesAssessmentConfig(!0)},d=(0,p.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:(0,p.jsx)(oa.AgGridReact,{domLayout:"autoHeight",columnDefs:r,defaultColDef:{filter:!1,resizable:!0,sortable:!1},onGridReady:e=>{i.current=e.api,e.api.sizeColumnsToFit()},onGridSizeChanged:()=>{var e;return null===(e=i.current)||void 0===e?void 0:e.sizeColumnsToFit()},rowData:e.assessmentConfig.current,rowHeight:36,rowDragManaged:!0,suppressCellSelection:!0,suppressMovableColumns:!0,suppressPaginationPanel:!0,onRowDragMove:c,onRowDragLeave:l,onRowDragEnd:l,onCellValueChanged:a=>{if("type"===a.colDef.field){const s=[...t.current];s[a.rowIndex]={...s[a.rowIndex],type:a.value},t.current=s,e.setHasChangesAssessmentConfig(!0)}}})});return(0,p.jsxs)("div",{className:"assessment-configuration",children:[(0,p.jsxs)("div",{className:"assessment-configuration-header-container",children:[(0,p.jsx)(n.H2,{children:"Assessment Configuration"}),(0,p.jsx)(n.zx,{text:"Add Row",onClick:()=>{var e;if(t.current.length>=8)return void(0,T.N9)("You can have at most 8 assessment types!");const s=[...t.current];s.push({assessmentConfigId:-1,type:"untitled",isManuallyGraded:!0,displayInDashboard:!0,hoursBeforeEarlyXpDecay:0,earlySubmissionXp:0}),a(s),null===(e=i.current)||void 0===e||e.setRowData(s)},className:"add-row-button"})]}),d]})};var ka=a(77181),Ma=a(83290);const Aa=e=>{const[t,a]=o.useState(),s=e.data[e.field];s.sort(((e,t)=>e.minutes-t.minutes));const i=e=>e.minutes>=60?Math.round(e.minutes/60*100)/100+" hour(s)":`${e.minutes} minute(s)`,r=s.filter((e=>e.isDefault));1===r.length&&(t&&t.id===r[0].id||a(r[0]));return(0,p.jsx)(Ma.u,{filterable:!1,items:s,itemRenderer:(e,t)=>{let{handleClick:a,handleFocus:s,modifiers:r,query:o}=t;return(0,p.jsx)(n.sN,{active:r.active,disabled:r.disabled,onClick:a,onFocus:s,roleStructure:"listoption",text:i(e)},e.id+""+e.minutes)},onItemSelect:t=>{a(t);const n=s.map((e=>({...e,isDefault:e.id===t.id&&e.minutes===t.minutes})));e.setStateHandler(e.rowIndex,n)},noResults:(0,p.jsx)(n.sN,{disabled:!0,text:"No results.",roleStructure:"listoption"}),children:(0,p.jsx)(n.zx,{text:t?i(t):"NA",rightIcon:"caret-down",placeholder:"Choose default"})})},Ta=e=>{const t=e.data[e.field],[a,s]=(0,o.useState)(t.map((e=>(e.minutes/60).toFixed(2).toString())));return(0,p.jsx)(n.EG,{values:a,onRemove:(n,i)=>{s(a.filter((e=>e!==n))),e.setDelete(t[i]),e.setStateHandler(e.rowIndex,t.filter(((e,t)=>t!==i)))},onAdd:n=>{if(function(e){const a=parseFloat(e),s=60*a;return!!(0,f.isInteger)(s)&&!t.some((e=>e.minutes===s))&&!isNaN(a)&&isFinite(a)&&a>=0}(n)){const i={id:-1,minutes:60*parseFloat(n),isDefault:!1};s([...a,n]),e.setStateHandler(e.rowIndex,[...t,i])}}})},Pa=()=>{const e=o.useRef(),t=(0,c.I0)(),a=(0,x.ix)((e=>e.session)),s=o.useRef(a.notificationConfigs),[i,r]=(0,o.useState)([]),[l,d]=(0,o.useState)(!1),g=e=>{s.current=e,d(!0)};(0,o.useEffect)((()=>{t((0,u.fetchNotificationConfigs)())}),[t]),(0,o.useEffect)((()=>{s.current=(0,f.cloneDeep)(a.notificationConfigs)}),[a]);const m=(t,a)=>{var n,i,r;const o=[...null!==(n=s.current)&&void 0!==n?n:[]];o[t]={...o[t],timeOptions:a},g(o),null===(i=e.current)||void 0===i||null===(r=i.getDisplayedRowAtIndex(t))||void 0===r||r.setDataValue("timeOptions",a),d(!0)},y=[{headerName:"Notification Type",field:"notificationType.name",rowDrag:!0},{headerName:"Assessment Type",field:"assessmentConfig.type",valueFormatter:e=>{var t;return(null===(t=e.data.assessmentConfig)||void 0===t?void 0:t.type)||"-"}},{headerName:"Recipients",field:"notificationType.forStaff",valueFormatter:e=>e.data.notificationType.forStaff?"Staff":"Student"},{headerName:"Reminder Time Options (hours)",field:"timeOptions",cellRendererFramework:Ta,cellRendererParams:{setStateHandler:m,setDelete:e=>{if(-1!==e.id){const t=[...i];t.push(e),r(t)}},field:"timeOptions"}},{headerName:"Default Reminder (hours)",field:"timeOptions",cellRendererFramework:Aa,cellRendererParams:{setStateHandler:m,field:"timeOptions"}},{headerName:"Enabled",field:"isEnabled",cellRendererFramework:fa,cellRendererParams:{setStateHandler:(t,a)=>{var n,i,r;const o=[...null!==(n=s.current)&&void 0!==n?n:[]];o[t]={...o[t],isEnabled:a},g(o),null===(i=e.current)||void 0===i||null===(r=i.getDisplayedRowAtIndex(t))||void 0===r||r.setDataValue("isEnabled",a),d(!0)},field:"isEnabled"}}],v=(0,p.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:(0,p.jsx)(oa.AgGridReact,{domLayout:"autoHeight",columnDefs:y,defaultColDef:{filter:!1,resizable:!0,sortable:!1},onGridReady:t=>{e.current=t.api,t.api.sizeColumnsToFit()},onGridSizeChanged:()=>{var t;return null===(t=e.current)||void 0===t?void 0:t.sizeColumnsToFit()},rowData:s.current,rowHeight:36,rowDragManaged:!0,suppressCellSelection:!0,suppressMovableColumns:!0,suppressPaginationPanel:!0})});return(0,p.jsxs)("div",{className:"assessment-configuration",children:[(0,p.jsx)("div",{className:"assessment-configuration-header-container",children:(0,p.jsx)(n.H2,{children:"Notification Configuration"})}),v,(0,p.jsx)(n.zx,{text:"Save",style:{marginTop:"15px"},intent:l?h.S.WARNING:h.S.NONE,onClick:()=>{if(l){var e,a;d(!1);const n=[];null===(e=s.current)||void 0===e||e.forEach((e=>{const t=e.timeOptions.map((t=>({...t,notificationConfigId:e.id})));n.push(...t)})),n.length>0&&t((0,u.updateTimeOptions)(n)),i.length>0&&(t((0,u.deleteTimeOptions)(i.map((e=>e.id)))),r([])),t((0,u.updateNotificationConfigs)(null!==(a=s.current)&&void 0!==a?a:[]))}}})]})},Ea=e=>{const{data:t}=e,a=o.useCallback((a=>{e.handleUpdateUserRole(t.courseRegId,a.target.value)}),[t,e]),s=[{label:"Student",value:d.uU.Student},{label:"Staff",value:d.uU.Staff},{label:"Admin",value:d.uU.Admin}];return(0,p.jsx)(da.p,{content:"You cannot downgrade yourself from an admin role!",interactionKind:"click",position:v.Ly.TOP,disabled:e.courseRegId!==t.courseRegId,children:(0,p.jsx)(n.Lu,{options:s,onChange:a,fill:!0,minimal:!0,style:{textAlign:"center"},value:t.role,disabled:e.courseRegId===t.courseRegId})})},Na=e=>{const[t,a]=o.useState(!1),i=o.useCallback((()=>{e.handleDeleteUserFromCourse(e.data.courseRegId),a(!1)}),[e]);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(da.p,{content:"You cannot delete an admin!",interactionKind:"click",position:v.Ly.TOP,disabled:e.data.role!==d.uU.Admin,children:(0,p.jsx)(n.zx,{text:"Delete User",icon:b.d.CROSS,onClick:()=>{e.data.role!==d.uU.Admin?a(!0):(0,T.N9)("You cannot delete an admin user!")},disabled:e.data.role===d.uU.Admin})}),(0,p.jsxs)(n.Vq,{icon:b.d.WARNING_SIGN,isOpen:t,onClose:()=>a(!1),title:"Deleting User From Course",canOutsideClickClose:!0,children:[(0,p.jsxs)("div",{className:s.TmF,children:[(0,p.jsxs)("p",{children:["Are you sure you want to ",(0,p.jsx)("b",{children:"delete"})," the user"," ",(0,p.jsxs)("i",{children:[e.data.name," (",e.data.username,")"]}),"?"]}),(0,p.jsx)("p",{children:(0,p.jsx)("b",{children:"All their assessment answers will be deleted as well."})})]}),(0,p.jsx)("div",{className:s.Alt,children:(0,p.jsxs)("div",{className:s.e$L,children:[(0,p.jsx)(H.Z,{label:"Cancel",icon:b.d.CROSS,onClick:()=>a(!1),options:{minimal:!1}}),(0,p.jsx)(H.Z,{label:"Confirm",icon:b.d.TRASH,onClick:i,options:{minimal:!1,intent:h.S.DANGER}})]})})]})]})},Oa=e=>{var t;const a=o.useRef(),s=null===(t=e.userCourseRegistrations)||void 0===t?void 0:t.map((e=>e.name?e:{...e,name:"(user has yet to log in)"})),i=[{headerName:"Name",field:"name",sort:"asc"},{headerName:"Username",field:"username"},{headerName:"Group",field:"group"},{headerName:"Role",field:"role",cellRendererFramework:Ea,cellRendererParams:{courseRegId:e.courseRegId,handleUpdateUserRole:e.handleUpdateUserRole},width:110},{headerName:"Actions",field:"actions",cellRendererFramework:Na,cellRendererParams:{handleDeleteUserFromCourse:e.handleDeleteUserFromCourse},width:120,filter:!1,resizable:!1}],r=(0,p.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:(0,p.jsx)(oa.AgGridReact,{domLayout:"autoHeight",columnDefs:i,defaultColDef:{filter:!0,resizable:!0,sortable:!0},onGridReady:e=>{a.current=e.api},onGridSizeChanged:()=>{var e;return null===(e=a.current)||void 0===e?void 0:e.sizeColumnsToFit()},rowData:s,rowHeight:36,suppressCellSelection:!0,suppressMovableColumns:!0,pagination:!0})});return(0,p.jsxs)("div",{className:"users-configuration",children:[(0,p.jsxs)("div",{className:"users-header-container",children:[(0,p.jsx)(n.H2,{children:"Users"}),(0,p.jsx)(n.zx,{text:"Export as CSV",className:"export-csv-button",onClick:()=>{a.current&&a.current.exportDataAsCsv({fileName:`SA Users (${(new Date).toISOString()}).csv`,columnKeys:["name","username","group","role"]})}})]}),r]})},Da=()=>{const[e,t]=o.useState(!1),[a,s]=o.useState(!1),[i,r]=o.useState({courseName:"",courseShortName:"",viewable:!0,enableGame:!0,enableAchievements:!0,enableSourcecast:!0,moduleHelpText:""}),l=(0,c.I0)(),d=(0,x.ix)((e=>e.session)),g=o.useRef(d.assessmentConfigurations),[m,y]=o.useState([]);o.useEffect((()=>{l((0,u.fetchCourseConfig)()),l((0,u.fetchAssessmentConfigs)()),l((0,u.fetchAdminPanelCourseRegistrations)()),l((0,u.fetchNotificationConfigs)())}),[l]),o.useEffect((()=>{r({courseName:d.courseName,courseShortName:d.courseShortName,viewable:d.viewable,enableGame:d.enableGame,enableAchievements:d.enableAchievements,enableSourcecast:d.enableSourcecast,moduleHelpText:d.moduleHelpText}),g.current=(0,f.cloneDeep)(d.assessmentConfigurations)}),[d]);const v={courseConfiguration:i,setCourseConfiguration:e=>{r(e),t(!0)}},b=o.useMemo((()=>({assessmentConfig:g,setAssessmentConfig:e=>{g.current=e,s(!0)},setAssessmentConfigsToDelete:e=>{if(-1!==e.assessmentConfigId){const t=[...m];t.push(e),y(t)}},setHasChangesAssessmentConfig:s})),[m]),C={courseRegId:d.courseRegId,userCourseRegistrations:d.userCourseRegistrations,handleUpdateUserRole:(e,t)=>l((0,u.updateUserRole)(e,t)),handleDeleteUserFromCourse:e=>l((0,u.deleteUserCourseRegistration)(e))},S={handleAddNewUsersToCourse:(e,t)=>l((0,va.addNewUsersToCourse)(e,t))},j=(0,p.jsxs)("div",{className:"admin-panel",children:[(0,p.jsx)(n.H1,{children:"Admin Panel"}),(0,p.jsxs)(n.mQ,{id:"admin-panel",renderActiveTabPanelOnly:!0,children:[(0,p.jsx)(n.OK,{id:"configuration",title:"Configuration",panel:(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(ka.Z,{...v}),(0,p.jsx)(n.iz,{}),(0,p.jsx)(Ia,{...b}),(0,p.jsx)(n.zx,{text:"Save",style:{marginTop:"15px"},intent:e||a?h.S.WARNING:h.S.NONE,onClick:()=>{e&&(l((0,u.updateCourseConfig)(i)),t(!1)),m.length>0&&(m.forEach((e=>{l((0,u.deleteAssessmentConfig)(e))})),y([])),a&&(l((0,u.setAssessmentConfigurations)([])),l((0,u.updateAssessmentConfigs)(g.current)),s(!1))}})]})}),(0,p.jsx)(n.OK,{id:"users",title:"Users",panel:(0,p.jsx)(Oa,{...C})}),(0,p.jsx)(n.OK,{id:"add-users",title:"Add Users",panel:(0,p.jsx)(Ca,{...S})}),(0,p.jsx)(n.OK,{id:"notification-config",title:"Notifications",panel:(0,p.jsx)(Pa,{})})]})]});return(0,p.jsx)(ye.Z,{loadContentDispatch:()=>{},display:j,fullWidth:!1})};var Ra=a(86859);const Ba={filter:!0,resizable:!0,sortable:!0},La=e=>{const t=(0,c.I0)(),a=(0,x.ix)((e=>e.dashboard.gradingSummary));let s;const n=a.cols.map((e=>({headerName:(0,f.startCase)(e),field:e}))),i=(0,p.jsx)("div",{className:"Dashboard",children:(0,p.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:(0,p.jsx)(oa.AgGridReact,{domLayout:"autoHeight",columnDefs:n,defaultColDef:Ba,onGridReady:e=>{s=e.api},onGridSizeChanged:()=>{s&&s.sizeColumnsToFit()},rowData:a.rows,rowHeight:30,suppressCellSelection:!0,suppressMovableColumns:!0})})});return(0,p.jsx)("div",{children:(0,p.jsx)(ye.Z,{display:i,loadContentDispatch:()=>t((0,Ra.fetchGroupGradingSummary)())})})};var Ga=a(37744);const Ua={zektonFont:{key:"zekton",pngPath:"../../assets/zekton.png",fntPath:"../../assets/zekton.fnt"},zektonDarkFont:{key:"zektonDark",pngPath:"../../assets/zekton_dark.png",fntPath:"../../assets/zekton.fnt"},alienCowsFont:{key:"alienAndCows",pngPath:"../../assets/alien_and_cows.png",fntPath:"../../assets/alien_and_cows.fnt"},alienLeagueFont:{key:"alienLeague",pngPath:"../../assets/alien_league.png",fntPath:"../../assets/alien_league.fnt"},pixelFont:{key:"pixel",pngPath:"../../assets/pixel.png",fntPath:"../../assets/pixel.fnt"}},Fa={assetsFolder:g.y.sourceAcademyAssets,fadeDuration:600,nullFunction:()=>{},nullInteractionId:"",nullSequenceNumber:-1,popUpDuration:1e3,defaultAssetPath:"/ui/wristDeviceButton.png",defaultFontStyle:{key:Ua.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},defaultCursor:""},_a={x:1920,y:1080},Va={x:_a.x/2,y:_a.y/2},Ha={navy:"#03092c",lightBlue:"#ece1fb",offWhite:"#bbc1c9",white:"#ffffff",darkGrey:"#333333",lightGrey:"#555555",blue:"#1133ff",darkBlue:"#0d2440",orange:"#ff9933",yellow:"#ffee33",red:"0#ff0000",maroon:"#142B2E",black:"#000000",purple:"#dd33dd",paleYellow:"#f6ffbd"},za=f.mapValues(Ha,(e=>parseInt(e.slice(1),16)));let $a;function Xa(e){let{direction:t=$a.Row,numOfItems:a,maxXSpace:s=_a.x,maxYSpace:n=_a.y,numItemLimit:i=0,redistributeLast:r=!0}=e,o=i||a;const c=Math.ceil(a/o);return f.times(a,(e=>{const i=e%o,l=Math.floor(e/o);return r&&l===c-1&&(o=a%c||o),t===$a.Row?[Wa(_a.x,s,i,o),Wa(_a.y,n,l,c)]:[Wa(_a.x,s,l,c),Wa(_a.y,n,i,o)]}))}function Wa(e,t,a,s){const n=t/s;return(e-t+n)/2+n*a}function Ka(e){let{numOfItems:t,xSpacing:a=30,ySpacing:s=30}=e;const n=new Array;for(let i=0;i<t;i++)n.push([i*a,i*s]);return n}!function(e){e.Row="Row",e.Column="Column"}($a||($a={}));const qa={fontFamily:"Verdana",fontSize:"15px",fill:Ha.lightBlue,align:"left",wordWrap:{width:290}};class Za extends Phaser.GameObjects.Container{constructor(e,t,a,s){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:300;super(e,t,a),this.renderTextHover(s,n)}renderTextHover(e,t){const a=parseInt(qa.fontSize.substring(0,qa.fontSize.length-2)),s=e.length*a*.75,n=Math.min(s,t),i=new Phaser.GameObjects.Text(this.scene,30,10,e,{...qa,wordWrap:{width:n-10}}),r=new Phaser.GameObjects.Rectangle(this.scene,20,0,n,i.getBounds().bottom+10,za.darkBlue).setOrigin(0,0).setAlpha(.8);this.add([r,i]),this.setDepth(1),this.setVisible(!1)}}const Ya=Za,Ja=(e,t,a,s)=>{let{x:n,y:i,oriX:r,oriY:o}=a;return new Phaser.GameObjects.BitmapText(e,n,i,s.key,t,s.size,s.align).setOrigin(r,o)},Qa={key:Ua.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},es={key:Ua.alienLeagueFont.key,size:50,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},ts={key:Ua.zektonFont.key,size:18,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},as={fontFamily:"Verdana",fontSize:"18px",fill:Ha.lightBlue,align:"center",lineSpacing:10,wordWrap:{width:500}},ss={id:"default-award",assetKey:Fa.nullInteractionId,assetPath:Fa.nullInteractionId,title:Fa.nullInteractionId,description:"There is no asset associated with this award.",completed:!1},ns="Asset key can be used to include the asset into your room by using 'create_award' function.",is=.3*-_a.x,rs=.05*-_a.y,os=rs+275,cs={arrow:{x:.08*_a.x,y:.34*_a.y,xOffset:80,xScale:.4,yScale:.3},itemsPerPage:7,list:{yStart:.31*-_a.y,ySpace:100},listTextConfig:{x:.09*-_a.x,y:0,oriX:0,oriY:.55},noPreviewTextConfig:{x:is,y:-40,oriX:.5,oriY:.5},preview:{descText:{yOffset:320},rect:{dim:430,x:is,y:rs,xOffset:30,yOffset:15},key:{x:is,y:os,width:430,height:35},keyTagTextConfig:{x:is-205,y:os,oriX:0,oriY:.5},keyTextConfig:{x:is-90,y:os,oriX:0,oriY:.5},explanation:{x:is-150,y:rs+200},titleTextConfig:{x:is+20,y:rs-275,oriX:.5,oriY:.5}}},ls=e=>e.map((e=>ds(e))),ds=e=>{const t=Eo.getInstance().getAwardsMapping().get(e);return t||{...ss,title:e}};let hs,us;!function(e){e.Image="Image",e.Sprite="Sprite"}(hs||(hs={})),function(e){e.Background="Background",e.Object="Object"}(us||(us={}));const gs={spaceshipBg:{type:hs.Image,key:"spaceship-bg",path:"/locations/spaceshipBackground.png"},saBanner:{type:hs.Image,key:"sa-banner",path:"/ui/sourceAcadBannerOneLine.png"},shortButton:{type:hs.Image,key:"short-button",path:"/ui/shortButton.png"},mediumButton:{type:hs.Image,key:"med-button",path:"/ui/mediumButton.png"},longButton:{type:hs.Image,key:"long-button",path:"/ui/longButton.png"},topButton:{type:hs.Image,key:"top-button",path:"/ui/topButton.png"},speechBox:{type:hs.Image,key:"speechBox",path:"/ui/speechbox.png"},speakerBox:{type:hs.Image,key:"speakerBox",path:"/ui/speakerBox.png"},defaultLocationImg:{type:hs.Image,key:"loc-default",path:"/ui/defaultLocation.jpg"},locationPreviewFrame:{type:hs.Image,key:"loc-preview-frame",path:"/ui/locationPreviewFrame.png"},locationPreviewFill:{type:hs.Image,key:"loc-preview-fill",path:"/ui/locationPreviewFill.png"},talkOptButton:{type:hs.Image,key:"talk-opt-button",path:"/ui/talkOptButton.png"},talkOptCheck:{type:hs.Image,key:"talk-opt-check",path:"/ui/talkOptCheck.png"},modeMenuBanner:{type:hs.Image,key:"mode-banner",path:"/ui/modeMenuBanner.png"},popUpFrame:{type:hs.Image,key:"pop-up-frame",path:"/ui/popUpFrame.png"},mediumBox:{type:hs.Image,key:"medium-box",path:"/ui/mediumBox.png"},diamond:{type:hs.Image,key:"diamond",path:"/ui/zircon.png"},arrow:{type:hs.Image,key:"arrow",path:"/ui/arrow.png"},cookies:{type:hs.Image,key:"cookies",path:"/images/cookies.png"},scrollFrame:{type:hs.Image,key:"scroll-frame",path:"/ui/scrollFrame.png"},messageBar:{type:hs.Image,key:"message-bar",path:"/ui/messageBg.png"},escapeMenuBackground:{type:hs.Image,key:"escape-bg",path:"/ui/escapeMenu.png"},awardsMenu:{type:hs.Image,key:"award-bg",path:"/ui/collectiblesBg.png"},awardsBanner:{type:hs.Image,key:"award-banner",path:"/ui/awardsBanner.png"},awardsPageChosen:{type:hs.Image,key:"award-pg-chosen",path:"/ui/collectiblesPageOptChosen.png"},awardsPage:{type:hs.Image,key:"award-pg-opt",path:"/ui/collectiblesPageOpt.png"},awardsBackground:{type:hs.Image,key:"award-hall-bg",path:"/ui/awardsHall.png"},gear:{type:hs.Image,key:"gear",path:"/ui/settings.png"},journal:{type:hs.Image,key:"journal",path:"/ui/journal.png"},chapterRepeatButton:{type:hs.Image,key:"chapter-repeat",path:"/ui/chapterRepeat.png"},chapterContinueButton:{type:hs.Image,key:"chapter-continue",path:"/ui/chapterContinue.png"},StarGold:{type:hs.Image,key:"StarGold",path:"/ui/StarGold.png"},StarSilver:{type:hs.Image,key:"StarSilver",path:"/ui/StarSilver.png"},StarBronze:{type:hs.Image,key:"StarBronze",path:"/ui/StarBronze.png"},chapterSelectFrame:{type:hs.Image,key:"chapter-select-frame",path:"/ui/chapterSelectionFrame.png"},chapterSelectBorder:{type:hs.Image,key:"chapter-select-border",path:"/ui/chapterSelectionBorder.png"},chapterSelectArrow:{type:hs.Image,key:"chapter-select-arrow",path:"/ui/chapSelectArrow.png"},mainMenuOptBanner:{type:hs.Image,key:"menu-option",path:"/ui/menuOption.png"},settingBanner:{type:hs.Image,key:"settings-bg",path:"/ui/settingsBg.png"},settingOption:{type:hs.Image,key:"settings-opt",path:"/ui/settingsOption.png"},verifiedFrame:{type:hs.Image,key:"verified-frame",path:"/ui/verifiedFrame.png"},sourceCrashedPod:{type:hs.Image,key:"source-crashed-pod",path:"/locations/sourceCrashedPod.png"},squareKeyboardIcon:{type:hs.Image,key:"keyboard-key-square",path:"/ui/keyboardKeyIcon.png"},medKeyboardIcon:{type:hs.Image,key:"keyboard-key-medium",path:"/ui/TabIcon.png"}},ps={volume:0,ease:"Power2"};let ms;!function(e){e[e.SFX=0]="SFX",e[e.BGM=1]="BGM"}(ms||(ms={}));const xs={buttonHover:{key:"btn-hover",path:"/sfx/buttonHover.mp3",config:{volume:.1},soundType:ms.SFX},buttonClick:{key:"btn-click",path:"/sfx/buttonClick.mp3",config:{volume:.1},soundType:ms.SFX},radioButtonClick:{key:"radio-btn-click",path:"/sfx/radioButtonClick.mp3",config:{volume:.15},soundType:ms.SFX},dialogueAdvance:{key:"dialogue-advance",path:"/sfx/dialogueAdvance.mp3",config:{volume:.3},soundType:ms.SFX},popUpEnter:{key:"pop-up-enter",path:"/sfx/popUpEnter.mp3",config:{volume:.35},soundType:ms.SFX},popUpExit:{key:"pop-up-exit",path:"/sfx/popUpExit.mp3",config:{volume:.35},soundType:ms.SFX},menuEnter:{key:"menu-enter",path:"/sfx/menuEnter.mp3",config:{volume:.5},soundType:ms.SFX},menuExit:{key:"menu-exit",path:"/sfx/menuExit.mp3",config:{volume:.5},soundType:ms.SFX},modeEnter:{key:"mode-enter",path:"/sfx/modeEnter.mp3",config:{volume:.1},soundType:ms.SFX},notifEnter:{key:"notif-enter",path:"/sfx/notifEnter.mp3",config:{volume:.25},soundType:ms.SFX},notifExit:{key:"notif-exit",path:"/sfx/notifExit.mp3",config:{volume:.25},soundType:ms.SFX},radioStatic:{key:"radio-static",path:"/sfx/radioStatic.mp3",config:{volume:.1},soundType:ms.SFX},galacticHarmony:{key:"galactic-harmony",path:"/bgm/GalacticHarmony.mp3",config:{volume:.25,loop:!0},soundType:ms.BGM}};let ys;!function(e){e[e.Effects=0]="Effects",e[e.Background=1]="Background",e[e.Character=2]="Character",e[e.Speaker=3]="Speaker",e[e.PopUp=4]="PopUp",e[e.Dialogue=5]="Dialogue",e[e.SpeakerBox=6]="SpeakerBox",e[e.UI=7]="UI",e[e.Objects=8]="Objects",e[e.BBox=9]="BBox",e[e.Escape=10]="Escape",e[e.Selector=11]="Selector",e[e.Dashboard=12]="Dashboard",e[e.WorkerMessage=13]="WorkerMessage"}(ys||(ys={}));const vs=[ys.Background,ys.Selector,ys.Objects,ys.BBox,ys.Character,ys.Speaker,ys.PopUp,ys.Dialogue,ys.SpeakerBox,ys.Effects,ys.Dashboard,ys.Escape,ys.UI,ys.WorkerMessage];var bs=a(26058);function Cs(e){return new Promise((t=>setTimeout(t,e)))}function fs(e,t,a){return Math.min(Math.max(e,t),a)}function Ss(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.startsWith("/")&&(e=e.substr(1)),Fa.assetsFolder+(t?Is()+e:e)}function js(e,t){if(void 0===e)throw new Error(t||"Object not found");return e}const ws=()=>bs.h.getState().session.courseId,Is=()=>bs.h.getState().session.assetsPrefix||"",ks=function(e){return{alpha:0,targets:e,duration:arguments.length>1&&void 0!==arguments[1]?arguments[1]:Fa.fadeDuration,ease:"Power2"}},Ms=function(e){return{alpha:1,targets:e,duration:arguments.length>1&&void 0!==arguments[1]?arguments[1]:Fa.fadeDuration,ease:"Power2"}};function As(e,t){let{fadeDuration:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t&&(e.add.tween(ks([t],a||Fa.fadeDuration)),setTimeout((()=>t.destroy()),a||Fa.fadeDuration))}function Ts(e){return new Phaser.GameObjects.Rectangle(e,Va.x,Va.y,_a.x,_a.y,0)}function Ps(e,t){let a=0;const s=setInterval((()=>{a%2!==0?(t.setAlpha(0),e.tweens.add(Ms([t],250))):(t.setAlpha(1),e.tweens.add(ks([t],250))),a++}),500);return function(){a=0,clearInterval(s)}}const Es={y:0,duration:300,ease:"Power2"},Ns={y:-_a.y,duration:250,ease:"Power2"},Os=(_a.x,{x:0,duration:500,ease:"Power2"}),Ds={x:_a.x,duration:500,ease:"Power2"},Rs=3e3,Bs={x:1900,y:100,oriX:1,oriY:.5},Ls={key:Ua.zektonDarkFont.key,size:24,align:Phaser.GameObjects.BitmapText.ALIGN_RIGHT},Gs=(()=>{let e=Promise.resolve();return(t,a)=>{e=e.then((()=>async function(e,t){const a=new Phaser.GameObjects.Container(e,0,0),s=new Phaser.GameObjects.Sprite(e,_a.x,100,gs.messageBar.key);s.setScale(-1.5,.8);const n=Ja(e,t,Bs,Ls);a.add([s,n]),e.getLayerManager().addToLayer(ys.Effects,a),a.setPosition(_a.x,0),a.setAlpha(0),Eo.getInstance().getSoundManager().playSound(xs.notifEnter.key),e.add.tween({targets:a,alpha:1,...Os}),await Cs(Os.duration+Rs),Eo.getInstance().getSoundManager().playSound(xs.notifExit.key),e.add.tween({targets:a,alpha:1,...Ds}),await Cs(Ds.duration),As(e,a,{fadeDuration:Fa.fadeDuration})}(t,a)))}})();const Us={prompt:{x:30,y:60,xPad:30,yPad:10},rect:{x:10,y:760,width:_a.x-20},text:{xPad:100,yPad:70},speakerTextConfig:{x:320,y:745,oriX:.5,oriY:.5}},Fs={fontFamily:"Verdana",fontSize:"30px",fill:Ha.lightBlue,align:"left",lineSpacing:10,wordWrap:{width:Us.rect.width-2*Us.text.xPad-2*Us.rect.x}},_s={key:Ua.zektonFont.key,size:36,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Vs=Us;const Hs=function(e,t){let{x:a=0,y:s=0,textStyle:n={},typeWriterInterval:i=1}=t;const r=new Phaser.GameObjects.Text(e,a,s,"",n);let o,c="",l=0;const d=()=>{o&&clearInterval(o)};return{container:r,changeLine:e=>{e&&(c=e,r.text="",l=0,d(),o=setInterval((()=>{r.text+=c[l++],l===c.length&&clearInterval(o)}),i))},clearTyping:d}};const zs=class{constructor(e){this.typewriter=void 0,this.dialogueBox=void 0,this.blinkingDiamond=void 0;const t=sn.getInstance().getGameManager();var a;this.dialogueBox=(a=t,new Phaser.GameObjects.Image(a,Va.x,Va.y,gs.speechBox.key).setAlpha(.9)).setInteractive({useHandCursor:!0,pixelPerfect:!0}),this.typewriter=function(e,t){return Hs(e,{x:Vs.rect.x+Vs.text.xPad,y:Vs.rect.y+Vs.text.yPad,textStyle:t})}(t,e),this.blinkingDiamond=this.drawDiamond(t)}getDialogueContainer(){const e=sn.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0);return t.add([this.dialogueBox,this.blinkingDiamond.container,this.typewriter.container]),t}drawDiamond(e){const t=new Phaser.GameObjects.Image(e,_a.x-Vs.prompt.x-Vs.prompt.xPad,_a.y-Vs.prompt.y-Vs.prompt.yPad,gs.diamond.key).setDisplaySize(Vs.prompt.x,Vs.prompt.y);return{container:t,clearBlink:Ps(e,t)}}getDialogueBox(){return this.dialogueBox}destroy(){const e=sn.getInstance().getGameManager();this.typewriter.clearTyping(),this.blinkingDiamond.clearBlink(),this.getDialogueBox().off(Phaser.Input.Events.GAMEOBJECT_POINTER_UP),As(e,this.getDialogueContainer())}changeText(e){this.typewriter.changeLine(e)}},$s={key:Ua.alienLeagueFont.key,size:100,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Xs={x:Va.x,y:Vs.rect.y+2*$s.size,oriX:.5,oriY:.9};const Ws=1,Ks=.9;function qs(e,t){let{assetKey:a,message:s="",textConfig:n={x:0,y:0,oriX:0,oriY:0},bitMapTextStyle:i=Fa.defaultFontStyle,onDown:r=Fa.nullFunction,onUp:o=Fa.nullFunction,onHover:c=Fa.nullFunction,onOut:l=Fa.nullFunction,onPointerMove:d=Fa.nullFunction,onHoverEffect:h=!0,onClickSound:u=xs.buttonClick.key,onHoverSound:g=xs.buttonHover.key}=t;const p=new Phaser.GameObjects.Container(e,0,0),m=new Phaser.GameObjects.Sprite(e,0,0,a);m.setInteractive({pixelPerfect:!0,useHandCursor:!0}),m.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,(()=>{Eo.getInstance().getSoundManager().playSound(u),o()})),m.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,(()=>{Eo.getInstance().getSoundManager().playSound(g),h&&p.setAlpha(Ws),c()})),m.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,(()=>{h&&p.setAlpha(Ks),l()})),m.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,(()=>{r()})),m.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_MOVE,((e,t,a)=>{d(e,t,a)}));const x=Ja(e,s,n,i);return p.add([m,x]),h&&p.setAlpha(Ks),p}const Zs={textPad:20,textConfig:{x:15,y:-15,oriX:.5,oriY:.5},y:100,width:450,yInterval:100},Ys={fontFamily:"Verdana",fontSize:"20px",fill:Ha.offWhite,align:"right",lineSpacing:10,wordWrap:{width:Zs.width-2*Zs.textPad}},Js={key:Ua.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};async function Qs(e,t,a){const s=new Phaser.GameObjects.Container(e,0,0),n=new Phaser.GameObjects.Text(e,_a.x-Zs.textPad,Zs.y,t,Ys).setOrigin(1,0),i=new Phaser.GameObjects.Rectangle(e,_a.x,Zs.y-Zs.textPad,Zs.width,.5*n.getBounds().bottom+Zs.textPad,za.darkBlue,.8).setOrigin(1,0),r=new Phaser.GameObjects.Rectangle(e,_a.x,Zs.y-Zs.textPad,Zs.width,.5*i.getBounds().bottom+(a.length+.5)*Zs.yInterval,za.lightBlue,.2).setOrigin(1,0);s.add([r,i,n]);const o=Ka({numOfItems:a.length,xSpacing:0,ySpacing:Zs.yInterval});sn.getInstance().addToLayer(ys.UI,s);const c=new Promise((t=>{s.add(a.map(((a,n)=>qs(e,{assetKey:gs.mediumButton.key,message:a,textConfig:Zs.textConfig,bitMapTextStyle:Js,onUp:()=>{s.destroy(),t(n)}}).setPosition(_a.x-Zs.width/2,o[n][1]+i.getBounds().bottom+75))))}));s.setPosition(_a.x,0),Eo.getInstance().getSoundManager().playSound(xs.notifEnter.key),e.add.tween({targets:s,alpha:1,...Os}),await Cs(Os.duration);const l=await c;return Eo.getInstance().getSoundManager().playSound(xs.notifExit.key),e.add.tween({targets:s,alpha:1,...Ds}),await Cs(Ds.duration),As(e,s,{fadeDuration:Fa.fadeDuration}),l}let en,tn;!function(e){e.Move="Move",e.Explore="Explore",e.Talk="Talk",e.Menu="Menu",e.EscapeMenu="EscapeMenu",e.None="None",e.Sequence="Sequence",e.Dashboard="Dashboard"}(en||(en={})),function(e){e.EscapeMenu="EscapeMenu",e.Dashboard="Dashboard"}(tn||(tn={}));class an{constructor(){this.gameManager=void 0,this.getGameManager=()=>js(this.gameManager),this.gameManager=void 0}static getInstance(){return an.instance||(an.instance=new an),an.instance}setGameManager(e){this.gameManager=e}getCurrLocId(){return this.getGameManager().currentLocationId}getLocationAtId(e){return this.getGameManager().getStateManager().getGameMap().getLocationAtId(e)}async changeLocationTo(e){await this.getGameManager().changeLocationTo(e)}getLocationModes(e){return this.getGameManager().getStateManager().getLocationModes(e)}addLocationMode(e,t){this.getGameManager().getStateManager().addLocationMode(e,t)}removeLocationMode(e,t){this.getGameManager().getStateManager().removeLocationMode(e,t)}hasTriggeredInteraction(e){return this.getGameManager().getStateManager().hasTriggeredInteraction(e)}triggerStateChangeAction(e){this.getGameManager().getStateManager().triggerStateChangeAction(e)}triggerInteraction(e){this.getGameManager().getStateManager().triggerInteraction(e)}watchGameItemType(e,t){this.getGameManager().getStateManager().watchGameItemType(e,t)}getGameMap(){return this.getGameManager().getStateManager().getGameMap()}getGameItemsInLocation(e,t){return this.getGameManager().getStateManager().getGameItemsInLocation(e,t)}addItem(e,t,a){this.getGameManager().getStateManager().addItem(e,t,a)}removeItem(e,t,a){return this.getGameManager().getStateManager().removeItem(e,t,a)}makeObjectGlow(e,t){this.getGameManager().getObjectManager().makeObjectGlow(e,t)}makeObjectBlink(e,t){this.getGameManager().getObjectManager().makeObjectBlink(e,t)}setObjProperty(e,t){this.getGameManager().getStateManager().setObjProperty(e,t)}renderObjectLayerContainer(e){this.getGameManager().getObjectManager().renderObjectsLayerContainer(e)}getAllActivatables(){return[...this.getGameManager().getObjectManager().getActivatables(),...this.getGameManager().getBBoxManager().getActivatables()]}setBBoxProperty(e,t){this.getGameManager().getStateManager().setBBoxProperty(e,t)}renderBBoxLayerContainer(e){this.getGameManager().getBBoxManager().renderBBoxLayerContainer(e)}areAllObjectivesComplete(){return this.getGameManager().getStateManager().areAllObjectivesComplete()}isObjectiveComplete(e){return this.getGameManager().getStateManager().isObjectiveComplete(e)}areObjectivesComplete(e){return this.getGameManager().getStateManager().areObjectivesComplete(e)}completeObjective(e){this.getGameManager().getStateManager().completeObjective(e)}isTaskComplete(e){return this.getGameManager().getStateManager().isTaskComplete(e)}areTasksComplete(e){return this.getGameManager().getStateManager().areTasksComplete(e)}completeTask(e){this.getGameManager().getStateManager().completeTask(e),Gs(this.getGameManager(),"Task completed!")}showTask(e){this.getGameManager().getStateManager().showTask(e),Gs(this.getGameManager(),"New task added")}getAllVisibleTaskData(){return this.getGameManager().getStateManager().getAllVisibleTaskData()}addCollectible(e){Eo.getInstance().getUserStateManager().addCollectible(e)}async isInUserState(e,t){return Eo.getInstance().getUserStateManager().isInUserState(e,t)}clearSeveralLayers(e){this.getGameManager().getLayerManager().clearSeveralLayers(e)}addToLayer(e,t){this.getGameManager().getLayerManager().addToLayer(e,t)}showLayer(e){this.getGameManager().getLayerManager().showLayer(e)}hideLayer(e){this.getGameManager().getLayerManager().hideLayer(e)}async fadeInLayer(e,t){await this.getGameManager().getLayerManager().fadeInLayer(e,t)}async fadeOutLayer(e,t){await this.getGameManager().getLayerManager().fadeOutLayer(e,t)}async bringUpUpdateNotif(e){await async function(e,t){const a=new zs({}),s=a.getDialogueContainer();e.getLayerManager().addToLayer(ys.Effects,s),e.getLayerManager().fadeInLayer(ys.Effects);const n=Ja(e,t,Xs,$s).setAlpha(0);s.add(n),Eo.getInstance().getSoundManager().playSound(xs.notifEnter.key),e.add.tween(Ms([n],2*Fa.fadeDuration)),await Cs(2*Fa.fadeDuration);const i=new Promise((t=>{a.getDialogueBox().on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,(()=>{Eo.getInstance().getSoundManager().playSound(xs.notifExit.key),As(e,n,{fadeDuration:Fa.fadeDuration/4}),a.destroy(),t()}))}));await i}(this.getGameManager(),e)}async processGameActions(e){await this.getGameManager().getPhaseManager().pushPhase(en.Sequence),await this.getGameManager().getActionManager().processGameActions(e),await this.getGameManager().getPhaseManager().popPhase()}async processGameActionsInSamePhase(e){await this.getGameManager().getActionManager().processGameActions(e)}async showDialogue(e){await this.getGameManager().getPhaseManager().pushPhase(en.Sequence),await this.getGameManager().getDialogueManager().showDialogue(e),await this.getGameManager().getPhaseManager().popPhase()}async showDialogueInSamePhase(e){await this.getGameManager().getDialogueManager().showDialogue(e)}storeDialogueLine(e,t){this.getGameManager().getDialogueStorageManager().storeLine(e,t)}getDialogueStorage(){return this.getGameManager().getDialogueStorageManager().getDialogueStorage()}async obtainCollectible(e){Gs(this.getGameManager(),`Obtained ${ds(e).title}`),Eo.getInstance().getUserStateManager().addCollectible(e)}displayPopUp(e,t,a,s){this.getGameManager().getPopupManager().displayPopUp(e,t,a,s)}destroyAllPopUps(){this.getGameManager().getPopupManager().destroyAllPopUps()}async destroyPopUp(e){this.getGameManager().getPopupManager().destroyPopUp(e)}async saveGame(){await this.getGameManager().getSaveManager().saveGame()}async saveSettings(e){await this.getGameManager().getSaveManager().saveSettings(e)}getLoadedUserState(){return this.getGameManager().getSaveManager().getLoadedUserState()}getSoundManager(){return Eo.getInstance().getSoundManager()}playSound(e){Eo.getInstance().getSoundManager().playSound(e)}playBgMusic(e){Eo.getInstance().getSoundManager().playBgMusic(e)}async stopAllSound(){Eo.getInstance().getSoundManager().stopAllSound()}pauseCurrBgMusic(){Eo.getInstance().getSoundManager().pauseCurrBgMusic()}continueCurrBgMusic(){Eo.getInstance().getSoundManager().continueCurrBgMusic()}applySoundSettings(e){Eo.getInstance().getSoundManager().applyUserSettings(e)}loadSounds(e){Eo.getInstance().getSoundManager().loadSounds(e)}startAnimation(e,t,a){const s=this.getAssetByKey(this.getGameMap().getAssetKeyFromId(e));this.getGameManager().getAnimationManager().displayAnimation(s,t,a)}stopAnimation(e){const t=this.getAssetByKey(this.getGameMap().getAssetKeyFromId(e));this.getGameManager().getAnimationManager().stopAnimation(t)}setDefaultCursor(e){this.getGameManager().getInputManager().setDefaultCursor(e)}enableKeyboardInput(e){this.getGameManager().getInputManager().enableKeyboardInput(e)}enableMouseInput(e){this.getGameManager().getInputManager().enableMouseInput(e)}enableSprite(e,t){t?this.getGameManager().input.enable(e):this.getGameManager().input.disable(e)}async popPhase(){await this.getGameManager().getPhaseManager().popPhase()}async pushPhase(e){await this.getGameManager().getPhaseManager().pushPhase(e)}async swapPhase(e){await this.getGameManager().getPhaseManager().swapPhase(e)}isCurrentPhase(e){return this.getGameManager().getPhaseManager().isCurrentPhase(e)}renderBackgroundLayerContainer(e){this.getGameManager().getBackgroundManager().renderBackgroundLayerContainer(e)}async promptNavigateToAssessment(e){0===await Qs(an.getInstance().getGameManager(),"Are you ready for the challenge?",["Yes","No"])&&(window.open(`/courses/${ws()}/missions/${e}/0`,"blank"),window.focus())}async updateAssessmentState(){await Eo.getInstance().getUserStateManager().loadAssessments()}createCharacterSprite(e,t,a){return this.getGameManager().getCharacterManager().createCharacterSprite(e,t,a)}moveCharacter(e,t,a){this.getGameManager().getStateManager().moveCharacter(e,t,a)}updateCharacter(e,t){this.getGameManager().getStateManager().updateCharacter(e,t)}getDialogueById(e){return js(this.getGameMap().getDialogueMap().get(e))}getCharacterById(e){return js(this.getGameMap().getCharacterMap().get(e))}getActionById(e){return js(this.getGameMap().getActionMap().get(e))}getObjectById(e){return js(this.getGameMap().getObjectPropMap().get(e))}getBBoxById(e){return js(this.getGameMap().getBBoxPropMap().get(e))}getAssetByKey(e){return this.getGameMap().getAssetByKey(e)}}an.instance=void 0;const sn=an;let nn,rn,on,cn;!function(e){e.UserState="UserState",e.ChecklistState="ChecklistState",e.TasklistState="TasklistState"}(nn||(nn={})),function(e){e.collectibles="collectibles",e.assessments="assessments",e.achievements="achievements"}(rn||(rn={}));class ln{static async checkAllConditionsSatisfied(e){return(await Promise.all(e.map((async e=>await this.checkConditionSatisfied(e))))).every((e=>!0===e))}static async checkConditionSatisfied(e){const{state:t,conditionParams:a,boolean:s}=e;switch(t){case nn.UserState:return await sn.getInstance().isInUserState(a.userStateType,a.id)===s;case nn.ChecklistState:return sn.getInstance().isObjectiveComplete(a.id)===s;case nn.TasklistState:return sn.getInstance().isTaskComplete(a.id)===s;default:return!0}}}!function(e){e.MoveCharacter="MoveCharacter",e.UpdateCharacter="UpdateCharacter",e.ObtainCollectible="ObtainCollectible",e.CompleteObjective="CompleteObjective",e.CompleteTask="CompleteTask",e.ShowTask="ShowTask",e.PreviewLocation="PreviewLocation",e.AddItem="AddItem",e.RemoveItem="RemoveItem",e.ShowDialogue="ShowDialogue",e.ChangeBackground="ChangeBackground",e.StartAnimation="StartAnimation",e.StopAnimation="StopAnimation",e.RemoveLocationMode="RemoveLocationMode",e.AddLocationMode="AddLocationMode",e.AddPopup="AddPopup",e.MakeObjectBlink="MakeObjectBlink",e.MakeObjectGlow="MakeObjectGlow",e.PlayBGM="PlayBGM",e.PlaySFX="PlaySFX",e.ShowObjectLayer="ShowObjectLayer",e.NavigateToAssessment="NavigateToAssessment",e.UpdateAssessmentStatus="UpdateAssessmentStatus",e.Delay="Delay"}(on||(on={}));class dn{static async executeGameAction(e,t){const a=sn.getInstance();switch(e){case on.AddItem:return void a.addItem(t.gameItemType,t.locationId,t.id);case on.RemoveItem:return void a.removeItem(t.gameItemType,t.locationId,t.id);case on.AddLocationMode:return void a.addLocationMode(t.locationId,t.mode);case on.RemoveLocationMode:return void a.removeLocationMode(t.locationId,t.mode);case on.MoveCharacter:return void a.moveCharacter(t.id,t.locationId,t.position);case on.UpdateCharacter:return void a.updateCharacter(t.id,t.expression);case on.ChangeBackground:return void a.renderBackgroundLayerContainer(t.id);case on.StartAnimation:return void a.startAnimation(t.id,t.startFrame,t.frameRate);case on.StopAnimation:return void a.stopAnimation(t.id);case on.PreviewLocation:return a.renderBackgroundLayerContainer(t.id),a.renderObjectLayerContainer(t.id),void a.renderBBoxLayerContainer(t.id);case on.ObtainCollectible:return void a.obtainCollectible(t.id);case on.CompleteObjective:return void a.completeObjective(t.id);case on.CompleteTask:return void a.completeTask(t.id);case on.ShowTask:return void a.showTask(t.id);case on.ShowDialogue:return void(a.isCurrentPhase(en.Sequence)?await a.showDialogueInSamePhase(t.id):await a.showDialogue(t.id));case on.AddPopup:return void await a.displayPopUp(t.id,t.position,t.duration,t.size);case on.MakeObjectBlink:return void await a.makeObjectBlink(t.id,t.turnOn);case on.MakeObjectGlow:return void await a.makeObjectGlow(t.id,t.turnOn);case on.PlayBGM:return void Eo.getInstance().getSoundManager().playBgMusic(t.id);case on.PlaySFX:return void await Eo.getInstance().getSoundManager().playSound(t.id);case on.ShowObjectLayer:return void(t.show?a.showLayer(ys.Objects):a.hideLayer(ys.Objects));case on.NavigateToAssessment:return void await a.promptNavigateToAssessment(t.assessmentId);case on.UpdateAssessmentStatus:return void await a.updateAssessmentState();case on.Delay:return void await Cs(t.duration);default:return}}static isStateChangeAction(e){switch(e){case on.AddItem:case on.RemoveItem:case on.AddLocationMode:case on.RemoveLocationMode:case on.MoveCharacter:case on.UpdateCharacter:return!0;case on.NavigateToAssessment:case on.UpdateAssessmentStatus:case on.PreviewLocation:case on.ChangeBackground:case on.StartAnimation:case on.StopAnimation:case on.ObtainCollectible:case on.CompleteObjective:case on.CompleteTask:case on.ShowTask:case on.ShowDialogue:case on.AddPopup:case on.MakeObjectBlink:case on.MakeObjectGlow:case on.PlayBGM:case on.PlaySFX:case on.ShowObjectLayer:case on.Delay:return!1}}}class hn{async fastForwardGameActions(e){if(e)for(const t of e){const{actionType:e,actionParams:a}=sn.getInstance().getActionById(t);await dn.executeGameAction(e,a)}}async processGameActions(e){if(e){for(const t of e)await this.processGameAction(t);await sn.getInstance().saveGame()}}async processGameAction(e){const{actionType:t,actionParams:a,actionConditions:s,isRepeatable:n,interactionId:i}=sn.getInstance().getActionById(e);await this.checkCanPlayAction(n,i,s)&&(await dn.executeGameAction(t,a),dn.isStateChangeAction(t)&&sn.getInstance().triggerStateChangeAction(e),sn.getInstance().triggerInteraction(e))}async checkCanPlayAction(e,t,a){return(e||!sn.getInstance().hasTriggeredInteraction(t))&&await ln.checkAllConditionsSatisfied(a)}}!function(e){e.navigation="navigation",e.locations="locations",e.talkTopics="talkTopics",e.dialogues="dialogues",e.objects="objects",e.boundingBoxes="boundingBoxes",e.characters="characters",e.actions="actions",e.bgmKey="bgmKey",e.collectibles="collectibles"}(cn||(cn={}));class un{constructor(){this.game=sn.getInstance().getGameManager(),this.animationInstanceMap=new Map,this.isSprite=e=>e.type===hs.Sprite}createImage(e,t){var a,s,n,i;switch(e.type){case hs.Sprite:return this.createAnimation(e,(null===(a=e.config)||void 0===a?void 0:a.start)||0,(null===(s=e.config)||void 0===s?void 0:s.frameRate)||20),this.getAnimation(e);case hs.Image:return new Phaser.GameObjects.Image(this.game,(null===e||void 0===e||null===(n=e.config)||void 0===n?void 0:n.centreX)||0,(null===e||void 0===e||null===(i=e.config)||void 0===i?void 0:i.centreY)||0,t)}}displayAnimation(e,t,a){var s;const n=sn.getInstance().getAssetByKey(e.path);switch(n&&n.config&&(n.config.start=t,n.config.frameRate=a),null===(s=n.config)||void 0===s?void 0:s.animType){case us.Object:const t=sn.getInstance().getCurrLocId();sn.getInstance().addItem(cn.objects,t,e.key);break;case us.Background:sn.getInstance().renderBackgroundLayerContainer(e.key)}}createAnimation(e,t,a){if(this.isSprite(e)){var s,n,i;this.removeAnimation(e);const r=new Phaser.GameObjects.Sprite(this.game,(null===(s=e.config)||void 0===s?void 0:s.centreX)||0,(null===(n=e.config)||void 0===n?void 0:n.centreY)||0,e.path),o={key:e.path,frames:this.game.anims.generateFrameNumbers(e.path,{start:t,end:(null===(i=e.config)||void 0===i?void 0:i.endFrame)||0,first:0}),frameRate:a,repeat:-1};this.game.anims.create(o),this.animationInstanceMap.set(e.key,r)}}startAnimation(e){if(this.isSprite(e)){const t=this.getAnimation(e);t.play(e.path,!1),this.game.add.existing(t)}}stopAnimation(e){const t=this.animationInstanceMap.get(e.key);this.isSprite(e)&&t&&t.anims&&t.anims.stop()}removeAnimation(e){const t=this.animationInstanceMap.get(e.key);t&&(this.game.anims.remove(e.path),t.destroy(),this.animationInstanceMap.delete(e.key))}getAnimation(e){return js(this.animationInstanceMap.get(e.key),`Image: ${e.path} not found`)}}function gn(e,t,a){const s=e.displayHeight/e.displayWidth;t?(e.displayWidth=t,e.displayHeight=a||t*s):(e.displayWidth=a/s,e.displayHeight=a)}function pn(e,t,a){e.displayWidth>e.displayHeight?gn(e,0,a):gn(e,t)}function mn(e,t,a){e.displayWidth>e.displayHeight?gn(e,t):gn(e,0,a)}const xn=class{constructor(e,t){this.scene=void 0,this.awardsGetter=void 0,this.uiContainer=void 0,this.previewContainer=void 0,this.itemsContainer=void 0,this.activePageNumber=void 0,this.scene=e,this.awardsGetter=t,this.activePageNumber=0}createUIContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0);this.uiContainer=e;const t=qs(this.scene,{assetKey:gs.arrow.key,onUp:()=>this.nextPage(!1)}).setScale(cs.arrow.yScale,cs.arrow.yScale).setRotation(-90*Math.PI/180).setPosition(cs.arrow.x-cs.arrow.xOffset,cs.arrow.y),a=qs(this.scene,{assetKey:gs.arrow.key,onUp:()=>this.nextPage(!0)}).setScale(cs.arrow.xScale,cs.arrow.yScale).setRotation(90*Math.PI/180).setPosition(cs.arrow.x+cs.arrow.xOffset,cs.arrow.y);e.add([t,a]);const s=new Phaser.GameObjects.Sprite(this.scene,cs.preview.rect.x,cs.preview.rect.y,gs.popUpFrame.key).setScale(1.2);return e.add(s),e.add(function(e){const t=new Phaser.GameObjects.Container(e,cs.preview.rect.xOffset,cs.preview.rect.yOffset),a=cs.preview.key,s=new Phaser.GameObjects.Rectangle(e,a.x,a.y,a.width,a.height,za.lightBlue,.1),n=new Phaser.GameObjects.Rectangle(e,a.x-a.width*s.originX*.75,a.y,a.width/4,a.height,za.lightBlue,.2),i=Ja(e,"asset key",cs.preview.keyTagTextConfig,ts),r=new Ya(e,cs.preview.explanation.x,cs.preview.explanation.y,ns);return n.setInteractive(),n.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,(()=>r.setVisible(!0))),n.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,(()=>r.setVisible(!1))),t.add([s,n,i,r]),t}(this.scene)),this.setPage(),e}setPage(){this.uiContainer&&(this.itemsContainer&&this.itemsContainer.destroy(),this.itemsContainer=this.createItemsContainer(),this.uiContainer.add(this.itemsContainer),this.setPreview())}setPreview(e){if(this.uiContainer){if(this.previewContainer&&this.previewContainer.destroy(),!e)return;let t;if(this.previewContainer=new Phaser.GameObjects.Container(this.scene,cs.preview.rect.xOffset,cs.preview.rect.yOffset),e.assetKey===Fa.nullInteractionId)t=Ja(this.scene,"No preview available",cs.noPreviewTextConfig,ts);else{const a=cs.preview.rect;t=new Phaser.GameObjects.Sprite(this.scene,0,0,e.assetKey),mn(t,a.dim,a.dim),t.setPosition(a.x,a.y)}const a=Ja(this.scene,e.title,cs.preview.titleTextConfig,es),s=new Phaser.GameObjects.Text(this.scene,cs.preview.rect.x,cs.preview.rect.y+cs.preview.descText.yOffset,e.description,as).setOrigin(.5,0),n=!1===e.completed?"":e.assetKey,i=Ja(this.scene,n,cs.preview.keyTextConfig,ts),r=new Phaser.GameObjects.Rectangle(this.scene,cs.preview.rect.x,cs.preview.rect.y,cs.preview.rect.dim,cs.preview.rect.dim,0).setAlpha(e.completed?0:.8);this.previewContainer.add([t,r,a,s,i]),this.uiContainer.add(this.previewContainer)}}nextPage(e){const t=this.activePageNumber,a=fs(e?t+1:t-1,0,Number.MAX_SAFE_INTEGER);this.getItems(a).length>0&&(this.activePageNumber=a,this.setPage())}createItemsContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0),t=this.getItems(this.activePageNumber),a=Ka({numOfItems:t.length,xSpacing:0,ySpacing:cs.list.ySpace});return e.add(t.map(((e,t)=>this.createItemButton(e.title,a[t][0],a[t][1]+cs.list.yStart,(()=>this.setPreview(e)),!1!==e.completed)))),e}createItemButton(e,t,a,s,n){const i=qs(this.scene,{assetKey:gs.awardsBanner.key,message:e,textConfig:cs.listTextConfig,bitMapTextStyle:Qa,onUp:s,onHoverEffect:n}).setPosition(t,a);return n||i.setAlpha(.5),i}getItems(e){const t=this.awardsGetter(),a=ls(t),s=e*cs.itemsPerPage;return a.slice(s,s+cs.itemsPerPage)}};class yn{constructor(){this.currentBackground=void 0}renderBackgroundLayerContainer(e){const t=sn.getInstance().getLocationAtId(e).assetKey;this.renderBackgroundImage(t)}renderBackgroundImage(e){sn.getInstance().clearSeveralLayers([ys.Background]),this.currentBackground=sn.getInstance().getAssetByKey(e);const t=sn.getInstance().getGameManager().getAnimationManager();let a;this.currentBackground&&(a=t.createImage(this.currentBackground,e),t.startAnimation(this.currentBackground),pn(a,_a.x,_a.y),sn.getInstance().addToLayer(ys.Background,a),sn.getInstance().fadeInLayer(ys.Background))}}const vn=class{constructor(){this.bboxes=void 0,this.bboxes=new Map,sn.getInstance().watchGameItemType(cn.boundingBoxes,this)}renderBBoxLayerContainer(e){sn.getInstance().clearSeveralLayers([ys.BBox]);const t=sn.getInstance().getGameItemsInLocation(cn.boundingBoxes,e);this.bboxes.clear(),t.map((e=>this.handleAdd(e)))}createBBox(e){const t=sn.getInstance().getGameManager(),{x:a,y:s,width:n,height:i,actionIds:r,interactionId:o}=e,c=new Phaser.GameObjects.Rectangle(t,a,s,n,i,0,0);return e.isInteractive&&c.setInteractive(),{sprite:c,clickArea:c,actionIds:r,interactionId:o}}handleAdd(e){const t=sn.getInstance().getBBoxById(e),a=this.createBBox(t);return sn.getInstance().addToLayer(ys.BBox,a.sprite),this.bboxes.set(e,a),!0}handleMutate(e){return this.handleDelete(e)&&this.handleAdd(e)}handleDelete(e){const t=this.bboxes.get(e);return!!t&&(this.bboxes.delete(e),t.sprite.destroy(),!0)}getActivatables(){return Array.from(this.bboxes.values())}},bn={charWidth:600,charRect:{x:{Left:350,Middle:Va.x,Right:_a.x-350}}};class Cn{constructor(){this.characterSpriteMap=void 0,this.characterSpriteMap=new Map,sn.getInstance().watchGameItemType(cn.characters,this)}renderCharacterLayerContainer(e){const t=sn.getInstance().getGameItemsInLocation(cn.characters,e);this.characterSpriteMap.clear(),t.map((e=>this.handleAdd(e)))}createCharacterSprite(e,t,a){const s=sn.getInstance().getCharacterById(e),{defaultPosition:n,defaultExpression:i,expressions:r,scale:o}=s,c=bn.charRect.x[a||n],l=r.get(t||i),d=new Phaser.GameObjects.Image(sn.getInstance().getGameManager(),c,_a.y,l).setOrigin(.5,1);return gn(d,bn.charWidth*o),d}handleAdd(e){const t=this.createCharacterSprite(e);return sn.getInstance().addToLayer(ys.Character,t),this.characterSpriteMap.set(e,t),!0}handleMutate(e){return this.handleDelete(e)&&this.handleAdd(e)}handleDelete(e){const t=this.characterSpriteMap.get(e);return!!t&&(this.characterSpriteMap.delete(e),t.destroy(),!0)}}const fn={key:Ua.alienLeagueFont.key,size:35,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},Sn={backButton:{y:.3*_a.y},page:{yStart:.3*-_a.y,ySpace:150},pageTextConfig:{x:.3*_a.x,y:0,oriX:.1,oriY:.5},pageArea:{x:-869,y:-412,width:.72*_a.x,height:.77*_a.y}};let jn;!function(e){e.Log="Log",e.Tasks="Tasks",e.Collectibles="Collectibles",e.Achievements="Achievements"}(jn||(jn={}));const wn=class{constructor(e,t,a){this.scene=void 0,this.pages=void 0,this.pageManagers=void 0,this.pageMask=void 0,this.uiContainer=void 0,this.pageChosenContainer=void 0,this.pageUIContainers=void 0,this.currPageIndex=void 0,this.getSoundManager=()=>Eo.getInstance().getSoundManager(),this.scene=e,this.pages=t,this.pageManagers=a,this.pageMask=this.createPageMask(),this.pageUIContainers=new Array(t.length),this.currPageIndex=0,this.scene.getPhaseManager().addPhaseToMap(en.Dashboard,this)}createPageMask(){const e=new Phaser.GameObjects.Graphics(this.scene),{x:t,y:a,width:s,height:n}=Sn.pageArea;return e.fillRect(t,a,s,n),e.createGeometryMask()}setPage(e){if(this.uiContainer){this.pageChosenContainer&&this.pageChosenContainer.destroy();const t=this.pageUIContainers[this.currPageIndex];t&&t.setVisible(!1),this.currPageIndex=e;let a=this.pageUIContainers[this.currPageIndex];a?a.setVisible(!0):(a=this.pageManagers[this.currPageIndex].createUIContainer(),a.setMask(this.pageMask),this.pageUIContainers[this.currPageIndex]=a,this.uiContainer.add(a));const s=this.getPageOptPositions(),n=this.currPageIndex,i=new Phaser.GameObjects.Sprite(this.scene,s[n][0],s[n][1]+Sn.page.yStart,gs.awardsPageChosen.key);this.pageChosenContainer=new Phaser.GameObjects.Container(this.scene,0,0,[i]),this.uiContainer.add(this.pageChosenContainer)}}createUIContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0),t=new Phaser.GameObjects.Rectangle(this.scene,0,0,_a.x,4*_a.y,0).setAlpha(.7).setInteractive(),a=new Phaser.GameObjects.Image(this.scene,0,0,gs.awardsMenu.key);e.add([t,a]);const s=this.pages.map(((e,t)=>({text:e,callback:()=>this.setPage(t)}))),n=this.getPageOptPositions();e.add(s.map(((e,t)=>this.createPageOpt(e.text,n[t][0],n[t][1]+Sn.page.yStart,e.callback))));const i=this.createPageOpt("Back",0,Sn.backButton.y,(async()=>{this.scene.getPhaseManager().isCurrentPhase(en.Dashboard)&&await this.scene.getPhaseManager().popPhase()}));return e.add(i),e}getPageOptPositions(){return Ka({numOfItems:Object.keys(jn).length,xSpacing:0,ySpacing:Sn.page.ySpace})}createPageOpt(e,t,a,s){return qs(this.scene,{assetKey:gs.awardsPage.key,message:e,textConfig:Sn.pageTextConfig,bitMapTextStyle:fn,onUp:s}).setPosition(t,a)}async activateUI(){this.uiContainer=this.createUIContainer(),this.scene.getLayerManager().addToLayer(ys.Dashboard,this.uiContainer),this.getSoundManager().playSound(xs.menuEnter.key),this.setPage(this.currPageIndex),this.uiContainer.setPosition(Va.x,-_a.y),this.pageMask.geometryMask.setPosition(Va.x,-_a.y),this.scene.tweens.add({targets:[this.uiContainer,this.pageMask.geometryMask],...Es,y:Va.y})}async deactivateUI(){this.uiContainer&&(this.pageUIContainers=new Array(this.pages.length),this.uiContainer.setPosition(this.uiContainer.x,this.uiContainer.y),this.getSoundManager().playSound(xs.menuExit.key),this.scene.tweens.add({targets:[this.uiContainer,this.pageMask.geometryMask],...Ns}),await Cs(Ns.duration),As(this.scene,this.uiContainer,{fadeDuration:50}))}};class In{constructor(e){this.currPart=void 0,this.currLineNum=void 0,this.dialogueContent=void 0,this.dialogueContent=e,this.currPart=e.keys().next().value,this.currLineNum=0}async generateNextLine(){const e=this.dialogueContent.get(this.currPart)[this.currLineNum];if(!e||!e.line)return{line:""};if(e.goto){let t=e.goto.part;if(await ln.checkAllConditionsSatisfied(e.goto.conditions)||(t=e.goto.altPart),t){if(!this.dialogueContent.get(t))return{line:""};this.currPart=t,this.currLineNum=0}else this.currLineNum++}else this.currLineNum++;return e}updateCurrPart(e){this.currPart=e,this.currLineNum=0}}let kn,Mn;!function(e){e.Left="Left",e.Middle="Middle",e.Right="Right"}(kn||(kn={})),function(e){e.Small="Small",e.Medium="Medium",e.Large="Large"}(Mn||(Mn={}));class An{static splitToParagraph(e){const t=[];return e.forEach((e=>{if(e.startsWith("\t")||e.startsWith("    ")){const a=e.startsWith("\t")?e.slice(1):e.slice(4);if(0===t.length)return void console.error("Unexpected tabs");t[t.length-1][1].push(a)}else t.push([e.trim(),[]])})),t}static mapByHeader(e,t){const a=new Map;if(!t(e[0]))return a.set("0",e),a;let s="";return e.forEach((e=>{if(t(e))return s=e,void a.set(e,[]);a.get(s).push(e)})),a}static splitWithLimit(e,t,a){if(a>=0){const s=e.split(t),n=s.slice(0,a);return n.push(s.slice(a).join(t)),n.map((e=>e.trim()))}return An.splitByChar(e,t)}static splitByChar(e,t){return e.split(t).map((e=>e.trim()))}static splitToLines(e){return e.split("\n").map((e=>e.trimRight())).filter((e=>""!==e))}static splitToLinesAndRemoveComments(e){return this.removeMultiLineComments(e.split("\n"),"/*","*/").map((e=>this.removeSingleLineComment(e,"//"))).map((e=>e.trimRight())).filter((e=>""!==e))}static removeSingleLineComment(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const s=e.indexOf(t);return-1===s?e:a?e.slice(0,s):e.slice(s+t.length)}static removeMultiLineComments(e,t,a){const s=[];let n=!1;for(let i=0;i<e.length;i++){const r=e[i],o=[],c=this.findAllInstances(r,t),l=this.findAllInstances(r,a);let d=-1,h=0,u=0,g=n?[0]:[];for(;h<c.length||u<l.length;){const e=d;d=n?l[u++]+a.length:c[h++],d<=e?(console.error(`Comment mismatch: Line ${i+1},  Pos ${d+1}`),d=e):(g.push(d),n=!n),2===g.length&&(o.push([g[0],g[1]]),g=[])}1===g.length&&o.push([g[0],r.length]),s.push(this.removeCommentRegions(r,o))}return s}static removeCommentRegions(e,t){let a="",s=0;return t.forEach((t=>{a+=e.slice(s,t[0]),s=t[1]})),a+=e.slice(s,e.length),a}static findAllInstances(e,t){const a=[];let s=e.indexOf(t);for(;-1!==s;)a.push(s),s=e.indexOf(t,s+1);return a}static capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}static toCapitalizedWords(e){return(e.match(/[A-Za-z][a-z]*/g)||[]).map(An.capitalize).join(" ")}static toIntString(e){return Math.floor(e).toString()}static isEmptyString(e){return e===Fa.nullInteractionId}}class Tn{constructor(){this.currentSpeakerId=void 0,this.getUsername=()=>Eo.getInstance().getAccountInfo().name}changeSpeakerTo(e){void 0!==e&&(this.currentSpeakerId&&sn.getInstance().clearSeveralLayers([ys.Speaker,ys.SpeakerBox]),this.showNewSpeaker(e))}showNewSpeaker(e){e&&(this.drawSpeakerSprite(e),this.drawSpeakerBox(e.speakerId))}drawSpeakerBox(e){if("narrator"===e)return;const t="you"===e?this.createSpeakerBox(this.getUsername(),kn.Right):this.createSpeakerBox(sn.getInstance().getCharacterById(e).name,kn.Left);sn.getInstance().addToLayer(ys.SpeakerBox,t)}drawSpeakerSprite(e){let{speakerId:t,speakerPosition:a,expression:s}=e;if(this.currentSpeakerId=t,"you"===t||"narrator"===t)return;const n=sn.getInstance().createCharacterSprite(t,s,a);sn.getInstance().addToLayer(ys.Speaker,n)}createSpeakerBox(e,t){const a=sn.getInstance().getGameManager(),s=new Phaser.GameObjects.Container(a,0,0),n=new Phaser.GameObjects.Image(a,Va.x,Va.y,gs.speakerBox.key).setAlpha(.8),i=Ja(a,"",Vs.speakerTextConfig,_s);return t===kn.Right&&(n.displayWidth*=-1,i.x=_a.x-i.x),s.add([n,i]),i.text=An.capitalize(e),s}}class Pn{constructor(){this.speakerRenderer=void 0,this.dialogueRenderer=void 0,this.dialogueGenerator=void 0,this.getDialogueGenerator=()=>this.dialogueGenerator,this.getDialogueRenderer=()=>this.dialogueRenderer,this.getSpeakerRenderer=()=>this.speakerRenderer,this.getUsername=()=>Eo.getInstance().getAccountInfo().name}async showDialogue(e){const t=sn.getInstance().getDialogueById(e);this.dialogueRenderer=new zs(Fs),this.dialogueGenerator=new In(t.content),this.speakerRenderer=new Tn,sn.getInstance().addToLayer(ys.Dialogue,this.dialogueRenderer.getDialogueContainer()),sn.getInstance().fadeInLayer(ys.Dialogue),await new Promise((e=>this.playWholeDialogue(e))),this.getDialogueRenderer().destroy(),this.getSpeakerRenderer().changeSpeakerTo(null)}async playWholeDialogue(e){await this.showNextLine(e),this.getDialogueRenderer().getDialogueBox().on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,(async()=>await this.showNextLine(e)))}async showNextLine(e){sn.getInstance().playSound(xs.dialogueAdvance.key);const{line:t,speakerDetail:a,actionIds:s,prompt:n}=await this.getDialogueGenerator().generateNextLine(),i=t.replace("{name}",this.getUsername());if(this.getDialogueRenderer().changeText(i),this.getSpeakerRenderer().changeSpeakerTo(a),sn.getInstance().storeDialogueLine(i,a),sn.getInstance().enableSprite(this.getDialogueRenderer().getDialogueBox(),!1),n){const e=await Qs(sn.getInstance().getGameManager(),n.promptTitle,n.choices.map((e=>e[0])));this.getDialogueGenerator().updateCurrPart(n.choices[e][1])}await sn.getInstance().processGameActionsInSamePhase(s),sn.getInstance().enableSprite(this.getDialogueRenderer().getDialogueBox(),!0),t||e()}}class En{constructor(){this.dialogueStorage=void 0,this.getUsername=()=>Eo.getInstance().getAccountInfo().name}storeLine(e,t){if(!t)return;this.dialogueStorage||(this.dialogueStorage=new Array);const a={speaker:this.getSpeakerName(t),line:e};this.dialogueStorage.push(a)}getSpeakerName(e){const t=null===e||void 0===e?void 0:e.speakerId;return t?"you"===t?this.getUsername():"narrator"===t?"Narrator":sn.getInstance().getCharacterById(t).name:""}clearDialogueStorage(){this.dialogueStorage=new Array}getDialogueStorage(){return this.dialogueStorage?this.dialogueStorage.map((e=>`${e.speaker}:\n${e.line}`)):new Array}}const Nn=320,On=50,Dn=Nn-20,Rn=On-20,Bn=Va.x-Nn/2,Ln=Va.y,Gn=Bn+10,Un=Ln+10;function Fn(e){let t,a,s;e.load.on("start",(()=>{s=e.add.existing(Ts(e)),t=e.add.graphics(),a=e.add.graphics(),a.fillStyle(2236962,.8),a.fillRect(Bn,Ln,Nn,On)})),e.load.on("progress",(e=>{t.clear(),t.fillStyle(16777215,1),t.fillRect(Gn,Un,Dn*e,Rn)})),e.load.on("complete",(function(){t.destroy(),a.destroy(),s.destroy()}))}class _n extends Phaser.GameObjects.Container{constructor(e,t,a,s){let{choices:n,defaultChoiceIdx:i=0,maxXSpace:r=_a.x,radioChoiceConfig:o={circleDim:20,checkedDim:10,outlineThickness:5},choiceTextConfig:c={x:0,y:0,oriX:.5,oriY:.5},bitmapTextStyle:l=Fa.defaultFontStyle}=t,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:xs.radioButtonClick.key;super(e,a,s),this.buttonClickSoundKey=void 0,this.activeChoice=void 0,this.activeChoiceIdx=void 0,this.choices=void 0,this.buttonPositions=void 0,this.radioChoiceConfig=void 0,this.choiceTextConfig=void 0,this.bitmapTextStyle=void 0,this.activeChoiceIdx=i,this.choices=n,this.choiceTextConfig=c,this.bitmapTextStyle=l,this.radioChoiceConfig=o,this.buttonClickSoundKey=d;const h=this.getRadioButtons(n);this.buttonPositions=Xa({numOfItems:h.length,maxXSpace:r}),this.renderRadioButtons(h,this.buttonPositions,this.radioChoiceConfig),this.activate(i)}getRadioButtons(e){return e.map(((e,t)=>({text:e,callback:()=>this.activate(t)})))}renderRadioButtons(e,t,a){this.add(e.map(((e,s)=>this.createRadioButton(t[s][0],t[s][1],e.callback,a))))}createRadioButton(e,t,a,s){return new Phaser.GameObjects.Ellipse(this.scene,e,t,s.circleDim,s.circleDim,za.lightBlue).setStrokeStyle(s.outlineThickness,za.darkBlue).setInteractive({useHandCursor:!0}).addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,(()=>{Eo.getInstance().getSoundManager().playSound(this.buttonClickSoundKey),a()}))}activate(e){this.activeChoiceIdx=e,this.activeChoice&&this.activeChoice.destroy(),this.activeChoice=new Phaser.GameObjects.Container(this.scene,this.buttonPositions[e][0],this.buttonPositions[e][1]);const t=Ja(this.scene,this.choices[e],this.choiceTextConfig,this.bitmapTextStyle),a=new Phaser.GameObjects.Ellipse(this.scene,0,0,this.radioChoiceConfig.checkedDim,this.radioChoiceConfig.checkedDim,za.darkBlue);this.activeChoice.add([t,a]),this.add(this.activeChoice)}getValueIdx(){return this.activeChoiceIdx}getChoices(){return this.choices}getChosenChoice(){return this.activeChoiceIdx<this.choices.length?this.choices[this.activeChoiceIdx]:Fa.nullInteractionId}}const Vn=_n,Hn={key:Ua.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},zn={key:Ua.zektonFont.key,size:35,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},$n={key:Ua.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Xn={optHeaderTextConfig:{x:.25*_a.x,y:0,oriX:.5,oriY:.75},opt:{x:140,xSpace:.4*_a.x,ySpace:.7*_a.y},radioButtonsTextConfig:{x:0,y:-50,oriX:.5,oriY:.25},volContainerOpts:["0","0.25","0.5","1.0","1.5","2.0"]},Wn={key:Ua.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Kn={key:Ua.zektonFont.key,size:20,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},qn={key:Ua.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Zn={button:{y:.15*_a.y},escapeOptTextConfig:{x:0,y:0,oriX:.37,oriY:.75},settings:{yOffset:.1*-Va.y,ySpace:.3*_a.y},settingsTextConfig:{x:.38*_a.x,y:.1*-Va.y,oriX:0,oriY:.5},radioButtons:{xSpace:.2*_a.x},radioChoiceTextConfig:{x:0,y:-45,oriX:.5,oriY:.25},volOpt:{x:.05*_a.x}};const Yn=class{constructor(e){this.bgmVolumeRadioButtons=void 0,this.sfxVolumeRadioButtons=void 0,this.scene=void 0,this.getSoundManager=()=>Eo.getInstance().getSoundManager(),this.getSettingsSaveManager=()=>Eo.getInstance().getSaveManager(),this.scene=e,this.scene.getPhaseManager().addPhaseToMap(en.EscapeMenu,this)}createUIContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0),t=new Phaser.GameObjects.Image(this.scene,Va.x,Va.y,gs.escapeMenuBackground.key).setDisplaySize(_a.x,_a.y).setInteractive({pixelPerfect:!0});e.add(t);const a=this.getSettings(),s=Xa({direction:$a.Column,numOfItems:a.length,maxYSpace:Zn.settings.ySpace});e.add(a.map(((e,t)=>Ja(this.scene,e,{...Zn.settingsTextConfig,y:s[t][1]+Zn.settingsTextConfig.y},qn))));const{bgmVolume:n,sfxVolume:i}=this.getSettingsSaveManager().getSettings(),r=Xn.volContainerOpts.findIndex((e=>parseFloat(e)===i)),o=Xn.volContainerOpts.findIndex((e=>parseFloat(e)===n));this.sfxVolumeRadioButtons=this.createSettingsRadioOptions(r,s[0][1]),this.bgmVolumeRadioButtons=this.createSettingsRadioOptions(o,s[1][1]),e.add([this.sfxVolumeRadioButtons,this.bgmVolumeRadioButtons]);const c=this.getOptButtons(),l=Xa({numOfItems:c.length});return e.add(c.map(((e,t)=>this.createEscapeOptButton(e.text,l[t][0],l[t][1]+Zn.button.y,e.callback)))),e}getSettings(){return["SFX","BGM"]}createSettingsRadioOptions(e,t){return new Vn(this.scene,{choices:Xn.volContainerOpts,defaultChoiceIdx:e,maxXSpace:Zn.radioButtons.xSpace,radioChoiceConfig:{circleDim:15,checkedDim:10,outlineThickness:3},choiceTextConfig:Zn.radioChoiceTextConfig,bitmapTextStyle:Kn},Zn.volOpt.x,-Va.y+t+Zn.settings.yOffset)}getOptButtons(){return[{text:"Main Menu",callback:()=>{this.cleanUp(),Eo.getInstance().isGameType(Po.Simulator)?this.scene.scene.start("StorySimulatorMenu"):this.scene.scene.start("MainMenu")}},{text:"Continue",callback:async()=>{this.scene.getPhaseManager().isCurrentPhase(en.EscapeMenu)&&await this.scene.getPhaseManager().popPhase()}},{text:"Apply Settings",callback:()=>this.applySettings()}]}createEscapeOptButton(e,t,a,s){return qs(this.scene,{assetKey:gs.mediumButton.key,message:e,textConfig:Zn.escapeOptTextConfig,bitMapTextStyle:Wn,onUp:s}).setPosition(t,a)}async applySettings(){const e=this.sfxVolumeRadioButtons?parseFloat(this.sfxVolumeRadioButtons.getChosenChoice()):1,t={bgmVolume:this.bgmVolumeRadioButtons?parseFloat(this.bgmVolumeRadioButtons.getChosenChoice()):1,sfxVolume:e};await this.getSettingsSaveManager().saveSettings(t),Eo.getInstance().getSoundManager().applyUserSettings(t)}cleanUp(){this.scene.getInputManager().clearListeners(),this.scene.getLayerManager().clearAllLayers()}activateUI(){const e=this.createUIContainer();this.getSoundManager().playSound(xs.menuEnter.key),this.scene.getLayerManager().addToLayer(ys.Escape,e)}deactivateUI(){this.getSoundManager().playSound(xs.menuExit.key),this.scene.getLayerManager().clearSeveralLayers([ys.Escape])}};const Jn=class{constructor(e){this.scene=void 0,this.keyboardListeners=void 0,this.eventListeners=void 0,this.keyboardListeners=[],this.eventListeners=[],this.scene=e}setDefaultCursor(e){this.scene.input.setDefaultCursor(e)}enableMouseInput(e){this.scene.input.mouse.enabled=e}enableKeyboardInput(e){this.scene.input.keyboard.enabled=e}registerKeyboardListener(e,t,a){const s=this.scene.input.keyboard.addKey(e).addListener(t,a);this.keyboardListeners.push(s)}registerEventListener(e,t){const a=this.scene.input.addListener(e,t);this.eventListeners.concat(a)}clearListeners(){this.keyboardListeners.forEach((e=>e.removeAllListeners())),this.eventListeners.forEach((e=>e.removeAllListeners()))}};const Qn=class{constructor(e){this.layers=void 0,this.layers=new Map(vs.map((t=>[t,new Phaser.GameObjects.Container(e,0,0)]))),this.layers.forEach((t=>e.add.existing(t)))}getLayer(e){return this.layers.get(e)}hideLayer(e){const t=this.layers.get(e);t&&t.setVisible(!1)&&t.setAlpha(0)}showLayer(e){const t=this.layers.get(e);t&&t.setVisible(!0)&&t.setAlpha(1)}async fadeInLayer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Fa.fadeDuration;const a=sn.getInstance().getGameManager(),s=this.layers.get(e);s.setVisible(!0),s.setAlpha(0),a.tweens.add(Ms([s],t)),await Cs(t)}async fadeOutLayer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Fa.fadeDuration;const a=sn.getInstance().getGameManager(),s=this.layers.get(e);s.setVisible(!0),s.setAlpha(1),a.tweens.add(ks([s],t)),await Cs(t)}addToLayer(e,t){const a=this.layers.get(e);a&&a.add(t)}clearSeveralLayers(e){e.forEach((e=>this.clearLayerContents(e)))}clearAllLayers(){this.layers.forEach(((e,t)=>this.clearLayerContents(t)))}clearLayerContents(e){const t=this.layers.get(e);if(t)for(;t.list.length;)t.list[0].destroy()}},ei={key:Ua.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},ti=.251*_a.x,ai={logTextConfig:{x:-.44*_a.x,y:-.378*_a.y,oriX:0,oriY:0},textMaxWidth:.68*_a.x,logHeight:.7632*_a.y,scrollbarTrack:{x:ti,y:.005*_a.y,width:7,height:.73*_a.y,color:5592405},scrollbarThumb:{x:ti,width:7,color:8947848},scrollSpeed:.5};const si=class{constructor(e){this.scene=void 0,this.scene=e}createUIContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0),t=sn.getInstance().getDialogueStorage();if(0===t.length)return e;const a=Ja(this.scene,t.join("\n\n"),ai.logTextConfig,ei).setMaxWidth(ai.textMaxWidth),s=ai.logTextConfig.y-Math.max(a.height-ai.logHeight,0);a.y=s,e.add(a);const n=new Phaser.GameObjects.Rectangle(this.scene,ai.scrollbarTrack.x,ai.scrollbarTrack.y,ai.scrollbarTrack.width,ai.scrollbarTrack.height,ai.scrollbarTrack.color),i=Math.max(ai.logHeight/a.height*ai.scrollbarTrack.height,4*ai.scrollbarThumb.width),r=ai.scrollbarTrack.y+ai.scrollbarTrack.height/2-i/2,o=(ai.scrollbarTrack.height-i)/(ai.logTextConfig.y-s),c=new Phaser.GameObjects.Rectangle(this.scene,ai.scrollbarThumb.x,r,ai.scrollbarThumb.width,i,ai.scrollbarThumb.color);e.add(n),e.add(c),a.height<=ai.logHeight&&(n.setVisible(!1),c.setVisible(!1));const{x:l,y:d,width:h,height:u}=Sn.pageArea,g=new Phaser.GameObjects.Zone(this.scene,l+h/2,d+u/2,h,u);return g.setInteractive(),g.on("wheel",((e,t,n,i)=>{a.y=fs(a.y-n*ai.scrollSpeed,s,ai.logTextConfig.y),c.y=r-(a.y-s)*o})),e.add(g),e}};class ni{constructor(e,t,a,s,n,i){this.scene=void 0,this.container=void 0,this.imageGlow=void 0,this.clickArea=void 0,this.glowClearer=void 0,this.blinkClearer=void 0,this.scene=e,this.container=new Phaser.GameObjects.Container(e,t,a),this.imageGlow=new Phaser.GameObjects.Image(e,0,0,s).setAlpha(0).setBlendMode(Phaser.BlendModes.ADD),this.clickArea=new Phaser.GameObjects.Image(e,0,0,s).setAlpha(.01).setInteractive({pixelPerfect:!0});const r=sn.getInstance().getGameMap().getMapAssets().get(s),o=sn.getInstance().getGameManager().getAnimationManager();if(r){const e=o.createImage(r,s);switch(null===r||void 0===r?void 0:r.type){case hs.Sprite:this.clickArea.setAlpha(0),o.startAnimation(r);break;case hs.Image:n&&(gn(e,n,i),gn(this.imageGlow,n,i),gn(this.clickArea,n,i))}this.container.add([e,this.imageGlow,this.clickArea])}}startGlow(){this.glowClearer&&this.glowClearer(),this.glowClearer=Ps(this.scene,this.imageGlow),this.imageGlow.setAlpha(1)}clearGlow(){this.glowClearer&&this.glowClearer(),this.imageGlow.setAlpha(0)}startBlink(){this.blinkClearer=Ps(this.scene,this.getContainer())}clearBlink(){this.getContainer().setAlpha(1),this.blinkClearer&&this.blinkClearer()}getContainer(){return this.container}getClickArea(){return this.clickArea}}const ii=class{constructor(){this.objects=void 0,this.objects=new Map,sn.getInstance().watchGameItemType(cn.objects,this)}renderObjectsLayerContainer(e){sn.getInstance().clearSeveralLayers([ys.Objects]);const t=sn.getInstance().getGameItemsInLocation(cn.objects,e);this.objects.clear(),t.map((e=>this.handleAdd(e)))}makeObjectGlow(e,t){const a=this.objects.get(e);a&&(t?a.sprite.startGlow():a.sprite.clearGlow())}makeObjectBlink(e,t){const a=this.objects.get(e);a&&(t?a.sprite.startBlink():a.sprite.clearBlink())}createObject(e){const t=sn.getInstance().getGameManager(),{assetKey:a,x:s,y:n,width:i,height:r,actionIds:o,interactionId:c}=e,l=new ni(t,s,n,a,i,r);return{sprite:l,clickArea:l.getClickArea(),actionIds:o,interactionId:c}}handleAdd(e){const t=sn.getInstance().getObjectById(e),a=this.createObject(t);return sn.getInstance().addToLayer(ys.Objects,a.sprite.getContainer()),this.objects.set(e,a),!0}handleMutate(e){return this.handleDelete(e)&&this.handleAdd(e)}handleDelete(e){const t=this.objects.get(e);return!!t&&(this.objects.delete(e),t.sprite.getContainer().destroy(),!0)}getActivatables(){return Array.from(this.objects.values())}};class ri{constructor(e,t){this.phaseMap=void 0,this.phaseStack=void 0,this.inputManager=void 0,this.interruptCheckCallback=void 0,this.interruptTransitionCallback=void 0,this.transitionCallback=void 0,this.phaseStack=[en.None],this.phaseMap=e,this.interruptCheckCallback=()=>!1,this.interruptTransitionCallback=async()=>Fa.nullFunction(),this.transitionCallback=Fa.nullFunction,this.inputManager=t}addPhaseToMap(e,t){this.phaseMap.set(e,t)}setInterruptCheckCallback(e){this.interruptCheckCallback=e}setInterruptCallback(e){this.interruptTransitionCallback=e}setCallback(e){this.transitionCallback=e}async popPhase(){const e=this.phaseStack.pop();await this.executePhaseTransition(e,this.getCurrentPhase())}async pushPhase(e){const t=this.getCurrentPhase();e!==t&&(this.phaseStack.push(e),await this.executePhaseTransition(t,e))}async swapPhase(e){const t=this.getCurrentPhase();e!==t&&(this.phaseStack.pop(),this.phaseStack.push(e),await this.executePhaseTransition(t,e))}async executePhaseTransition(e,t){if(this.inputManager.enableKeyboardInput(!1),this.inputManager.enableMouseInput(!1),await this.phaseMap.get(e).deactivateUI(),this.interruptCheckCallback(e,t))return this.inputManager.enableMouseInput(!0),this.inputManager.enableKeyboardInput(!0),void await this.interruptTransitionCallback(e,t);this.transitionCallback(e,t),await this.phaseMap.get(t).activateUI(),this.inputManager.enableMouseInput(!0),this.inputManager.enableKeyboardInput(!0)}isCurrentPhase(e){return this.getCurrentPhase()===e}isCurrentPhaseTerminal(){return Object.values(tn).includes(this.getCurrentPhase())}getCurrentPhase(){return this.phaseStack.length||(this.phaseStack=[en.None]),this.phaseStack[this.phaseStack.length-1]}}const oi={image:{xOffset:20,yOffset:20},rect:{x:{Left:400,Middle:Va.x,Right:_a.x-400},y:{Small:325,Medium:350,Large:420},scale:{Small:.7,Medium:1,Large:1.5},width:280,height:280},tweenDuration:300};const ci=class{constructor(){this.currPopUp=void 0,this.currPopUp=new Map}async displayPopUp(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Fa.popUpDuration,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Mn.Medium;this.destroyPopUp(t);const n=sn.getInstance().getGameManager(),i=new Phaser.GameObjects.Container(n,0,0),r=new Phaser.GameObjects.Image(n,oi.rect.x[t],oi.rect.y[s],gs.popUpFrame.key).setScale(oi.rect.scale[s]),o=this.getAssetKey(e);if(!o)return;const c=new Phaser.GameObjects.Image(n,oi.rect.x[t]+oi.image.xOffset,oi.rect.y[s]+oi.image.yOffset,o);mn(c,oi.rect.width*oi.rect.scale[s],oi.rect.height*oi.rect.scale[s]),i.add([r,c]),this.currPopUp.set(t,i),sn.getInstance().addToLayer(ys.PopUp,i),sn.getInstance().playSound(xs.popUpEnter.key),i.setActive(!0),i.setVisible(!0),i.setScale(1,0),n.tweens.add(function(e){return{scaleY:1,targets:e,duration:arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,ease:"Power1"}}([i],oi.tweenDuration)),await Cs(oi.tweenDuration),setTimeout((()=>this.destroyPopUp(t)),a)}destroyAllPopUps(){this.currPopUp.forEach(((e,t,a)=>{this.destroyPopUp(t)}))}async destroyPopUp(e){const t=this.currPopUp.get(e);t&&(sn.getInstance().getGameManager().tweens.add(function(e){return{scaleY:0,targets:e,duration:arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,ease:"Power1"}}([t],oi.tweenDuration)),await Cs(oi.tweenDuration),t.setVisible(!1),t.setActive(!1),t.destroy(),this.currPopUp.delete(e),sn.getInstance().playSound(xs.popUpExit.key))}getAssetKey(e){const t=sn.getInstance().getGameMap().getObjectPropMap().get(e);if(t)return t.assetKey}};const li=()=>({gameSaveStates:{},userSaveState:{collectibles:[],settings:{bgmVolume:1,sfxVolume:1},recentlyPlayedCheckpoint:[-1,-1],largestCompletedChapter:-1}}),di=()=>({lastCheckpointPlayed:0,currentLocation:void 0,currentPhase:en.Menu,chapterNewlyCompleted:!1,incompleteTasks:[],completedTasks:[],completedObjectives:[],triggeredInteractions:[],triggeredStateChangeActions:[]});function hi(e){return Array.from(e).filter((e=>{let[t,a]=e;return a})).map((e=>{let[t]=e;return t}))}const ui=class{constructor(e){this.subscribers=void 0,this.gameMap=void 0,this.checkpointObjective=void 0,this.checkpointTask=void 0,this.chapterNewlyCompleted=void 0,this.updatedLocations=void 0,this.triggeredInteractions=void 0,this.triggeredStateChangeActions=void 0,this.getGameMap=()=>this.gameMap,this.getCharacterAtId=e=>js(this.gameMap.getCharacterMap().get(e)),this.getSaveManager=()=>Eo.getInstance().getSaveManager(),this.getChapterNewlyCompleted=()=>this.chapterNewlyCompleted,this.subscribers=new Map,this.gameMap=e.map,this.checkpointObjective=e.objectives,this.checkpointTask=e.tasks,this.chapterNewlyCompleted=!1,this.updatedLocations=new Set(this.gameMap.getLocationIds()),this.triggeredInteractions=new Map,this.triggeredStateChangeActions=[],this.loadStatesFromSaveManager()}loadStatesFromSaveManager(){this.triggeredStateChangeActions=this.getSaveManager().getTriggeredStateChangeActions(),this.getSaveManager().getTriggeredInteractions().forEach((e=>this.triggerInteraction(e))),this.getSaveManager().getCompletedObjectives().forEach((e=>this.checkpointObjective.setObjective(e,!0))),this.getSaveManager().getCompletedTasks().forEach((e=>{this.checkpointTask.setTask(e,!0),this.checkpointTask.showTask(e)})),this.getSaveManager().getIncompleteTasks().forEach((e=>{this.checkpointTask.setTask(e,!1),this.checkpointTask.showTask(e)})),this.chapterNewlyCompleted=this.getSaveManager().getChapterNewlyCompleted()}watchGameItemType(e,t){this.subscribers.set(e,t)}getSubscriberForItemType(e){return this.subscribers.get(e)}triggerInteraction(e){this.triggeredInteractions.set(e,!0)}triggerStateChangeAction(e){this.triggeredStateChangeActions.push(e)}hasTriggeredInteraction(e){return this.triggeredInteractions.get(e)}addLocationNotif(e){this.updatedLocations.add(e)}removeLocationNotif(e){this.updatedLocations.delete(e)}hasLocationNotif(e){return this.updatedLocations.has(e)}isCurrentLocation(e){return e===sn.getInstance().getCurrLocId()}getLocationModes(e){return Array.from(this.gameMap.getLocationAtId(e).modes)||[]}addLocationMode(e,t){this.gameMap.getLocationAtId(e).modes.add(t),!this.isCurrentLocation(e)&&this.addLocationNotif(e)}removeLocationMode(e,t){this.gameMap.getLocationAtId(e).modes.delete(t),!this.isCurrentLocation(e)&&this.addLocationNotif(e)}getGameItemsInLocation(e,t){return Array.from(this.gameMap.getLocationAtId(t)[e])||[]}addItem(e,t,a){var s,n;null===(s=this.gameMap.getLocationAtId(t)[e])||void 0===s||s.add(a),this.isCurrentLocation(t)?null===(n=this.getSubscriberForItemType(e))||void 0===n||n.handleAdd(a):this.addLocationNotif(t)}removeItem(e,t,a){var s,n;null===(s=this.gameMap.getLocationAtId(t)[e])||void 0===s||s.delete(a),this.isCurrentLocation(t)?null===(n=this.getSubscriberForItemType(e))||void 0===n||n.handleDelete(a):this.addLocationNotif(t)}setObjProperty(e,t){this.gameMap.setItemInMap(cn.objects,e,t),this.gameMap.getLocations().forEach(((t,a)=>{var s;t.objects.has(e)&&(this.isCurrentLocation(a)?null===(s=this.getSubscriberForItemType(cn.objects))||void 0===s||s.handleMutate(e):this.addLocationNotif(a))}))}setBBoxProperty(e,t){this.gameMap.setItemInMap(cn.boundingBoxes,e,t),this.gameMap.getLocations().forEach(((t,a)=>{var s;t.boundingBoxes.has(e)&&(this.isCurrentLocation(a)?null===(s=this.getSubscriberForItemType(cn.boundingBoxes))||void 0===s||s.handleMutate(e):this.addLocationNotif(a))}))}moveCharacter(e,t,a){this.getCharacterAtId(e).defaultPosition=a,this.gameMap.getLocations().forEach(((t,a)=>{t.characters.has(e)&&this.removeItem(cn.characters,a,e)})),this.addItem(cn.characters,t,e)}updateCharacter(e,t){this.getCharacterAtId(e).defaultExpression=t,this.gameMap.getLocations().forEach(((t,a)=>{var s;t.characters.has(e)&&(this.isCurrentLocation(a)?null===(s=this.getSubscriberForItemType(cn.characters))||void 0===s||s.handleMutate(e):this.addLocationNotif(a))}))}areAllObjectivesComplete(){return this.checkpointObjective.isAllComplete()}isObjectiveComplete(e){return this.checkpointObjective.getObjectiveState(e)}areObjectivesComplete(e){let t=!0;return e.forEach((e=>t=t&&this.isObjectiveComplete(e))),t}completeObjective(e){this.checkpointObjective.setObjective(e,!0)}isTaskComplete(e){return this.checkpointTask.getTaskState(e)}areTasksComplete(e){let t=!0;return e.forEach((e=>t=t&&this.isTaskComplete(e))),t}completeTask(e){this.checkpointTask.setTask(e,!0)}showTask(e){this.checkpointTask.showTask(e)}getAllVisibleTaskData(){return this.checkpointTask.getAllVisibleTaskData()}getCompletedObjectives(){return hi(this.checkpointObjective.getObjectives())}getCompletedTasks(){return hi(this.checkpointTask.getAllTasks())}getIncompleteTasks(){return this.checkpointTask.getAllIncompleteTasks()}getTriggeredInteractions(){return hi(this.triggeredInteractions)}getTriggeredStateChangeActions(){return this.triggeredStateChangeActions}},gi={key:Ua.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},pi=.251*_a.x,mi={taskTextConfig:{x:-.42*_a.x,y:-.378*_a.y,oriX:0,oriY:0},textMaxWidth:.66*_a.x,checkMark:{x:-.202*_a.x,y:-.369*_a.y,imageUrl:gs.talkOptCheck.key},logHeight:.7632*_a.y,scrollbarTrack:{x:pi,y:.005*_a.y,width:7,height:.73*_a.y,color:5592405},scrollbarThumb:{x:pi,width:7,color:8947848},scrollSpeed:.5};const xi=class{constructor(e){this.scene=void 0,this.scene=e}createUIContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0),t=sn.getInstance().getAllVisibleTaskData(),a=new Phaser.GameObjects.Container(this.scene,0,0);let s=0;if(0===t.length){const e=Ja(this.scene,"No tasks available.",mi.taskTextConfig,gi).setMaxWidth(mi.textMaxWidth);a.add(e),s=e.height}else for(let m=0;m<t.length;m++){const e=t[m][0];if(t[m][1]){const e=new Phaser.GameObjects.Image(this.scene,mi.checkMark.x,mi.checkMark.y+s,mi.checkMark.imageUrl);a.add(e)}const n=Ja(this.scene,e.title,{...mi.taskTextConfig,y:mi.taskTextConfig.y+s},gi).setMaxWidth(mi.textMaxWidth),i=Ja(this.scene,"_",{...mi.taskTextConfig,y:mi.taskTextConfig.y+s},gi);i.setScale(n.width/i.width,1),a.add(n),a.add(i),s+=n.height;const r=Ja(this.scene,e.description+(m<t.length-1?"\n ":""),{...mi.taskTextConfig,y:mi.taskTextConfig.y+s},gi).setMaxWidth(mi.textMaxWidth);a.add(r),s+=r.height}const n=-Math.max(s-mi.logHeight,0);a.y=n,e.add(a);const i=new Phaser.GameObjects.Rectangle(this.scene,mi.scrollbarTrack.x,mi.scrollbarTrack.y,mi.scrollbarTrack.width,mi.scrollbarTrack.height,mi.scrollbarTrack.color),r=Math.max(mi.logHeight/s*mi.scrollbarTrack.height,4*mi.scrollbarThumb.width),o=mi.scrollbarTrack.y+mi.scrollbarTrack.height/2-r/2,c=(mi.scrollbarTrack.height-r)/-n,l=new Phaser.GameObjects.Rectangle(this.scene,mi.scrollbarThumb.x,o,mi.scrollbarThumb.width,r,mi.scrollbarThumb.color);e.add(i),e.add(l),s<=mi.logHeight&&(i.setVisible(!1),l.setVisible(!1));const{x:d,y:h,width:u,height:g}=Sn.pageArea,p=new Phaser.GameObjects.Zone(this.scene,d+u/2,h+g/2,u,g);return p.setInteractive(),p.on("wheel",((e,t,s,i)=>{a.y=fs(a.y-s*mi.scrollSpeed,n,0),l.y=o-(a.y-n)*c})),e.add(p),e}},yi=[{assetKey:gs.gear.key,onUp:e=>async()=>{const t=e.getPhaseManager();t.isCurrentPhase(en.EscapeMenu)?await t.popPhase():t.isCurrentPhaseTerminal()?await t.swapPhase(en.EscapeMenu):await t.pushPhase(en.EscapeMenu)}},{assetKey:gs.journal.key,onUp:e=>async()=>{const t=e.getPhaseManager();t.isCurrentPhase(en.Dashboard)?await t.popPhase():t.isCurrentPhaseTerminal()?await t.swapPhase(en.Dashboard):await t.pushPhase(en.Dashboard)}}],vi={firstButton:{x:_a.x-37,y:37},xOffset:64,buttonConfigs:yi};const bi=class{constructor(e){this.uiContainer=void 0,this.scene=void 0,this.scene=e}createUIContainer(){const e=new Phaser.GameObjects.Container(this.scene,0,0);return e.add(vi.buttonConfigs.map(((e,t)=>this.createToolbarButton(vi.firstButton.x-vi.xOffset*t,vi.firstButton.y,e)))),e}createToolbarButton(e,t,a){return qs(this.scene,{assetKey:a.assetKey,onUp:a.onUp(this.scene)}).setPosition(e,t)}async renderToolbarContainer(){this.uiContainer=this.createUIContainer(),this.scene.getLayerManager().addToLayer(ys.UI,this.uiContainer)}},Ci=.975*-Va.y,fi={key:Ua.zektonDarkFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};class Si extends Phaser.GameObjects.Container{constructor(e,t){super(e,0,0),this.renderBackButton(t)}renderBackButton(e){const t=qs(this.scene,{assetKey:gs.topButton.key,message:"Back",textConfig:{x:0,y:Ci,oriX:.5,oriY:.25},bitMapTextStyle:fi,onUp:e}).setPosition(Va.x,Va.y);this.add(t)}}const ji=Si,wi={normal:`url(${Ss("/ui/magnifying.png",!1)}), pointer`,hover:`url(${Ss("/ui/magnifying_trigg.png",!1)}), pointer`,checked:`url(${Ss("/ui/magnifying_check.png",!1)}), pointer`};const Ii=class{constructor(){this.uiContainer=void 0}createUIContainer(){const e=sn.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),a=new ji(e,(async()=>await sn.getInstance().swapPhase(en.Menu)));return t.add(a),t}async activateUI(){const e=sn.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),sn.getInstance().addToLayer(ys.UI,this.uiContainer),this.uiContainer.setPosition(this.uiContainer.x,-_a.y),this.enableInteractions(),e.tweens.add({targets:this.uiContainer,...Es}),sn.getInstance().setDefaultCursor(wi.normal),sn.getInstance().playSound(xs.modeEnter.key)}async deactivateUI(){const e=sn.getInstance().getGameManager();sn.getInstance().setDefaultCursor(Fa.defaultCursor),this.disableInteractions(),this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...Ns}),await Cs(500),As(e,this.uiContainer))}enableInteractions(){sn.getInstance().getAllActivatables().forEach((e=>{e.actionIds&&e.actionIds.length&&(e.clickArea.on("pointerout",(()=>this.explorePointerOut())),e.clickArea.on("pointerover",(()=>this.explorePointerOver(e.interactionId))),e.clickArea.on("pointerup",(async()=>{this.explorePointerUp(e.interactionId),await sn.getInstance().processGameActions(e.actionIds)})))}))}disableInteractions(){sn.getInstance().getAllActivatables().forEach((e=>{e.clickArea.off("pointerout"),e.clickArea.off("pointerover"),e.clickArea.off("pointerup")}))}explorePointerOver(e){sn.getInstance().hasTriggeredInteraction(e)?sn.getInstance().setDefaultCursor(wi.checked):sn.getInstance().setDefaultCursor(wi.hover)}explorePointerOut(){sn.getInstance().setDefaultCursor(wi.normal)}explorePointerUp(e){sn.getInstance().setDefaultCursor(Fa.defaultCursor),sn.getInstance().triggerInteraction(e),sn.getInstance().setDefaultCursor(wi.normal)}};let ki;!function(e){e.Move="Move",e.Explore="Explore",e.Talk="Talk",e.Menu="Menu"}(ki||(ki={}));const Mi={Move:en.Move,Explore:en.Explore,Talk:en.Talk,Menu:en.Menu},Ai={key:Ua.zektonFont.key,size:45,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Ti={button:{yOffset:.3*_a.y},entryTweenProps:{y:0,duration:500,ease:"Power2"},exitTweenProps:{y:.4*_a.y,duration:300,ease:"Power2"}};const Pi=class{constructor(){this.uiContainer=void 0}getLatestLocationModes(){const e=sn.getInstance().getCurrLocId();let t=sn.getInstance().getLocationModes(e);return 0===sn.getInstance().getGameItemsInLocation(cn.talkTopics,e).length&&(t=t.filter((e=>e!==ki.Talk))),t}createUIContainer(){const e=sn.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),a=new Phaser.GameObjects.Image(e,Va.x,Va.y,gs.modeMenuBanner.key);t.add(a);const s=this.getLatestLocationModes(),n=this.getModeButtons(s),i=Xa({numOfItems:n.length});return t.add(n.map(((e,t)=>this.createModeButton(e.text,i[t][0],i[t][1]+Ti.button.yOffset,e.callback)))),t}getModeButtons(e){return e.sort().map((e=>({text:e,callback:async()=>await sn.getInstance().swapPhase(Mi[e])})))}createModeButton(e,t,a,s){return qs(sn.getInstance().getGameManager(),{assetKey:gs.shortButton.key,message:e,textConfig:{x:0,y:0,oriX:.5,oriY:.25},bitMapTextStyle:Ai,onUp:s}).setPosition(t,a)}async activateUI(){const e=sn.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),sn.getInstance().addToLayer(ys.UI,this.uiContainer),this.uiContainer.setPosition(this.uiContainer.x,_a.y),e.tweens.add({targets:this.uiContainer,...Ti.entryTweenProps}),await Cs(500),sn.getInstance().playSound(xs.modeEnter.key)}async deactivateUI(){const e=sn.getInstance().getGameManager();this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...Ti.exitTweenProps}),await Cs(500),As(e,this.uiContainer))}},Ei={key:Ua.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Ni={button:{xOffSet:.25*_a.x,ySpace:.8*_a.y},preview:{rect:{x:.3125*_a.x,y:.515*_a.y,width:.473*_a.x,height:.56*_a.y},frame:{x:.3*_a.x}}};const Oi=class{constructor(){this.uiContainer=void 0}setPreview(e,t){e.setTexture(t).setDisplaySize(Ni.preview.rect.width,Ni.preview.rect.height).setPosition(Ni.preview.rect.x,Ni.preview.rect.y)}getLatestNavigations(){return sn.getInstance().getGameItemsInLocation(cn.navigation,sn.getInstance().getCurrLocId())}createUIContainer(){const e=sn.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),a=new Phaser.GameObjects.Sprite(e,Ni.preview.frame.x,Va.y,gs.locationPreviewFrame.key),s=new Phaser.GameObjects.Sprite(e,Va.x,Va.y,gs.locationPreviewFill.key);t.add([a,s]);const n=this.getLatestNavigations(),i=this.getMoveButtons(n,s),r=Xa({numOfItems:i.length,numItemLimit:1,maxYSpace:Ni.button.ySpace});t.add(i.map(((e,t)=>this.createMoveButton(e.text,r[t][0]+Ni.button.xOffSet,r[t][1],e.callback,e.onHover,e.onOut))));const o=new ji(e,(async()=>await sn.getInstance().swapPhase(en.Menu)));return t.add(o),this.setPreview(s,gs.defaultLocationImg.key),t}getMoveButtons(e,t){const a=e=>this.setPreview(t,e),s=()=>this.setPreview(t,gs.defaultLocationImg.key);return e.map((e=>{const t=sn.getInstance().getLocationAtId(e);return{text:t.name,callback:async()=>{await sn.getInstance().swapPhase(en.Sequence),await sn.getInstance().changeLocationTo(e)},onHover:()=>a(t.previewKey||t.assetKey),onOut:()=>s()}}))}createMoveButton(e,t,a,s,n,i){return qs(sn.getInstance().getGameManager(),{assetKey:gs.longButton.key,message:e,textConfig:{x:0,y:0,oriX:.4,oriY:.15},bitMapTextStyle:Ei,onUp:s,onHover:n,onOut:i}).setPosition(t,a)}async activateUI(){const e=sn.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),sn.getInstance().addToLayer(ys.UI,this.uiContainer),this.uiContainer.setPosition(this.uiContainer.x,-_a.y),e.tweens.add({targets:this.uiContainer,...Es}),sn.getInstance().playSound(xs.modeEnter.key)}async deactivateUI(){const e=sn.getInstance().getGameManager();this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...Ns}),await Cs(500),As(e,this.uiContainer))}};const Di=class{activateUI(){}deactivateUI(){}},Ri={key:Ua.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},Bi={button:{ySpace:.7*_a.y}};const Li=class{constructor(){this.uiContainer=void 0}getLatestTalkTopics(){return sn.getInstance().getGameItemsInLocation(cn.talkTopics,sn.getInstance().getCurrLocId())}createUIContainer(){const e=sn.getInstance().getGameManager(),t=new Phaser.GameObjects.Container(e,0,0),a=this.getLatestTalkTopics(),s=this.getTalkTopicButtons(a),n=Xa({direction:$a.Column,numOfItems:s.length,maxYSpace:Bi.button.ySpace});t.add(s.map(((e,t)=>this.createTalkTopicButton(e.text,n[t][0],n[t][1],e.callback)))),s.forEach(((a,s)=>{const i=new Phaser.GameObjects.Sprite(e,n[s][0],n[s][1],gs.talkOptCheck.key);!!a.interactionId&&sn.getInstance().hasTriggeredInteraction(a.interactionId)&&t.add(i)}));const i=new ji(e,(async()=>await sn.getInstance().swapPhase(en.Menu)));return t.add(i),t}getTalkTopicButtons(e){return e.map((e=>({text:js(sn.getInstance().getDialogueById(e)).title,callback:async()=>{sn.getInstance().triggerInteraction(e),await sn.getInstance().showDialogue(e)},interactionId:e})))}createTalkTopicButton(e,t,a,s){return qs(sn.getInstance().getGameManager(),{assetKey:gs.talkOptButton.key,message:e,textConfig:{x:0,y:0,oriX:.5,oriY:.2},bitMapTextStyle:Ri,onUp:s}).setPosition(t,a)}async activateUI(){const e=sn.getInstance().getGameManager();this.uiContainer=this.createUIContainer(),sn.getInstance().addToLayer(ys.UI,this.uiContainer),this.uiContainer.setPosition(this.uiContainer.x,-_a.y),e.tweens.add({targets:this.uiContainer,...Es}),sn.getInstance().playSound(xs.modeEnter.key)}async deactivateUI(){const e=sn.getInstance().getGameManager();this.uiContainer&&(this.uiContainer.setPosition(this.uiContainer.x,0),e.tweens.add({targets:this.uiContainer,...Ns}),await Cs(500),As(e,this.uiContainer))}};class Gi extends Phaser.Scene{constructor(){super("GameManager"),this.currentLocationId=void 0,this.hasTransitioned=void 0,this.stateManager=void 0,this.layerManager=void 0,this.objectManager=void 0,this.characterManager=void 0,this.dialogueManager=void 0,this.actionManager=void 0,this.boundingBoxManager=void 0,this.popUpManager=void 0,this.phaseManager=void 0,this.backgroundManager=void 0,this.animationManager=void 0,this.inputManager=void 0,this.escapeManager=void 0,this.collectibleManager=void 0,this.achievementManager=void 0,this.logManager=void 0,this.dialogueStorageManager=void 0,this.toolbarManager=void 0,this.taskLogManager=void 0,this.dashboardManager=void 0,this.getSaveManager=()=>Eo.getInstance().getSaveManager(),this.getStateManager=()=>js(this.stateManager),this.getObjectManager=()=>js(this.objectManager),this.getDialogueManager=()=>js(this.dialogueManager),this.getCharacterManager=()=>js(this.characterManager),this.getBBoxManager=()=>js(this.boundingBoxManager),this.getActionManager=()=>js(this.actionManager),this.getInputManager=()=>js(this.inputManager),this.getLayerManager=()=>js(this.layerManager),this.getPhaseManager=()=>js(this.phaseManager),this.getBackgroundManager=()=>js(this.backgroundManager),this.getAnimationManager=()=>js(this.animationManager),this.getPopupManager=()=>js(this.popUpManager),this.getEscapeManager=()=>js(this.escapeManager),this.getCollectibleManager=()=>js(this.collectibleManager),this.getAchievementManager=()=>js(this.achievementManager),this.getLogManager=()=>js(this.logManager),this.getDialogueStorageManager=()=>js(this.dialogueStorageManager),this.getToolbarManager=()=>js(this.toolbarManager),this.getTaskLogManager=()=>js(this.taskLogManager),this.getDashboardManager=()=>js(this.dashboardManager),this.currentLocationId=Fa.nullInteractionId,this.hasTransitioned=!1}init(e){let{gameCheckpoint:t,continueGame:a,chapterNum:s,checkpointNum:n}=e;sn.getInstance().setGameManager(this),Eo.getInstance().setCurrentSceneRef(this),this.getSaveManager().registerGameInfo(s,n,a),this.currentLocationId=this.getSaveManager().getLoadedLocation()||t.startingLoc,this.hasTransitioned=!1,this.stateManager=new ui(t),this.layerManager=new Qn(this),this.inputManager=new Jn(this),this.phaseManager=new ri(new Map([[en.Menu,new Pi],[en.Move,new Oi],[en.Explore,new Ii],[en.Talk,new Li],[en.Sequence,new Di],[en.None,new Di]]),this.inputManager),this.characterManager=new Cn,this.objectManager=new ii,this.dialogueManager=new Pn,this.actionManager=new hn,this.boundingBoxManager=new vn,this.backgroundManager=new yn,this.animationManager=new un,this.popUpManager=new ci,this.escapeManager=new Yn(this),this.collectibleManager=new xn(this,Eo.getInstance().getUserStateManager().getCollectibles),this.achievementManager=new xn(this,Eo.getInstance().getUserStateManager().getAchievements),this.logManager=new si(this),this.dialogueStorageManager=new En,this.toolbarManager=new bi(this),this.taskLogManager=new xi(this),this.dashboardManager=new wn(this,[jn.Log,jn.Tasks,jn.Collectibles,jn.Achievements],[this.logManager,this.taskLogManager,this.collectibleManager,this.achievementManager])}preload(){Fn(this),this.getPhaseManager().setInterruptCheckCallback(((e,t)=>this.transitionChecker(e,t))),this.getPhaseManager().setInterruptCallback((async(e,t)=>await this.checkpointTransition())),this.getPhaseManager().setCallback((async(e,t)=>await this.handleCharacterLayer(e,t))),this.preloadLocationsAssets(),this.bindKeyboardTriggers()}preloadLocationsAssets(){const e=this.getStateManager().getGameMap();sn.getInstance().loadSounds(e.getSoundAssets()),e.getMapAssets().forEach(((e,t)=>{this.loadImage(e,t)}))}loadImage(e,t){switch(e.type){case hs.Image:this.load.image(t,Ss(e.path,!0));break;case hs.Sprite:this.load.spritesheet(t,Ss(e.path,!0),e.config)}}async create(){sn.getInstance().hideLayer(ys.Character),await this.changeLocationTo(this.currentLocationId,!0),await sn.getInstance().saveGame()}async renderLocation(e,t){const a=sn.getInstance().getLocationAtId(e);this.getToolbarManager().renderToolbarContainer(),await sn.getInstance().playBgMusic(a.bgmKey),this.getBackgroundManager().renderBackgroundLayerContainer(e),this.getObjectManager().renderObjectsLayerContainer(e),this.getBBoxManager().renderBBoxLayerContainer(e),this.getCharacterManager().renderCharacterLayerContainer(e),await this.getPhaseManager().swapPhase(en.Sequence),t&&(await this.getActionManager().fastForwardGameActions(this.getStateManager().getTriggeredStateChangeActions()),await this.getActionManager().processGameActions(this.getStateManager().getGameMap().getGameStartActions())),await this.getActionManager().processGameActions(a.actionIds),this.getStateManager().hasLocationNotif(e)&&(await sn.getInstance().bringUpUpdateNotif(a.name),this.getStateManager().removeLocationNotif(e)),this.getPhaseManager().isCurrentPhase(en.Sequence)&&await this.getPhaseManager().swapPhase(en.Menu)}async changeLocationTo(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.currentLocationId=e,await(async(e,t,a,s)=>{const n=Ts(e);e.getLayerManager().addToLayer(ys.Effects,n),n.setAlpha(0),e.tweens.add(Ms([n],t)),await Cs(t),await s(),await Cs(a),n.setAlpha(1),e.tweens.add(ks([n],t)),await Cs(t),n.destroy()})(this,300,500,(async()=>{await this.getLayerManager().clearAllLayers(),await this.renderLocation(e,t)})),this.getStateManager().triggerInteraction(e)}bindKeyboardTriggers(){this.getInputManager().registerKeyboardListener(Phaser.Input.Keyboard.KeyCodes.ESC,"up",(async()=>{this.getPhaseManager().isCurrentPhaseTerminal()?await this.getPhaseManager().popPhase():await this.getPhaseManager().pushPhase(en.EscapeMenu)})),this.getInputManager().registerKeyboardListener(Phaser.Input.Keyboard.KeyCodes.TAB,"up",(async()=>{this.getPhaseManager().isCurrentPhase(en.Dashboard)?await this.getPhaseManager().popPhase():this.getPhaseManager().isCurrentPhaseTerminal()?await this.getPhaseManager().swapPhase(en.Dashboard):await this.getPhaseManager().pushPhase(en.Dashboard)}))}cleanUp(){this.getInputManager().clearListeners(),this.getLayerManager().clearAllLayers(),this.getDialogueStorageManager().clearDialogueStorage()}transitionChecker(e,t){return!this.hasTransitioned&&t!==en.Sequence&&sn.getInstance().areAllObjectivesComplete()&&!this.getStateManager().getChapterNewlyCompleted()}async checkpointTransition(){this.hasTransitioned=!0,await this.getActionManager().processGameActions(this.getStateManager().getGameMap().getCheckpointCompleteActions()),this.getInputManager().setDefaultCursor(Fa.defaultCursor),this.getInputManager().enableMouseInput(!0),this.getInputManager().enableKeyboardInput(!0),this.tweens.add(Ms([Ts(this).setAlpha(0)],Fa.fadeDuration)),await Cs(Fa.fadeDuration),this.cleanUp(),this.scene.start("CheckpointTransition")}async handleCharacterLayer(e,t){e===en.Menu&&sn.getInstance().fadeOutLayer(ys.Character),t===en.Menu&&sn.getInstance().fadeInLayer(ys.Character)}}const Ui=Gi;class Fi{constructor(){this.fullSaveState=void 0,this.chapterNum=void 0,this.checkpointNum=void 0,this.getTriggeredStateChangeActions=()=>this.getGameSaveState().triggeredStateChangeActions,this.getTriggeredInteractions=()=>this.getGameSaveState().triggeredInteractions,this.getCompletedObjectives=()=>this.getGameSaveState().completedObjectives,this.getCompletedTasks=()=>this.getGameSaveState().completedTasks,this.getIncompleteTasks=()=>this.getGameSaveState().incompleteTasks,this.getLoadedPhase=()=>this.getGameSaveState().currentPhase,this.getChapterNewlyCompleted=()=>this.getGameSaveState().chapterNewlyCompleted,this.getChapterNum=()=>js(this.chapterNum),this.getCheckpointNum=()=>js(this.checkpointNum),this.getFullSaveState=()=>this.fullSaveState,this.fullSaveState=li()}async loadLastSaveState(){this.fullSaveState=await async function(){var e;const t={method:"GET",headers:Ro(Eo.getInstance().getAccountInfo().accessToken)},a=await fetch(`${g.Z.backendUrl}/v2/user`,t),s=await a.text(),n=null===(e=JSON.parse(s).courseRegistration)||void 0===e?void 0:e.gameStates;return S().isEmpty(n)?li():n}()}registerGameInfo(e,t,a){this.chapterNum=e,this.checkpointNum=t,a||(this.fullSaveState.gameSaveStates[e]=di())}async saveGame(){Eo.getInstance().getCurrentSceneRef()instanceof Ui&&(this.fullSaveState=function(e,t,a){const s=sn.getInstance().getGameManager(),n=s.getStateManager(),i=s.getPhaseManager();return{gameSaveStates:{...e.gameSaveStates,[t]:{lastCheckpointPlayed:a,currentLocation:s.currentLocationId,currentPhase:i.getCurrentPhase(),chapterNewlyCompleted:n.getChapterNewlyCompleted(),incompleteTasks:n.getIncompleteTasks(),completedTasks:n.getCompletedTasks(),completedObjectives:n.getCompletedObjectives(),triggeredInteractions:n.getTriggeredInteractions(),triggeredStateChangeActions:n.getTriggeredStateChangeActions()}},userSaveState:{settings:e.userSaveState.settings,recentlyPlayedCheckpoint:[t,a],collectibles:Eo.getInstance().getUserStateManager().getCollectibles(),largestCompletedChapter:e.userSaveState.largestCompletedChapter}}}(this.fullSaveState,this.getChapterNum(),this.getCheckpointNum()),await Do(this.fullSaveState))}async saveChapterComplete(e){this.fullSaveState.gameSaveStates[e].chapterNewlyCompleted=!0,e>this.getLargestCompletedChapterNum()&&(this.fullSaveState.userSaveState.largestCompletedChapter=e),await Do(this.fullSaveState)}async saveSettings(e){this.fullSaveState.userSaveState.settings=e,await Do(this.fullSaveState)}getSettings(){return this.fullSaveState.userSaveState.settings}getLoadedUserState(){return this.fullSaveState.userSaveState}getLargestCompletedChapterNum(){return this.fullSaveState.userSaveState.largestCompletedChapter}getGameSaveState(){return this.fullSaveState.gameSaveStates[this.getChapterNum()]||di()}getLoadedLocation(){return this.getGameSaveState().currentLocation}getChapterSaveState(e){return this.fullSaveState.gameSaveStates[e]||di()}}const _i={key:Ua.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};const Vi=["Clang. Thud. One hit to the wall, one hit to my flesh.","","They told me I was to be the pillar of this","spaceship - who knew they meant it literally?","- A. Halim"],Hi=["I blink synchronously with the screen;","I breathe as the machine steams on and off.","","Behind this closed space, my very blood fuels","these engines - hoping for you to find me.","- T. S. Chong"],zi={yInterval:80,messageDuration:5e3};function $i(e,t,a,s){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:50,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:50;const r=new Phaser.GameObjects.Rectangle(e,a,s,n,i,0,0),o="A"===t?Vi:Hi;r.setInteractive({useHandCursor:!0}),r.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,(()=>async function(e,t){const a=Ts(e).setInteractive().setAlpha(0),s=Ka({numOfItems:t.length,xSpacing:0,ySpacing:zi.yInterval}),n={x:Va.x,y:0,oriX:.5,oriY:.5},i=Va.y-t.length*zi.yInterval*.5;e.getLayerManager().addToLayer(ys.WorkerMessage,a),e.add.tween(Ms([a],Fa.fadeDuration)),Eo.getInstance().getSoundManager().playSound(xs.radioStatic.key),await Cs(Fa.fadeDuration),t.forEach(((t,a)=>{const r=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0,oriX:.5,oriY:.5},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_i,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:3;const o=[];for(let c=0;c<n;c++){const n={x:a.x+i*Math.random(),y:a.y+r*Math.random(),oriX:a.oriX,oriY:a.oriY},c=Ja(e,t,n,s);c.setAlpha(.4).setBlendMode(Phaser.BlendModes.SCREEN),o.push(c)}return o.forEach((t=>{e.tweens.add({targets:t,x:t.x+i*Math.random(),y:t.y+r*Math.random(),alpha:.5,duration:20,yoyo:!0,loop:-1,loopDelay:1e3*Math.random()})})),o}(e,t,{...n,y:s[a][1]+i});r.forEach((t=>e.getLayerManager().addToLayer(ys.WorkerMessage,t))),setTimeout((()=>r.forEach((e=>e.destroy()))),zi.messageDuration)})),await Cs(zi.messageDuration),As(e,a)}(e,o))),e.getLayerManager().addToLayer(ys.UI,r)}const Xi={scrollSpeed:20,tileDim:2048,maxAwardsPerCol:2,arrow:{xOffset:875},award:{xSpace:300,yStart:300,ySpace:Va.y-50,dim:200},awardInfo:{width:300},banner:{xOffset:.28*-_a.x},bannerTextConfig:{x:30,y:0,oriX:0,oriY:.5}},Wi={key:Ua.alienLeagueFont.key,size:35,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT},Ki={fontFamily:"Verdana",fontSize:"30px",fill:Ha.lightBlue,align:"center",wordWrap:{width:Xi.award.dim-20}},qi={fontFamily:"Verdana",fontSize:"20px",fill:Ha.lightBlue,align:"left",wordWrap:{width:Xi.awardInfo.width-20}},Zi={fontFamily:"Verdana",fontSize:"15px",fill:Ha.offWhite,align:"left",wordWrap:{width:Xi.awardInfo.width-20}},Yi={fontFamily:"Verdana",fontSize:"15px",fill:Ha.lightBlue,align:"left",wordWrap:{width:Xi.awardInfo.width-20}};class Ji extends Phaser.Scene{constructor(){super("AwardsHall"),this.layerManager=void 0,this.inputManager=void 0,this.backgroundTile=void 0,this.awardsContainer=void 0,this.isScrollLeft=void 0,this.isScrollRight=void 0,this.scrollLim=void 0,this.awardXSpace=void 0,this.getUserStateManager=()=>Eo.getInstance().getUserStateManager(),this.getInputManager=()=>js(this.inputManager),this.getLayerManager=()=>js(this.layerManager),Eo.getInstance().setCurrentSceneRef(this),this.isScrollLeft=!1,this.isScrollRight=!1,this.scrollLim=0,this.awardXSpace=0}init(){this.layerManager=new Qn(this),this.inputManager=new Jn(this)}preload(){Fn(this)}async create(){const e=this.getUserStateManager().getAchievements().length,t=this.getUserStateManager().getCollectibles().length;this.awardXSpace=Math.ceil(Math.max(e,t)/Xi.maxAwardsPerCol)*Xi.award.xSpace,this.scrollLim=this.awardXSpace<_a.x?0:this.awardXSpace-_a.x,this.renderBackground(),this.renderAwards(),$i(this,"A",.95*_a.x,.99*_a.y)}update(){if(!this.backgroundTile||!this.awardsContainer)return;let e=this.awardsContainer.x;this.isScrollRight?e-=Xi.scrollSpeed:this.isScrollLeft&&(e+=Xi.scrollSpeed),e=fs(e,-this.scrollLim,0),this.backgroundTile.tilePositionX=-e,this.awardsContainer.x=e}renderBackground(){this.backgroundTile&&this.backgroundTile.destroy(),this.backgroundTile=new Phaser.GameObjects.TileSprite(this,0,0,Xi.tileDim,Xi.tileDim,gs.awardsBackground.key).setOrigin(0,.25),this.getLayerManager().addToLayer(ys.Background,this.backgroundTile);const e=["Achievements","Collectibles"],t=Xa({direction:$a.Column,numOfItems:e.length});e.forEach(((e,a)=>{const s=this.createBanner(e,t[a][1]);this.getLayerManager().addToLayer(ys.UI,s)}));const a=qs(this,{assetKey:gs.chapterSelectArrow.key,onDown:()=>this.isScrollLeft=!0,onUp:()=>this.isScrollLeft=!1,onOut:()=>this.isScrollLeft=!1}).setPosition(Va.x-Xi.arrow.xOffset,Va.y),s=qs(this,{assetKey:gs.chapterSelectArrow.key,onDown:()=>this.isScrollRight=!0,onUp:()=>this.isScrollRight=!1,onOut:()=>this.isScrollRight=!1}).setPosition(Va.x+Xi.arrow.xOffset,Va.y).setScale(-1,1),n=new ji(this,(()=>{this.cleanUp(),this.scene.start("MainMenu")}));this.getLayerManager().addToLayer(ys.UI,a),this.getLayerManager().addToLayer(ys.UI,s),this.getLayerManager().addToLayer(ys.UI,n)}renderAwards(){this.awardsContainer&&this.awardsContainer.destroy(),this.awardsContainer=new Phaser.GameObjects.Container(this,0,0);const e=this.getAwards(this.getUserStateManager().getAchievements()),t=Xa({direction:$a.Column,numOfItems:e.length,numItemLimit:Xi.maxAwardsPerCol,redistributeLast:!1,maxXSpace:this.awardXSpace,maxYSpace:Xi.award.ySpace});this.awardsContainer.add(e.map(((e,a)=>this.createAward(e,t[a][0],t[a][1]+Xi.award.yStart-Va.y))));const a=this.getAwards(this.getUserStateManager().getCollectibles()),s=Xa({direction:$a.Column,numOfItems:a.length,numItemLimit:Xi.maxAwardsPerCol,redistributeLast:!1,maxXSpace:this.awardXSpace,maxYSpace:Xi.award.ySpace});this.awardsContainer.add(a.map(((e,t)=>this.createAward(e,s[t][0],s[t][1]+Xi.award.yStart)))),this.getLayerManager().addToLayer(ys.Objects,this.awardsContainer)}getAwards(e){return ls(e)}createAward(e,t,a){const s=new Phaser.GameObjects.Container(this,t,a);let n;if(e.assetKey===Fa.nullInteractionId){n=new Phaser.GameObjects.Rectangle(this,0,0,Xi.award.dim,Xi.award.dim,za.darkBlue,.8),n.setInteractive();const t=new Phaser.GameObjects.Text(this,0,0,e.title,Ki).setOrigin(.5,.5);s.add([n,t])}else n=new Phaser.GameObjects.Sprite(this,0,0,e.assetKey).setOrigin(.5),mn(n,Xi.award.dim,Xi.award.dim),n.setInteractive({pixelPerfect:!0,useHandCursor:!0}),s.add(n);const i=new Phaser.GameObjects.Rectangle(this,0,0,Xi.award.dim,Xi.award.dim,0).setAlpha(e.completed?0:.8);s.add(i);const r=((e,t)=>{const a=new Phaser.GameObjects.Container(e,0,0),s=new Phaser.GameObjects.Text(e,20,20,t.title,qi),n=new Phaser.GameObjects.Text(e,20,s.getBounds().bottom+20,t.assetKey,Zi),i=new Phaser.GameObjects.Text(e,20,n.getBounds().bottom+20,t.description,Yi),r=new Phaser.GameObjects.Rectangle(e,0,0,Xi.awardInfo.width,i.getBounds().bottom+20,za.darkBlue).setOrigin(0,0).setAlpha(.8),o=new Phaser.GameObjects.Sprite(e,Xi.awardInfo.width/2,0,gs.scrollFrame.key),c=new Phaser.GameObjects.Sprite(e,Xi.awardInfo.width/2,r.getBounds().bottom,gs.scrollFrame.key);return a.add([r,s,i,o,c]),t.completed&&a.add(n),a.setVisible(!1),a})(this,e);return n.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,(()=>r.setVisible(!0))),n.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,(()=>r.setVisible(!1))),n.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_MOVE,(e=>{r.x=e.x+10,r.y=e.y-10})),this.getLayerManager().addToLayer(ys.UI,r),s}cleanUp(){this.getInputManager().clearListeners(),this.getLayerManager().clearAllLayers()}createBanner(e,t){const a=new Phaser.GameObjects.Container(this,0,t),s=new Phaser.GameObjects.Sprite(this,Xi.banner.xOffset,0,gs.awardsPage.key),n=Ja(this,e,Xi.bannerTextConfig,Wi);return a.add([s,n]),a}}const Qi=Ji,er={keyTextConfig:{x:Va.x-100,y:0,oriX:.5,oriY:.5},keyDescTextConfig:{x:Va.x+100,y:0,oriX:.5,oriY:.5},key:{yStart:.9*Va.y,yInterval:150},icon:{x:Va.x-100}},tr={key:Ua.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},ar={key:Ua.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER};class sr extends Phaser.Scene{constructor(){super("Bindings"),this.layerManager=void 0,this.inputManager=void 0,this.getInputManager=()=>js(this.inputManager),this.getLayerManager=()=>js(this.layerManager)}init(){this.layerManager=new Qn(this),this.inputManager=new Jn(this)}create(){this.renderBackground(),this.renderBindings()}renderBackground(){const e=new Phaser.GameObjects.Image(this,Va.x,Va.y,gs.spaceshipBg.key),t=new Phaser.GameObjects.Rectangle(this,Va.x,Va.y,_a.x,_a.y,0).setAlpha(.3);this.getLayerManager().addToLayer(ys.Background,e),this.getLayerManager().addToLayer(ys.Background,t)}renderBindings(){const e=new Phaser.GameObjects.Container(this,0,0),t=this.getBindings(),a=Ka({numOfItems:t.length,xSpacing:0,ySpacing:er.key.yInterval});e.add(t.map(((e,t)=>this.createBinding(e.key,e.text,a[t][0],a[t][1]+er.key.yStart))));const s=new ji(this,(()=>{this.getLayerManager().clearAllLayers(),this.scene.start("MainMenu")}));this.getLayerManager().addToLayer(ys.UI,e),this.getLayerManager().addToLayer(ys.UI,s)}getBindings(){return[{key:"Esc",text:"Escape Menu"},{key:"Tab",text:"Dashboard"}]}createBinding(e,t,a,s){const n=new Phaser.GameObjects.Container(this,a,s),i=new Phaser.GameObjects.Sprite(this,er.icon.x,0,gs.squareKeyboardIcon.key);if("Tab"===e)i.setTexture(gs.medKeyboardIcon.key);const r=Ja(this,e,er.keyTextConfig,tr),o=Ja(this,t,er.keyDescTextConfig,ar);return n.add([i,r,o]),n}}const nr=sr,ir=(e,t,a)=>new Promise((s=>{"__MISSING"!==e.textures.get(t).key?s(t):(e.load.image(t,a),e.load.once(`filecomplete-image-${t}`,s),e.load.once("loaderror",s),e.load.start())})),rr=(e,t,a)=>new Promise((s=>{e.cache.text.exists(t)?s(t):(e.load.text(t,a),e.load.once(`filecomplete-text-${t}`,s),e.load.start())})),or={key:Ua.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},cr={key:Ua.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},lr={key:Ua.zektonFont.key,size:25,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},dr={arrow:{xOffset:875},buttons:{scale:.65},resetButton:{xOffset:135,yOffset:85},playButton:{xOffset:55,yOffset:85},frame:{xOffset:12,yOffset:-4},scrollSpeed:100,indexTextConfig:{x:0,y:-110,oriX:.5,oriY:.5},titleTextConfig:{x:0,y:-50,oriX:.5,oriY:.5},pageNumberTextConfig:{x:Va.x,y:_a.y-30,oriX:.5,oriY:.5},imageRect:{width:400,height:280},imageScale:{x:.8,y:.4},chapComplete:{y:10,height:30,text:"Chapter Completed"},grid:{chapPerRow:3,chapPerCol:3,chapPerPage:9,chapGapX:50,chapGapY:50}},hr=e=>Ss(`/stories/${e}`,!0),ur={defaultCheckpoint:{key:"default-chap",path:hr("defaultCheckpoint.txt")},awardsMapping:{key:"awards-mapping",path:hr("awardsMapping.txt")},roomPreviewMapping:{key:"room-prev-mapping",path:hr("roomPreviewMapping.txt")}},gr={defaultCheckpoint:{key:"mock-default-chap",path:"../../assets/mockDefaultCheckpoint.txt"},awardsMapping:{key:"mock-awards-mapping",path:"../../assets/mockAwardsMapping.txt"},roomPreviewMapping:{key:"mock-room-prev-mapping",path:"../../assets/mockRoomPreviewMapping.txt"}},pr=ur;const mr=class{constructor(){this.soundAssets=void 0,this.mapAssets=void 0,this.locations=void 0,this.dialogues=void 0,this.objects=void 0,this.boundingBoxes=void 0,this.characters=void 0,this.actions=void 0,this.gameStartActions=void 0,this.checkpointCompleteActions=void 0,this.getLocationAtId=e=>js(this.locations.get(e),`Location ${e} was not found!`),this.getAssetByKey=e=>js(this.mapAssets.get(e),`Asset ${e} not found!`),this.soundAssets=[],this.mapAssets=new Map,this.locations=new Map,this.dialogues=new Map,this.objects=new Map,this.boundingBoxes=new Map,this.characters=new Map,this.actions=new Map,this.gameStartActions=[],this.checkpointCompleteActions=[]}addSoundAsset(e){this.soundAssets.push(e)}addMapAsset(e,t){this.mapAssets.set(e,t)}getMapAssets(){return this.mapAssets}addLocation(e,t){this.locations.set(e,t)}setModesAt(e,t){this.getLocationAtId(e).modes=new Set(t)}setNavigationFrom(e,t){this.getLocationAtId(e).navigation=new Set(t)}getNavigationFrom(e){return this.getLocationAtId(e).navigation}setGameStartActions(e){this.gameStartActions=e}setCheckpointCompleteActions(e){this.checkpointCompleteActions=e}getGameStartActions(){return this.gameStartActions}getCheckpointCompleteActions(){return this.checkpointCompleteActions}getLocations(){return this.locations}getObjectPropMap(){return this.objects}getBBoxPropMap(){return this.boundingBoxes}getDialogueMap(){return this.dialogues}getCharacterMap(){return this.characters}getActionMap(){return this.actions}getSoundAssets(){return this.soundAssets}setItemInMap(e,t,a){this[e].set(t,a)}addItemToLocation(e,t,a){this.getLocationAtId(e)[t].add(a)}setBGMusicAt(e,t){this.getLocationAtId(e).bgmKey=t}getLocationIds(){return Array.from(this.locations.keys())}getAssetKeyFromId(e){var t,a;return js((null===(t=this.objects.get(e))||void 0===t?void 0:t.assetKey)||(null===(a=this.locations.get(e))||void 0===a?void 0:a.assetKey),`Id ${e} not found!`)}};const xr=class{constructor(){this.objective=void 0,this.totalNumOfObjectives=void 0,this.numOfCompletedObjectives=void 0,this.objective=new Map,this.totalNumOfObjectives=0,this.numOfCompletedObjectives=0}setObjective(e,t){const a=this.objective.get(e);this.objective.set(e,t),void 0!==a&&a!==t&&this.numOfCompletedObjectives++}addObjective(e){this.objective.set(e,!1),this.totalNumOfObjectives++}addObjectives(e){e.forEach((e=>this.addObjective(e)))}isAllComplete(){return this.numOfCompletedObjectives>=this.totalNumOfObjectives}getObjectiveState(e){const t=this.objective.get(e);if(void 0===t)throw new Error(`Cannot find objective with the given task id "${e}"`);return t}getObjectives(){return this.objective}setObjectives(e){this.objective=e}};const yr=class{constructor(){this.tasks=void 0,this.taskDetails=void 0,this.tasks=new Map,this.taskDetails=new Map}setTask(e,t){this.tasks.set(e,t)}showTask(e){const t=this.taskDetails.get(e);if(void 0!==t){const a={...t,visible:!0};this.taskDetails.set(e,a)}}addTask(e){const t=e.taskId;this.tasks.set(t,!1),this.taskDetails.set(t,e)}addTasks(e){e.forEach((e=>this.addTask(e)))}getTaskState(e){const t=this.tasks.get(e);if(void 0===t)throw new Error(`Cannot find task with the given task id "${e}"`);return t}getTaskDetail(e){const t=this.taskDetails.get(e);if(void 0===t)throw new Error(`Cannot find task with the given task id "${e}"`);return t}getAllTasks(){return this.tasks}getAllIncompleteTasks(){const e=new Array;for(const a of this.tasks.keys()){var t;!this.tasks.get(a)&&null!==(t=this.taskDetails.get(a))&&void 0!==t&&t.visible&&e.push(a)}return e}getAllVisibleTaskData(){const e=new Array;for(const t of this.tasks.keys()){const a=this.getTaskState(t),s=this.getTaskDetail(t);void 0!==a&&void 0!==s&&s.visible&&e.push([s,a])}return e}},vr={small:Mn.Small,medium:Mn.Medium,large:Mn.Large},br={left:kn.Left,middle:kn.Middle,right:kn.Right},Cr={talk:ki.Talk,explore:ki.Explore,move:ki.Move,menu:ki.Menu},fr={navigation:cn.navigation,talkTopics:cn.talkTopics,objects:cn.objects,boundingBoxes:cn.boundingBoxes,characters:cn.characters,actions:cn.actions,bgmKey:cn.bgmKey,collectibles:cn.collectibles},Sr={move_character:on.MoveCharacter,update_character:on.UpdateCharacter,obtain_collectible:on.ObtainCollectible,complete_objective:on.CompleteObjective,complete_task:on.CompleteTask,show_task:on.ShowTask,add_item:on.AddItem,remove_item:on.RemoveItem,change_background:on.ChangeBackground,start_animation:on.StartAnimation,stop_animation:on.StopAnimation,show_dialogue:on.ShowDialogue,add_mode:on.AddLocationMode,remove_mode:on.RemoveLocationMode,add_popup:on.AddPopup,make_object_glow:on.MakeObjectGlow,make_object_blink:on.MakeObjectBlink,play_bgm:on.PlayBGM,play_sfx:on.PlaySFX,preview_location:on.PreviewLocation,show_object_layer:on.ShowObjectLayer,navigate_to_assessment:on.NavigateToAssessment,update_assessment_status:on.UpdateAssessmentStatus,delay:on.Delay},jr={checklist:nn.ChecklistState,tasklist:nn.TasklistState,userstate:nn.UserState},wr={assessments:rn.assessments,achievements:rn.achievements,collectibles:rn.collectibles};class Ir{static stringToSize(e){return vr[e]||Mn.Medium}static stringToPosition(e){return br[e]||kn.Middle}static stringToGameMode(e){return js(Cr[e],`Invalid location mode, ${e}`)}static stringToActionType(e){return js(Sr[e],`Invalid action type, ${e}`)}static stringToGameStateStorage(e){return js(jr[e],`Invalid condition type, ${e}`)}static stringToGameItemType(e){return js(fr[e],`Invalid entity type, ${e}`)}static stringToBoolean(e){return"false"!==e}static stringToUserStateType(e){return js(wr[e],`Invalid user state type ${e}`)}}let kr;!function(e){e.locations="locations",e.objectives="objectives",e.tasks="tasks",e.bgms="bgms",e.sfxs="sfxs"}(kr||(kr={}));class Mr{constructor(){this.gameItemAsserts=void 0,this.gameEntityAsserts=void 0,this.gameAnimAsserts=void 0,this.gameAnimMaps=[Wr.checkpoint.map.getLocations(),Wr.checkpoint.map[cn.objects]],this.allItemIds=void 0,this.gameItemAsserts=new Map,this.gameEntityAsserts=new Map,this.gameAnimAsserts=[],this.allItemIds=new Set}registerId(e){if(this.allItemIds.has(e))throw new Error(`Duplicate item id ${e}`);this.allItemIds.add(e)}verifyAssertions(){this.verifyGameItemAssert(),this.verifyGameEntityAsserts(),this.verifyGameAnimAsserts()}assertItemType(e,t,a){e===cn.talkTopics?e=cn.dialogues:e===cn.navigation&&(e=cn.locations),this.gameItemAsserts.get(e)||this.gameItemAsserts.set(e,[]),this.gameItemAsserts.get(e).push({itemId:t,actionType:a})}verifyGameItemAssert(){this.gameItemAsserts.forEach(((e,t)=>{e.forEach((e=>{const{itemId:a,actionType:s}=e;if(!Wr.checkpoint.map[t].has(a))throw s&&this.actionAssertionError(a,t,s),new Error(`Cannot find id "${a}" under ${t} entity type`)}))}))}assertItemTypes(e,t,a){t.forEach((t=>this.assertItemType(e,t,a)))}assertEntityType(e,t,a){this.gameEntityAsserts.get(e)||this.gameEntityAsserts.set(e,[]),this.gameEntityAsserts.get(e).push({itemId:t,actionType:a})}verifyGameEntityAsserts(){this.gameEntityAsserts.forEach(((e,t)=>{e.forEach((e=>{const{itemId:a,actionType:s}=e;switch(t){case kr.locations:Wr.checkpoint.map.getLocationAtId(a);break;case kr.objectives:if(void 0===Wr.checkpoint.objectives.getObjectives().get(a))throw s&&this.actionAssertionError(a,t,s),new Error(`Cannot find objective id "${a}"`);break;case kr.tasks:if(void 0===Wr.checkpoint.tasks.getAllTasks().get(a))throw s&&this.actionAssertionError(a,t,s),new Error(`Cannot find task id "${a}"`);break;case kr.bgms:const e=Wr.checkpoint.map.getSoundAssets().filter((e=>e.soundType===ms.BGM&&e.key===a)).length;if(0===e)throw new Error(`Cannot find bgm key "${a}"`);if(e>1)throw new Error(`More than 1 bgm key "${a}"`);break;case kr.sfxs:const n=Wr.checkpoint.map.getSoundAssets().filter((e=>e.soundType===ms.SFX&&e.key===a)).length;if(0===n)throw new Error(`Cannot find sfx key "${a}"`);if(n>1)throw new Error(`More than 1 sfx key "${a}"`)}}))}))}assertAnimType(e,t){this.gameAnimAsserts.push({itemId:e,actionType:t})}verifyGameAnimAsserts(){this.gameAnimAsserts.forEach((e=>{const{itemId:t,actionType:a}=e;let s=!1;this.gameAnimMaps.forEach((e=>{e.get(t)&&(s=!0)})),s||this.actionAssertionError(t,"locationId or itemId",a)}))}actionAssertionError(e,t,a){throw new Error(`Expected type of "${t}" as argument for "${a}", obtained "${e}" which is either undefined or the wrong id.`)}}class Ar{static parse(e){const t="!"===e[0];t&&(e=e.slice(1));const[a,...s]=An.splitByChar(e,".");switch(Ir.stringToGameStateStorage(a)){case nn.ChecklistState:return Wr.validator.assertEntityType(kr.objectives,s[0]),{state:nn.ChecklistState,conditionParams:{id:s[0]},boolean:!t};case nn.TasklistState:return Wr.validator.assertEntityType(kr.tasks,s[0]),{state:nn.TasklistState,conditionParams:{id:s[0]},boolean:!t};case nn.UserState:return{state:nn.UserState,conditionParams:{userStateType:Ir.stringToUserStateType(s[0]),id:s[1]},boolean:!t};default:throw new Error("Parsing error: Invalid condition param")}}}class Tr{static parseActions(e){return e.map((e=>this.parseAction(e)))}static parseAction(e){const[t,a]=An.splitByChar(e,"if"),s=this.parseActionContent(t);return a&&(s.actionConditions=An.splitByChar(a,"AND").map((e=>Ar.parse(e)))),Wr.checkpoint.map.setItemInMap(cn.actions,s.interactionId,s),s.interactionId}static parseActionContent(e){const[t,a]=An.splitByChar(e,"(");let s=!1,n=t;"*"===t[t.length-1]&&(s=!0,n=n.slice(0,-1));const i=Ir.stringToActionType(n),r=An.splitByChar(a.slice(0,-1),","),o={};switch(i){case on.ObtainCollectible:o.id=r[0];break;case on.CompleteObjective:o.id=r[0],Wr.validator.assertEntityType(kr.objectives,r[0],n);break;case on.CompleteTask:case on.ShowTask:o.id=r[0],Wr.validator.assertEntityType(kr.tasks,r[0],n);break;case on.PreviewLocation:case on.ChangeBackground:o.id=r[0],Wr.validator.assertEntityType(kr.locations,r[0],n);break;case on.StartAnimation:o.id=r[0],o.startFrame=+r[1],o.frameRate=+r[2],o.assetCategory=r[3],Wr.validator.assertAnimType(r[0],n);break;case on.StopAnimation:o.id=r[0],Wr.validator.assertAnimType(r[0],n);break;case on.ShowDialogue:o.id=r[0],Wr.validator.assertItemType(cn.dialogues,r[0],n);break;case on.AddItem:case on.RemoveItem:const e=Ir.stringToGameItemType(r[0]);o.gameItemType=e,o.locationId=r[1],Wr.validator.assertEntityType(kr.locations,r[1],n),o.id=r[2],Wr.validator.assertItemType(e,r[2],n);break;case on.AddLocationMode:case on.RemoveLocationMode:Wr.validator.assertEntityType(kr.locations,r[0],n),o.locationId=r[0],o.mode=Ir.stringToGameMode(r[1]);break;case on.AddPopup:Wr.validator.assertItemType(cn.objects,r[0],n),o.id=r[0],o.position=Ir.stringToPosition(r[1]),r[2]&&(o.duration=1e3*parseInt(r[2])),r[3]&&(o.size=Ir.stringToSize(r[3]));break;case on.MakeObjectBlink:case on.MakeObjectGlow:Wr.validator.assertItemType(cn.objects,r[0],n),o.id=r[0],o.turnOn=Ir.stringToBoolean(r[1]);break;case on.PlayBGM:o.id=r[0],Wr.validator.assertEntityType(kr.bgms,r[0],n);break;case on.PlaySFX:o.id=r[0],Wr.validator.assertEntityType(kr.sfxs,r[0],n);break;case on.ShowObjectLayer:o.show=Ir.stringToBoolean(r[0]);break;case on.UpdateCharacter:Wr.validator.assertItemType(cn.characters,r[0],n),o.id=r[0],o.expression=r[1];break;case on.MoveCharacter:Wr.validator.assertItemType(cn.characters,r[0],n),Wr.validator.assertEntityType(kr.locations,r[1],n),o.id=r[0],o.locationId=r[1],o.position=Ir.stringToPosition(r[2]);break;case on.NavigateToAssessment:o.assessmentId=r[0];break;case on.Delay:o.duration=1e3*parseInt(r[0])}return{actionType:i,actionParams:o,actionConditions:[],interactionId:Wr.generateActionId(),isInteractive:!1,isRepeatable:s}}}class Pr{static parsePrompt(e,t){return{promptTitle:e.split("prompt:")[1].trim(),choices:t.map(this.splitChoice)}}static splitChoice(e){const t=An.splitWithLimit(e,"->",1);return[t[0].trim(),t[1].split(" ")[1].trim()]}}class Er{static parse(e,t){t.forEach((t=>this.parseCharacterDetails(e,t)))}static characterAssetKey(e,t){return e+"-"+t}static characterAssetPath(e,t){return`/avatars/${e}/${e}.${t}.png`}static parseCharacterDetails(e,t){const a="+"===t[0];a&&(t=t.slice(1));const[s,n,i,r,o]=An.splitByChar(t,",");Wr.validator.registerId(s);const c=new Map,l={id:s,name:n,expressions:c,defaultExpression:i,defaultPosition:Ir.stringToPosition(r),scale:o?parseFloat(o):1};c.set(i,this.characterAssetKey(s,i)),Wr.checkpoint.map.addMapAsset(this.characterAssetKey(s,i),{type:hs.Image,path:this.characterAssetPath(s,i),key:s}),Wr.checkpoint.map.setItemInMap(cn.characters,s,l),a&&Wr.checkpoint.map.addItemToLocation(e,cn.characters,s)}}class Nr{static parse(e){const[t,a,s]=An.splitByChar(e.slice(1),","),n=Ir.stringToPosition(s);return this.addCharacterExprToMap(t,a),{speakerId:t,expression:a,speakerPosition:n}}static addCharacterExprToMap(e,t){if("you"===e||"narrator"===e)return;const a=Wr.checkpoint.map.getCharacterMap().get(e);if(!a)throw new Error(`Character "${e}" not in map`);const s=t||a.defaultExpression;a.expressions.set(t,Er.characterAssetKey(e,t||s)),Wr.checkpoint.map.addMapAsset(Er.characterAssetKey(e,s),{path:Er.characterAssetPath(e,s),type:hs.Image,key:e})}}class Or{static parse(e){An.splitToParagraph(e).forEach((e=>{let[t,a]=e;0!==a.length?this.parseDialogue(t,a):console.error("No dialogue found for dialogueId")}))}static parseDialogue(e,t){const[a,s]=An.splitWithLimit(e,",",1);Wr.validator.registerId(a);const n={title:s,content:this.parseDialogueContent(t)};n.title||(n.title=An.toCapitalizedWords(a)),Wr.checkpoint.map.setItemInMap(cn.dialogues,a,n)}static parseDialogueContent(e){return function(e,t){const a=new Map;return e.forEach(((e,s)=>{const n=t(e,s);a.set(s,n)})),a}(An.mapByHeader(e,Dr),this.createDialogueLines)}static createDialogueLines(e){const t=[];let a=0;for(;a!==e.length;){const s=e[a];switch(!0){case Rr(s):const[n,i]=An.splitByChar(s,"if"),[r,o]=i?An.splitByChar(i,"else"):[null,null],c=r?An.splitByChar(r,"AND").map((e=>Ar.parse(e))):[];t[t.length-1].goto={conditions:c,part:n.split(" ")[1],altPart:o};break;case Gr(s):const l=s,d=[];for(;e[a+1]&&Ur(e[a+1]);)a++,d.push(e[a].trim());const h=Pr.parsePrompt(l,d);t[t.length-1].prompt=h;break;case Br(s):const u=t[t.length-1];!u.actionIds&&(u.actionIds=[]),u.actionIds.push(Tr.parseAction(s));break;case Lr(s):a++;const g=e[a];if(!g)throw new Error("Parsing error: Cannot change speaker without next line");t.push({line:g}),t[t.length-1].speakerDetail=Nr.parse(s);break;default:t.push({line:s}),t[t.length-1].speakerDetail=Nr.parse("@narrator")}a++}return t}}const Dr=e=>new RegExp(/^[0-9]+$/).test(e),Rr=e=>new RegExp(/^goto [0-9]+.*$/).test(e),Br=e=>e&&("\t"===e[0]||"    "===e.slice(0,4)),Lr=e=>e&&"@"===e[0],Gr=e=>e.trim().startsWith("prompt:"),Ur=e=>new RegExp(/-> +goto/).test(e);class Fr{static parse(e){e.forEach((e=>{const[t,a,s,n,i]=An.splitByChar(e,",");Wr.validator.registerId(t),Wr.checkpoint.map.addLocation(t,{id:"",name:"",assetKey:"",previewKey:null,modes:new Set([]),navigation:new Set([]),talkTopics:new Set([]),objects:new Set([]),boundingBoxes:new Set([]),bgmKey:"",characters:new Set([]),id:t,name:s,assetKey:this.locationAssetKey(a)}),Wr.checkpoint.map.addMapAsset(this.locationAssetKey(a),{type:hs[n]||hs.Image,key:t,path:this.locationPath(a),config:{frameWidth:_a.x,frameHeight:_a.y,centreX:Va.x,centreY:Va.y,endFrame:parseInt(i)-1||0,animType:us.Background}})}))}static locationAssetKey(e){return e}static locationPath(e){return e}}class _r{static parse(e,t){An.splitToParagraph(t).forEach((t=>{let[a,s]=t;const n=this.parseBBoxConfig(e,a);s.length&&(n.isInteractive=!0,n.actionIds=Tr.parseActions(s))}))}static parseBBoxConfig(e,t){const a="+"===t[0];a&&(t=t.slice(1));const[s,n,i,r,o]=An.splitByChar(t,","),c={x:parseInt(n),y:parseInt(i),width:parseInt(r),height:parseInt(o),isInteractive:!1,interactionId:s};return Wr.validator.registerId(s),Wr.checkpoint.map.setItemInMap(cn.boundingBoxes,s,c),a&&Wr.checkpoint.map.addItemToLocation(e,cn.boundingBoxes,s),c}}class Vr{static parse(e,t,a){t.forEach(((t,s)=>{const[n,i,r]=An.splitByChar(t,",");Wr.validator.registerId(n),Wr.checkpoint.map.addSoundAsset({key:n,path:i,config:{volume:parseFloat(r),loop:a===ms.BGM},soundType:a}),a===ms.BGM&&0===s&&Wr.checkpoint.map.setBGMusicAt(e,n)}))}}class Hr{static parse(e,t){An.splitToParagraph(t).forEach((t=>{let[a,s]=t;const n=this.parseObjectConfig(e,a);s.length&&(n.isInteractive=!0,n.actionIds=Tr.parseActions(s))}))}static objectAssetKey(e){return e}static objectPath(e){return e}static parseObjectConfig(e,t){const a="+"===t[0];a&&(t=t.slice(1));const[s,n,i,r,o,c,l,d]=An.splitByChar(t,",");Wr.validator.registerId(s);const h={assetKey:this.objectAssetKey(n),x:parseInt(i),y:parseInt(r),width:parseInt(o)||void 0,height:parseInt(c)||void 0,isInteractive:!1,interactionId:s};return Wr.checkpoint.map.addMapAsset(this.objectAssetKey(n),{type:hs[l]||hs.Image,key:s,path:this.objectPath(n),config:{frameHeight:parseInt(c)||-1,frameWidth:parseInt(o)||-1,centreX:0,centreY:0,endFrame:parseInt(d)-1||0,animType:us.Object}}),Wr.checkpoint.map.setItemInMap(cn.objects,s,h),a&&Wr.checkpoint.map.addItemToLocation(e,cn.objects,s),h}}class zr{static parse(e,t){const a=Wr.checkpoint.map.getLocationAtId(e);An.splitToParagraph(t).forEach((e=>{let[t,s]=e;0===s.length&&t.includes(":")?this.parseLocationConfig(a,t):this.parseLocationParagraphs(a,t,s)}))}static parseLocationConfig(e,t){const[a,s]=An.splitByChar(t,":"),n=An.splitByChar(s,",");switch(a){case"modes":n.forEach((t=>{const a=Ir.stringToGameMode(t);e.modes.add(a)}));break;case"nav":n.forEach((t=>{Wr.validator.assertEntityType(kr.locations,t),e.navigation.add(t)}));break;case"talkTopics":const t=n;Wr.validator.assertItemTypes(cn.dialogues,t),e.talkTopics=new Set(t);break;case"preview":const[s]=n;if(s){const t="/preview"+s;Wr.checkpoint.map.addMapAsset(t,{type:hs.Image,key:e.id+"Preview",path:s}),e.previewKey=t}break;default:throw new Error(`Invalid config key "${a}" specified under location "${e.id}"`)}}static parseLocationParagraphs(e,t,a){switch(t){case"objects":Hr.parse(e.id,a);break;case"boundingBoxes":_r.parse(e.id,a);break;case"characters":Er.parse(e.id,a);break;case"bgm":Vr.parse(e.id,a,ms.BGM);break;case"sfx":Vr.parse(e.id,a,ms.SFX);break;case"actions":e.actionIds=Tr.parseActions(a);break;default:throw new Error(`Invalid location paragraph header "${t}"`)}}}class $r{static parse(e){const t=[];e.forEach((e=>{const[a,s,n]=An.splitWithLimit(e,",",2),i={taskId:a,title:s,description:n,visible:!1};t.push(i)})),Wr.checkpoint.tasks.addTasks(t)}}class Xr{static generateActionId(){return Xr.actionIdNum++,`action#${Xr.actionIdNum}`}static init(){Xr.actionIdNum=0,Xr.checkpoint={map:new mr,startingLoc:"",objectives:new xr,tasks:new yr},Xr.validator=new Mr}static parse(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]||Xr.init();const t=An.splitToLinesAndRemoveComments(e);An.splitToParagraph(t).forEach((e=>{let[t,a]=e;0===a.length&&t.includes(":")?Xr.parseCheckpointConfig(t):Xr.parseCheckpointParagraphs(t,a)||zr.parse(t,a)})),Xr.validator.verifyAssertions()}static parseCheckpointConfig(e){const[t,a]=An.splitByChar(e,":");if("startingLoc"!==t)throw new Error(`Invalid checkpoint config key, "${e}"`);Xr.validator.assertEntityType(kr.locations,a),Xr.checkpoint.startingLoc=a}static parseCheckpointParagraphs(e,t){switch(e){case"objectives":Xr.checkpoint.objectives.addObjectives(t);break;case"tasks":$r.parse(t);break;case"locations":Fr.parse(t);break;case"gameStartActions":Xr.checkpoint.map.setGameStartActions(Tr.parseActions(t));break;case"checkpointCompleteActions":Xr.checkpoint.map.setCheckpointCompleteActions(Tr.parseActions(t));break;case"dialogues":Or.parse(t);break;default:return!1}return!0}}Xr.checkpoint=void 0,Xr.actionIdNum=void 0,Xr.validator=void 0;const Wr=Xr;async function Kr(e,t,a){const s=Eo.getInstance().getIsUsingMock()?gr:pr,n=Eo.getInstance().getCurrentSceneRef(),i=Eo.getInstance().getGameChapters()[t].filenames[a];if(!i)return;await rr(n,i,i),await rr(n,s.defaultCheckpoint.key,s.defaultCheckpoint.path);const r=n.cache.text.get(i),o=n.cache.text.get(s.defaultCheckpoint.key);Wr.parse(o),Wr.parse(r,!0);const c=Wr.checkpoint;n.scene.start("GameManager",{gameCheckpoint:c,continueGame:e,chapterNum:t,checkpointNum:a})}async function qr(){const e=Eo.getInstance().getCurrentSceneRef(),t=Eo.getInstance().getSSChapterSimFilenames();if(!t.length)return void e.scene.start("StorySimulatorMenu");const a=t.pop();await rr(e,a,hr(a)),await rr(e,pr.defaultCheckpoint.key,pr.defaultCheckpoint.path);const s=e.cache.text.get(a),n=e.cache.text.get(pr.defaultCheckpoint.key);Wr.parse(n),Wr.parse(s,!0);const i=Wr.checkpoint;return e.scene.start("GameManager",{gameCheckpoint:i,chapterNum:-1,checkpointNum:-1}),!0}function Zr(e,t,a){let{title:s,imageUrl:n}=t;const[i,r]=function(e){const t=Math.floor(e/dr.grid.chapPerPage);e%=dr.grid.chapPerPage;const a=Math.floor(e/dr.grid.chapPerRow),s=e%dr.grid.chapPerRow,n=(dr.grid.chapPerRow-1)/2,i=(dr.grid.chapPerCol-1)/2;let r=t*_a.x+Va.x;r+=(s-n)*(dr.imageRect.width+dr.grid.chapGapX);let o=Va.y;return o+=(a-i)*(dr.imageRect.height+dr.grid.chapGapY),[r,o]}(a),o=new Phaser.GameObjects.Container(e,i,r),c=a<=Eo.getInstance().getSaveManager().getLargestCompletedChapterNum(),l=new Phaser.GameObjects.Image(e,0,0,n).setDisplaySize(dr.imageRect.width,dr.imageRect.height),d=new Phaser.GameObjects.Sprite(e,dr.frame.xOffset,dr.frame.yOffset,gs.chapterSelectFrame.key).setScale(.99*dr.imageScale.x,.99*dr.imageScale.y),h=new Phaser.GameObjects.Rectangle(e,0,dr.chapComplete.y,dr.imageRect.width,dr.chapComplete.height,0).setOrigin(.5).setAlpha(.7).setInteractive().setVisible(c),u=Ja(e,dr.chapComplete.text,{x:0,y:dr.chapComplete.y,oriX:.5,oriY:.5},or).setVisible(c),g=new Ya(e,dr.resetButton.xOffset+8,dr.resetButton.yOffset-20,"Reset progress"),p=new Ya(e,dr.playButton.xOffset+8,dr.playButton.yOffset-20,"Play/Continue"),m=qs(e,{assetKey:gs.chapterRepeatButton.key,onUp:async()=>await Kr(!1,a,0),onHover:()=>g.setVisible(!0),onOut:()=>g.setVisible(!1)}).setPosition(dr.resetButton.xOffset,dr.resetButton.yOffset).setScale(dr.buttons.scale),x=Eo.getInstance().getSaveManager().getChapterSaveState(a).lastCheckpointPlayed,y=qs(e,{assetKey:gs.chapterContinueButton.key,onUp:async()=>await Kr(!0,a,x),onHover:()=>p.setVisible(!0),onOut:()=>p.setVisible(!1)}).setPosition(dr.playButton.xOffset,dr.playButton.yOffset).setScale(dr.buttons.scale),v=Ja(e,`Chapter ${a}`,dr.indexTextConfig,or),b=Ja(e,s,dr.titleTextConfig,cr),C=a<=Eo.getInstance().getSaveManager().getLargestCompletedChapterNum()+1,f=new Phaser.GameObjects.Rectangle(e,0,0,dr.imageRect.width,dr.imageRect.height,0).setOrigin(.5).setAlpha(C?0:.8).setInteractive();return o.add([l,d,h,u,m,y,g,p,v,b,f]),o}class Yr extends Phaser.Scene{constructor(){super("ChapterSelect"),this.layerManager=void 0,this.chaptersContainer=void 0,this.backButtonContainer=void 0,this.pageNumberText=void 0,this.targetPage=void 0,this.getGameChapters=()=>Eo.getInstance().getGameChapters(),this.getLayerManager=()=>js(this.layerManager),this.chaptersContainer=void 0,this.backButtonContainer=void 0,this.pageNumberText=void 0,this.targetPage=0}preload(){Fn(this)}async create(){Eo.getInstance().setCurrentSceneRef(this),this.layerManager=new Qn(this),await this.preloadChapterAssets(),this.renderBackground(),this.renderChapters()}update(){if(!this.chaptersContainer)return;const e=-this.targetPage*_a.x;if(this.chaptersContainer.x>e){const t=this.chaptersContainer.x-dr.scrollSpeed;this.chaptersContainer.x=Math.max(t,e)}else if(e>this.chaptersContainer.x){const t=this.chaptersContainer.x+dr.scrollSpeed;this.chaptersContainer.x=Math.min(t,e)}}cleanUp(){this.getLayerManager().clearAllLayers()}async preloadChapterAssets(){await Promise.all(this.getGameChapters().map((async e=>await ir(this,e.imageUrl,Ss(e.imageUrl,!0)))))}renderBackground(){const e=new Phaser.GameObjects.Image(this,Va.x,Va.y,gs.spaceshipBg.key),t=new Phaser.GameObjects.Rectangle(this,Va.x,Va.y,_a.x,_a.y,0).setAlpha(.3);this.getLayerManager().addToLayer(ys.Background,e),this.getLayerManager().addToLayer(ys.Background,t)}renderChapters(){this.backButtonContainer=new ji(this,(()=>{this.cleanUp(),this.scene.start("MainMenu")})),this.chaptersContainer=this.createChaptersContainer(),this.pageNumberText=Ja(this,`1 / ${this.numPages()}`,dr.pageNumberTextConfig,lr);const e=Math.min(Eo.getInstance().getSaveManager().getLargestCompletedChapterNum()+1,this.getGameChapters().length-1);this.targetPage=Math.floor(e/dr.grid.chapPerPage),this.targetPage<0&&(this.targetPage=0),this.pageNumberText.setText(`${this.targetPage+1} / ${this.numPages()}`);const t=new Phaser.GameObjects.Image(this,Va.x,Va.y,gs.chapterSelectBorder.key),a=qs(this,{assetKey:gs.chapterSelectArrow.key,onUp:()=>this.scrollPrevPage()}).setPosition(Va.x-dr.arrow.xOffset,Va.y),s=qs(this,{assetKey:gs.chapterSelectArrow.key,onUp:()=>this.scrollNextPage()}).setPosition(Va.x+dr.arrow.xOffset,Va.y).setScale(-1,1);this.getLayerManager().addToLayer(ys.UI,this.chaptersContainer),this.getLayerManager().addToLayer(ys.UI,this.backButtonContainer),this.getLayerManager().addToLayer(ys.UI,this.pageNumberText),this.getLayerManager().addToLayer(ys.UI,t),this.getLayerManager().addToLayer(ys.UI,a),this.getLayerManager().addToLayer(ys.UI,s)}createChaptersContainer(){const e=new Phaser.GameObjects.Container(this,0,0);return e.add(this.getGameChapters().map(((e,t)=>Zr(this,e,t)))).sort("depth").reverse(),e}numPages(){const e=Math.ceil(this.getGameChapters().length/dr.grid.chapPerPage);return Math.max(e,1)}scrollPrevPage(){var e;this.targetPage=Math.max(this.targetPage-1,0),null===(e=this.pageNumberText)||void 0===e||e.setText(`${this.targetPage+1} / ${this.numPages()}`)}scrollNextPage(){var e;const t=this.numPages();this.targetPage=Math.min(this.targetPage+1,t-1),null===(e=this.pageNumberText)||void 0===e||e.setText(`${this.targetPage+1} / ${t}`)}}const Jr=Yr,Qr={key:Ua.alienCowsFont.key,size:80,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},eo=1500,to={text:{chapter:"Chapter completed.",checkpoint:"Checkpoint reached."},transitionTextConfig:{x:Va.x,y:Va.y,oriX:.5,oriY:.5},tweenDuration:eo,entryTween:{alpha:1,duration:eo,ease:"Power2"},exitTween:{alpha:0,duration:eo,ease:"Power2"}};class ao extends Phaser.Scene{constructor(){super("CheckpointTransition")}preload(){Eo.getInstance().setCurrentSceneRef(this)}async create(){if(Eo.getInstance().isGameType(Po.Simulator))return await this.showTransitionText(to.text.checkpoint),void await qr();const e=Eo.getInstance().getSaveManager().getFullSaveState(),t=Eo.getInstance().getGameChapters(),[a,s]=e.userSaveState.recentlyPlayedCheckpoint;return this.isLastCheckpoint(t,a,s)?(await Eo.getInstance().getSaveManager().saveChapterComplete(a),await this.showTransitionText(to.text.chapter),this.isLastChapter(t,a)?void this.scene.start("ChapterSelect"):void await Kr(!0,a+1,0)):(await this.showTransitionText(to.text.checkpoint),void await Kr(!1,a,s+1))}async showTransitionText(e){const t=Ja(this,e,to.transitionTextConfig,Qr).setAlpha(0);this.add.existing(t),this.tweens.add({targets:t,...to.entryTween}),await Cs(2*to.tweenDuration),this.tweens.add({targets:t,...to.exitTween}),await Cs(to.tweenDuration)}isLastCheckpoint(e,t,a){return a>=e[t].filenames.length-1}isLastChapter(e,t){return t>=e.length-1}}const so=ao,no={key:Ua.zektonFont.key,size:30,align:Phaser.GameObjects.BitmapText.ALIGN_RIGHT},io={text:{chapterSelect:"Play Chapter",studentRoom:"Go to My Room",awards:"Awards Hall",settings:"Settings",bindings:"Key Bindings"},button:{ySpace:.5*_a.y},buttonTextConfig:{x:600,y:0,oriX:1,oriY:.1},banner:{xHide:300},onFocusTween:{x:Va.x+200,duration:200,ease:"Power2"},outFocusTween:{x:Va.x+300,duration:200,ease:"Power2"},saBanner:{x:.3*_a.x,y:.9*_a.y}};class ro extends Phaser.Scene{constructor(){super("MainMenu"),this.layerManager=void 0,this.getLayerManager=()=>js(this.layerManager)}async create(){Eo.getInstance().setCurrentSceneRef(this),this.layerManager=new Qn(this),this.renderBackground(),this.renderOptionButtons(),$i(this,"T",1.12*Va.x,1.1*Va.y),Eo.getInstance().getSoundManager().playBgMusic(xs.galacticHarmony.key)}renderBackground(){const e=new Phaser.GameObjects.Image(this,Va.x,Va.y,gs.spaceshipBg.key).setDisplaySize(_a.x,_a.y),t=Ts(this).setAlpha(.15),a=new Phaser.GameObjects.Image(this,io.saBanner.x,io.saBanner.y,gs.saBanner.key).setAlpha(.7);this.getLayerManager().addToLayer(ys.Background,e),this.getLayerManager().addToLayer(ys.Background,t),this.getLayerManager().addToLayer(ys.Background,a)}renderOptionButtons(){const e=new Phaser.GameObjects.Container(this,0,0),t=this.getOptionButtons(),a=Xa({direction:$a.Column,numOfItems:t.length,maxYSpace:io.button.ySpace});e.add(t.map(((e,t)=>this.createOptionButton(e.text,a[t][0]+io.banner.xHide,a[t][1],e.callback)))),this.getLayerManager().addToLayer(ys.UI,e)}createOptionButton(e,t,a,s){const n=e=>{this.tweens.add({targets:e,...io.onFocusTween})},i=e=>{this.tweens.add({targets:e,...io.outFocusTween})},r=qs(this,{assetKey:gs.mainMenuOptBanner.key,message:e,textConfig:io.buttonTextConfig,bitMapTextStyle:no,onUp:s,onHover:()=>n(r),onOut:()=>i(r),onHoverEffect:!1}).setPosition(t,a);return r}getOptionButtons(){return[{text:io.text.chapterSelect,callback:()=>{this.getLayerManager().clearAllLayers(),this.scene.start("ChapterSelect")}},{text:io.text.awards,callback:()=>{this.getLayerManager().clearAllLayers(),this.scene.start("AwardsHall")}},{text:io.text.studentRoom,callback:()=>{this.getLayerManager().clearAllLayers(),this.scene.start("RoomPreview")}},{text:io.text.settings,callback:()=>{this.getLayerManager().clearAllLayers(),this.scene.start("Settings")}},{text:io.text.bindings,callback:()=>{this.getLayerManager().clearAllLayers(),this.scene.start("Bindings")}}]}}const oo=ro;var co=a(61881),lo=a(92228);const ho='\nimport { prepend_remote_url, get_screen_width, get_screen_height, load_image, create_image, create_text, create_rect, add, set_display_size, set_alpha, set_origin } from \'game\';\n\nfunction preload() {\n    load_image("galaxy", prepend_remote_url("/locations/galaxy/normal.png"));\n}\n\nfunction create() {\n    const width = get_screen_width();\n    const height = get_screen_height();\n    const centre_x = width / 2;\n    const centre_y = height / 2;\n\n    const image = create_image(centre_x, centre_y, "galaxy");\n    const image_resized = set_display_size(image, width, height);\n\n    const black_tint = create_rect(centre_x, centre_y, width, height, 0x000011);\n    const black_tint_alpha = set_alpha(black_tint, 0.5);\n\n    const text = create_text(centre_x, centre_y, "Unable to fetch mission!");\n    const text_repos = set_origin(text, 0.5, 0.5);\n\n    add(image_resized);\n    add(black_tint_alpha);\n    add(text_repos);\n}\n\nfunction update() {}\n',uo={key:Ua.pixelFont.key,size:20,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},go={assessmentNumber:"MYROOM",verifiedText:"VERIFIED",tag:{width:128,height:50},hoverTagTextConfig:{x:64,y:0,oriX:.5,oriY:.55},refreshButton:{x:.95*_a.x,y:.92*_a.y}};var po=a(71829);async function mo(){const e=await async function(){const e=(await(0,po.$C)(Eo.getInstance().getAccountInfo())||[]).find((e=>e.number===go.assessmentNumber));return e?e.id:null}();if(!e)return xo(null);return xo(await(0,po.AZ)(e,Eo.getInstance().getAccountInfo()))}function xo(e){if(e){const t=e.questions[0],a=t.answer;return a||t.solutionTemplate}return ho}class yo extends Phaser.Scene{constructor(){super("RoomPreview"),this.layerManager=void 0,this.inputManager=void 0,this.phaseManager=void 0,this.escapeManager=void 0,this.collectibleManager=void 0,this.achievementManager=void 0,this.toolbarManager=void 0,this.dashboardManager=void 0,this.studentCode=void 0,this.preloadImageMap=void 0,this.preloadSoundMap=void 0,this.preloadSpritesheetMap=void 0,this.verifCont=void 0,this.context=void 0,this.getVerifCont=()=>js(this.verifCont),this.getUserStateManager=()=>Eo.getInstance().getUserStateManager(),this.getInputManager=()=>js(this.inputManager),this.getLayerManager=()=>js(this.layerManager),this.getPhaseManager=()=>js(this.phaseManager),this.getEscapeManager=()=>js(this.escapeManager),this.getCollectibleManager=()=>js(this.collectibleManager),this.getAchievementManager=()=>js(this.achievementManager),this.getToolbarManager=()=>js(this.toolbarManager),this.getDashboardManager=()=>js(this.dashboardManager),this.preloadImageMap=new Map,this.preloadSoundMap=new Map,this.preloadSpritesheetMap=new Map,this.studentCode=ho}init(){Eo.getInstance().setCurrentSceneRef(this),this.studentCode=Eo.getInstance().getRoomCode(),this.createContext()}preload(){Fn(this),this.verifCont=(e=>{const t=new Phaser.GameObjects.Container(e,0,0),a=new Phaser.GameObjects.Rectangle(e,0,0,go.tag.width,go.tag.height,za.darkBlue).setOrigin(0,.5).setAlpha(.8),s=new Phaser.GameObjects.Sprite(e,0,0,gs.verifiedFrame.key).setOrigin(0,.5),n=new Phaser.GameObjects.Rectangle(e,0,.5*-a.height,a.width,.05*a.height,za.offWhite).setOrigin(0,0),i=Ja(e,go.verifiedText,go.hoverTagTextConfig,uo).setBlendMode(Phaser.BlendModes.DIFFERENCE);return e.tweens.add({targets:n,alpha:.2,y:.35*a.height,duration:2e3,ease:"Power0",yoyo:!0,loop:-1}),t.add([a,i,n,s]),t.setVisible(!1),t})(this)}async create(){await this.eval(this.studentCode),this.renderDefaultBackground(),await this.eval("preload();"),await Promise.all(Array.from(this.preloadImageMap).map((async e=>{let[t,a]=e;await ir(this,t,a)}))),await Promise.all(Array.from(this.preloadSoundMap).map((async e=>{let[t,a]=e;var s,n,i;await(s=this,n=t,i=a,new Promise((e=>{null!==s.sound.get(n)?e(n):(s.load.audio(n,i).on("filecomplete",e),s.load.start())})))}))),await Promise.all(Array.from(this.preloadSpritesheetMap).map((async e=>{let[t,[a,s]]=e;await((e,t,a,s)=>new Promise((n=>{"__MISSING"!==e.textures.get(t).key?n(t):(e.load.spritesheet(t,a,s),e.load.once(`filecomplete-spritesheet-${t}`,n),e.load.once("loaderror",n),e.load.start())})))(this,t,a,s)})));const e=new Ya(this,go.refreshButton.x-200,go.refreshButton.y-30,"Refresh Room"),t=qs(this,{assetKey:gs.chapterRepeatButton.key,onUp:async()=>{await Eo.getInstance().loadRoomCode(),this.studentCode=Eo.getInstance().getRoomCode(),this.getLayerManager().clearAllLayers(),this.sound.stopAll(),this.scene.restart()},onHover:()=>e.setVisible(!0),onOut:()=>e.setVisible(!1)}).setPosition(go.refreshButton.x,go.refreshButton.y);await this.eval("create();"),Eo.getInstance().getSoundManager().playBgMusic(Fa.nullInteractionId),this.initialiseManagers(),this.bindKeyboardTriggers(),this.getLayerManager().addToLayer(ys.UI,this.getVerifCont()),this.getLayerManager().addToLayer(ys.UI,t),this.getLayerManager().addToLayer(ys.UI,e),this.getToolbarManager().renderToolbarContainer()}update(){this.eval("update();")}createContext(){this.context=(0,lo.kr)(k.Chapter.SOURCE_4,[],"playground",k.Variant.DEFAULT),this.context.moduleContexts.game={tabs:null,state:{scene:this,preloadImageMap:this.preloadImageMap,preloadSoundMap:this.preloadSoundMap,preloadSpritesheetMap:this.preloadSpritesheetMap,remotePath:e=>Ss(e,!0),screenSize:_a,createAward:(e,t,a)=>this.createAward(e,t,a)}}}async eval(e){await(0,co.runInContext)(e,this.context)}bindKeyboardTriggers(){this.getInputManager().registerKeyboardListener(Phaser.Input.Keyboard.KeyCodes.ESC,"up",(async()=>{this.getPhaseManager().isCurrentPhaseTerminal()?await this.getPhaseManager().popPhase():await this.getPhaseManager().pushPhase(en.EscapeMenu)})),this.getInputManager().registerKeyboardListener(Phaser.Input.Keyboard.KeyCodes.TAB,"up",(async()=>{this.getPhaseManager().isCurrentPhase(en.Dashboard)?await this.getPhaseManager().popPhase():this.getPhaseManager().isCurrentPhaseTerminal()?await this.getPhaseManager().swapPhase(en.Dashboard):await this.getPhaseManager().pushPhase(en.Dashboard)}))}cleanUp(){this.getInputManager().clearListeners(),this.getLayerManager().clearAllLayers()}createAward(e,t,a){const s=this.getUserStateManager().getAchievements(),n=this.getUserStateManager().getCollectibles(),i=new Phaser.GameObjects.Sprite(this,e,t,gs.cookies.key);if(!s.includes(a)&&!n.includes(a))return i;const r=ds(a);if(!r.completed)return i;const o=new Phaser.GameObjects.Sprite(this,e,t,r.assetKey);return this.attachVerificationTag(o)}attachVerificationTag(e){const t=this.getVerifCont();return e.setInteractive({pixelPerfect:!0,useHandCursor:!0}),e.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,(()=>t.setVisible(!0))),e.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,(()=>t.setVisible(!1))),e.addListener(Phaser.Input.Events.GAMEOBJECT_POINTER_MOVE,(e=>{t.x=e.x+10,t.y=e.y-10})),e}renderDefaultBackground(){const e=new Phaser.GameObjects.Image(this,Va.x,Va.y,this.getDefaultBackgroundKey());pn(e,_a.x,_a.y),this.add.existing(e)}getDefaultBackgroundKey(){const e=this.getUserStateManager().getAssessments().reverse(),t=Eo.getInstance().getRoomPreviewMapping();for(let a=0;a<e.length;a++)if(t.has(e[a]))return e[a];return gs.sourceCrashedPod.key}initialiseManagers(){this.layerManager=new Qn(this),this.inputManager=new Jn(this),this.phaseManager=new ri(new Map([[en.None,new Di]]),this.inputManager),this.escapeManager=new Yn(this),this.collectibleManager=new xn(this,Eo.getInstance().getUserStateManager().getCollectibles),this.achievementManager=new xn(this,Eo.getInstance().getUserStateManager().getAchievements),this.toolbarManager=new bi(this),this.dashboardManager=new wn(this,[jn.Collectibles,jn.Achievements],[this.collectibleManager,this.achievementManager])}}class vo extends Phaser.Scene{constructor(){super("Settings"),this.bgmVolumeRadioButtons=void 0,this.sfxVolumeRadioButtons=void 0,this.layerManager=void 0,this.getSaveManager=()=>Eo.getInstance().getSaveManager(),this.getLayerManager=()=>js(this.layerManager)}async create(){Eo.getInstance().setCurrentSceneRef(this),this.layerManager=new Qn(this),this.renderBackground(),this.renderOptions()}renderBackground(){const e=new Phaser.GameObjects.Image(this,Va.x,Va.y,gs.spaceshipBg.key),t=new Phaser.GameObjects.Image(this,Va.x,Va.y,gs.settingBanner.key);this.getLayerManager().addToLayer(ys.Background,e),this.getLayerManager().addToLayer(ys.Background,t)}renderOptions(){const e=new Phaser.GameObjects.Container(this,0,0),t=this.getSettingsHeader(),a=Xa({direction:$a.Column,numOfItems:t.length,maxYSpace:Xn.opt.ySpace});e.add(t.map(((e,t)=>this.createOptionHeader(e,a[t][1]))));const{bgmVolume:s,sfxVolume:n}=this.getSaveManager().getSettings(),i=Xn.volContainerOpts.findIndex((e=>parseFloat(e)===n)),r=Xn.volContainerOpts.findIndex((e=>parseFloat(e)===s));this.sfxVolumeRadioButtons=this.createOptRadioOptions(i,a[0][1]),this.bgmVolumeRadioButtons=this.createOptRadioOptions(r,a[1][1]);const o=qs(this,{assetKey:gs.mediumButton.key,message:"Apply Settings",textConfig:{x:0,y:0,oriX:.33,oriY:.85},bitMapTextStyle:$n,onUp:()=>this.applySettings()}).setPosition(Va.x,.925*_a.y),c=new ji(this,(()=>{this.getLayerManager().clearAllLayers(),this.scene.start("MainMenu")}));this.getLayerManager().addToLayer(ys.UI,e),this.getLayerManager().addToLayer(ys.UI,this.sfxVolumeRadioButtons),this.getLayerManager().addToLayer(ys.UI,this.bgmVolumeRadioButtons),this.getLayerManager().addToLayer(ys.UI,o),this.getLayerManager().addToLayer(ys.UI,c)}getSettingsHeader(){return["SFX","BGM"]}createOptionHeader(e,t){const a=new Phaser.GameObjects.Container(this,0,t),s=new Phaser.GameObjects.Image(this,Va.x,0,gs.settingOption.key),n=Ja(this,e,Xn.optHeaderTextConfig,zn);return a.add([s,n]),a}createOptRadioOptions(e,t){return new Vn(this,{choices:Xn.volContainerOpts,defaultChoiceIdx:e,maxXSpace:Xn.opt.xSpace,choiceTextConfig:Xn.radioButtonsTextConfig,bitmapTextStyle:Hn},Xn.opt.x,-Va.y+t)}async applySettings(){const e=this.sfxVolumeRadioButtons?parseFloat(this.sfxVolumeRadioButtons.getChosenChoice()):1,t=this.bgmVolumeRadioButtons?parseFloat(this.bgmVolumeRadioButtons.getChosenChoice()):1;await this.getSaveManager().saveSettings({bgmVolume:t,sfxVolume:e}),Eo.getInstance().getSoundManager().applyUserSettings(this.getSaveManager().getSettings())}}const bo=vo;const Co=class{constructor(){this.soundAssetMap=void 0,this.bgmVol=void 0,this.sfxVol=void 0,this.currBgMusicKey=void 0,this.currBgMusic=void 0,this.getBaseSoundManager=()=>this.getCurrentScene().sound,this.getCurrentScene=()=>js(Eo.getInstance().getCurrentSceneRef()),this.soundAssetMap=new Map,this.bgmVol=1,this.sfxVol=1,this.currBgMusicKey=Fa.nullInteractionId}applyUserSettings(e){if(this.bgmVol=void 0!==e.bgmVolume?e.bgmVolume:1,this.sfxVol=void 0!==e.sfxVolume?e.sfxVolume:1,this.currBgMusic&&this.currBgMusic.isPlaying){const e=js(this.getSoundAsset(this.currBgMusicKey)),t=void 0!==e.config.volume?e.config.volume:1;this.currBgMusic.setVolume(t*this.bgmVol)}}addSoundAsset(e){this.soundAssetMap.set(e.key,e)}getSoundAsset(e){return this.soundAssetMap.get(e)}loadSounds(e){e.forEach((e=>{this.addSoundAsset(e),this.loadSound(e.key,Ss(e.path,!0))}))}loadSoundAssetMap(e){Object.values(e).forEach((e=>{this.addSoundAsset(e),this.loadSound(e.key,Ss(e.path,!1))}))}loadSound(e,t){this.getCurrentScene().load.audio(e,t)}playSound(e){const t=this.getSoundAsset(e);if(t){const e=void 0!==t.config.volume?t.config.volume:1;this.getBaseSoundManager().play(t.key,{...t.config,volume:e*this.sfxVol})}}playBgMusic(e,t){if(!Eo.getInstance().isMounted)return;if(this.currBgMusicKey===e)return;if(e===Fa.nullInteractionId&&this.currBgMusic)return this.fadeOutAndDestroyMusic(this.currBgMusic,t),this.currBgMusic=void 0,void(this.currBgMusicKey=e);this.currBgMusic&&this.fadeOutAndDestroyMusic(this.currBgMusic);const a=js(this.getSoundAsset(e)),s=void 0!==a.config.volume?a.config.volume:1;this.currBgMusic=this.getBaseSoundManager().add(a.key,{...a.config,volume:s*this.bgmVol}),this.currBgMusicKey=a.key,this.currBgMusic.play()}fadeOutAndDestroyMusic(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;this.getCurrentScene().tweens.add({targets:e,...ps,duration:t}),setTimeout((()=>e.destroy()),2*t)}stopAllSound(){this.getBaseSoundManager().stopAll()}pauseCurrBgMusic(){this.getCurrentScene()&&this.currBgMusic&&this.currBgMusic.isPlaying&&this.currBgMusic.pause()}continueCurrBgMusic(){this.getCurrentScene()&&this.currBgMusic&&this.currBgMusic.isPaused&&this.currBgMusic.play()}};var fo=a(18371);const So=[{title:"Spaceship Emergency",imageUrl:"/locations/planet-y-orbit/crashing.png",filenames:["../../assets/mockChapter0.txt","../../assets/mockChapter0.1.txt"]},{title:"Alien Attack",imageUrl:"/locations/telebay/emergency.png",filenames:["../../assets/mockChapter1.txt"]},{title:"Jedi Master",imageUrl:"/locations/classroom/normal.png",filenames:["../../assets/mockChapter2.txt"]}];class jo{static parse(e){jo.awardsMapping=new Map;const t=An.splitToLines(e);return An.splitToParagraph(t).forEach((e=>{let[,t]=e;jo.parseAwardParagraphs(t)})),this.awardsMapping}static parseAwardParagraphs(e){An.splitToParagraph(e).forEach((e=>{let[t,a]=e;const[s,n,i,r]=An.splitWithLimit(a[0],",",3);jo.awardsMapping.set(t,{id:t,assetKey:s,assetPath:Ss(n,!0),title:i,description:r,completed:!0})}))}}jo.awardsMapping=void 0;const wo=jo;class Io{static parse(e){Io.backgroundMapping=new Map;const t=An.splitToLines(e);return An.splitToParagraph(t).forEach((e=>{let[t,a]=e;Io.backgroundMapping.set(t,Ss(a[0],!0))})),Io.backgroundMapping}}Io.backgroundMapping=void 0;const ko=Io;class Mo extends Phaser.Scene{constructor(){super("Entry")}async preload(){Eo.getInstance().setCurrentSceneRef(this),this.preloadAssets(),Fn(this),await Eo.getInstance().loadGameChapters(),await Eo.getInstance().loadRoomCode(),await Eo.getInstance().getSaveManager().loadLastSaveState()}async create(){await this.preloadAwards(),await Eo.getInstance().getUserStateManager().loadUserState(),await this.preloadRoomPreviewBackgrounds(),this.applyLoadedSettings(),this.scene.start("MainMenu")}applyLoadedSettings(){const e=Eo.getInstance().getSaveManager().getSettings();Eo.getInstance().getSoundManager().applyUserSettings(e)}async preloadAwards(){const e=this.cache.text.get(pr.awardsMapping.key)||"",t=wo.parse(e);Eo.getInstance().setAwardsMapping(t),await Promise.all(Array.from(t.values()).map((async e=>await ir(this,e.assetKey,e.assetPath))))}async preloadRoomPreviewBackgrounds(){const e=this.cache.text.get(pr.roomPreviewMapping.key)||"",t=ko.parse(e);Eo.getInstance().setRoomPreviewMapping(t),await Promise.all(Array.from(t.entries()).map((async e=>{let[t,a]=e;return await ir(this,t,a)})))}preloadAssets(){Eo.getInstance().getSoundManager().loadSoundAssetMap(xs),Object.values(gs).forEach((e=>this.load.image(e.key,Ss(e.path,!1)))),Object.values(Ua).forEach((e=>this.load.bitmapFont(e.key,e.pngPath,e.fntPath))),Object.values(pr).forEach((e=>this.load.text(e.key,e.path)))}}const Ao=Mo;class To{constructor(){this.collectibles=void 0,this.achievements=void 0,this.assessments=void 0,this.getCollectibles=()=>Array.from(this.collectibles),this.getAchievements=()=>Array.from(this.achievements),this.getAssessments=()=>Array.from(this.assessments),this.collectibles=new Set([]),this.achievements=new Set([]),this.assessments=new Set([])}async loadUserState(){Eo.getInstance().isGameType(Po.Simulator)||(await this.loadAchievements(),await this.loadAssessments(),this.collectibles=new Set(Eo.getInstance().getSaveManager().getLoadedUserState().collectibles))}addCollectible(e){this.collectibles.add(e)}async loadAssessments(){const e=await(0,po.$C)(Eo.getInstance().getAccountInfo());this.assessments=new Set((e||[]).filter((e=>"submitted"===e.status)).sort(((e,t)=>e.closeAt<=t.closeAt?-1:1)).map((e=>e.id.toString())))}async isInUserState(e,t){if(Eo.getInstance().isGameType(Po.Game))return this[e].has(t);return 0===await Qs(sn.getInstance().getGameManager(),`${An.capitalize(e)} ${t}?`,["Yes","No"])}async loadAchievements(){const e=Eo.getInstance().getAwardsMapping(),t=Eo.getInstance().getAchievements(),a=Eo.getInstance().getGoals(),s=new Map;a.forEach((e=>s.set(e.uuid,e))),t.forEach((t=>{const a=t.uuid.toString(),n=t.goalUuids.reduce(((e,t)=>{var a;return e&&!(null===(a=s.get(t))||void 0===a||!a.completed)}),!0),i=e.get(a);if(i){const e={...i,completed:n};Eo.getInstance().addAwardMapping(e.assetKey,e),this.achievements.add(e.assetKey)}}))}}let Po;!function(e){e.Simulator="Simulator",e.Game="Game"}(Po||(Po={}));class Eo extends Ga.Game{constructor(e,t){super(e),this.global=void 0,this.isMounted=void 0,this.getAwardsMapping=()=>js(this.global.awardsMapping),this.getAccountInfo=()=>js(this.global.accountInfo),this.getAchievements=()=>js(this.global.achievements),this.getSoundManager=()=>js(this.global.soundManager),this.getGoals=()=>js(this.global.goals),this.getRoomPreviewMapping=()=>js(this.global.roomPreviewMapping),this.getUserStateManager=()=>js(this.global.userStateManager),this.getSaveManager=()=>js(this.global.saveManager),this.getCurrentSceneRef=()=>js(this.global.currentSceneRef),this.isGameType=e=>this.global.gameType===e,this.getSSChapterSimFilenames=()=>this.global.ssChapterSimFilenames,this.getIsUsingMock=()=>this.global.isUsingMock,this.getRoomCode=()=>this.global.roomCode,this.getGameChapters=()=>this.global.isUsingMock?So:this.global.gameChapters,Eo.instance=this,this.isMounted=!0,this.global={awardsMapping:new Map,accountInfo:void 0,achievements:void 0,currentSceneRef:void 0,gameChapters:[],gameType:t,goals:void 0,isUsingMock:!1,roomCode:"",roomPreviewMapping:new Map,saveManager:new Fi,setStorySimState:Fa.nullFunction,soundManager:new Co,ssChapterSimFilenames:[],userStateManager:new To}}stopAllSounds(){this.sound.stopAll()}setAccountInfo(e){this.global.accountInfo=e}setAchievements(e){this.global.achievements=e}setAwardsMapping(e){this.global.awardsMapping=e}addAwardMapping(e,t){this.global.awardsMapping.set(e,t)}setGoals(e){this.global.goals=e}setStorySimStateSetter(e){this.setStorySimState=e}setRoomPreviewMapping(e){this.global.roomPreviewMapping=e}async loadGameChapters(){this.global.gameChapters=await async function(){const e=bs.h.getState().session.courseId,t=await(0,fo.WY)(`courses/${e}/stories`,"GET",{accessToken:Eo.getInstance().getAccountInfo().accessToken,refreshToken:Eo.getInstance().getAccountInfo().refreshToken});if(!t)return[];const a=200===t.status?await t.json():[],s=S().sortBy(a,(e=>new Date(e.openAt)));return s.forEach((e=>e.filenames=e.filenames.map(hr))),s}()}async loadRoomCode(){this.global.roomCode=await mo()}setStorySimState(e){this.global.setStorySimState(e)}setCurrentSceneRef(e){this.global.currentSceneRef=e}toggleUsingMock(e){this.global.isUsingMock=void 0===e?!this.global.isUsingMock:e}setChapterSimStack(e){this.global.ssChapterSimFilenames=e.reverse()}}Eo.instance=void 0,Eo.getInstance=()=>js(Eo.instance);const No={debug:!0,type:Ga.CANVAS,width:_a.x,height:_a.y,physics:{default:"arcade"},scale:{mode:Ga.Scale.FIT,parent:"game-display"},fps:{target:24},scene:[Ao,oo,bo,Jr,Ui,so,Qi,yo,nr]},Oo=()=>new Eo(No,Po.Game);async function Do(e){if("student"!==Eo.getInstance().getAccountInfo().role)return;const t={method:"PUT",headers:Ro(Eo.getInstance().getAccountInfo().accessToken),body:JSON.stringify({gameStates:e})},a=await fetch(`${g.Z.backendUrl}/v2/courses/${ws()}/user/game_states`,t);return a&&a.ok?a:void 0}function Ro(e){const t=new Headers;return t.append("Accept","application/json"),t.append("Authorization",`Bearer ${e}`),t.append("Content-Type","application/json"),t}const Bo=function(){const e=(0,x.ix)((e=>e.session)),t=(0,c.I0)(),a=(0,x.ix)((e=>e.achievement.achievements)),s=(0,x.ix)((e=>e.achievement.goals)),[n,i]=o.useState(!1),[r,l]=o.useState(!1);return o.useEffect((()=>{t((0,Me.getAchievements)()),t((0,Me.getOwnGoals)())}),[t]),o.useEffect((()=>{const e=Oo();return()=>{e.isMounted=!1,e.stopAllSounds(),e.destroy(!0)}}),[]),o.useEffect((()=>{Eo.getInstance().setAccountInfo({accessToken:e.accessToken,refreshToken:e.refreshToken,role:e.role,name:e.name}),Eo.getInstance().setAchievements(a),Eo.getInstance().setGoals(s)}),[e,a,s]),(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{id:"game-display"}),n&&(0,p.jsxs)("div",{className:"Horizontal",children:[(0,p.jsx)("button",{onClick:async()=>{await Do({}),alert("Game cleared! Please refresh")},children:"Clear data"}),(0,p.jsx)("button",{onClick:()=>{l(!r),Eo.getInstance().toggleUsingMock()},children:r?"Use Game Chapters":"Use Mock Chapters"})]})]})};a(22750);var Lo=a(96673),Go=a(99018),Uo=a(1407);const Fo=e=>{let{submissionId:t}=e;const a=(0,c.I0)(),s=(0,x.ix)((e=>e.session.courseId));return(0,p.jsxs)(Lo.kC,{justifyContent:"justify-start",spaceX:"space-x-2",children:[(0,p.jsx)(j.rU,{to:`/courses/${s}/grading/${t}`,children:(0,p.jsx)(Lo.JO,{tooltip:"Grade",icon:()=>(0,p.jsx)(n.JO,{icon:b.d.EDIT}),variant:"light"})}),(0,p.jsx)("button",{type:"button",style:{padding:0},onClick:async()=>{await(0,Ne.pG)({contents:(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("p",{children:"Reautograde this submission?"}),(0,p.jsx)("p",{children:"Note: all manual adjustments will be reset to 0."})]}),positiveIntent:"danger",positiveLabel:"Reautograde"})&&a((0,u.reautogradeSubmission)(t))},children:(0,p.jsx)(Lo.JO,{tooltip:"Reautograde",icon:()=>(0,p.jsx)(n.JO,{icon:b.d.REFRESH}),variant:"simple"})}),(0,p.jsx)("button",{type:"button",style:{padding:0},onClick:async()=>{await(0,Ne.pG)({contents:"Are you sure you want to unsubmit?",positiveIntent:"danger",positiveLabel:"Unsubmit"})&&a((0,u.unsubmitSubmission)(t))},children:(0,p.jsx)(Lo.JO,{tooltip:"Unsubmit",icon:()=>(0,p.jsx)(n.JO,{icon:b.d.UNDO}),variant:"simple"})})]})},_o={missions:"indigo",quests:"emerald",paths:"sky",submitted:"green",attempting:"yellow",attempted:"red",graded:"green",grading:"yellow",none:"red"};function Vo(e){return _o[e.toLowerCase()]||"gray"}const Ho=e=>{let{type:t,size:a="sm"}=e;return(0,p.jsx)(Lo.Ct,{text:"xs"===a?t.charAt(0).toUpperCase():t,size:a,color:Vo(t)})},zo=e=>{let{status:t}=e;const a=t.charAt(0).toUpperCase()+t.slice(1);return(0,p.jsx)(Lo.Ct,{text:a,color:Vo(t)})},$o=e=>{let{status:t}=e;const a=t.charAt(0).toUpperCase()+t.slice(1);return(0,p.jsx)(Lo.Ct,{text:a,color:Vo(t),icon:()=>(0,p.jsx)(n.JO,{icon:"graded"===t?b.d.TICK:"grading"===t?b.d.TIME:"none"===t?b.d.CROSS:b.d.DISABLE,style:{marginRight:"0.5rem"}})})},Xo=e=>{let{filter:t,onRemove:a}=e,s=t.value;return s=s.charAt(0).toUpperCase()+s.slice(1),(0,p.jsx)("button",{type:"button",onClick:()=>a(t),style:{padding:0},children:(0,p.jsx)(Lo.Ct,{text:s,icon:()=>(0,p.jsx)(n.JO,{icon:b.d.CROSS,style:{marginRight:"0.25rem"}}),color:Vo(s)})})},Wo=e=>{let{filters:t,onFilterRemove:a}=e;return(0,p.jsx)(Lo.kC,{justifyContent:"justify-start",spaceX:"space-x-1",children:t.map((e=>(0,p.jsx)(Xo,{filter:e,onRemove:a},e.id)))})},Ko=(0,Go.Cl)(),qo=[Ko.accessor("assessmentName",{header:"Name",cell:e=>(0,p.jsx)(Zo,{column:e.column,value:e.getValue()})}),Ko.accessor("assessmentType",{header:"Type",cell:e=>(0,p.jsx)(Zo,{column:e.column,value:e.getValue(),children:(0,p.jsx)(Ho,{type:e.getValue()})})}),Ko.accessor("studentName",{header:"Student",cell:e=>(0,p.jsx)(Zo,{column:e.column,value:e.getValue()})}),Ko.accessor("groupName",{header:"Group",cell:e=>(0,p.jsx)(Zo,{column:e.column,value:e.getValue()})}),Ko.accessor("submissionStatus",{header:"Progress",cell:e=>(0,p.jsx)(Zo,{column:e.column,value:e.getValue(),children:(0,p.jsx)(zo,{status:e.getValue()})})}),Ko.accessor("gradingStatus",{header:"Grading",cell:e=>(0,p.jsx)(Zo,{column:e.column,value:e.getValue(),children:(0,p.jsx)($o,{status:e.getValue()})})}),Ko.accessor((e=>{let{currentXp:t,maxXp:a}=e;return{currentXp:t,maxXp:a}}),{header:"XP",enableColumnFilter:!1,cell:e=>{const{currentXp:t,maxXp:a}=e.getValue();return(0,p.jsxs)(Lo.kC,{justifyContent:"justify-start",spaceX:"space-x-2",children:[(0,p.jsx)(Lo.xv,{children:t}),(0,p.jsx)(Lo.xv,{children:"/"}),(0,p.jsx)(Lo.xv,{children:a})]})}}),Ko.accessor((e=>{let{submissionId:t}=e;return{submissionId:t}}),{header:"Actions",enableColumnFilter:!1,cell:e=>{const{submissionId:t}=e.getValue();return(0,p.jsx)(Fo,{submissionId:t})}})],Zo=e=>{let{column:t,value:a,children:s}=e;return(0,p.jsx)("button",{type:"button",onClick:()=>{t.setFilterValue(a)},style:{padding:0},children:s||a})},Yo=e=>{let{group:t,submissions:a}=e;const s=(0,c.I0)(),i=(0,x.ix)((e=>e.workspaces.grading.submissionsTableFilters)),r=[];t&&!i.columnFilters.find((e=>"groupName"===e.id))&&r.push({id:"groupName",value:t});const[l,d]=(0,o.useState)([...i.columnFilters,...r]),[h,u]=(0,o.useState)(i.globalFilter),g=(0,Uo.b7)({data:a,columns:qo,state:{columnFilters:l,globalFilter:h},onColumnFiltersChange:d,onGlobalFilterChange:u,getCoreRowModel:(0,Go.sC)(),getFilteredRowModel:(0,Go.vL)(),getPaginationRowModel:(0,Go.G_)()});return(0,o.useEffect)((()=>{s((0,ue.updateSubmissionsTableFilters)({columnFilters:l,globalFilter:h}))}),[l,h,s]),(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(Lo.kC,{marginTop:"mt-2",justifyContent:"justify-between",alignItems:"items-center",children:[(0,p.jsxs)(Lo.kC,{alignItems:"items-center",spaceX:"space-x-2",children:[(0,p.jsxs)("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",height:"1.75rem"},children:[(0,p.jsx)(n.JO,{icon:b.d.FILTER_LIST}),(0,p.jsxs)(Lo.xv,{children:[l.length>0?"Filters: ":"No filters applied. Click on any cell to filter by its value."," "]})]}),(0,p.jsx)(Wo,{filters:l,onFilterRemove:e=>{let{id:t,value:a}=e;const s=l.filter((e=>e.id!==t&&e.value!==a));d(s)}})]}),(0,p.jsx)(Lo.oi,{maxWidth:"max-w-sm",icon:()=>(0,p.jsx)(n.JO,{icon:b.d.SEARCH,style:{marginLeft:"0.75rem"}}),placeholder:"Search for any value here...",onChange:e=>u(e.target.value)})]}),(0,p.jsxs)(Lo.iA,{marginTop:"mt-2",children:[(0,p.jsx)(Lo.ss,{children:g.getHeaderGroups().map((e=>(0,p.jsx)(Lo.SC,{children:e.headers.map((e=>(0,p.jsx)(Lo.xs,{children:e.isPlaceholder?null:(0,Uo.ie)(e.column.columnDef.header,e.getContext())},e.id)))},e.id)))}),(0,p.jsx)(Lo.RM,{children:g.getRowModel().rows.map((e=>(0,p.jsx)(Lo.SC,{children:e.getVisibleCells().map((e=>(0,p.jsx)(Lo.pj,{children:(0,Uo.ie)(e.column.columnDef.cell,e.getContext())},e.id)))},e.id)))}),(0,p.jsx)(Lo.$_,{children:(0,p.jsxs)(Lo.kC,{justifyContent:"justify-center",spaceX:"space-x-3",children:[(0,p.jsx)(Lo.zx,{size:"xs",icon:()=>(0,p.jsx)(n.JO,{icon:b.d.ARROW_LEFT}),variant:"light",onClick:()=>g.previousPage(),disabled:!g.getCanPreviousPage()}),(0,p.jsxs)(Lo.d8,{children:["Page ",g.getState().pagination.pageIndex+1," of ",g.getPageCount()]}),(0,p.jsx)(Lo.zx,{size:"xs",icon:()=>(0,p.jsx)(n.JO,{icon:b.d.ARROW_RIGHT}),variant:"light",onClick:()=>g.nextPage(),disabled:!g.getCanNextPage()})]})})]})]})},Jo=e=>{let{group:t,submissions:a,assessments:s}=e;a=a.filter((e=>{let{assessmentType:t}=e;return"Paths"!==t}));const n=a.filter((e=>{let{groupName:a}=e;return null===t||a===t})),i=n.filter((e=>{let{gradingStatus:t}=e;return t!==A.TD.graded})),r=[...new Set(i.map((e=>{let{assessmentId:t}=e;return t})))].reduce(((e,t)=>{const a=s.find((e=>e.id===t));return a?[...e,{id:t,type:a.type,title:a.title}]:e}),[]),o=n.length,c=o-i.length,l=Math.round(c/o*100);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(Lo.Dx,{children:"My gradings"}),(0,p.jsxs)(Lo.kC,{marginTop:"mt-4",justifyContent:"justify-start",spaceX:"space-x-1",alignItems:"items-baseline",children:[(0,p.jsxs)(Lo.jb,{children:[c," "]}),(0,p.jsxs)(Lo.xv,{children:["/ ",o," graded"]})]}),(0,p.jsx)(Lo.ko,{percentageValue:l,color:l<50?"red":"emerald",marginTop:"mt-4"}),(0,p.jsxs)(Lo.kC,{marginTop:"mt-4",children:[(0,p.jsxs)(Lo.gO,{children:[(0,p.jsx)(Lo.xv,{children:"Graded"}),(0,p.jsxs)(Lo.xv,{color:l<50?"red":"emerald",children:[(0,p.jsx)(Lo.d8,{children:c})," (",l,"%)"]})]}),(0,p.jsxs)(Lo.gO,{children:[(0,p.jsx)(Lo.xv,{textAlignment:"text-right",children:"Ungraded"}),(0,p.jsxs)(Lo.xv,{textAlignment:"text-right",children:[(0,p.jsx)(Lo.d8,{children:o-c})," (",100-l,"%)"]})]})]}),(0,p.jsx)(Lo.xv,{marginTop:"mt-6",children:(0,p.jsx)(Lo.d8,{children:"Ungraded assessments"})}),0===r.length?(0,p.jsx)(Lo.xv,{marginTop:"mt-4",children:"\ud83c\udf89 Good job! You've graded everything! \ud83c\udf89"}):(0,p.jsx)(Lo.aV,{marginTop:"mt-1",children:r.map((e=>{let{id:t,title:a,type:s}=e;return(0,p.jsx)(Lo.HC,{children:(0,p.jsxs)(Lo.kC,{justifyContent:"justify-start",spaceX:"space-x-1",children:[(0,p.jsx)(Ho,{type:s,size:"xs"}),(0,p.jsx)("span",{children:a}),(0,p.jsx)(Lo.Ct,{size:"xs",color:"red",text:(n=t,i.filter((e=>{let{assessmentId:t}=e;return t===n})).length).toString()})]})},t);var n}))})]})},Qo=e=>{let{submissions:t,handleCsvExport:a}=e;const s=(0,x.ix)((e=>e.session.group)),i=(0,x.ix)((e=>e.session.assessmentOverviews))||[],[r,c]=(0,o.useState)(!1),l=t.filter((e=>!("submitted"===e.submissionStatus&&e.gradingStatus===A.TD.graded))),d=r?t:l;return(0,p.jsxs)(Lo.z2,{numColsLg:8,gapX:"gap-x-4",gapY:"gap-y-2",children:[(0,p.jsx)(Lo.JX,{numColSpanLg:6,children:(0,p.jsxs)(Lo.Zb,{children:[(0,p.jsxs)(Lo.kC,{justifyContent:"justify-between",children:[(0,p.jsxs)(Lo.kC,{justifyContent:"justify-start",spaceX:"space-x-6",children:[(0,p.jsx)(Lo.Dx,{children:"Submissions"}),(0,p.jsx)(Lo.zx,{variant:"light",size:"xs",icon:()=>(0,p.jsx)(n.JO,{icon:b.d.EXPORT,style:{marginRight:"0.5rem"}}),onClick:a,children:"Export to CSV"})]}),(0,p.jsxs)(Lo.ZD,{color:"gray",defaultValue:!1,handleSelect:e=>{c(e)},children:[(0,p.jsx)(Lo.HP,{value:!1,text:"Ungraded"}),(0,p.jsx)(Lo.HP,{value:!0,text:"All"})]})]}),(0,p.jsx)(Yo,{group:s,submissions:d})]})}),(0,p.jsx)(Lo.JX,{numColSpanLg:2,children:(0,p.jsx)(Lo.Zb,{hFull:!0,children:(0,p.jsx)(Jo,{group:s,submissions:t,assessments:i})})})]})};var ec=a(21288);const tc="grading-editor-button",ac={header:[b.d.HEADER,"Header Styles"],bold:[b.d.BOLD,"Bold"],italic:[b.d.ITALIC,"Italic"],strikethrough:[b.d.STRIKETHROUGH,"Strikethrough"],link:[b.d.LINK,"Link"],quote:[b.d.CITATION,"Quote"],code:[b.d.CODE,"Monospaced"],image:[b.d.MEDIA,"Image"],"unordered-list":[b.d.UNGROUP_OBJECTS,"Bullets"],"ordered-list":[b.d.NUMBERED_LIST,"Numbering"],"checked-list":[b.d.SQUARE,"Checkboxes"]},sc=e=>{switch(e){case"header":case"bold":case"italic":case"strikethrough":case"link":case"quote":case"code":case"image":case"unordered-list":case"ordered-list":case"checked-list":const[t,a]=ac[e];return{iconName:t,title:a};default:return{iconName:b.d.HELP}}},nc=e=>{const[t,a]=(0,o.useState)(e.xpAdjustment.toString()),[s,i]=(0,o.useState)(e.comments),[r,c]=(0,o.useState)("write"),[l,d]=(0,o.useState)(!1);(0,o.useEffect)((()=>{u()}),[e.submissionId,e.questionId]);const u=()=>{a(e.xpAdjustment.toString()),i(e.comments),c("write"),d(!1)};const g=a=>()=>{const n=(0,de.GA)(t||void 0)||void 0,i=e.initialXp+(n||0);i<0||i>e.maxXp?(0,T.N9)(`XP ${i.toString()} is out of bounds. Maximum xp is ${e.maxXp.toString()}.`):a(e.submissionId,e.questionId,n,s)},m=()=>{const a=(0,de.GA)(t||void 0);return e.xpAdjustment!==a||e.comments!==s},x=m(),y={intent:x?h.S.WARNING:h.S.NONE,minimal:!x,className:tc},C={intent:x?h.S.DANGER:h.S.NONE,minimal:!x,className:tc},f={intent:x?h.S.SUCCESS:h.S.NONE,minimal:!x,className:tc},S=e.initialXp+((0,de.GA)(t||void 0)||0),j=`${e.initialXp>0?"-":""}${e.initialXp} to ${e.maxXp-e.initialXp}`;return(0,p.jsxs)("div",{className:"GradingEditor",children:[(0,p.jsx)(Kt.N,{when:!l&&x,message:"You have unsaved changes. Are you sure you want to leave?"}),(0,p.jsx)("div",{className:"grading-editor-header",children:(0,p.jsxs)(n.H3,{children:["Currently Grading: ",e.studentName]})}),null!==e.solution?(0,p.jsx)("div",{className:"grading-editor-marking-scheme",children:(0,p.jsxs)(n.SU,{children:[e.solution.toString()," "]})}):null,(0,p.jsx)("div",{className:"grading-editor-container",children:(0,p.jsxs)("div",{className:"grading-editor-xp",children:[(0,p.jsxs)("div",{className:"autograder-xp",children:[(0,p.jsx)("div",{children:"Autograder XP:"}),(0,p.jsxs)("div",{children:[`${e.initialXp} / ${e.maxXp}`," ",(0,p.jsx)(n.zx,{icon:"refresh",small:!0,minimal:!0,onClick:async()=>{await(0,Ne.pG)({contents:(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("p",{children:"Reautograde this answer?"}),(0,p.jsx)("p",{children:"Note: manual adjustments will be reset to 0."})]}),positiveLabel:"Reautograde",positiveIntent:"danger"})&&e.handleReautogradeAnswer(e.submissionId,e.questionId)}})]})]}),(0,p.jsxs)("div",{className:"xp-adjustment",children:[(0,p.jsx)("div",{children:"XP adjustment:"}),(0,p.jsx)("div",{children:(0,p.jsx)(n.Af,{className:"adjustment-input",onValueChange:(e,t)=>{a(t)},value:t||"",buttonPosition:v.Ly.RIGHT,fill:!0,placeholder:j,intent:S<0||S>e.maxXp?h.S.DANGER:h.S.NONE,min:0-e.initialXp,max:e.maxXp>e.initialXp?e.maxXp-e.initialXp:void 0,stepSize:50,minorStepSize:25,majorStepSize:100})})]}),(0,p.jsxs)("div",{className:"final-xp",children:[(0,p.jsx)("div",{children:"Final XP:"}),(0,p.jsx)("div",{children:`${S} / ${e.maxXp}`})]})]})}),(0,p.jsx)("div",{className:"react-mde-parent",children:(0,p.jsx)(ec.default,{value:s,onChange:i,selectedTab:r,onTabChange:e=>c(e),generateMarkdownPreview:e=>Promise.resolve((0,p.jsx)($.Z,{content:e,simplifiedAutoLink:!0,strikethrough:!0,tasklists:!0,openLinksInNewWindow:!0})),minEditorHeight:200,maxEditorHeight:1e3,minPreviewHeight:240,getIcon:function(e){const t=sc(e);return(0,p.jsx)(n.JO,{icon:t.iconName,htmlTitle:t.title})}})}),"write"===r&&(0,p.jsxs)("div",{className:"grading-editor-draft-buttons",children:[(0,p.jsx)("div",{className:"grading-editor-save-button",children:(0,p.jsx)(H.Z,{label:"Save Changes",icon:b.d.FLOPPY_DISK,onClick:g(e.handleGradingSave),options:y})}),(0,p.jsx)("div",{className:"grading-editor-discard-button",children:(0,p.jsx)(H.Z,{label:"Discard Changes",icon:b.d.TRASH,onClick:()=>{m()&&!window.confirm("This will reset the editor. Are you sure?")||(a(e.xpAdjustment.toString()),i(e.comments),(0,T.rO)("Discarded!",1e3))},options:C})})]}),(0,p.jsx)("div",{className:"grading-editor-save-continue-button",children:(0,p.jsx)(H.Z,{label:"Save and Continue",icon:b.d.UPDATED,onClick:g(((t,a,s,n)=>{d(!0),e.handleGradingSaveAndContinue(t,a,s,n)})),options:f})}),e.graderName&&e.gradedAt&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(n.iz,{}),(0,p.jsxs)("div",{className:"grading-editor-last-graded-details",children:["Last edited by ",(0,p.jsx)("b",{children:e.graderName})," on ",(0,ge.Dh)(e.gradedAt)]})]})]})},ic=(0,c.$j)(null,(e=>(0,Ie.DE)({handleGradingSave:u.submitGrading,handleGradingSaveAndContinue:u.submitGradingAndContinue,handleReautogradeAnswer:u.reautogradeAnswer},e)))(nc),rc="grading",oc=e=>{var t,a,i,h,g,m,y,v,C,f;const S=(0,l.s0)(),[j,w]=(0,o.useState)(le.B.grading),I=(0,x.ix)((t=>t.session.gradings.get(e.submissionId))),M=(0,x.ix)((e=>e.session.courseId)),{autogradingResults:T,isFolderModeEnabled:P,activeEditorTabIndex:E,editorTabs:N,editorTestcases:O,isRunning:D,output:F,replValue:V,sideContentHeight:H,currentSubmission:X,currentQuestion:W}=(0,x.ix)((e=>e.workspaces[rc])),K=(0,c.I0)(),{handleBrowseHistoryDown:q,handleBrowseHistoryUp:Z,handleClearContext:Y,handleDeclarationNavigate:J,handleEditorEval:Q,handleSetActiveEditorTabIndex:te,handleRemoveEditorTabByIndex:ae,handleEditorValueChange:se,handleEditorUpdateBreakpoints:ne,handleGradingFetch:ie,handleReplEval:re,handleReplOutputClear:oe,handleReplValueChange:de,handleResetWorkspace:ge,handleChangeExecTime:pe,handleSideContentHeightChange:me,handleTestcaseEval:xe,handleRunAllTestcases:ye,handleUpdateCurrentSubmissionId:ve,handleUpdateHasUnsavedChanges:be,handlePromptAutocomplete:Ce}=(0,o.useMemo)((()=>({handleBrowseHistoryDown:()=>K((0,ue.browseReplHistoryDown)(rc)),handleBrowseHistoryUp:()=>K((0,ue.browseReplHistoryUp)(rc)),handleClearContext:(e,t)=>K((0,ue.beginClearContext)(rc,e,t)),handleDeclarationNavigate:e=>K((0,ue.navigateToDeclaration)(rc,e)),handleEditorEval:()=>K((0,ue.evalEditor)(rc)),handleSetActiveEditorTabIndex:e=>K((0,ue.updateActiveEditorTabIndex)(rc,e)),handleRemoveEditorTabByIndex:e=>K((0,ue.removeEditorTab)(rc,e)),handleEditorValueChange:(e,t)=>K((0,ue.updateEditorValue)(rc,0,t)),handleEditorUpdateBreakpoints:(e,t)=>K((0,ue.setEditorBreakpoint)(rc,e,t)),handleGradingFetch:e=>K((0,u.fetchGrading)(e)),handleReplEval:()=>K((0,ue.evalRepl)(rc)),handleReplOutputClear:()=>K((0,ue.clearReplOutput)(rc)),handleReplValueChange:e=>K((0,ue.updateReplValue)(e,rc)),handleResetWorkspace:e=>K((0,ue.resetWorkspace)(rc,e)),handleChangeExecTime:e=>K((0,ue.changeExecTime)(e,rc)),handleSideContentHeightChange:e=>K((0,ue.changeSideContentHeight)(e,rc)),handleTestcaseEval:e=>K((0,ue.evalTestcase)(rc,e)),handleRunAllTestcases:()=>K((0,ue.runAllTestcases)(rc)),handleUpdateCurrentSubmissionId:(e,t)=>K((0,ue.updateCurrentSubmissionId)(e,t)),handleUpdateHasUnsavedChanges:e=>K((0,ue.updateHasUnsavedChanges)(rc,e)),handlePromptAutocomplete:(e,t,a)=>K((0,ue.promptAutocomplete)(rc,e,t,a))})),[K]);(0,o.useEffect)((()=>{if(ie(e.submissionId),!I)return;let t=e.questionId;e.questionId>=I.length&&(t=I.length-1);const a=I[t].question;let s="";a.type===A.LD.programming&&(s=a.answer?a.answer:a.solutionTemplate||""),se(0,s)}),[]),(0,o.useEffect)((()=>{if(void 0===I)return;const t=e.questionId;void 0===I[t]?S(`/courses/${M}/grading`):fe(e)}));const fe=e=>{var t;const a=e.submissionId,s=e.questionId;if(X===a&&W===s)return;const n=I[s].question;let i=[],r="",o="",c="",l=[];if(n.type===A.LD.programming){const e=n;i=e.autogradingResults,o=e.prepend,c=e.postpend,l=e.testcases,r=e.answer,r||(r=e.solutionTemplate)}ne(0,[]),ve(a,s),ge({autogradingResults:i,editorTabs:[{value:r,highlightedLines:[],breakpoints:[]}],programPrependValue:o,programPostpendValue:c,editorTestcases:l}),pe(null!==(t=n.library.execTimeMs)&&void 0!==t?t:d.t7.grading.execTime),Y(n.library,!0),be(!1),r&&se(0,r)},Se=()=>{Q(),j===le.B.autograder&&ye()};if(void 0===I)return(0,p.jsx)(n.tR,{className:r()("WorkspaceParent",s.Pyr),description:"Getting assessment ready...",icon:(0,p.jsx)(n.$j,{size:n.Ey.LARGE})});const je=e.questionId>=I.length?I.length-1:e.questionId,we=I[je].question,Ie={controlBarProps:(t=>{const a=`/courses/${M}/grading`,s=a+`/${e.submissionId}`,n=[t+1,I.length],i=(0,p.jsx)(L.g,{onClickNext:()=>S(s+`/${(t+1).toString()}`),onClickReturn:()=>S(a),questionProgress:n},"next_question"),r=(0,p.jsx)(G.f,{onClick:()=>S(s+`/${(t-1).toString()}`),questionProgress:n},"previous_question"),o=(0,p.jsx)(U.M,{questionProgress:n},"question_view");return{editorButtons:[(0,p.jsx)(_.h,{isEntrypointFileDefined:null!==E,handleEditorEval:Se},"run")],flowButtons:[r,o,i]}})(je),editorContainerProps:we.type===A.LD.programming||we.type===A.LD.voting?{editorVariant:"normal",isFolderModeEnabled:P,activeEditorTabIndex:E,setActiveEditorTabIndex:te,removeEditorTabByIndex:ae,editorTabs:N.map(z.F),editorSessionId:"",handleDeclarationNavigate:J,handleEditorEval:Se,handleEditorValueChange:se,handleEditorUpdateBreakpoints:ne,handlePromptAutocomplete:Ce,isEditorAutorun:!1,sourceChapter:(null===we||void 0===we||null===(t=we.library)||void 0===t?void 0:t.chapter)||k.Chapter.SOURCE_4,sourceVariant:null!==(a=null===we||void 0===we||null===(i=we.library)||void 0===i?void 0:i.variant)&&void 0!==a?a:k.Variant.DEFAULT,externalLibraryName:(null===we||void 0===we||null===(h=we.library)||void 0===h||null===(g=h.external)||void 0===g?void 0:g.name)||"NONE"}:void 0,handleSideContentHeightChange:me,mcqProps:{mcq:we,handleMCQSubmit:e=>{}},sideBarProps:{tabs:[]},sideContentHeight:H,sideContentProps:((e,t)=>{var a;const s=[{label:`Grading: Question ${t+1}`,iconName:b.d.TICK,body:(0,p.jsx)(ic,{solution:I[t].question.solution,questionId:I[t].question.id,submissionId:e.submissionId,initialXp:I[t].grade.xp,xpAdjustment:I[t].grade.xpAdjustment,maxXp:I[t].question.maxXp,studentName:I[t].student.name,comments:null!==(a=I[t].grade.comments)&&void 0!==a?a:"",graderName:I[t].grade.grader?I[t].grade.grader.name:void 0,gradedAt:I[t].grade.grader?I[t].grade.gradedAt:void 0}),id:le.B.grading},{label:`Question ${t+1}`,iconName:b.d.NINJA,body:(0,p.jsx)($.Z,{content:I[t].question.content}),id:le.B.questionOverview},{label:"Autograder",iconName:b.d.AIRPLANE,body:(0,p.jsx)(ee,{testcases:O,autogradingResults:T,handleTestcaseEval:xe,workspaceLocation:"grading"}),id:le.B.autograder}];I[t].question.library.external.symbols.includes("get_matrix")&&s.push({label:"Tone Matrix",iconName:b.d.GRID_VIEW,body:(0,p.jsx)(ce.Z,{}),id:le.B.toneMatrix});return{onChange:(e,t,a)=>{e!==t&&w(e)},tabs:{beforeDynamicTabs:s,afterDynamicTabs:[]},workspaceLocation:rc}})(e,je),replProps:{handleBrowseHistoryDown:q,handleBrowseHistoryUp:Z,handleReplEval:re,handleReplValueChange:de,output:F,replValue:V,sourceChapter:(null===we||void 0===we||null===(m=we.library)||void 0===m?void 0:m.chapter)||k.Chapter.SOURCE_4,sourceVariant:null!==(y=null===we||void 0===we||null===(v=we.library)||void 0===v?void 0:v.variant)&&void 0!==y?y:k.Variant.DEFAULT,externalLibrary:(null===we||void 0===we||null===(C=we.library)||void 0===C||null===(f=C.external)||void 0===f?void 0:f.name)||"NONE",replButtons:(()=>{const e=(0,p.jsx)(R._,{handleReplOutputClear:oe},"clear_repl");return[(0,p.jsx)(B.e,{handleReplEval:re,isRunning:D},"eval_repl"),e]})()}};return(0,p.jsx)("div",{className:r()("WorkspaceParent",s.Pyr),children:(0,p.jsx)(he.Z,{...Ie})})},cc=()=>{var e,t,a;const{courseId:s,gradingOverviews:i}=(0,x.ix)((e=>e.session)),r=(0,l.UO)();if(r.submissionId&&(null===(e=r.submissionId)||void 0===e||!e.match(w.CJ))||r.questionId&&(null===(t=r.questionId)||void 0===t||!t.match(w.CJ)))return(0,p.jsx)(l.Fg,{to:`/courses/${s}/grading`});const o=(0,de.GA)(r.submissionId),c=(0,de.GA)(r.questionId)||0;if(null!==o)return(0,p.jsx)(oc,{questionId:c,submissionId:o});const d=(0,p.jsx)(n.tR,{className:"Grading",description:"Fetching submissions...",icon:(0,p.jsx)(n.$j,{size:n.Ey.LARGE})}),h=null!==(a=null===i||void 0===i?void 0:i.map((e=>e.studentName?e:{...e,studentName:"(user has yet to log in)"})))&&void 0!==a?a:[];return(0,p.jsx)(ye.Z,{display:void 0===i?d:(0,p.jsx)(Qo,{submissions:h,handleCsvExport:()=>{if(!i)return;const e=document.defaultView||window;if(!e)return void console.warn("There is no `window` associated with the current `document`");const t=new Blob(['"Assessment Name","Student Name","Group","Status","Grading","Question Count","Questions Graded","Initial XP","XP Adjustment","Current XP (excl. bonus)","Max XP","Bonus XP"\n',...i.map((e=>[e.assessmentName,e.studentName,e.groupName,e.submissionStatus,e.gradingStatus,e.questionCount,e.gradedCount,e.initialXp,e.xpAdjustment,e.currentXp,e.maxXp,e.xpBonus].map((e=>`"${e}"`)).join(",")+"\n"))],{type:"text/csv"}),a=`SA submissions (${(new Date).toISOString()}).csv`,s=document.createElement("a"),n=e.URL.createObjectURL(t);s.setAttribute("href",n),s.setAttribute("download",a),s.style.display="none",document.body.appendChild(s),s.dispatchEvent(new MouseEvent("click",{bubbles:!1,cancelable:!0,view:e})),document.body.removeChild(s),e.setTimeout((()=>{e.URL.revokeObjectURL(n)}),0)}}),fullWidth:!0})};var lc=a(61691);const dc=e=>{const{handleUpdateSublanguage:t}=e,{sourceChapter:a,sourceVariant:i}=e,[r,c]=o.useState(d.Vf[0]),[l,u]=o.useState(!1),g=o.useCallback((e=>{u(!0),c(e)}),[u,c]),m=o.useCallback((()=>{u(!1)}),[u]),x=o.useCallback((()=>{u(!1),t(r)}),[r,u,t]),y=o.useCallback(((e,t)=>{let{handleClick:a}=t;return(0,p.jsx)(n.sN,{onClick:a,text:e.displayName},e.displayName)}),[]),v=o.useCallback((e=>{let{itemsParentRef:t,renderItem:a,items:s}=e;const i=s.filter((e=>{let{variant:t}=e;return t===k.Variant.DEFAULT})),r=s.filter((e=>{let{variant:t}=e;return t!==k.Variant.DEFAULT}));return(0,p.jsxs)(n.v2,{ulRef:t,children:[i.map(a),r.length>0&&(0,p.jsx)(n.sN,{text:"Variants",icon:"cog",children:r.map(a)},"variant-menu")]})}),[]),C=Le.P.ofType(),f=(0,p.jsxs)(n.Vq,{canEscapeKeyClose:!0,canOutsideClickClose:!0,className:"change-default-lang-dialog",icon:b.d.ERROR,isCloseButtonShown:!0,isOpen:l,onClose:m,title:"Updating default Source sublanguage",children:[(0,p.jsxs)("div",{className:s.TmF,children:["Are you sure you want to update the ",(0,p.jsx)("b",{children:"default Playground Source sublanguage"})," from"," ",(0,d.w$)(a,i)," to ",(0,p.jsx)("b",{children:r.displayName}),"?"]}),(0,p.jsx)("div",{className:s.Alt,children:(0,p.jsxs)("div",{className:s.e$L,children:[(0,p.jsx)(H.Z,{label:"Cancel",onClick:m,options:{minimal:!1}}),(0,p.jsx)(H.Z,{label:"Confirm",onClick:x,options:{minimal:!1,intent:h.S.DANGER}})]})})]});return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(C,{items:d.Vf,onItemSelect:g,itemRenderer:y,itemListRenderer:v,filterable:!1,children:(0,p.jsxs)(n.zx,{rightIcon:b.d.DOUBLE_CARET_VERTICAL,children:[(0,p.jsx)("span",{className:"hidden-xs hidden-sm",children:"Default sublanguage: "}),(0,p.jsx)("span",{children:(0,d.w$)(a,i)})]})}),f]})},hc=(0,c.$j)((e=>({sourceChapter:e.session.sourceChapter||g.Z.defaultSourceChapter,sourceVariant:e.session.sourceVariant||g.Z.defaultSourceVariant})),(e=>(0,Ie.DE)({handleUpdateSublanguage:ue.changeSublanguage},e)))(dc),uc=e=>{const[t,a]=o.useState(!1),i=o.useCallback((()=>a(!0)),[]),r=o.useCallback((()=>a(!1)),[]),{handleDeleteAssessment:c,data:l}=e,d=o.useCallback((()=>{const{id:e}=l;c(e),r()}),[l,r,c]);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(H.Z,{icon:b.d.TRASH,onClick:i}),(0,p.jsxs)(n.Vq,{icon:b.d.WARNING_SIGN,isOpen:t,onClose:r,title:"Deleting assessment",canOutsideClickClose:!0,children:[(0,p.jsxs)("div",{className:s.TmF,children:[(0,p.jsxs)("p",{children:["Are you sure you want to ",(0,p.jsx)("b",{children:"delete"})," the assessment ",(0,p.jsx)("i",{children:l.title}),"?"]}),(0,p.jsx)("p",{children:(0,p.jsx)("b",{children:"All submissions and their answers will be deleted as well."})})]}),(0,p.jsx)("div",{className:s.Alt,children:(0,p.jsxs)("div",{className:s.e$L,children:[(0,p.jsx)(H.Z,{label:"Cancel",icon:b.d.CROSS,onClick:r,options:{minimal:!1}}),(0,p.jsx)(H.Z,{label:"Confirm",icon:b.d.TRASH,onClick:d,options:{minimal:!1,intent:h.S.DANGER}})]})})]})]})};var gc=a(18267);const pc=e=>{const[t,a]=o.useState(void 0),[s,i]=o.useState(!1),[c,l]=o.useState(!1),[d,u]=o.useState(-1);o.useEffect((()=>{e.assessmentConfigurations&&-1===d&&u(e.assessmentConfigurations[0].assessmentConfigId)}),[e.assessmentConfigurations,d]);const{handleUploadAssessment:g}=e,m=o.useMemo((()=>{var t;return null===(t=e.assessmentConfigurations)||void 0===t?void 0:t.map((e=>({value:e.assessmentConfigId,label:e.type})))}),[e.assessmentConfigurations]),x=o.useCallback((()=>{-1!==d?(t&&(g(t,c,d),l(!1)),a(void 0)):(0,T.N9)("Please select a valid assessment type before uploading!")}),[t,c,g,d]),v=o.useCallback((()=>a(void 0)),[a]),C=o.useCallback((e=>{a(e[0]),l(!1)}),[a]),f=o.useCallback((e=>{e.length>1&&(0,T.N9)("Uploading multiple files at once is not currently supported!",2e3)}),[]),{getRootProps:S,getInputProps:j,isFocused:w,isDragActive:I,isDragAccept:k,isDragReject:M}=(0,gc.uI)({multiple:!1,onDropAccepted:C,onDropRejected:f}),A=o.useMemo((()=>r()("dropzone-base",w||I?"dropzone-active":void 0,k?"dropzone-accept":void 0,M?"dropzone-reject":void 0)),[w,I,k,M]),P=o.useCallback((()=>{c?l(!1):i(!0)}),[c,i,l]),E=o.useMemo((()=>(0,p.jsx)("div",{className:"toggle-button-wrapper",children:(0,p.jsx)(n.rs,{checked:c,onChange:P})})),[c,P]),N=o.useCallback((()=>{l(!0),i(!1)}),[l]),O=o.useCallback((()=>{i(!1)}),[i]),D=o.useMemo((()=>(0,p.jsxs)("div",{className:"dropzone-controls",children:[(0,p.jsx)(H.Z,{label:"Yes",icon:b.d.CONFIRM,onClick:N,options:{minimal:!1,intent:h.S.DANGER}}),(0,p.jsx)(H.Z,{label:"No",icon:b.d.CROSS,onClick:O,options:{minimal:!1}})]})),[O,N]);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(n.Zb,{elevation:y.u.TWO,interactive:!0,children:(0,p.jsxs)("div",{...S({className:A}),children:[(0,p.jsx)("input",{...j()}),(0,p.jsx)("p",{children:"Drag 'n' drop a file here, or click to select a file"})]})}),t&&(0,p.jsxs)(n.Zb,{className:"dropzone-prompt",elevation:y.u.TWO,interactive:!0,children:[(0,p.jsx)("h3",{children:null===t||void 0===t?void 0:t.name}),!s&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("div",{className:"dropzone-controls",children:[(0,p.jsx)(n.Lu,{options:m,onChange:e=>u(parseInt(e.target.value)),value:d}),(0,p.jsx)(H.Z,{label:"Confirm Upload",icon:b.d.UPLOAD,onClick:x,options:{minimal:!1,intent:h.S.DANGER}}),(0,p.jsx)(H.Z,{label:"Cancel Upload",icon:b.d.DELETE,onClick:v,options:{minimal:!1}})]}),(0,p.jsxs)("div",{className:"dropzone-controls",children:[(0,p.jsx)("p",{children:"Force update opened assessment"}),E]})]}),s&&(0,p.jsx)("p",{children:"Are you sure that you want to force update the assessment?"}),s&&D]})]})};var mc=a(73655);const xc="YYYY-MM-DD HH:mm:ss ZZ",yc=e=>{const t=new Date(2010,0,0),a=new Date(2030,11,31),{data:i,forOpenDate:r}=e,c=r?i.openAt:i.closeAt,l=xt(c,xt.ISO_8601,!0),[d,u]=o.useState(!1),[g,m]=o.useState(l),x=o.useCallback((()=>u(!0)),[]),y=o.useCallback((()=>u(!1)),[]),{handleAssessmentChangeDate:v}=e,C=o.useCallback((()=>{if(g){const{id:e,openAt:t,closeAt:a}=i;v(e,r?g.toISOString():t,r?a:g.toISOString()),y()}else(0,T.N9)("No date and time selected!",2e3),m(l)}),[g,l,i,v,r,y]),f=o.useCallback((e=>m(xt(e))),[]),S=o.useCallback((()=>{(0,T.N9)("Failed to parse date string! Defaulting to current date.",2e3),m(l)}),[l]),j=(0,p.jsx)(mc.W,{formatDate:e=>xt(e).format(xc),onChange:f,onError:S,parseDate:e=>{const t=xt(e,xc,!0);return!!t.isValid()&&t.toDate()},placeholder:`${xc} or select a date`,value:null===g||void 0===g?void 0:g.toDate(),timePrecision:"second",fill:!0,minDate:t,maxDate:a,closeOnSelection:!1});return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("span",{className:"date-cell-text",children:l.format(xc)}),(0,p.jsx)(H.Z,{icon:b.d.EDIT,onClick:x}),(0,p.jsxs)(n.Vq,{icon:b.d.INFO_SIGN,isOpen:d,onClose:y,title:"Updating assessment settings",canOutsideClickClose:!0,children:[(0,p.jsxs)("div",{className:s.TmF,children:[(0,p.jsxs)("p",{children:[r?"Opening":"Closing"," date and time:"]}),j]}),(0,p.jsx)("div",{className:s.Alt,children:(0,p.jsxs)("div",{className:s.e$L,children:[(0,p.jsx)(H.Z,{label:"Cancel",icon:b.d.CROSS,onClick:y,options:{minimal:!1}}),(0,p.jsx)(H.Z,{label:"Confirm",icon:b.d.TICK,onClick:C,options:{minimal:!1,intent:h.S.DANGER}})]})})]})]})},vc=e=>{const{data:t}=e,[a,i]=o.useState(!1),[r]=o.useState(!!t.isPublished),c=o.useCallback((()=>i(!0)),[]),l=o.useCallback((()=>i(!1)),[]),{handlePublishAssessment:d}=e,u=o.useCallback((()=>{const{id:e}=t;d(!r,e),l()}),[t,r,l,d]);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(n.rs,{className:"publish-cell",checked:r,onChange:c}),(0,p.jsxs)(n.Vq,{icon:b.d.WARNING_SIGN,isOpen:a,onClose:l,title:(r?"Unpublish":"Publish")+" assessment",canOutsideClickClose:!0,children:[(0,p.jsxs)("div",{className:s.TmF,children:[(0,p.jsxs)("p",{children:["Are you sure you want to ",(0,p.jsx)("b",{children:r?"unpublish":"publish"})," the assessment"," ",(0,p.jsx)("i",{children:t.title}),"?"]}),r?(0,p.jsx)("p",{children:(0,p.jsx)("b",{children:"This will hide the assessment for students and prevent them from uploading new answers. Admins and staff are not affected."})}):null]}),(0,p.jsx)("div",{className:s.Alt,children:(0,p.jsxs)("div",{className:s.e$L,children:[(0,p.jsx)(H.Z,{label:"Cancel",icon:b.d.CROSS,onClick:l,options:{minimal:!1}}),(0,p.jsx)(H.Z,{label:"Confirm",icon:b.d.CONFIRM,onClick:u,options:{minimal:!1,intent:h.S.DANGER}})]})})]})]})};class bc extends o.Component{constructor(e){super(e),this.columnDefs=void 0,this.defaultColumnDefs=void 0,this.gridApi=void 0,this.columnApi=void 0,this.loadContent=()=>{this.props.handleAssessmentOverviewFetch(),this.props.handleFetchCourseConfigs()},this.dateFilterComparator=(e,t)=>{const a=new Date(t);return a<e?-1:a>e?1:0},this.onGridReady=e=>{this.gridApi=e.api,this.columnApi=e.columnApi,this.gridApi.sizeColumnsToFit(),this.columnApi.applyColumnState({state:[{colId:"openAt",sort:"desc"},{colId:"closeAt",sort:"desc"}]})},this.resizeGrid=()=>{this.gridApi&&this.gridApi.sizeColumnsToFit()},this.toggleDropzone=()=>{this.setState({showDropzone:!this.state.showDropzone})},this.state={showDropzone:!1},this.columnDefs=[{field:"number",headerName:"ID",width:50},{headerName:"Title",field:"title"},{headerName:"Category",field:"type",width:100},{headerName:"Open Date",field:"openAt",filter:"agDateColumnFilter",filterParams:{comparator:this.dateFilterComparator,inRangeInclusive:!0},sortingOrder:["desc","asc",null],cellRendererFramework:yc,cellRendererParams:{handleAssessmentChangeDate:this.props.handleAssessmentChangeDate,forOpenDate:!0},width:150},{headerName:"Close Date",field:"closeAt",filter:"agDateColumnFilter",filterParams:{comparator:this.dateFilterComparator,inRangeInclusive:!0},sortingOrder:["desc","asc",null],cellRendererFramework:yc,cellRendererParams:{handleAssessmentChangeDate:this.props.handleAssessmentChangeDate,forOpenDate:!1},width:150},{headerName:"Publish",field:"",cellRendererFramework:vc,cellRendererParams:{handlePublishAssessment:this.props.handlePublishAssessment},width:100,filter:!1,resizable:!1,sortable:!1,cellStyle:{padding:0}},{headerName:"Delete",field:"",cellRendererFramework:uc,cellRendererParams:{handleDeleteAssessment:this.props.handleDeleteAssessment},width:100,filter:!1,resizable:!1,sortable:!1,cellStyle:{padding:0}}],this.defaultColumnDefs={filter:!0,resizable:!0,sortable:!0}}render(){const e=(0,p.jsxs)("div",{className:"GridControls ground-control-controls",children:[(0,p.jsx)(n.zx,{active:this.state.showDropzone,icon:b.d.CLOUD_UPLOAD,intent:this.state.showDropzone?h.S.PRIMARY:h.S.NONE,onClick:this.toggleDropzone,children:(0,p.jsx)("span",{className:"hidden-xs",children:"Upload assessment"})}),(0,p.jsx)(hc,{}),(0,p.jsx)(n.zx,{icon:b.d.REFRESH,onClick:this.props.handleAssessmentOverviewFetch,children:(0,p.jsx)("span",{className:"hidden-xs",children:"Refresh assessments"})})]}),t=(0,p.jsx)(n.UO,{isOpen:this.state.showDropzone,keepChildrenMounted:!0,children:(0,p.jsx)(pc,{handleUploadAssessment:this.props.handleUploadAssessment,assessmentConfigurations:this.props.assessmentConfigurations})}),a=(0,p.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:(0,p.jsx)(oa.AgGridReact,{domLayout:"autoHeight",columnDefs:this.columnDefs,defaultColDef:this.defaultColumnDefs,onGridReady:this.onGridReady,onGridSizeChanged:this.resizeGrid,rowData:this.props.assessmentOverviews,rowHeight:30,suppressCellSelection:!0,suppressMovableColumns:!0,suppressPaginationPanel:!0})}),s=(0,p.jsxs)("div",{className:"GroundControl",children:[e,t,(0,p.jsx)(n.iz,{}),a]});return(0,p.jsx)("div",{children:(0,p.jsx)(ye.Z,{display:s,loadContentDispatch:this.loadContent})})}}const Cc=bc,fc=(0,c.$j)((e=>({assessmentOverviews:e.session.assessmentOverviews,assessmentConfigurations:e.session.assessmentConfigurations})),(e=>(0,Ie.DE)({handleAssessmentChangeDate:lc.changeDateAssessment,handleAssessmentOverviewFetch:u.fetchAssessmentOverviews,handleDeleteAssessment:lc.deleteAssessment,handleUploadAssessment:lc.uploadAssessment,handlePublishAssessment:lc.publishAssessment,handleFetchCourseConfigs:u.fetchCourseConfig},e)))(Cc),Sc=e=>{const{data:t}=e;let a=!1;null!==t.notificationPreference&&null!==t.notificationPreference.isEnabled&&(a=t.notificationPreference.isEnabled);const s=o.useCallback((()=>{e.setStateHandler(e.rowIndex,!a)}),[e,a]);return(0,p.jsx)(n.rs,{checked:a,onChange:s})},jc=e=>{const[t,a]=o.useState(),s=e.data[e.field];s.sort(((e,t)=>e.minutes-t.minutes));const i=e=>e.minutes>=60?Math.round(e.minutes/60*100)/100+" hour(s)":`${e.minutes} minute(s)`,r=e.data.isEnabled;let c;const l=s.filter((e=>e.isDefault));let d;if(1===l.length&&(c=l[0]),null!==e.data.notificationPreference){const t=s.filter((t=>t.id===e.data.notificationPreference.timeOptionId));1===t.length&&(d=t[0])}if(d||c){const e=d||c;t&&t.id===e.id||a(e)}return(0,p.jsx)(Ma.u,{filterable:!1,items:s,itemRenderer:(e,t)=>{let{handleClick:a,handleFocus:s,modifiers:r,query:o}=t;return(0,p.jsx)(n.sN,{active:r.active,disabled:r.disabled,onClick:a,onFocus:s,roleStructure:"listoption",text:i(e)},e.id)},onItemSelect:t=>{a(t),e.setStateHandler(e.rowIndex,t)},noResults:(0,p.jsx)(n.sN,{disabled:!0,text:"No results.",roleStructure:"listoption"}),disabled:!r,children:(0,p.jsx)(n.zx,{text:t?i(t):"NA",rightIcon:"caret-down",placeholder:"Choose default",disabled:!r})})},wc=()=>{const e=o.useRef(),t=(0,c.I0)(),a=(0,x.ix)((e=>e.session)),[s,i]=(0,o.useState)(!1),r=o.useRef(a.configurableNotificationConfigs);o.useEffect((()=>{a.courseRegId&&t((0,u.fetchConfigurableNotificationConfigs)(a.courseRegId))}),[t,a.courseRegId]),o.useEffect((()=>{var e;void 0!==a.configurableNotificationConfigs&&(r.current=(0,f.cloneDeep)(a.configurableNotificationConfigs)),null===(e=r.current)||void 0===e||e.forEach((e=>{null===e.notificationPreference&&(e.notificationPreference={id:-1,isEnabled:!0,timeOptionId:null})}))}),[a]);const l=[{headerName:"Notification Type",field:"notificationType.name",rowDrag:!0},{headerName:"Assessment Type",field:"assessmentConfig.type",valueFormatter:e=>{var t;return(null===(t=e.data.assessmentConfig)||void 0===t?void 0:t.type)||"-"}},{headerName:"Recipients",field:"notificationType.forStaff",valueFormatter:e=>e.data.notificationType.forStaff?"Staff":"Student"},{headerName:"Reminder",field:"timeOptions",cellRendererFramework:jc,cellRendererParams:{setStateHandler:(t,a)=>{var s,n,o;const c=[...null!==(s=r.current)&&void 0!==s?s:[]];c[t].notificationPreference.timeOptionId=a.id,r.current=c,null===(n=e.current)||void 0===n||null===(o=n.getDisplayedRowAtIndex(t))||void 0===o||o.setDataValue("timeOptions",c[t].timeOptions),i(!0)},field:"timeOptions"}},{headerName:"Enabled",field:"notificationPreference.isEnabled",cellRendererFramework:Sc,cellRendererParams:{setStateHandler:(t,a)=>{var s,n,o;const c=[...null!==(s=r.current)&&void 0!==s?s:[]];c[t].notificationPreference.isEnabled=a,r.current=c,null===(n=e.current)||void 0===n||null===(o=n.getDisplayedRowAtIndex(t))||void 0===o||o.setDataValue("notificationPreference.isEnabled",a),i(!0)},field:"notificationPreference.isEnabled"}}],d=(0,p.jsxs)("div",{children:[(0,p.jsx)(n.H1,{children:"Notifications"}),(0,p.jsx)("div",{className:"Grid ag-grid-parent ag-theme-balham",children:(0,p.jsx)(oa.AgGridReact,{domLayout:"autoHeight",columnDefs:l,defaultColDef:{filter:!1,resizable:!0,sortable:!1},onGridReady:t=>{e.current=t.api,t.api.sizeColumnsToFit()},onGridSizeChanged:()=>{var t;return null===(t=e.current)||void 0===t?void 0:t.sizeColumnsToFit()},rowData:r.current,rowHeight:36,rowDragManaged:!0,suppressCellSelection:!0,suppressMovableColumns:!0,suppressPaginationPanel:!0})}),(0,p.jsx)(n.zx,{text:"Save",style:{marginTop:"15px"},disabled:!s,intent:s?h.S.WARNING:h.S.NONE,onClick:()=>{var e,n;if(!s)return;const o=null!==(e=null===(n=r.current)||void 0===n?void 0:n.map((e=>({...e.notificationPreference,notificationConfigId:e.id}))))&&void 0!==e?e:[];t((0,u.updateNotificationPreferences)(o,a.courseRegId)),i(!1)}})]});return(0,p.jsx)(ye.Z,{loadContentDispatch:()=>{},display:d,fullWidth:!1})};var Ic=a(30561),kc=a(85323),Mc=a.n(kc);class Ac extends o.PureComponent{constructor(e){super(e),this.recorder=void 0,this.handleCloseDialog=()=>this.setState({dialogOpen:!1}),this.handleOpenDialog=()=>this.setState({dialogOpen:!0}),this.updateTimerDuration=()=>{this.setState({duration:this.props.getTimerDuration()})},this.handleTruncatePlaybackData=()=>{const e=this.props.playbackData.inputs.filter((e=>e.time<=1e3*this.props.currentPlayerTime));this.props.handleResetInputs(e)},this.handleRecorderPausing=()=>{if(!this.recorder)return;const{handleSetIsEditorReadonly:e,handleSetSourcecastData:t,handleTimerPause:a}=this.props;clearInterval(this.state.updater),e(!0),a(),this.recorder.pause();t("","","",window.URL.createObjectURL(this.recorder.exportWAV()),this.props.playbackData)},this.handleRecorderStarting=()=>{this.recorder=new(Mc());const{handleRecordInit:e,handleSetIsEditorReadonly:t,handleTimerStart:a}=this.props;this.recorder.start().then((()=>{e(),t(!1),a();const s=setInterval(this.updateTimerDuration,100);this.setState({updater:s})}),(e=>{alert("Microphone not found: "+e)}))},this.handleRecorderResuming=()=>{if(!this.recorder)return;const{handleSetIsEditorReadonly:e,handleTimerResume:t}=this.props;e(!1),t(-1);const a=setInterval(this.updateTimerDuration,100);this.setState({updater:a}),this.recorder.resume()},this.handleRecorderResumingFromCurrent=()=>{if(!this.recorder)return;const{currentPlayerTime:e,handleSetIsEditorReadonly:t,handleTimerResume:a}=this.props;this.handleTruncatePlaybackData(),t(!1),a(1e3*e);const s=setInterval(this.updateTimerDuration,100);this.setState({updater:s}),this.recorder.resume(e)},this.handleRecorderStopping=()=>{if(!this.recorder)return;const{handleSetIsEditorReadonly:e,handleTimerStop:t}=this.props;e(!1),t(),clearInterval(this.state.updater),this.recorder.stop(),this.setState({fileDataBlob:this.recorder.exportWAV()}),this.recorder.clear()},this.handleRecorderResetting=()=>{const{handleSetIsEditorReadonly:e,handleTimerReset:t}=this.props;e(!1),t(),clearInterval(this.state.updater),this.setState({duration:0}),this.recorder&&(this.recorder.stop(),this.recorder.clear())},this.handleRecorderSaving=()=>{this.state.fileDataBlob?this.props.handleSaveSourcecastData(this.state.saveTitle,this.state.saveDescription,this.state.saveUID,this.state.fileDataBlob,this.props.playbackData):alert("No recording found")},this.renderLabel=e=>{const t=Math.floor(e/60),a=Math.floor(e-60*t);return(t<10?"0"+t:t)+":"+(a<10?"0"+a:a)},this.handleSaveTitleInputChange=e=>{this.setState({saveTitle:e.target.value})},this.handleSaveDescriptionInputChange=e=>{this.setState({saveDescription:e.target.value})},this.handleSaveUIDInputChange=e=>{this.setState({saveUID:e.target.value})},this.state={dialogOpen:!1,duration:0,updater:void 0,saveTitle:"",saveDescription:"",saveUID:""}}async componentDidMount(){Mc().getPermission().then((()=>{}),(e=>{alert("Microphone not found: "+e)}))}render(){const e=(0,p.jsx)(H.Z,{label:"Record Pause",icon:b.d.SNOWFLAKE,onClick:this.props.handleRecordPause}),t=(0,p.jsx)(H.Z,{label:"Pause",icon:b.d.PAUSE,onClick:this.handleRecorderPausing}),a=(0,p.jsx)(H.Z,{label:"Resume",icon:b.d.PLAY,onClick:this.handleRecorderResuming}),i=(0,p.jsx)(H.Z,{label:"Resume Here",icon:b.d.PLAY,onClick:this.handleRecorderResumingFromCurrent}),r=(0,p.jsx)(H.Z,{label:"Record",icon:b.d.PLAY,onClick:this.handleRecorderStarting}),o=(0,p.jsx)(H.Z,{label:"Stop",icon:b.d.STOP,onClick:this.handleRecorderStopping}),c=(0,p.jsx)(H.Z,{label:"Reset",icon:b.d.REFRESH,onClick:this.handleRecorderResetting}),l=(0,p.jsx)(H.Z,{label:"Upload",icon:b.d.FLOPPY_DISK,onClick:this.handleOpenDialog});return(0,p.jsxs)("div",{children:[(0,p.jsxs)(n.Vq,{icon:"info-sign",isOpen:this.state.dialogOpen,onClose:this.handleCloseDialog,title:"Upload Sourcecast",canOutsideClickClose:!0,children:[(0,p.jsxs)("div",{className:s.TmF,children:[(0,p.jsx)(n.BZ,{id:"title",leftIcon:b.d.HEADER,onChange:this.handleSaveTitleInputChange,placeholder:"Title",value:this.state.saveTitle}),(0,p.jsx)("br",{}),(0,p.jsx)(n.BZ,{id:"description",leftIcon:b.d.LIST_DETAIL_VIEW,onChange:this.handleSaveDescriptionInputChange,placeholder:"Description",value:this.state.saveDescription}),(0,p.jsx)("br",{}),(0,p.jsx)(n.BZ,{id:"uid",leftIcon:b.d.KEY,onChange:this.handleSaveUIDInputChange,placeholder:"UID (optional, only alphanumeric, dash and underscore allowed)",value:this.state.saveUID})]}),(0,p.jsx)("div",{className:s.Alt,children:(0,p.jsxs)("div",{className:s.e$L,children:[(0,p.jsx)(H.Z,{label:"Confirm Upload",icon:b.d.TICK,onClick:this.handleRecorderSaving}),(0,p.jsx)(H.Z,{label:"Cancel",icon:b.d.CROSS,onClick:this.handleCloseDialog})]})})]}),(0,p.jsx)("br",{}),(0,p.jsx)("div",{className:"Timer",children:(0,p.jsx)(n.Zb,{elevation:2,style:{background:"#24323F"},children:(0,p.jsx)(n.H1,{children:this.renderLabel(this.props.recordingStatus!==O.bl.paused?this.state.duration/1e3:this.props.currentPlayerTime)})})}),(0,p.jsx)("br",{}),(0,p.jsxs)("div",{className:"RecorderControl",children:[this.props.recordingStatus===O.bl.notStarted&&r,this.props.recordingStatus===O.bl.paused&&a,this.props.recordingStatus===O.bl.paused&&i,this.props.recordingStatus===O.bl.recording&&t,this.props.recordingStatus===O.bl.recording&&e,this.props.recordingStatus===O.bl.paused&&o,this.props.recordingStatus===O.bl.finished&&l,this.props.recordingStatus!==O.bl.notStarted&&c]}),(0,p.jsx)("br",{})]})}}const Tc=Ac,Pc="sourcereel",Ec="sourcecast",Nc="Welcome to Sourcereel!",Oc=()=>{const[e,t]=(0,o.useState)(le.B.sourcereel),a=(0,x.ix)((e=>e.session.courseId)),{chapter:i,variant:l}=(0,x.ix)((e=>e.workspaces[Pc].context)),{audioUrl:d,currentPlayerTime:h,codeDeltasToApply:u,inputToApply:g,playbackDuration:m,playbackStatus:y,sourcecastIndex:v}=(0,x.ix)((e=>e.workspaces.sourcecast)),{isFolderModeEnabled:C,activeEditorTabIndex:f,editorTabs:S,externalLibrary:j,isDebugging:w,isEditorAutorun:I,isEditorReadonly:M,isRunning:A,output:T,playbackData:P,recordingStatus:E,replValue:N,sideContentHeight:L,timeElapsedBeforePause:G,timeResumed:U}=(0,x.ix)((e=>e.workspaces[Pc])),F=(0,c.I0)(),{handleChapterSelect:_,handleEditorEval:V,handleEditorValueChange:H,handleExternalSelect:$,handleRecordInput:X,handleReplEval:W,handleSetSourcecastStatus:K,handleSetIsEditorReadonly:q}=(0,o.useMemo)((()=>({handleChapterSelect:e=>F((0,ue.chapterSelect)(e,k.Variant.DEFAULT,Pc)),handleEditorEval:()=>F((0,ue.evalEditor)(Pc)),handleEditorValueChange:e=>F((0,ue.updateEditorValue)(Pc,0,e)),handleExternalSelect:e=>F((0,ue.externalLibrarySelect)(e,Pc)),handleRecordInput:e=>F((0,Ic.recordInput)(e,Pc)),handleReplEval:()=>F((0,ue.evalRepl)(Pc)),handleSetSourcecastStatus:e=>F((0,ta.setSourcecastStatus)(e,Ec)),handleSetIsEditorReadonly:e=>F((0,ue.setIsEditorReadonly)(Pc,e))})),[F]);(0,o.useEffect)((()=>{(0,ea.fetchSourcecastIndex)(Ec)}),[]),(0,o.useEffect)((()=>{if(g)switch(g.type){case"activeTabChange":t(g.data);break;case"chapterSelect":_(g.data);break;case"externalLibrarySelect":$(g.data);break;case"forcePause":K(O.PO.forcedPaused)}}),[g]);const Z=()=>G+Date.now()-U,Y=(0,o.useMemo)((()=>({handleDebuggerPause:()=>F((0,Qt.beginDebuggerPause)(Pc)),handleDebuggerResume:()=>F((0,Qt.debuggerResume)(Pc)),handleDebuggerReset:()=>F((0,Qt.debuggerReset)(Pc)),handleInterruptEval:()=>F((0,Qt.beginInterruptExecution)(Pc)),handleToggleEditorAutorun:()=>F((0,ue.toggleEditorAutorun)(Pc))})),[F]),J=(0,p.jsx)(aa.k,{handleDebuggerPause:Y.handleDebuggerPause,handleDebuggerResume:Y.handleDebuggerResume,handleDebuggerReset:Y.handleDebuggerReset,handleEditorEval:()=>{V(),E===O.bl.recording&&X({time:Z(),type:"keyboardCommand",data:O.SO.run})},handleInterruptEval:Y.handleInterruptEval,handleToggleEditorAutorun:Y.handleToggleEditorAutorun,isEntrypointFileDefined:null!==f,isDebugging:w,isEditorAutorun:I,isRunning:A},"autorun"),Q=(0,p.jsx)(D.b,{handleChapterSelect:(e,t)=>{let{chapter:a}=e;_(a),E===O.bl.recording&&X({time:Z(),type:"chapterSelect",data:a})},isFolderModeEnabled:C,sourceChapter:i,sourceVariant:l},"chapter"),ee=(0,o.useMemo)((()=>(0,p.jsx)(R._,{handleReplOutputClear:()=>F((0,ue.clearReplOutput)(Pc))},"clear_repl")),[F]),te=(0,p.jsx)(B.e,{handleReplEval:W,isRunning:A},"eval_repl"),ae=(0,o.useMemo)((()=>({setActiveEditorTabIndex:e=>F((0,ue.updateActiveEditorTabIndex)(Pc,e)),removeEditorTabByIndex:e=>F((0,ue.removeEditorTab)(Pc,e)),handleDeclarationNavigate:e=>F((0,ue.navigateToDeclaration)(Pc,e)),handleEditorUpdateBreakpoints:e=>F((0,ue.setEditorBreakpoint)(Pc,0,e))})),[F]),se={handleEditorEval:V,handleEditorValueChange:H,handleRecordInput:X,codeDeltasToApply:u,inputToApply:g,isEditorAutorun:I,isEditorReadonly:M,editorVariant:Ec,isFolderModeEnabled:C,activeEditorTabIndex:f,setActiveEditorTabIndex:ae.setActiveEditorTabIndex,removeEditorTabByIndex:ae.removeEditorTabByIndex,editorTabs:S.map(z.F),handleDeclarationNavigate:ae.handleDeclarationNavigate,handleEditorUpdateBreakpoints:ae.handleEditorUpdateBreakpoints,editorSessionId:"",getTimerDuration:Z,isPlaying:y===O.PO.playing,isRecording:E===O.bl.recording},ne={label:"Data Visualizer",iconName:b.d.EYE_OPEN,body:(0,p.jsx)(sa.Z,{}),id:le.B.dataVisualizer},ie={label:"Env Visualizer",iconName:b.d.GLOBE,body:(0,p.jsx)(na.Z,{workspaceLocation:Pc}),id:le.B.envVisualizer},re=(0,o.useMemo)((()=>({handleBrowseHistoryDown:()=>F((0,ue.browseReplHistoryDown)(Pc)),handleBrowseHistoryUp:()=>F((0,ue.browseReplHistoryUp)(Pc)),handleReplValueChange:e=>F((0,ue.updateReplValue)(e,Pc)),handleDeleteSourcecastEntry:e=>F((0,Ic.deleteSourcecastEntry)(e,Ec)),handleResetInputs:e=>F((0,Ic.resetInputs)(e,Pc)),handleSaveSourcecastData:(e,t,a,s,n)=>F((0,ta.saveSourcecastData)(e,t,a,s,n,Ec)),handleSetSourcecastData:(e,t,a,s,n)=>F((0,ta.setSourcecastData)(e,t,a,s,n,Ec)),handleTimerPause:()=>F((0,Ic.timerPause)(Pc)),handleTimerReset:()=>F((0,Ic.timerReset)(Pc)),handleTimerResume:e=>F((0,Ic.timerResume)(e,Pc)),handleTimerStart:()=>F((0,Ic.timerStart)(Pc)),handleTimerStop:()=>F((0,Ic.timerStop)(Pc))})),[F]),oe={controlBarProps:{editorButtons:[J,Q]},editorContainerProps:se,handleSideContentHeightChange:e=>F((0,ue.changeSideContentHeight)(e,Pc)),replProps:{output:T,replValue:N,handleBrowseHistoryDown:re.handleBrowseHistoryDown,handleBrowseHistoryUp:re.handleBrowseHistoryUp,handleReplEval:W,handleReplValueChange:re.handleReplValueChange,sourceChapter:i,sourceVariant:l,externalLibrary:j,replButtons:[te,ee]},sideBarProps:{tabs:[]},sideContentHeight:L,sideContentProps:{onChange:e=>{t(e),E===O.bl.recording&&X({time:Z(),type:"activeTabChange",data:e})},selectedTabId:e,tabs:{beforeDynamicTabs:[{label:"Recording Panel",iconName:b.d.COMPASS,body:(0,p.jsxs)("div",{children:[(0,p.jsx)("span",{className:"Multi-line",children:(0,p.jsxs)(n.SU,{children:[" ",Nc," "]})}),(0,p.jsx)(Tc,{currentPlayerTime:h,editorValue:S[0].value,getTimerDuration:Z,playbackData:P,handleRecordInit:()=>{const e={chapter:i,externalLibrary:j,editorValue:S[0].value};F((0,Ic.recordInit)(e,Pc))},handleRecordPause:()=>X({time:Z(),type:"forcePause",data:null}),handleResetInputs:re.handleResetInputs,handleSaveSourcecastData:re.handleSaveSourcecastData,handleSetSourcecastData:re.handleSetSourcecastData,handleSetIsEditorReadonly:q,handleTimerPause:re.handleTimerPause,handleTimerReset:re.handleTimerReset,handleTimerResume:re.handleTimerResume,handleTimerStart:re.handleTimerStart,handleTimerStop:re.handleTimerStop,recordingStatus:E})]}),id:le.B.sourcereel},{label:"Sourcecast Table",iconName:b.d.EDIT,body:(0,p.jsx)("div",{children:(0,p.jsx)(pa,{handleDeleteSourcecastEntry:re.handleDeleteSourcecastEntry,sourcecastIndex:v,courseId:a})}),id:le.B.introduction},ne,ie],afterDynamicTabs:[]},workspaceLocation:Pc}},ce=(0,o.useMemo)((()=>({handleSetCurrentPlayerTime:e=>F((0,ta.setCurrentPlayerTime)(e,Ec)),handleSetCodeDeltasToApply:e=>F((0,ta.setCodeDeltasToApply)(e,Ec)),handleSetInputToApply:e=>F((0,ta.setInputToApply)(e,Ec)),handleSetSourcecastDuration:e=>F((0,ta.setSourcecastDuration)(e,Ec)),handlePromptAutocomplete:(e,t,a)=>F((0,ue.promptAutocomplete)(Pc,e,t,a))})),[F]),de={handleChapterSelect:_,handleEditorValueChange:H,handleExternalSelect:$,handleSetSourcecastStatus:K,handleSetIsEditorReadonly:q,audioUrl:d,currentPlayerTime:h,playbackData:P,playbackStatus:y,handleSetCurrentPlayerTime:ce.handleSetCurrentPlayerTime,handleSetCodeDeltasToApply:ce.handleSetCodeDeltasToApply,handleSetInputToApply:ce.handleSetInputToApply,handleSetSourcecastDuration:ce.handleSetSourcecastDuration,handlePromptAutocomplete:ce.handlePromptAutocomplete,duration:m};return(0,p.jsxs)("div",{className:r()("Sourcereel",s.Pyr),children:[E===O.bl.paused?(0,p.jsx)(ra,{...de}):void 0,(0,p.jsx)(he.Z,{...oe})]})};let Dc;!function(e){e.Default="Default",e.ObjectPlacement="ObjectPlacement",e.AssetUploader="AssetUploader",e.CheckpointSim="CheckpointSim",e.ChapterSim="ChapterSim"}(Dc||(Dc={}));const Rc=e=>async function(t,a){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{const i=function(e){const t=new Headers;return t.append("Accept","application/json"),t.append("Authorization",`Bearer ${e}`),t}(Eo.getInstance().getAccountInfo().accessToken||"");Object.entries(s).forEach((e=>{let[t,a]=e;i.append(t,a)}));const r={method:a,headers:i,...n};return fetch(g.Z.backendUrl+`/v2/courses/${ws()}/${e}/`+t,r)}finally{}},Bc=Rc("admin/assets"),Lc=Rc("stories"),Gc=Rc("admin/stories");const Uc=["locations","objects","images","avatars","ui","sfx","bgm","stories"];const Fc=async()=>(await Vc("stories")).filter((e=>e.startsWith("stories")&&e.endsWith("txt"))).map((e=>e.slice(8)));async function _c(){return(await Promise.all(Uc.map((async e=>{const t=await Vc(e);return t.length?t:[`${e}`]})))).reduce(((e,t)=>e.concat(t)),[])}async function Vc(e){const t=await Bc(e,"GET",{"Content-Type":"application/json"});return 200===t.status?t.json():[]}async function Hc(e,t){const a=await Promise.all(Array.from(e).map((async e=>{const a=await async function(e,t){const a=new FormData;a.set("upload",e);const s=await Bc(`${t}/${e.name}`,"POST",{},{body:a,mode:"cors"});return s?s.text():""}(e,t);return e.name+" => "+a})));return a.join("\n")}async function zc(){const e=await Lc("","GET"),t=200===e.status?await e.json():[];return S().sortBy(t,(e=>new Date(e.openAt)))}async function $c(e,t){const a=await Gc(e,"POST",{"Content-Type":"application/json"},{body:JSON.stringify(t)});return 200===a.status?"Chapter successfully created/updated":a.text()}const Xc="Specify own folder...",Wc=()=>{const[e,t]=o.useState(),[a,s]=o.useState(Uc[0]),[i,r]=o.useState(),[c,l]=o.useState(!1);function d(e){e.target.innerText&&(s(e.target.innerText),l(!1))}const h=(0,p.jsxs)(n.v2,{children:[Uc.map((e=>(0,p.jsx)(n.sN,{onClick:d,id:e,text:e},e))),(0,p.jsx)(n.sN,{onClick:function(e){e.target.innerText&&(s(e.target.innerText),l(!0))},id:Xc,text:Xc},Xc)]});return(0,p.jsxs)("div",{className:"LeftAlign",children:[(0,p.jsx)("h4",{children:"Choose Folder"}),(0,p.jsx)(da.p,{placement:v.Ly.BOTTOM,content:h,children:(0,p.jsx)(n.zx,{text:a})}),c&&(0,p.jsx)(n.BZ,{placeholder:"Or specify your own, e.g. 'locations/hallway'",onChange:function(e){r(e.target.value)}}),(0,p.jsx)("br",{}),(0,p.jsx)("h4",{children:"Choose File"}),(0,p.jsx)("input",{type:"file",multiple:!0,onChange:function(e){if(!e.target.files)return;const a=e.target.files;t(a)}}),(0,p.jsx)(n.zx,{onClick:async function(){const t=i||a;if(!e||!t)return;const s=await Hc(e,t);alert(s)},children:"Upload"})]})};function Kc(e,t){e&&e.forEach((e=>{t(e),Kc(e.childNodes,t)}))}function qc(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const s={};return e.forEach((e=>S().set(s,e.split("/"),"FILE"))),a.forEach((e=>{s[e]&&"FILE"!==s[e]||(s[e]=[])})),function e(a,s){return Object.keys(s).map((n=>{const i="/"+a.join("/")+"/"+n;return{id:i,label:n,secondaryLabel:t(i),childNodes:"FILE"===s[n]?void 0:e([...a,n],s[n])}}))}([],s)}const Zc=(0,o.memo)((e=>{let{assetPath:t}=e;const a=t||Fa.defaultAssetPath;return(0,p.jsx)("img",{alt:"asset",crossOrigin:"anonymous",src:Ss(a,!!t),width:"150px",onError:e=>{e.target.onerror=null,e.target.src=Ss(Fa.defaultAssetPath,!1)}})})),Yc=e=>(0,p.jsx)(C.u,{content:"Delete",children:(0,p.jsx)(n.JO,{icon:"trash",onClick:Jc(e)})}),Jc=e=>async()=>{const t=window.confirm(`Are you sure you want to delete ${e}?\nThere is no undoing this action!`);alert(t?await async function(e){const t=await Bc(e,"DELETE");return await t.text()||"Successfully Deleted"}(e):"Whew")},Qc=()=>{const{value:e}=(0,x.QT)(_c,[]),[t,a]=o.useState(""),[s,i]=o.useState({nodes:[]});o.useEffect((()=>{i({nodes:qc(e,Yc,Uc)})}),[e]);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(Zc,{assetPath:t}),(0,p.jsx)(n.mp,{contents:s.nodes,onNodeClick:e=>{Kc(s.nodes,(e=>e.isSelected=!1)),e.isSelected=!e.isSelected,e.isExpanded=!e.isExpanded;const t=e.id.toString();e.childNodes||(a(t),sessionStorage.setItem("selectedAsset",t)),i({...s})}})]})};var el=a(73074),tl=a(48919);const al=o.memo((0,tl.W8)((e=>{let{value:t}=e;return(0,p.jsx)("div",{children:(0,p.jsx)(n.zx,{children:t})})}))),sl=o.memo((0,tl.JN)((e=>{let{items:t}=e;return(0,p.jsx)("div",{children:t&&t.map(((e,t)=>(0,p.jsx)(al,{index:t,value:e},`item-${e}`)))})}))),nl=o.memo((e=>{let{chapterDetail:t,checkpointFilenames:a}=e;const{id:s}=t,{value:i,setValue:r,inputProps:c}=(0,x.Gl)(""),{value:l,setValue:d,inputProps:u}=(0,x.Gl)(""),{items:g,setItems:m,onSortEnd:y}=(()=>{const[e,t]=o.useState([]),a=o.useCallback((e=>{let{oldIndex:a,newIndex:s}=e;t((e=>(0,el.q)(e,a,s)))}),[]);return{items:e,setItems:t,onSortEnd:a}})(),[v,b]=o.useState(!1),[C,f]=o.useState(new Date),[S,j]=o.useState([]),[w,I]=o.useState(!1);o.useEffect((()=>{r(t.title),d(t.imageUrl),f(new Date(t.openAt)),m(t.filenames),b(t.isPublished),j((a||[]).filter((e=>!t.filenames.includes(e))))}),[t,m,d,f,r,a,w]);const k=o.useCallback((e=>{m((t=>t.filter((t=>t!==e)))),j((t=>[...t,e]))}),[m]),M=o.useCallback((e=>{m((t=>[...t,e])),j((t=>t.filter((t=>t!==e))))}),[m]);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("h4",{children:["Title: ",(0,p.jsx)("input",{className:"bp4-input",type:"text",...c})]}),(0,p.jsx)("b",{children:"Open date: "}),C&&(0,ge.gS)(C.toISOString()),(0,p.jsx)(He.M,{onChange:e=>{e&&f(e)}}),(0,p.jsxs)("h4",{children:["Image url: ",(0,p.jsx)("input",{className:"bp4-input",type:"text",...u}),(0,p.jsx)(n.zx,{onClick:e=>window.open(Ss(l,!0)),children:"View"})]}),(0,p.jsx)("b",{children:"Checkpoint Txt Files"}),(0,p.jsx)(sl,{items:g,onSortEnd:y}),(0,p.jsx)("br",{}),g.length>0&&(0,p.jsx)(n.zx,{icon:"delete",onClick:()=>g.map(k),children:"Clear checkpoint files"}),(0,p.jsx)("br",{}),(0,p.jsx)("b",{children:"All Txt Files"}),S&&S.map((e=>(0,p.jsx)("div",{children:(0,p.jsx)(n.zx,{onClick:()=>M(e),icon:"add",children:e})},`choice-${e}`))),(0,p.jsx)("br",{}),(0,p.jsx)(n.zx,{icon:"play",onClick:async()=>{Eo.getInstance().setChapterSimStack(g),await qr()},children:"Simulate Chapter"}),(0,p.jsx)("br",{}),(0,p.jsx)("br",{}),(0,p.jsx)(n.rs,{checked:v,labelElement:"Published",onChange:()=>b(!v)}),(0,p.jsx)(n.zx,{onClick:async()=>{const e={openAt:C.toISOString(),closeAt:il(C).toISOString(),title:i,filenames:g,imageUrl:l,isPublished:v};if(!window.confirm(`Are you sure you want to save changes to ${JSON.stringify(e)}`))return;const t=parseInt(s)===rl?await $c("",{story:e}):await $c(s,{story:e});alert(t)},children:"Save Changes"}),(0,p.jsx)(n.zx,{intent:h.S.WARNING,onClick:()=>{window.confirm("Are you you want to clear changes for this chapter?")&&(I(!w),alert("Cleared changes"))},children:"Clear Changes"}),(0,p.jsx)("br",{}),(0,p.jsx)("br",{}),(0,p.jsx)(n.zx,{icon:"trash",intent:h.S.DANGER,onClick:async()=>{if(window.confirm("Are you sure you want to delete this chapter?")){const e=await async function(e){const t=await Gc(e,"DELETE");return 204===t.status?"Chapter successfully deleted":t.text()}(s);alert(e)}},children:"Delete Chapter"})]})})),il=e=>(e.setFullYear(e.getFullYear()+1),e),rl=-1,ol={id:rl,title:"title goes here",imageUrl:"/locations/telebay/emergency.png",openAt:(new Date).toISOString(),closeAt:il(new Date).toISOString(),isPublished:!1,filenames:[]},cl=o.memo((()=>{const{value:e}=(0,x.QT)(Fc,[]),{value:t}=(0,x.QT)(zc,[]),[a,s]=o.useState(rl);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("h3",{children:"Chapter Simulator"}),(0,p.jsxs)("select",{className:"bp4-menu",onChange:e=>s(e.target.value),children:[t.map(((e,t)=>(0,p.jsx)("option",{value:t,children:`Chapter ${t}: ${e.title}`},t))),(0,p.jsx)("option",{value:rl,children:"Create new chapter"},rl)]}),(0,p.jsx)("hr",{}),(0,p.jsx)(nl,{chapterDetail:t[a]||ol,checkpointFilenames:e})]})})),ll={key:Ua.zektonDarkFont.key,size:35,align:Phaser.GameObjects.BitmapText.ALIGN_CENTER},dl={maxOptButtonsRow:2,optButton:{xSpace:.9*_a.x,ySpace:.5*_a.y},gameTxtStorageName:{defaultChapter:"defaultChapter",checkpointTxt:"checkpointTxt"}};a(25351);const hl=(e,t)=>{const a=new FileReader;a.readAsText(t),a.onloadend=t=>{a.result&&sessionStorage.setItem(e,a.result.toString())}},ul=function(e){let{storageName:t,s3TxtFiles:a}=e;const[s,i]=o.useState(a[0]),r=(0,p.jsx)("input",{type:"file",onChange:function(e){if(!e.target.files)return;const[a]=e.target.files;hl(t,a)},style:{width:"250px"}}),c=(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("select",{className:"bp4-menu",onChange:async function(e){const a=e.target.value;i(a);const s=await fetch(Ss(`/stories/${a}`,!0),{headers:gl()}),n=await s.text();sessionStorage.setItem(t,n)},children:a.map((e=>(0,p.jsx)("option",{value:e,children:e},e)))}),(0,p.jsx)(n.zx,{icon:"download",onClick:()=>window.open(hr(s))})]});return(0,p.jsxs)("div",{className:"LeftAlign",children:[(0,p.jsx)("hr",{}),(0,p.jsxs)(n.mQ,{id:"Tabs",renderActiveTabPanelOnly:!0,children:[(0,p.jsx)(n.OK,{id:"own",title:"Local",panel:r}),(0,p.jsx)(n.OK,{id:"s3",title:"S3",panel:c})]},"vertical"),(0,p.jsx)("hr",{})]})};function gl(){const e=new Headers;return e.append("Access-Control-Allow-Origin","*"),e}function pl(){const{value:e}=(0,x.QT)(Fc,[]);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("h3",{children:"Checkpoint Text Loader"}),(0,p.jsx)("b",{children:"Step 1: Choose default checkpoint"}),(0,p.jsx)(ul,{s3TxtFiles:e,storageName:dl.gameTxtStorageName.defaultChapter}),(0,p.jsx)("b",{children:"Step 2: Choose checkpoint text"}),(0,p.jsx)(ul,{s3TxtFiles:e,storageName:dl.gameTxtStorageName.checkpointTxt}),(0,p.jsx)("br",{}),(0,p.jsx)(n.zx,{onClick:function(){Eo.getInstance().getCurrentSceneRef().simulateCheckpoint()},icon:"play",children:"Simulate Checkpoint"}),(0,p.jsx)("br",{}),(0,p.jsx)("br",{}),(0,p.jsx)(n.zx,{onClick:ml,children:"Reset All Files"}),(0,p.jsx)("br",{})]})}function ml(e){sessionStorage.setItem(dl.gameTxtStorageName.checkpointTxt,""),sessionStorage.setItem(dl.gameTxtStorageName.defaultChapter,"")}const xl={storySimBg:{type:hs.Image,key:"student-room",path:"/locations/deathCube_ext/shields-down.png"},shortButton:{type:hs.Image,key:"short-button",path:"/ui/shortButton.png"},invertedButton:{type:hs.Image,key:"inverted-button",path:"/ui/invertedColorButton.png"},blueUnderlay:{type:hs.Image,key:"blue-underlay",path:"/ui/blueUnderlay.png"},topButton:{type:hs.Image,key:"top-button",path:"/ui/topButton.png"},colorIcon:{type:hs.Image,key:"color-icon",path:"/ui/colorIcon.png"},imageIcon:{type:hs.Image,key:"image-icon",path:"/ui/imageIcon.png"},bboxIcon:{type:hs.Image,key:"bbox-icon",path:"/ui/bboxIcon.png"},handIcon:{type:hs.Image,key:"hand-icon",path:"/ui/handIcon.png"},listIcon:{type:hs.Image,key:"list-icon",path:"/ui/listIcon.png"},eraseIcon:{type:hs.Image,key:"erase-icon",path:"/ui/eraserIcon.png"},iconBg:{type:hs.Image,key:"icon-bg",path:"/ui/modeIconBg.png"}};class yl extends Phaser.Scene{constructor(){super("StorySimulatorMenu"),this.layerManager=void 0,this.getLayerManager=()=>js(this.layerManager)}preload(){Eo.getInstance().setCurrentSceneRef(this),this.layerManager=new Qn(this),Fn(this),Object.values(gs).forEach((e=>this.load.image(e.key,Ss(e.path,!1)))),Object.values(xl).forEach((e=>this.load.image(e.key,Ss(e.path,!1)))),Object.values(Ua).forEach((e=>this.load.bitmapFont(e.key,e.pngPath,e.fntPath))),Eo.getInstance().getSoundManager().loadSoundAssetMap(xs)}async create(){"student"!==Eo.getInstance().getAccountInfo().role?(this.renderBackground(),this.renderOptionButtons()):console.log("Students cannot use story sim")}renderOptionButtons(){const e=new Phaser.GameObjects.Container(this,0,0),t=this.getOptionButtons(),a=Xa({numOfItems:t.length,maxXSpace:dl.optButton.xSpace,maxYSpace:dl.optButton.ySpace,numItemLimit:dl.maxOptButtonsRow,redistributeLast:!0});e.add(t.map(((e,t)=>this.createOptButton(e.text,a[t][0],a[t][1],e.callback)))),this.getLayerManager().addToLayer(ys.UI,e)}getOptionButtons(){return[{text:"Object Placement",callback:()=>{Eo.getInstance().setStorySimState(Dc.ObjectPlacement),this.getLayerManager().clearAllLayers(),this.scene.start("ObjectPlacement")}},{text:"Checkpoint Simulator",callback:()=>{Eo.getInstance().setStorySimState(Dc.CheckpointSim)}},{text:"Asset Uploader",callback:()=>{Eo.getInstance().setStorySimState(Dc.AssetUploader)}},{text:"Chapter Simulator",callback:()=>{Eo.getInstance().setStorySimState(Dc.ChapterSim)}}]}createOptButton(e,t,a,s){return qs(this,{assetKey:xl.invertedButton.key,message:e,textConfig:{x:0,y:0,oriX:.5,oriY:.5},bitMapTextStyle:ll,onUp:s}).setPosition(t,a)}simulateCheckpoint(){const e=sessionStorage.getItem(dl.gameTxtStorageName.defaultChapter)||"",t=sessionStorage.getItem(dl.gameTxtStorageName.checkpointTxt)||"";if(""===e&&""===t)return;this.getLayerManager().clearAllLayers(),Wr.parse(e),t&&Wr.parse(t,!0);const a=Wr.checkpoint;this.scene.start("GameManager",{gameCheckpoint:a,chapterNum:-1,checkpointNum:-1})}renderBackground(){const e=new Phaser.GameObjects.Image(this,Va.x,Va.y,xl.storySimBg.key);e.setDisplaySize(_a.x,_a.y);const t=new Phaser.GameObjects.Image(this,Va.x,Va.y,xl.blueUnderlay.key).setAlpha(.5);this.getLayerManager().addToLayer(ys.Background,e),this.getLayerManager().addToLayer(ys.Background,t)}}const vl=yl;class bl{constructor(){this.backgroundAssetPath=void 0,this.objectPlacement=void 0,this.x=void 0,this.y=void 0,this.getObjectPlacement=()=>js(this.objectPlacement),this.x=Va.x,this.y=Va.y}initialise(e){this.objectPlacement=e}async loadBackground(){const e=sessionStorage.getItem("selectedAsset");if(!e||!e.startsWith("/locations/"))return;this.backgroundAssetPath=e;const t=`!${e}`;this.getObjectPlacement().addAsset(t,e);const a=await ir(this.getObjectPlacement(),t,Ss(e,!0));this.renderBackground(a)}renderBackground(e){if("!"!==e[0])return;this.getObjectPlacement().getLayerManager().clearLayerContents(ys.Background);const t=new Phaser.GameObjects.Image(this.getObjectPlacement(),Va.x,Va.y,e).setInteractive();this.getObjectPlacement().getLayerManager().addToLayer(ys.Background,t)}getBackgroundAssetPath(){return this.backgroundAssetPath}screenLog(){return this.backgroundAssetPath+"\n"}}let Cl;!function(e){e[e.DrawBBox=0]="DrawBBox",e[e.DragResizeObj=1]="DragResizeObj"}(Cl||(Cl={}));class fl{constructor(){this.checkpointTitle="boundingBoxes",this.objectPlacement=void 0,this.bboxBeingDrawn=void 0,this.startingCoordinates=void 0,this.bboxDetailMap=void 0,this.getObjectPlacement=()=>js(this.objectPlacement),this.bboxDetailMap=new Map}initialise(e){this.objectPlacement=e,this.addBBoxListeners(e)}addBBoxListeners(e){this.getObjectPlacement().getInputManager().registerEventListener("pointerdown",(()=>{this.getObjectPlacement().isCursorMode(Cl.DrawBBox)&&(this.bboxBeingDrawn=this.createNewBBox())})),this.getObjectPlacement().getInputManager().registerEventListener("pointerup",(()=>{if(this.getObjectPlacement().isCursorMode(Cl.DrawBBox)&&this.bboxBeingDrawn){if(this.bboxBeingDrawn.displayWidth<=2||this.bboxBeingDrawn.displayHeight<=2)return void this.bboxBeingDrawn.destroy();this.bboxBeingDrawn.x+=this.bboxBeingDrawn.displayWidth/2,this.bboxBeingDrawn.y+=this.bboxBeingDrawn.displayHeight/2,this.bboxBeingDrawn.setOrigin(.5),this.registerBBox(this.bboxBeingDrawn),e.input.setDraggable(this.bboxBeingDrawn),this.getObjectPlacement().setActiveSelection(this.bboxBeingDrawn),this.startingCoordinates=void 0,this.bboxBeingDrawn=void 0}}))}createNewBBox(){const[e,t]=this.getObjectPlacement().getCoordinates(),a=new Phaser.GameObjects.Rectangle(this.getObjectPlacement(),e,t,1,1,za.white).setOrigin(0).setAlpha(.1).setInteractive().setDataEnabled();return this.startingCoordinates=[e,t],this.getObjectPlacement().getLayerManager().addToLayer(ys.BBox,a),a}registerBBox(e){const t="bbox"+this.getObjectPlacement().generateItemIdNumber(),a={id:t,x:e.x,y:e.y,width:e.displayWidth,height:e.displayHeight};this.bboxDetailMap.set(t,a),e.data.set("itemId",t),e.data.set("type","bbox")}getLoggables(){return[...this.bboxDetailMap.values()]}getItemById(e){return this.bboxDetailMap.get(e)}resizeWhileBeingDrawn(e){if(!this.getObjectPlacement().isCursorMode(Cl.DrawBBox)||!this.startingCoordinates||!this.bboxBeingDrawn)return;const[t,a]=this.startingCoordinates,s=e.input.x,n=e.input.y;gn(this.bboxBeingDrawn,s-t,n-a)}checkpointTxtLog(){const e=[];return this.bboxDetailMap.forEach((t=>{const a=["+"+t.id,An.toIntString(t.x),An.toIntString(t.y),An.toIntString(t.width),An.toIntString(t.height)];e.push(a.join(", ")),e.push("    show_dialogue*(click)")})),e}setAttribute(e,t,a){const s=e.data.get("itemId"),n=this.bboxDetailMap.get(s);n&&(n[t]=a)}deleteAll(){this.bboxDetailMap.clear()}delete(e){const t=e.data.get("itemId");this.bboxDetailMap.delete(t)}}const Sl={icon:{bgSize:55,size:40,yInterval:15},alpha:{inactive:.7,hover:1,active:.9}};class jl extends Phaser.GameObjects.Container{constructor(e,t,a){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Cl.DragResizeObj;super(e,t,a),this.isModes=void 0,this.currCursorMode=void 0,this.cursorModes=void 0,this.currActiveModeIdx=void 0,this.currCursorMode=s,this.isModes=new Array,this.cursorModes=new Array,this.currActiveModeIdx=Fa.nullSequenceNumber}getCurrCursorMode(){return this.currCursorMode}setCursorMode(e){this.currCursorMode=e}addCursorMode(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Fa.nullFunction,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Fa.nullFunction,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Fa.nullFunction;const o=new Phaser.GameObjects.Container(e,0,0);this.isModes.push(a),this.cursorModes.push(o);const c=this.cursorModes.length-1,l=new Ya(e,0,0,s),d=qs(e,{assetKey:xl.iconBg.key,onUp:()=>{this.isModes[c]&&(this.currActiveModeIdx=c),n(),this.renderCursorModesContainer()},onHover:()=>{""!==s&&l.setVisible(!0),o.setAlpha(Sl.alpha.hover),i()},onOut:()=>{l.setVisible(!1);const e=c===this.currActiveModeIdx&&this.isModes[c];o.setAlpha(e?Sl.alpha.active:Sl.alpha.inactive),r()},onPointerMove:e=>{l.x=e.x-o.x-100,l.y=e.y-o.y-100},onHoverEffect:!1}),h=new Phaser.GameObjects.Sprite(e,0,0,t).setDisplaySize(Sl.icon.size,Sl.icon.size);d.add(h),o.add([d,l])}renderCursorModesContainer(){this.removeAll(!1);let e=0;this.cursorModes.forEach(((t,a)=>{t.setPosition(0,e);const s=a===this.currActiveModeIdx&&this.isModes[a];t.setAlpha(s?Sl.alpha.active:Sl.alpha.inactive),this.add(t),e+=Sl.icon.bgSize+Sl.icon.yInterval}))}}const wl={key:Ua.zektonFont.key,size:27,align:Phaser.GameObjects.BitmapText.ALIGN_LEFT};function Il(e){return e.split("/").pop().split(".")[0]}const kl=e=>"    "+e;class Ml{constructor(){this.detailMapContainer=void 0,this.objectPlacement=void 0,this.getObjectPlacement=()=>js(this.objectPlacement)}initialise(e){this.objectPlacement=e}printCheckpoint(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/locations/yourRoom-dim/normal.png",t=arguments.length>1?arguments[1]:void 0;const a=""===e?"default":Il(e),s=t.map((e=>{const t=e.checkpointTxtLog();if(!t)return"";return`${e.checkpointTitle}\n${t.map(kl).map(kl).join("\n")}`})),n=`\nstartingLoc: ${a}\n\nobjectives\n    talk\n\nlocations\n    ${a}, ${e}, ${An.toCapitalizedWords(e)}\n\n${a}\n    modes: explore\n    actions\n        show_dialogue(welcome)\n${s.map(kl).join("\n")}\n\ndialogues\n    welcome\n        Congrats on creating your scene\n    click\n        Invisible bounding box is right here\n`;alert("Chapter ready!"),console.log(n)}showDetailMap(e){this.detailMapContainer=new Phaser.GameObjects.Container(this.getObjectPlacement(),0,0),e.forEach((e=>{const t=new Phaser.GameObjects.Rectangle(this.getObjectPlacement(),e.x,e.y,400,210,za.darkBlue).setOrigin(0,.5).setAlpha(.9),a=Ja(this.getObjectPlacement(),this.formatObjectDetails(e),{x:e.x+20,y:e.y+10,oriX:0,oriY:.6},wl).setLetterSpacing(3);this.detailMapContainer.add([t,a])})),this.getObjectPlacement().add.existing(this.detailMapContainer)}formatObjectDetails(e){return Object.entries(e).map((e=>{let[t,a]=e;return`${t}: ${"number"===typeof a?An.toIntString(a):a.toString()}`})).join("\n")}hideDetailMap(){this.detailMapContainer&&this.detailMapContainer.destroy()}}class Al{constructor(){this.checkpointTitle="objects",this.objectPlacement=void 0,this.objectDetailMap=void 0,this.getObjectPlacement=()=>js(this.objectPlacement),this.objectDetailMap=new Map}initialise(e){this.objectPlacement=e,this.objectDetailMap=new Map}async loadObject(){const e=sessionStorage.getItem("selectedAsset");if(!e)return;const t=`#${e}`;this.getObjectPlacement().addAsset(t,e);const a=await ir(this.getObjectPlacement(),t,Ss(e,!0));this.renderObject(a)}renderObject(e){if("#"!==e[0])return;const t=new Phaser.GameObjects.Image(this.getObjectPlacement(),Va.x,Va.y,e).setInteractive().setDataEnabled();this.getObjectPlacement().input.setDraggable(t),this.getObjectPlacement().getLayerManager().addToLayer(ys.Objects,t),this.registerObject(e,t)}registerObject(e,t){const a=this.generateItemId(e,this.getObjectPlacement().generateItemIdNumber()),s={id:a,assetKey:e,assetPath:js(this.getObjectPlacement().getAssetPath(e)),x:Va.x,y:Va.y};this.objectDetailMap.set(a,s),t.data.set("itemId",a),t.data.set("type","object"),this.getObjectPlacement().setActiveSelection(t)}generateItemId(e,t){return`${Il(e)}${t}`}getLoggables(){return[...this.objectDetailMap.values()]}checkpointTxtLog(){return Array.from(this.objectDetailMap.values()).map((e=>{const t=["+"+e.id,e.assetPath,An.toIntString(e.x),An.toIntString(e.y)];return e.width&&(t.push(An.toIntString(e.width)),t.push(An.toIntString(e.height))),t.join(", ")}))}setAttribute(e,t,a){const s=e.data.get("itemId"),n=this.objectDetailMap.get(s);n&&(n[t]=a)}deleteAll(){this.objectDetailMap.clear()}delete(e){const t=e.data.get("itemId");this.objectDetailMap.delete(t)}}const Tl={activeSelectMargin:30,scaleFactor:1.02};class Pl{constructor(){this.activeSelection=void 0,this.activeSelectRect=void 0,this.objectPlacement=void 0,this.getObjectPlacement=()=>js(this.objectPlacement)}initialise(e){this.objectPlacement=e,this.trackDraggables(e),this.drawActiveSelectRect(),this.bindDeleteKey()}drawActiveSelectRect(){this.activeSelectRect=new Phaser.GameObjects.Rectangle(this.getObjectPlacement(),0,0,1,1,0).setAlpha(.3),this.getObjectPlacement().getLayerManager().addToLayer(ys.Selector,this.activeSelectRect)}trackDraggables(e){e.getInputManager().registerEventListener("drag",((t,a,s,n)=>{e.isCursorMode(Cl.DrawBBox)||(e.getCursorManager().setCursorMode(Cl.DragResizeObj),a.x=s,a.y=n),"object"===a.data.get("type")&&(e.setObjAttribute(a,"x",s),e.setObjAttribute(a,"y",n),this.setActiveSelection(a)),"bbox"===a.data.get("type")&&(e.setBBoxAttribute(a,"x",s),e.setBBoxAttribute(a,"y",n),this.setActiveSelection(a))}))}resizeActive(e){const t=this.getObjectPlacement();if(!this.activeSelection||!this.activeSelectRect)return;const a=e?Tl.scaleFactor:1/Tl.scaleFactor;!function(e,t){e.displayWidth*=t,e.displayHeight*=t}(this.activeSelection,a),this.activeSelectRect.displayHeight=this.activeSelection.displayHeight+Tl.activeSelectMargin,this.activeSelectRect.displayWidth=this.activeSelection.displayWidth+Tl.activeSelectMargin,"object"===this.activeSelection.data.get("type")&&(t.setObjAttribute(this.activeSelection,"width",Math.abs(this.activeSelection.displayWidth)),t.setObjAttribute(this.activeSelection,"height",Math.abs(this.activeSelection.displayHeight))),"bbox"===this.activeSelection.data.get("type")&&(t.setBBoxAttribute(this.activeSelection,"width",Math.abs(this.activeSelection.displayWidth)),t.setBBoxAttribute(this.activeSelection,"height",Math.abs(this.activeSelection.displayHeight)))}setActiveSelection(e){this.activeSelectRect&&(this.activeSelectRect.setAlpha(.3),this.activeSelection=e,this.activeSelectRect.x=e.x,this.activeSelectRect.y=e.y,this.activeSelectRect.displayHeight=e.displayHeight+Tl.activeSelectMargin,this.activeSelectRect.displayWidth=e.displayWidth+Tl.activeSelectMargin)}deselect(){this.activeSelectRect.setAlpha(0),this.activeSelection=void 0}bindDeleteKey(){[Phaser.Input.Keyboard.KeyCodes.BACKSPACE,Phaser.Input.Keyboard.KeyCodes.DELETE].forEach((e=>this.getObjectPlacement().getInputManager().registerKeyboardListener(e,"up",(()=>{this.deleteActiveSelection(),this.deselect()}))))}deleteActiveSelection(){if(this.activeSelection){switch(this.getType(this.activeSelection)){case"object":this.getObjectPlacement().deleteObj(this.activeSelection);break;case"bbox":this.getObjectPlacement().deleteBBox(this.activeSelection)}this.activeSelection.destroy()}}getType(e){var t;return null===(t=this.activeSelection)||void 0===t?void 0:t.data.get("type")}}const El={cursor:{x:100,y:100}};class Nl extends Phaser.Scene{constructor(){super("ObjectPlacement"),this.layerManager=void 0,this.inputManager=void 0,this.transformManager=void 0,this.cursorModes=void 0,this.bboxManager=void 0,this.objectManager=void 0,this.backgroundManager=void 0,this.logManager=void 0,this.assetMap=void 0,this.itemIdNumber=void 0,this.openBracket=void 0,this.closedBracket=void 0,this.getCursorManager=()=>js(this.cursorModes),this.getInputManager=()=>js(this.inputManager),this.getLayerManager=()=>js(this.layerManager),this.objectManager=new Al,this.bboxManager=new fl,this.backgroundManager=new bl,this.logManager=new Ml,this.transformManager=new Pl,this.cursorModes=void 0,this.itemIdNumber=0,this.assetMap=new Map}init(){this.layerManager=new Qn(this),this.inputManager=new Jn(this),this.objectManager=new Al,this.bboxManager=new fl,this.backgroundManager=new bl,this.logManager=new Ml,this.transformManager=new Pl,this.cursorModes=void 0,this.itemIdNumber=0,this.assetMap=new Map}create(){Eo.getInstance().setCurrentSceneRef(this),this.renderBackground(),this.createUIButtons(),this.backgroundManager.initialise(this),this.objectManager.initialise(this),this.bboxManager.initialise(this),this.transformManager.initialise(this),this.logManager.initialise(this),this.openBracket=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.OPEN_BRACKET),this.closedBracket=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.CLOSED_BRACKET)}update(){this.openBracket&&this.openBracket.isDown&&this.transformManager.resizeActive(!1),this.closedBracket&&this.closedBracket.isDown&&this.transformManager.resizeActive(!0),this.bboxManager.resizeWhileBeingDrawn(this)}createUIButtons(){const e=new Phaser.GameObjects.Container(this,0,0),t=new ji(this,(()=>{this.cleanUp(),Eo.getInstance().setStorySimState(Dc.Default),this.scene.start("StorySimulatorMenu")}));this.cursorModes=new jl(this,El.cursor.x,El.cursor.y),this.populateCursorModes(),e.add(this.cursorModes),e.add(t),this.getLayerManager().addToLayer(ys.UI,e)}renderBackground(){const e=new Phaser.GameObjects.Image(this,Va.x,Va.y,xl.storySimBg.key);e.setDisplaySize(_a.x,_a.y),this.getLayerManager().addToLayer(ys.Background,e)}populateCursorModes(){this.cursorModes&&(this.cursorModes.addCursorMode(this,xl.colorIcon.key,!1,"Set background",(async()=>await this.backgroundManager.loadBackground())),this.cursorModes.addCursorMode(this,xl.imageIcon.key,!1,"Add selected object",(async()=>await this.objectManager.loadObject())),this.cursorModes.addCursorMode(this,xl.bboxIcon.key,!0,"Draw bounding boxes",(()=>this.cursorModes.setCursorMode(Cl.DrawBBox))),this.cursorModes.addCursorMode(this,xl.handIcon.key,!0,"Drag or resize",(()=>this.cursorModes.setCursorMode(Cl.DragResizeObj))),this.cursorModes.addCursorMode(this,xl.listIcon.key,!1,"Print coordinates",(()=>this.logManager.printCheckpoint(this.backgroundManager.getBackgroundAssetPath(),[this.objectManager,this.bboxManager])),(()=>this.logManager.showDetailMap([...this.objectManager.getLoggables(),...this.bboxManager.getLoggables()])),(()=>this.logManager.hideDetailMap())),this.cursorModes.addCursorMode(this,xl.eraseIcon.key,!1,"Erase all",(()=>{window.confirm("Are you sure you want to delete?")&&(this.getLayerManager().clearSeveralLayers([ys.Background,ys.BBox,ys.Objects]),this.objectManager.deleteAll(),this.bboxManager.deleteAll(),this.transformManager.deselect(),this.renderBackground())})),this.cursorModes.renderCursorModesContainer())}getCoordinates(){return[this.input.x,this.input.y]}isCursorMode(e){return this.getCursorManager().getCurrCursorMode()===e}cleanUp(){this.getInputManager().clearListeners(),this.getLayerManager().clearAllLayers()}addAsset(e,t){this.assetMap.set(e,t)}getAssetPath(e){return this.assetMap.get(e)}generateItemIdNumber(){return this.itemIdNumber++}setActiveSelection(e){this.transformManager.setActiveSelection(e)}setObjAttribute(e,t,a){this.objectManager.setAttribute(e,t,a)}deleteObj(e){this.objectManager.delete(e)}setBBoxAttribute(e,t,a){this.bboxManager.setAttribute(e,t,a)}deleteBBox(e){this.bboxManager.delete(e)}}const Ol={debug:!0,type:Ga.CANVAS,width:_a.x,height:_a.y,physics:{default:"arcade"},scale:{mode:Ga.Scale.FIT,parent:"game-display"},fps:{target:24}},Dl=()=>{const e=new Eo(Ol,Po.Simulator);return e.scene.add("StorySimulatorMenu",vl,!0),e.scene.add("ObjectPlacement",Nl),e.scene.add("GameManager",Ui),e.scene.add("CheckpointTransition",so),e};const Rl=function(){const e=(0,x.ix)((e=>e.session)),[t,a]=o.useState(Dc.Default);return o.useEffect((()=>{Dl().setStorySimStateSetter(a)}),[]),o.useEffect((()=>{Eo.getInstance().setAccountInfo({accessToken:e.accessToken,refreshToken:e.refreshToken,role:e.role,name:e.name})}),[e]),(0,p.jsxs)("div",{className:"StorySimulatorWrapper",children:[(0,p.jsx)("div",{id:"game-display"}),(0,p.jsxs)("div",{className:"LeftAlign StorySimulatorPanel",children:[t===Dc.Default&&(0,p.jsx)("h3",{children:"Welcome to story simulator!"}),t===Dc.CheckpointSim&&(0,p.jsx)(pl,{}),t===Dc.ObjectPlacement&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("h3",{children:"Asset Selection"}),(0,p.jsx)(Qc,{})]}),t===Dc.AssetUploader&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("h3",{children:"Asset uploader"}),(0,p.jsx)(Wc,{}),(0,p.jsx)("h3",{children:"Asset Viewer"}),(0,p.jsx)(Qc,{})]}),t===Dc.ChapterSim&&(0,p.jsx)(cl,{})]})]})},Bl=[{field:"name"},{field:"NUS Net ID"},{field:"Assessment Xp"},{field:"Achievement Xp"}],Ll={resizable:!0,sortable:!0},Gl=(e,t,a,s)=>0===a?"(none)":t!==a?`(#${e*t-19} - #${e*t})`:`(#${e*t-19} - #${s})`,Ul=()=>{const e=(0,c.I0)(),t=(0,x.ix)((e=>e.session.allUserXp)),[a,s]=(0,o.useState)([]),[i,r]=(0,o.useState)(),[l,d]=(0,o.useState)({currPage:1,maxPages:1,rowCountString:"(none)",isBackDisabled:!0,isForwardDisabled:!0});(0,o.useEffect)((()=>{if(t){const e=t.map((e=>{const[t,a,s,n]=e;return{name:null!==t&&void 0!==t?t:"","NUS Net ID":null!==a&&void 0!==a?a:"","Assessment Xp":null!==s&&void 0!==s?s:"0","Achievement Xp":null!==n&&void 0!==n?n:"0"}}));s(e)}}),[t]);const h=(0,o.useCallback)((()=>{i&&i.exportDataAsCsv({fileName:`SA XP Count (${(new Date).toISOString()}).csv`,columnKeys:["name","NUS Net ID","Assessment Xp","Achievement Xp"]})}),[i]),g=(0,o.useCallback)((()=>{i&&i.sizeColumnsToFit()}),[i]),m=(0,o.useCallback)((e=>()=>{if(i)switch(e){case"first":return i.paginationGoToFirstPage();case"prev":return i.paginationGoToPreviousPage();case"next":return i.paginationGoToNextPage();case"last":return i.paginationGoToLastPage()}}),[i]),y=(0,o.useCallback)((()=>{if(i){const e=i.paginationGetTotalPages(),t=0===e?0:i.paginationGetCurrentPage()+1;d({currPage:t,maxPages:e,rowCountString:Gl(25,t,e,i.paginationGetRowCount()),isBackDisabled:0===e||1===t,isForwardDisabled:0===e||t===e})}}),[i,d]),v=(0,o.useCallback)((e=>{r(e.api),y()}),[r,y]),C=()=>(0,p.jsx)("div",{className:"grading-controls",children:(0,p.jsxs)("div",{className:"GridControls ag-grid-controls",children:[(0,p.jsx)("div",{style:{width:"130px"},className:"left-controls"}),(0,p.jsxs)("div",{className:"centre-controls",children:[(0,p.jsx)(n.zx,{icon:b.d.CHEVRON_BACKWARD,onClick:m("first"),minimal:!0,disabled:l.isBackDisabled}),(0,p.jsx)(n.zx,{icon:b.d.CHEVRON_LEFT,onClick:m("prev"),minimal:!0,disabled:l.isBackDisabled}),(0,p.jsxs)(n.zx,{className:"pagination-details hidden-xs",disabled:!0,minimal:!0,children:[(0,p.jsx)("div",{children:`Page ${l.currPage} of ${l.maxPages}`}),(0,p.jsx)("div",{children:l.rowCountString})]}),(0,p.jsx)(n.zx,{icon:b.d.CHEVRON_RIGHT,onClick:m("next"),minimal:!0,disabled:l.isForwardDisabled}),(0,p.jsx)(n.zx,{icon:b.d.CHEVRON_FORWARD,onClick:m("last"),minimal:!0,disabled:l.isForwardDisabled})]}),(0,p.jsx)("div",{className:"right-controls",children:(0,p.jsx)(n.zx,{icon:b.d.EXPORT,onClick:h,children:(0,p.jsx)("span",{className:"hidden-xs",children:"Export to CSV"})})})]})}),f=(0,p.jsx)(n.tR,{className:"Grading",description:"Fetching XP...",icon:(0,p.jsx)(n.$j,{size:n.Ey.LARGE})}),S=(0,p.jsxs)("div",{className:"Grading",children:[(0,p.jsx)(C,{}),(0,p.jsx)(n.iz,{}),(0,p.jsx)(oa.AgGridReact,{domLayout:"autoHeight",className:"ag-grid-parent ag-theme-balham",columnDefs:Bl,onGridReady:v,onPaginationChanged:y,onGridSizeChanged:g,defaultColDef:Ll,rowData:a,rowHeight:30,pagination:!0,paginationPageSize:20,suppressCellSelection:!0,suppressMovableColumns:!0,suppressPaginationPanel:!0})]});return(0,p.jsx)(ye.Z,{loadContentDispatch:()=>e((0,u.fetchAllUserXp)()),display:t?S:f,fullWidth:!1})},Fl=()=>{const e=(0,c.I0)();o.useEffect((()=>{e((0,u.fetchNotifications)()),e((0,u.fetchGradingOverviews)(!1))}),[e]);const t=(0,x.ix)((e=>e.session.agreedToResearch)),a=(0,x.ix)((e=>e.session.assessmentConfigurations)),s=(0,x.ix)((e=>e.session.enableGame)),n=(0,x.ix)((e=>e.session.role)),i=n!==d.uU.Student?[(0,p.jsx)(l.AW,{path:"groundcontrol",element:(0,p.jsx)(fc,{})},0),(0,p.jsx)(l.AW,{path:`grading/${w.R6}`,element:(0,p.jsx)(cc,{})},1),(0,p.jsx)(l.AW,{path:"xpcalculation",element:(0,p.jsx)(Ul,{})},2),(0,p.jsx)(l.AW,{path:"sourcereel",element:(0,p.jsx)(Oc,{})},3),(0,p.jsx)(l.AW,{path:"storysimulator",element:(0,p.jsx)(Rl,{})},4),(0,p.jsx)(l.AW,{path:"dashboard",element:(0,p.jsx)(La,{})},5)]:null;return(0,p.jsxs)("div",{className:"Academy",children:[g.Z.showResearchPrompt&&null===t&&(0,p.jsx)(m,{}),(0,p.jsxs)(l.Z5,{children:[null===a||void 0===a?void 0:a.map((e=>(0,p.jsx)(l.AW,{path:`${(0,de.q1)(e.type)}/${w._T}`,element:(0,p.jsx)(je,{assessmentConfiguration:e})},e.type))),s&&(0,p.jsx)(l.AW,{path:"game",element:(0,p.jsx)(Bo,{})}),(0,p.jsx)(l.AW,{path:"/notipreference",element:(0,p.jsx)(wc,{})}),(0,p.jsx)(l.AW,{path:"sourcecast/:sourcecastId?",element:(0,p.jsx)(ya,{})}),(0,p.jsx)(l.AW,{path:"achievements/*",element:(0,p.jsx)(Jt,{})}),(0,p.jsx)(l.AW,{path:"",element:(0,p.jsx)(l.Fg,{replace:!0,to:s?"game":a&&a.length>0?`${(0,de.q1)(a[0].type)}`:n===d.uU.Admin?"adminpanel":"/404"})}),i,n===d.uU.Admin&&(0,p.jsx)(l.AW,{path:"adminpanel",element:(0,p.jsx)(Da,{})}),(0,p.jsx)(l.AW,{path:"*",element:(0,p.jsx)(we.default,{})})]})]})},_l=()=>{const e=(0,c.I0)(),t=(0,l.s0)(),a=(0,x.ix)((e=>e.session.courseId)),{courseId:i}=(0,l.UO)(),d=null!=i?parseInt(i,10):void 0;return o.useEffect((()=>{if(null===i||void 0===i||!i.match(w.CJ))return t("/");void 0===d||Number.isNaN(d)||a===d||e((0,u.updateLatestViewedCourse)(d))}),[a,e,d,t,i]),Number.isNaN(d)?(0,p.jsx)(l.Fg,{to:"/"}):d===a?(0,p.jsx)(Fl,{}):(0,p.jsx)("div",{className:r()("Academy-switching-courses",s.Pyr),children:(0,p.jsx)(n.Zb,{className:s.W7H,children:(0,p.jsx)(n.tR,{description:"Switching courses...",icon:(0,p.jsx)(n.$j,{size:n.Ey.LARGE})})})})},Vl=_l;Vl.displayName="Academy";const Hl=_l},36896:(e,t,a)=>{a.r(t),a.d(t,{Component:()=>d,default:()=>h});var s=a(37305),n=a(51411),i=a(59118),r=a(81694),o=a.n(r),c=(a(72791),a(80184));const l=()=>(0,c.jsx)("div",{className:o()("NoPage",s.Pyr),"data-testid":"NotFound-Component",children:(0,c.jsx)(n.tR,{icon:i.d.ERROR,title:"404 Not Found",description:"The requested resource could not be found"})}),d=l;d.displayName="NotFound";const h=l},5602:(e,t,a)=>{e.exports=a.p+"static/media/default_cover_image.e2be07249bb127696687.jpg"}}]);
//# sourceMappingURL=842.bd21b321.chunk.js.map